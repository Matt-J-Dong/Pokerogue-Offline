var rh=Object.defineProperty;var p=(P,e)=>rh(P,"name",{value:e,configurable:!0});import{g as n,i as S,B as I,a as Tt,f as ye,p as Ot,r as it,P as pn,b as ve,N as Jt,t as Tl,c as ft,d as Sl,e as vl,h as ah,j as di,k as Et,l as es,m as Hi,n as Ss,o as Il,q as Ks,s as oh,U as lh,u as hh,v as ch,w as fn,x as oi,y as bs,z as dh,A as El,F as uh,C as ph,M as fh,D as gh,E as wt,T as mh,G as yh,H as Ch,I as bh,J as Th,K as Dt,L as Sh,O as Ae,Q as vh,R as Oo,S as Ih,V as Eh,W as xh}from"./index-BleBCbtu.js";import{M as at,U as L,a as me,b as V,T as x,P as Wi,g as _h,c as yt,d as At,e as Mt,C as Qe,f as ls,B as Pe,h as Te,i as wh,j as Oh,k as Vi,l as Ah,W as gt,G as vs,D as Z,m as Wt,s as dt,A as Ui,n as Xe,o as $e,p as Ye,q as pt,r as ct,t as Yi,u as xl,v as Re,w as Le,x as Ze,S as _l,y as as,z as wl,E as Ol,F as ws,H as Os,I as As,J as ks,K as Ct,L as It,N as Fe,O as xt,Q as oe,R as Se,V as kh,X as Ur,Y as Al,Z as ui,_ as ge,$ as Qt,a0 as Ms,a1 as Ge,a2 as kt,a3 as kl,a4 as pi,a5 as gn,a6 as fi,a7 as _e,a8 as Mh,a9 as Ml,aa as Yr,ab as Lh,ac as Ls,ad as pe,ae as Gr,af as Ll,ag as Dh,ah as Ph,ai as He,aj as Ds,ak as Bh,al as mn,am as ts,an as Hr,ao as H,ap as Rh,aq as Nh,ar as Fh,as as Vh,at as Ao,au as ko,av as Mo,aw as Uh,ax as Ki,ay as Dl,az as Yh,aA as Gh,aB as yn,aC as Hh,aD as ns,aE as Is,aF as Vt,aG as bt,aH as Wh,aI as jt,aJ as Pl,aK as Kh,aL as Kt,aM as je,aN as ys,aO as zh,aP as hs,aQ as jh,aR as Bl,aS as Ue,aT as gi,aU as Cn,aV as Rl,aW as zs,aX as li,aY as Xh,aZ as $h,a_ as Zh,a$ as qh,b0 as Qh,b1 as Nl,b2 as Jh,b3 as Fl,b4 as St,b5 as zt,b6 as zi,b7 as Ve,b8 as bn,b9 as js,ba as ji,bb as ut,bc as Lo,bd as ec,be as tc,bf as sc,bg as ic,bh as nc,bi as rc,bj as ac,bk as oc,bl as lc,bm as Vl,bn as hc,bo as Ts,bp as cc,bq as Ps,br as Ut,bs as Tn,bt as Do,bu as dc,bv as uc,bw as is,bx as pc,by as Xi,bz as Sn,bA as ss,bB as Xt,bC as Po,bD as fc,bE as Ul,bF as Pt,bG as gc,bH as Xs,bI as mi,bJ as mc,bK as yc,bL as Cc,bM as Bo,bN as Yl,bO as ps,bP as Gi,bQ as nt,bR as bc,bS as Tc,bT as Ys,bU as rs,bV as Sc,bW as hi,bX as vn,bY as Gl,bZ as Es,b_ as Hl,b$ as vc,c0 as Ic,c1 as Ec,c2 as Wl,c3 as Kl,c4 as xc,c5 as _c,c6 as wc,c7 as Ro,c8 as Oc,c9 as Ac,ca as yi,cb as $t,cc as kc,cd as Mc,ce as Lc,cf as Dc,cg as Pc,ch as Bc,ci as Rc,cj as Nc,ck as os,cl as Fc,cm as No,cn as zl,co as Ci,cp as Vc,cq as Uc,cr as Yc,cs as Gc,ct as Hc,cu as jl,cv as Wc,cw as Kc,cx as zc,cy as jc,cz as Xc,cA as $c,cB as Zc,cC as qc,cD as Qc,cE as Fo,cF as Jc,cG as ed,cH as td,cI as sd,cJ as id,cK as nd,cL as rd,cM as ad,cN as od,cO as ld,cP as hd,cQ as cd,cR as dd,cS as Vo,cT as ud,cU as pd,cV as fd,cW as Xl,cX as gd,cY as md,cZ as yd,c_ as Cd,c$ as $l,d0 as Zl,d1 as ql,d2 as $i,d3 as Ql,d4 as bd,d5 as Td,d6 as Sd,d7 as vd,d8 as Id,d9 as Uo,da as Ed,db as xd,dc as _d,dd as wd,de as Yo,df as Od,dg as Go,dh as Zi,di as $s,dj as Ad,dk as kd,dl as Md,dm as Ld,dn as Ho,dp as Dd,dq as Wo,dr as Pd,ds as Zs,dt as Bd,du as qi,dv as Rd,dw as Nd,dx as Qi,dy as Ko,dz as qs,dA as Fd,dB as Vd,dC as Ud,dD as Yd,dE as Gd,dF as Hd,dG as Wd,dH as Kd,dI as zd,dJ as ht,dK as zo,dL as jo,dM as jd,dN as Xd,dO as Ji,dP as $d,dQ as Zd,dR as Xo,dS as qd,dT as Qd,dU as en,dV as Qs,dW as Jd,dX as eu,dY as tu,dZ as su,d_ as iu,d$ as nu,e0 as ru,e1 as au,e2 as ou,e3 as tn,e4 as $o,e5 as lu,e6 as hu,e7 as cu,e8 as du,e9 as uu,ea as pu,eb as fu,ec as gu,ed as mu,ee as yu,ef as Cu,eg as Bt,eh as Zo,ei as bu,ej as Tu,ek as qo,el as Su,em as sn,en as Qo,eo as vu,ep as Iu,eq as Eu,er as xu,es as Jo}from"./loading-scene-B61qMQI9.js";const nn=!1,Kr=class Kr extends at{constructor(){super(L.MESSAGE),this.wordWrapWidth=1780}setup(){const e=this.getUi();this.textTimer=null,this.textCallbackTimer=null,this.bg=n.add.sprite(0,0,"bg",n.windowType),this.bg.setName("sprite-battle-msg-bg"),this.bg.setOrigin(0,1),e.add(this.bg),this.commandWindow=me(202,0,118,48),this.commandWindow.setName("window-command"),this.commandWindow.setOrigin(0,1),this.commandWindow.setVisible(!1),e.add(this.commandWindow),this.movesWindowContainer=n.add.container(0,0),this.movesWindowContainer.setName("moves-bg"),this.movesWindowContainer.setVisible(!1);const t=me(0,0,243,48);t.setName("moves-window"),t.setOrigin(0,1);const s=me(240,0,80,48,!1,!1,-1,132);s.setName("move-details-window"),s.setOrigin(0,1),this.movesWindowContainer.add([t,s]),e.add(this.movesWindowContainer);const i=n.add.container(12,-39);e.add(i);const r=V(0,0,"",x.MESSAGE,{maxLines:2,wordWrap:{width:this.wordWrapWidth}});i.add(r),this.message=r,this.nameBoxContainer=n.add.container(0,-16),this.nameBoxContainer.setVisible(!1),this.nameBox=n.add.nineslice(0,0,"namebox",n.windowType,72,16,8,8,5,5),this.nameBox.setOrigin(0,0),this.nameText=V(8,0,"Rival",x.MESSAGE,{maxLines:1}),this.nameBoxContainer.add(this.nameBox),this.nameBoxContainer.add(this.nameText),i.add(this.nameBoxContainer),this.initPromptSprite(i);const a=n.add.container(0,0);a.setVisible(!1),e.add(a),this.levelUpStatsContainer=a;const o=V(n.game.canvas.width/6-73,-94,"",x.WINDOW,{maxLines:6});o.setLineSpacing(S.resolvedLanguage==="ja"?25:5);let l="";for(const f of Wi)l+=`${S.t(_h(f))}
`;o.text=l,o.x-=o.displayWidth;const h=me(n.game.canvas.width/6,-100,80+o.displayWidth,100);h.setOrigin(1,0),a.add(h),a.add(o);const c=V(n.game.canvas.width/6-50,-94,`+
+
+
+
+
+`,x.WINDOW,{maxLines:6});c.setLineSpacing(S.resolvedLanguage==="ja"?25:5),a.add(c),this.levelUpStatsIncrContent=c;const d=yt(n.game.canvas.width/6-7,-94,"",x.WINDOW,{maxLines:6,lineSpacing:5});d.setLineSpacing(S.resolvedLanguage==="ja"?25:5),d.setOrigin(1,0),d.setAlign("right"),a.add(d),this.levelUpStatsValuesContent=d}show(e){return super.show(e),this.commandWindow.setVisible(!1),this.movesWindowContainer.setVisible(!1),this.message.setWordWrapWidth(this.wordWrapWidth),!0}processInput(e){const t=this.getUi();if(this.awaitingActionInput&&(e===I.CANCEL||e===I.ACTION)&&this.onActionInput){t.playSelect();const s=this.onActionInput;return this.onActionInput=null,s(),!0}return!1}clear(){super.clear()}showText(e,t,s,i,r,a){this.hideNameText(),super.showText(e,t,s,i,r,a)}showDialogue(e,t,s,i,r,a,o){t&&this.showNameText(t),super.showDialogue(e,t,s,i,r,a,o)}promptLevelUpStats(e,t,s){return new Promise(i=>{if(!n.showLevelUpStats)return i();const r=n.getPlayerParty()[e].stats;let a="";for(const o of Wi)a+=`${s?r[o]:r[o]-t[o]}
`;this.levelUpStatsValuesContent.text=a,this.levelUpStatsIncrContent.setVisible(!s),this.levelUpStatsContainer.setVisible(!0),this.awaitingActionInput=!0,this.onActionInput=()=>{if(!s)return this.promptLevelUpStats(e,[],!0).then(()=>i());this.levelUpStatsContainer.setVisible(!1),i()}})}promptIvs(e,t){return new Promise(s=>{n.executeWithSeedOffset(()=>{let i="";for(const r of Wi)i+=`${this.getIvDescriptor(t[r],r,e)}
`;this.levelUpStatsValuesContent.text=i,this.levelUpStatsIncrContent.setVisible(!1),this.levelUpStatsContainer.setVisible(!0),this.awaitingActionInput=!0,this.onActionInput=()=>{this.levelUpStatsContainer.setVisible(!1),s()}},e)})}getIvDescriptor(e,t,s){const i=n.getPokemonById(s).species.getRootSpeciesId(),r=n.gameData.dexData[i].ivs,a=n.uiTheme,o=p((l,h,c)=>{let d;return h?c===31?d=x.PERFECT_IV:d=x.SUMMARY_GREEN:d=x.WINDOW,`[color=${At(d,!1,a)}][shadow=${At(d,!0,a)}]${l}[/shadow][/color]`},"coloredText");return e>30?o(S.t("battleMessageUiHandler:ivBest"),e>r[t],e):e===30?o(S.t("battleMessageUiHandler:ivFantastic"),e>r[t],e):e>20?o(S.t("battleMessageUiHandler:ivVeryGood"),e>r[t],e):e>10?o(S.t("battleMessageUiHandler:ivPrettyGood"),e>r[t],e):e>0?o(S.t("battleMessageUiHandler:ivDecent"),e>r[t],e):o(S.t("battleMessageUiHandler:ivNoGood"),e>r[t],e)}showNameText(e){this.nameBoxContainer.setVisible(!0),this.nameText.setText(e),this.nameBox.width=this.nameText.displayWidth+16}hideNameText(){this.nameBoxContainer.setVisible(!1)}};p(Kr,"BattleMessageUiHandler");let In=Kr;const xs=class xs extends Mt{constructor(){super(L.FIGHT),this.fieldIndex=0,this.fromCommand=Qe.FIGHT,this.cursor2=0}setup(){const e=this.getUi();this.movesContainer=n.add.container(18,-38.7),this.movesContainer.setName(xs.MOVES_CONTAINER_NAME),e.add(this.movesContainer),this.moveInfoContainer=n.add.container(1,0),this.moveInfoContainer.setName("move-info"),e.add(this.moveInfoContainer),this.typeIcon=n.add.sprite(n.scaledCanvas.width-57,-36,Tt("types"),"unknown"),this.typeIcon.setVisible(!1),this.moveInfoContainer.add(this.typeIcon),this.moveCategoryIcon=n.add.sprite(n.scaledCanvas.width-25,-36,"categories","physical"),this.moveCategoryIcon.setVisible(!1),this.moveInfoContainer.add(this.moveCategoryIcon),this.ppLabel=V(n.scaledCanvas.width-70,-26,"PP",x.MOVE_INFO_CONTENT),this.ppLabel.setOrigin(0,.5),this.ppLabel.setVisible(!1),this.ppLabel.setText(S.t("fightUiHandler:pp")),this.moveInfoContainer.add(this.ppLabel),this.ppText=V(n.scaledCanvas.width-12,-26,"--/--",x.MOVE_INFO_CONTENT),this.ppText.setOrigin(1,.5),this.ppText.setVisible(!1),this.moveInfoContainer.add(this.ppText),this.powerLabel=V(n.scaledCanvas.width-70,-18,"POWER",x.MOVE_INFO_CONTENT),this.powerLabel.setOrigin(0,.5),this.powerLabel.setVisible(!1),this.powerLabel.setText(S.t("fightUiHandler:power")),this.moveInfoContainer.add(this.powerLabel),this.powerText=V(n.scaledCanvas.width-12,-18,"---",x.MOVE_INFO_CONTENT),this.powerText.setOrigin(1,.5),this.powerText.setVisible(!1),this.moveInfoContainer.add(this.powerText),this.accuracyLabel=V(n.scaledCanvas.width-70,-10,"ACC",x.MOVE_INFO_CONTENT),this.accuracyLabel.setOrigin(0,.5),this.accuracyLabel.setVisible(!1),this.accuracyLabel.setText(S.t("fightUiHandler:accuracy")),this.moveInfoContainer.add(this.accuracyLabel),this.accuracyText=V(n.scaledCanvas.width-12,-10,"---",x.MOVE_INFO_CONTENT),this.accuracyText.setOrigin(1,.5),this.accuracyText.setVisible(!1),this.moveInfoContainer.add(this.accuracyText);const t=1;this.moveInfoOverlay=new ls({delayVisibility:!0,scale:t,onSide:!0,right:!0,x:0,y:-ls.getHeight(t,!0),width:n.game.canvas.width/6+4,hideEffectBox:!0,hideBg:!0}),e.add(this.moveInfoOverlay),n.addInfoToggle(this.moveInfoOverlay),n.addInfoToggle(this)}show(e){super.show(e),this.fieldIndex=e.length?e[0]:0,this.fromCommand=e.length>1?e[1]:Qe.FIGHT;const t=this.getUi().getMessageHandler();return t.bg.setVisible(!1),t.commandWindow.setVisible(!1),t.movesWindowContainer.setVisible(!0),n.getCurrentPhase().getPokemon().tempSummonData.turnCount<=1?this.setCursor(0):this.setCursor(this.getCursor()),this.displayMoves(),this.toggleInfo(!1),this.active=!0,!0}processInput(e){const t=this.getUi();let s=!1;const i=this.getCursor();if(e===I.CANCEL||e===I.ACTION)if(e===I.ACTION)n.getCurrentPhase().handleCommand(this.fromCommand,i,!1)?s=!0:t.playError();else{const{battleType:r,mysteryEncounter:a}=n.currentBattle;(r!==Pe.MYSTERY_ENCOUNTER||!(a!=null&&a.skipToFightInput))&&(t.setMode(L.COMMAND,this.fieldIndex),s=!0)}else switch(e){case I.UP:i>=2&&(s=this.setCursor(i-2));break;case I.DOWN:i<2&&(s=this.setCursor(i+2));break;case I.LEFT:i%2===1&&(s=this.setCursor(i-1));break;case I.RIGHT:i%2===0&&(s=this.setCursor(i+1));break}return s&&t.playSelect(),s}toggleInfo(e){var t,s;e&&(this.movesContainer.setVisible(!1),(t=this.cursorObj)==null||t.setVisible(!1)),n.tweens.add({targets:[this.movesContainer,this.cursorObj],duration:ye(125),ease:"Sine.easeInOut",alpha:e?0:1}),e||(this.movesContainer.setVisible(!0),(s=this.cursorObj)==null||s.setVisible(!0))}isActive(){return this.active}getCursor(){return this.fieldIndex?this.cursor2:this.cursor}setCursor(e){const t=this.getUi();this.moveInfoOverlay.clear();const s=this.getCursor()!==e;if(s&&(this.fieldIndex?this.cursor2=e:this.cursor=e),!this.cursorObj){const o=this.fromCommand===Qe.TERA;this.cursorObj=n.add.image(0,0,o?"cursor_tera":"cursor"),this.cursorObj.setScale(o?.7:1),t.add(this.cursorObj)}const i=n.getCurrentPhase().getPokemon(),r=i.getMoveset(),a=e<r.length;if(a){const o=r[e],l=i.getMoveType(o.getMove()),h=Tt("types");this.typeIcon.setTexture(h,Te[l].toLowerCase()).setScale(.8);const c=o.getMove().category;this.moveCategoryIcon.setTexture("categories",wh[c].toLowerCase()).setScale(1);const d=o.getMove().power,f=o.getMove().accuracy,u=o.getMovePp(),C=u-o.ppUsed,g=Ot(C,2,"  "),v=Ot(u,2,"  ");this.ppText.setText(`${g}/${v}`),this.powerText.setText(`${d>=0?d:"---"}`),this.accuracyText.setText(`${f>=0?f:"---"}`);const m=C/u;let b=x.MOVE_PP_FULL;m>.25&&m<=.5?b=x.MOVE_PP_HALF_FULL:m>0&&m<=.25?b=x.MOVE_PP_NEAR_EMPTY:m===0&&(b=x.MOVE_PP_EMPTY),this.ppText.setColor(this.getTextColor(b,!1)),this.ppText.setShadowColor(this.getTextColor(b,!0)),this.moveInfoOverlay.show(o.getMove()),i.getOpponents().forEach(E=>{E.updateEffectiveness(this.getEffectivenessText(i,E,o))})}return this.typeIcon.setVisible(a),this.ppLabel.setVisible(a),this.ppText.setVisible(a),this.powerLabel.setVisible(a),this.powerText.setVisible(a),this.accuracyLabel.setVisible(a),this.accuracyText.setVisible(a),this.moveCategoryIcon.setVisible(a),this.cursorObj.setPosition(13+(e%2===1?100:0),-31+(e>=2?15:0)),s}getEffectivenessText(e,t,s){const i=t.getMoveEffectiveness(e,s.getMove(),!t.waveData.abilityRevealed,void 0,void 0,!0);if(i!==void 0)return`${i}x`}displayMoves(){const e=n.getCurrentPhase().getPokemon(),t=e.getMoveset();for(let s=0;s<4;s++){const i=V(s%2===0?0:100,s<2?0:16,"-",x.WINDOW);if(i.setName("text-empty-move"),s<t.length){const r=t[s];i.setText(r.getName()),i.setName(r.getName()),i.setColor(this.getMoveColor(e,r)??i.style.color)}this.movesContainer.add(i)}}getMoveColor(e,t){if(!n.typeHints)return;const s=e.getOpponents();return s.length<=0?void 0:s.map(r=>r.getMoveEffectiveness(e,t.getMove(),!r.waveData.abilityRevealed,void 0,void 0,!0)).sort((r,a)=>a-r).map(r=>Oh(r??0))[0]}clear(){super.clear();const e=this.getUi().getMessageHandler();this.clearMoves(),this.typeIcon.setVisible(!1),this.ppLabel.setVisible(!1),this.ppText.setVisible(!1),this.powerLabel.setVisible(!1),this.powerText.setVisible(!1),this.accuracyLabel.setVisible(!1),this.accuracyText.setVisible(!1),this.moveCategoryIcon.setVisible(!1),this.moveInfoOverlay.clear(),e.bg.setVisible(!0),this.eraseCursor(),this.active=!1}clearMoves(){this.movesContainer.removeAll(!0),n.getCurrentPhase().getPokemon().getOpponents().forEach(t=>{t.updateEffectiveness(void 0)})}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};p(xs,"FightUiHandler"),xs.MOVES_CONTAINER_NAME="moves";let En=xs;const zr=class zr extends Mt{constructor(){super(L.BALL),this.scale=.1666666667}setup(){const e=this.getUi();this.scale=Vi(x.WINDOW,n.uiTheme).scale;let t="";for(let r=0;r<Object.keys(n.pokeballCounts).length;r++)t+=`${Ah(r)}
`;t+="Cancel";const s=V(0,0,t,x.WINDOW,{align:"right",maxLines:6}),i=s.displayWidth;this.pokeballSelectContainer=n.add.container(n.game.canvas.width/6-51-Math.max(64,i),-49),this.pokeballSelectContainer.setVisible(!1),e.add(this.pokeballSelectContainer),this.pokeballSelectBg=me(0,0,50+Math.max(64,i),32+480*this.scale),this.pokeballSelectBg.setOrigin(0,1),this.pokeballSelectContainer.add(this.pokeballSelectBg),this.pokeballSelectContainer.add(s),s.setOrigin(0,0),s.setPositionRelative(this.pokeballSelectBg,42,9),s.setLineSpacing(this.scale*72),this.countsText=V(0,0,"",x.WINDOW,{maxLines:5}),this.countsText.setPositionRelative(this.pokeballSelectBg,18,9),this.countsText.setLineSpacing(this.scale*72),this.pokeballSelectContainer.add(this.countsText),this.setCursor(0)}show(e){return super.show(e),this.updateCounts(),this.pokeballSelectContainer.setVisible(!0),this.setCursor(this.cursor),!0}processInput(e){const t=this.getUi();let s=!1;const i=Object.keys(n.pokeballCounts).length;if(e===I.ACTION||e===I.CANCEL){const r=n.getCurrentPhase();s=!0,e===I.ACTION&&this.cursor<i?n.pokeballCounts[this.cursor]?r.handleCommand(Qe.BALL,this.cursor)&&(n.ui.setMode(L.COMMAND,r.getFieldIndex()),n.ui.setMode(L.MESSAGE),s=!0):t.playError():(t.setMode(L.COMMAND,r.getFieldIndex()),s=!0)}else switch(e){case I.UP:s=this.setCursor(this.cursor?this.cursor-1:i);break;case I.DOWN:s=this.setCursor(this.cursor<i?this.cursor+1:0);break}return s&&t.playSelect(),s}updateCounts(){this.countsText.setText(Object.values(n.pokeballCounts).map(e=>`x${e}`).join(`
`))}setCursor(e){const t=super.setCursor(e);return this.cursorObj||(this.cursorObj=n.add.image(0,0,"cursor"),this.pokeballSelectContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.pokeballSelectBg,12,15+(6+this.cursor*96)*this.scale),t}clear(){super.clear(),this.pokeballSelectContainer.setVisible(!1),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};p(zr,"BallUiHandler");let xn=zr;var Ke=(P=>(P[P.UNLOCKED=1]="UNLOCKED",P[P.ENABLED=2]="ENABLED",P))(Ke||{});const jr=class jr extends Phaser.GameObjects.Container{constructor(e,t,s,i,r){super(n,e,t),this.maxRows=r,this.totalRows=r,this.currentRow=0;const a=2;s=Math.max(s,4),this.bg=n.add.nineslice(0,0,"scroll_bar",void 0,s,i,a,a,a,a),this.bg.setOrigin(0,0),this.add(this.bg),this.handleBody=n.add.rectangle(1,1,s-2,4,11184810),this.handleBody.setOrigin(0,0),this.add(this.handleBody),this.handleBottom=n.add.nineslice(1,1,"scroll_bar_handle",void 0,s-2,2,2,0,0,0),this.handleBottom.setOrigin(0,0),this.add(this.handleBottom)}setScrollCursor(e){this.currentRow=e,this.updateHandlePosition()}setTotalRows(e){this.totalRows=e,this.handleBody.height=(this.bg.displayHeight-1-this.handleBottom.displayHeight)*this.maxRows/this.totalRows,this.updateHandlePosition(),this.setVisible(this.totalRows>this.maxRows)}updateHandlePosition(){this.handleBody.y=1+(this.bg.displayHeight-1-this.handleBottom.displayHeight)/this.totalRows*this.currentRow,this.handleBottom.y=this.handleBody.y+this.handleBody.displayHeight}};p(jr,"ScrollBar");let _t=jr;var ee=(P=>(P[P.ON=0]="ON",P[P.OFF=1]="OFF",P[P.EXCLUDE=2]="EXCLUDE",P[P.UNLOCKABLE=3]="UNLOCKABLE",P[P.ONE=4]="ONE",P[P.TWO=5]="TWO",P))(ee||{}),Je=(P=>(P[P.SINGLE=0]="SINGLE",P[P.MULTI=1]="MULTI",P[P.HYBRID=2]="HYBRID",P[P.RADIAL=3]="RADIAL",P))(Je||{}),we=(P=>(P[P.NUMBER=0]="NUMBER",P[P.COST=1]="COST",P[P.CANDY=2]="CANDY",P[P.IV=3]="IV",P[P.NAME=4]="NAME",P[P.CAUGHT=5]="CAUGHT",P[P.HATCHED=6]="HATCHED",P))(we||{});const Xr=class Xr{constructor(e,t,s=1){this.text=e||"",this.sprite=t,this.state=s}};p(Xr,"DropDownLabel");let se=Xr;const $r=class $r extends Phaser.GameObjects.Container{constructor(e,t){super(n),this.state=0,this.dir=-1,this.onColor=3390463,this.offColor=2565927,this.excludeColor=16733525,this.unlockableColor=16776960,this.oneColor=3390463,this.twoColor=3390463,this.val=e,Array.isArray(t)?this.labels=t:this.labels=t?[t]:[new se("")],this.currentLabelIndex=0;const s=this.labels[this.currentLabelIndex];this.state=s.state,this.text=V(0,0,s.text||"",x.TOOLTIP_CONTENT),this.text.setOrigin(0,.5),this.add(this.text);for(let i=0;i<this.labels.length;i++){const r=this.labels[i].sprite;r&&(this.add(r),r.setOrigin(0,.5),i!==this.currentLabelIndex&&r.setVisible(!1))}}setupToggleIcon(e,t){e===0?(this.toggle=n.add.sprite(0,0,"cursor"),this.toggle.setScale(.5),this.toggle.setOrigin(0,.5),this.toggle.setRotation(Math.PI/180*-90)):(this.toggle=n.add.sprite(0,0,"candy"),this.toggle.setScale(.3),this.toggle.setOrigin(0,.5)),this.add(this.toggle),this.toggle.setVisible(t),this.updateToggleIconColor()}updateToggleIconColor(){switch(this.state){case 0:this.toggle.setTint(this.onColor);break;case 1:this.toggle.setTint(this.offColor);break;case 2:this.toggle.setTint(this.excludeColor);break;case 3:this.toggle.setTint(this.unlockableColor);break;case 4:this.toggle.setTint(this.oneColor);break;case 5:this.toggle.setTint(this.twoColor);break}}toggleOptionState(){if(this.labels.length>1)return this.setCurrentLabel((this.currentLabelIndex+1)%this.labels.length);const e=this.state===0?1:0;return this.setOptionState(e)}setOptionState(e){const t=this.labels.findIndex(s=>s.state===e);return t!==-1&&t!==this.currentLabelIndex?this.setCurrentLabel(t):(this.state=e,this.updateToggleIconColor(),e)}setCurrentLabel(e){const t=this.labels[this.currentLabelIndex],s=this.labels[e];return s?(this.currentLabelIndex=e,this.state=s.state,this.updateToggleIconColor(),t.sprite&&(this.text.x-=t.sprite.displayWidth+2,t.sprite.setVisible(!1)),s.sprite&&(this.text.x+=s.sprite.displayWidth+2,s.sprite.setVisible(!0)),this.text.setText(s.text),this.state):this.state}setDirection(e){this.dir=e,this.toggle.flipX=this.dir===1}toggleDirection(){this.setDirection(this.dir*-1)}setLabelPosition(e,t){let s=e;for(let i=0;i<this.labels.length;i++){const r=this.labels[i];r.sprite&&(r.sprite.x=e,r.sprite.y=t,i===this.currentLabelIndex&&(s+=r.sprite.displayWidth+2))}this.text&&(this.text.x=s,this.text.y=t)}setTogglePosition(e,t){this.toggle&&(this.toggle.x=e,this.toggle.y=t)}getCurrentLabelX(){var e;return this.labels[this.currentLabelIndex].sprite?(e=this.labels[this.currentLabelIndex].sprite)==null?void 0:e.x:this.text.x}getWidth(){let e=0;const t=this.text.text;for(const s of this.labels){this.text.setText(s.text);const i=s.sprite?s.sprite.displayWidth+2:0;e=Math.max(e,this.text.displayWidth+i)}return this.text.setText(t),e}};p($r,"DropDownOption");let fe=$r;const Zr=class Zr extends Phaser.GameObjects.Container{constructor(e,t,s,i,r=1,a=2){super(n,e-7-5,t),this.dropDownType=1,this.cursor=0,this.lastCursor=-1,this.defaultCursor=0,this.lastDir=-1,this.totalOptions=0,this.maxOptions=0,this.shownOptions=0,this.tooManyOptions=!1,this.firstShown=0,this.optionHeight=0,this.optionSpacing=0,this.optionPaddingX=4,this.optionPaddingY=6,this.optionWidth=100,this.cursorOffset=0,this.optionWidth=100,this.optionHeight=7,this.optionSpacing=a,this.optionPaddingX=4,this.optionPaddingY=6,this.cursorOffset=7,this.options=s,this.dropDownType=r,this.onChange=i,this.cursorObj=n.add.image(this.optionPaddingX+3,0,"cursor"),this.cursorObj.setScale(.5),this.cursorObj.setOrigin(0,.5),this.cursorObj.setVisible(!1),(this.dropDownType===1||this.dropDownType===2)&&this.options.unshift(new fe("ALL",new se(S.t("filterBar:all"),void 0,this.checkForAllOn()?0:1))),this.maxOptions=19,this.totalOptions=this.options.length,this.tooManyOptions=this.totalOptions>this.maxOptions,this.shownOptions=this.tooManyOptions?this.maxOptions:this.totalOptions,this.defaultSettings=this.getSettings(),s.forEach((h,c)=>{const d=r!==0||h.state===0;h.setupToggleIcon(r,d),h.width=this.optionWidth,h.y=c*this.optionHeight+c*a+this.optionPaddingY;const f=7+this.optionPaddingX+3,u=this.optionHeight/2;h.setLabelPosition(f+8,u),r===0?h.setTogglePosition(f+3,u+1):h.setTogglePosition(f,u),c>=this.shownOptions&&(h.visible=!1),this.firstShown=0}),this.window=me(0,0,this.optionWidth,s[this.shownOptions-1].y+this.optionHeight+this.optionPaddingY,!1,!1,void 0,void 0,gt.XTHIN),this.add(this.window),this.add(s),this.add(this.cursorObj),this.setVisible(!1),this.tooManyOptions&&(this.dropDownScrollBar=new _t(this.window.width-3,5,5,this.window.height-10,1),this.add(this.dropDownScrollBar),this.dropDownScrollBar.setTotalRows(this.totalOptions),this.dropDownScrollBar.setScrollCursor(0))}getWidth(){return this.window?this.window.width:this.width}toggleVisibility(){this.setVisible(!this.visible)}setVisible(e){return super.setVisible(e),e&&this.autoSize(),this}resetCursor(){return this.dropDownType===2&&this.checkForAllOff()?this.setCursor(this.lastCursor):this.setCursor(this.defaultCursor)}setCursor(e){return this.tooManyOptions&&this.setLabels(e),this.cursor=e,e<0?(e=0,this.cursorObj.setVisible(!1),!1):e>=this.options.length?(e=this.options.length-1,this.cursorObj.y=this.options[e].y+3.5,this.cursorObj.setVisible(!0),!1):(this.cursorObj.y=this.options[e].y+3.5,this.cursorObj.setVisible(!0),this.dropDownType===2&&(this.lastCursor=e,this.onChange()),!0)}setLabels(e){e===0&&this.lastCursor===this.totalOptions-1?this.firstShown=0:e===this.totalOptions-1&&this.lastCursor===0?this.firstShown=this.totalOptions-this.shownOptions:e-this.firstShown>=this.shownOptions&&e>this.lastCursor?this.firstShown+=1:e<this.firstShown&&e<this.lastCursor&&(this.firstShown-=1),this.options.forEach((t,s)=>{t.y=(s-this.firstShown)*(this.optionHeight+this.optionSpacing)+this.optionPaddingY;const i=this.cursorOffset+this.optionPaddingX+3,r=this.optionHeight/2;t.setLabelPosition(i+8,r),this.dropDownType===0?t.setTogglePosition(i+3,r+1):t.setTogglePosition(i,r),s<this.firstShown||s>=this.firstShown+this.shownOptions?t.visible=!1:t.visible=!0}),this.dropDownScrollBar.setScrollCursor(e)}toggleOptionState(e=this.cursor){const t=this.options[e];if(this.dropDownType===1||this.dropDownType===2){const s=t.toggleOptionState();e===0?this.setAllOptions(s):s===0&&this.checkForAllOn()?this.options[0].setOptionState(0):this.options[0].setOptionState(1)}else this.dropDownType===0?t.state===1?(this.options.forEach(s=>{s.setOptionState(1),s.setDirection(-1),s.toggle.setVisible(!1)}),t.setOptionState(0),t.setDirection(this.lastDir),t.toggle.setVisible(!0)):(t.toggleDirection(),this.lastDir=this.options[this.cursor].dir):this.dropDownType===3&&t.toggleOptionState();this.onChange()}checkForAllOn(){return this.options.every((e,t)=>t===0||e.state===0)}checkForAllOff(){return this.options.every((e,t)=>t===0||e.state===1)}getVals(){if(this.dropDownType===1)return this.options.filter((e,t)=>t>0&&e.state===0).map(e=>e.val);if(this.dropDownType===2){const e=this.options.filter((t,s)=>s>0&&t.state===0).map(t=>t.val);return e.length>0?e:this.cursor===0?this.options.filter((t,s)=>s>0).map(t=>t.val):[this.options[this.cursor].val]}return this.dropDownType===3?this.options.map(e=>({val:e.val,state:e.state})):this.options.filter(e=>e.state===0).map(e=>({val:e.val,dir:e.dir}))}getSettings(){const e=[];for(let t=0;t<this.options.length;t++)e.push({val:this.options[t].val,state:this.options[t].state,cursor:this.cursor===t,dir:this.options[t].dir});return e}hasDefaultValues(){const e=this.getSettings(),t=p(s=>e.length===this.defaultSettings.length&&e.every((i,r)=>s.every(a=>i[a]===this.defaultSettings[r][a])),"compareValues");switch(this.dropDownType){case 1:case 3:return t(["val","state"]);case 2:return t(["val","state","cursor"]);case 0:return t(["val","state","dir"]);default:return!1}}resetToDefault(){if(this.defaultSettings.length>0){this.setCursor(this.defaultCursor),this.lastDir=-1;for(let e=0;e<this.options.length;e++)this.dropDownType===0?this.defaultSettings[e].state===1?(this.options[e].setOptionState(1),this.options[e].setDirection(-1),this.options[e].toggle.setVisible(!1)):(this.options[e].setOptionState(0),this.options[e].setDirection(-1),this.options[e].toggle.setVisible(!0)):this.defaultSettings[e]&&this.options[e].setOptionState(this.defaultSettings[e].state);this.onChange()}}setAllOptions(e){if(this.dropDownType!==0)for(const t of this.options)t.setOptionState(e)}selectAllOptions(){this.setAllOptions(0)}unselectAllOptions(){this.setAllOptions(1)}autoSize(){let e=0,t=0;for(let s=0;s<this.options.length;s++){const i=this.options[s].getWidth();i>e&&(e=i,t=this.options[s].getCurrentLabelX()??0)}this.window.width=e+t-this.window.x+9,this.tooManyOptions&&(this.window.width+=6,this.dropDownScrollBar.x=this.window.width-9),this.x+this.window.width>this.parentContainer.width&&(this.x=this.parentContainer.width-this.window.width)}};p(Zr,"DropDown");let et=Zr;const qr=class qr extends Phaser.GameObjects.Container{constructor(e){super(n,0,0),this.shinyIcons=[],this.cost=0,this.species=e;const t=n.gameData.getSpeciesDefaultDexAttr(e,!1,!0),s=n.gameData.getSpeciesDexAttrProps(e,t),i=n.add.image(2,5,"passive_bg");i.setOrigin(0,0),i.setScale(.75),i.setVisible(!1),this.add(i),this.starterPassiveBgs=i,this.icon=n.add.sprite(-2,2,e.getIconAtlasKey(s.formIndex,s.shiny,s.variant)),this.icon.setScale(.5),this.icon.setOrigin(0,0),this.icon.setFrame(e.getIconId(s.female,s.formIndex,s.shiny,s.variant)),this.checkIconId(s.female,s.formIndex,s.shiny,s.variant),this.icon.setTint(0),this.add(this.icon);for(let d=0;d<3;d++){const f=n.add.image(d*-3+12,2,"shiny_star_small");f.setScale(.5),f.setOrigin(0,0),f.setVisible(!1),this.shinyIcons.push(f)}this.add(this.shinyIcons);const r=V(1,2,"0",x.WINDOW,{fontSize:"32px"});r.setShadowOffset(2,2),r.setOrigin(0,0),r.setVisible(!1),this.add(r),this.label=r;const a=n.add.image(12,7,"ha_capsule");a.setOrigin(0,0),a.setScale(.5),a.setVisible(!1),this.add(a),this.hiddenAbilityIcon=a;const o=n.add.image(0,7,"favorite");o.setOrigin(0,0),o.setScale(.5),o.setVisible(!1),this.add(o),this.favoriteIcon=o;const l=n.add.image(0,12,"champion_ribbon");l.setOrigin(0,0),l.setScale(.5),l.setVisible(!1),this.add(l),this.classicWinIcon=l;const h=n.add.image(12,12,"candy");h.setOrigin(0,0),h.setScale(.25),h.setVisible(!1),this.add(h),this.candyUpgradeIcon=h;const c=n.add.image(12,12,"candy_overlay");c.setOrigin(0,0),c.setScale(.25),c.setVisible(!1),this.add(c),this.candyUpgradeOverlayIcon=c}checkIconId(e,t,s,i){this.icon.frame.name!==this.species.getIconId(e,t,s,i)&&(console.log(`${this.species.name}'s variant icon does not exist. Replacing with default.`),this.icon.setTexture(this.species.getIconAtlasKey(t,!1,i)),this.icon.setFrame(this.species.getIconId(e,t,!1,i)))}};p(qr,"StarterContainer");let _n=qr;var be=(P=>(P[P.GEN=0]="GEN",P[P.TYPES=1]="TYPES",P[P.BIOME=2]="BIOME",P[P.CAUGHT=3]="CAUGHT",P[P.UNLOCKS=4]="UNLOCKS",P[P.MISC=5]="MISC",P[P.SORT=6]="SORT",P))(be||{});const Qr=class Qr extends Phaser.GameObjects.Container{constructor(e,t,s,i,r=6,a=6,o=8){super(n,e,t),this.labels=[],this.dropDowns=[],this.columns=[],this.numFilters=0,this.openDropDown=!1,this.lastCursor=-1,this.width=s,this.height=i,this.leftPaddingX=r,this.rightPaddingX=a,this.cursorOffset=o,this.window=me(0,0,s,i,!1,!1,void 0,void 0,gt.THIN),this.add(this.window),this.cursorObj=n.add.image(1,1,"cursor"),this.cursorObj.setScale(.5),this.cursorObj.setVisible(!1),this.cursorObj.setOrigin(0,0),this.add(this.cursorObj)}addFilter(e,t,s){if(this.columns.includes(e))return!1;this.columns.push(e);const i=V(0,3,t,x.TOOLTIP_CONTENT);return this.labels.push(i),this.add(i),this.dropDowns.push(s),this.add(s),this.calcFilterPositions(),this.numFilters++,!0}getFilter(e){return this.dropDowns[this.columns.indexOf(e)]}getColumn(e){return this.columns[e]}updateFilterLabels(){for(let e=0;e<this.numFilters;e++)this.dropDowns[e].hasDefaultValues()?this.labels[e].setColor(At(x.TOOLTIP_CONTENT,!1,n.uiTheme)):this.labels[e].setColor(At(x.STATS_LABEL,!1,n.uiTheme))}calcFilterPositions(){let e=this.leftPaddingX+this.rightPaddingX+this.cursorOffset;this.labels.forEach(s=>{e+=s.displayWidth+this.cursorOffset});const t=(this.width-e)/(this.labels.length-1);for(let s=0;s<this.labels.length;s++){if(s===0)this.labels[s].x=this.leftPaddingX+this.cursorOffset;else{const i=this.labels[s-1].x+this.labels[s-1].displayWidth;this.labels[s].x=i+t+this.cursorOffset}this.dropDowns[s].x=this.labels[s].x-this.cursorOffset-this.leftPaddingX,this.dropDowns[s].y=this.height}}offsetHybridFilters(){for(let e=0;e<this.dropDowns.length;e++)this.dropDowns[e].dropDownType===Je.HYBRID&&(this.dropDowns[e].autoSize(),this.dropDowns[e].x=-this.dropDowns[e].getWidth(),this.dropDowns[e].y=0)}setCursor(e){this.lastCursor>-1&&this.dropDowns[this.lastCursor].visible&&(this.dropDowns[this.lastCursor].setVisible(!1),this.dropDowns[e].setVisible(!0),this.dropDowns[e].resetCursor()),this.cursorObj.setPosition(this.labels[e].x-this.cursorOffset+2,6),this.lastCursor=e}toggleDropDown(e){this.dropDowns[e].toggleVisibility(),this.openDropDown=this.dropDowns[e].visible,this.dropDowns[e].resetCursor()}hideDropDowns(){this.dropDowns.forEach(e=>{e.setVisible(!1)}),this.openDropDown=!1}incDropDownCursor(){return this.dropDowns[this.lastCursor].cursor===this.dropDowns[this.lastCursor].options.length-1?this.dropDowns[this.lastCursor].setCursor(0):this.dropDowns[this.lastCursor].setCursor(this.dropDowns[this.lastCursor].cursor+1)}decDropDownCursor(){return this.dropDowns[this.lastCursor].cursor===0?this.dropDowns[this.lastCursor].setCursor(this.dropDowns[this.lastCursor].options.length-1):this.dropDowns[this.lastCursor].setCursor(this.dropDowns[this.lastCursor].cursor-1)}toggleOptionState(){this.dropDowns[this.lastCursor].toggleOptionState()}getVals(e){return this.getFilter(e).getVals()}resetSelection(e){this.dropDowns[e].resetToDefault(),this.updateFilterLabels()}setValsToDefault(){for(const e of this.dropDowns)e.resetToDefault()}getNearestFilter(e){const t=e.x+e.icon.displayWidth/2;let s=0,i=1e3;for(let r=0;r<this.labels.length;r++){const a=Math.abs(t-(this.labels[r].x+this.labels[r].displayWidth/3));a<i&&(s=r,i=a)}return s}};p(Qr,"FilterBar");let bi=Qr;const el={en:{starterInfoTextSize:"56px",instructionTextSize:"38px"},de:{starterInfoTextSize:"48px",instructionTextSize:"35px",starterInfoXPos:33},"es-ES":{starterInfoTextSize:"52px",instructionTextSize:"35px"},"es-MX":{starterInfoTextSize:"52px",instructionTextSize:"35px"},fr:{starterInfoTextSize:"54px",instructionTextSize:"38px"},it:{starterInfoTextSize:"56px",instructionTextSize:"38px"},pt_BR:{starterInfoTextSize:"47px",instructionTextSize:"38px",starterInfoXPos:33},zh:{starterInfoTextSize:"47px",instructionTextSize:"38px",starterInfoYOffset:1,starterInfoXPos:24},pt:{starterInfoTextSize:"48px",instructionTextSize:"42px",starterInfoXPos:33},ko:{starterInfoTextSize:"52px",instructionTextSize:"38px"},ja:{starterInfoTextSize:"51px",instructionTextSize:"38px"},"ca-ES":{starterInfoTextSize:"52px",instructionTextSize:"38px"}},tl=2,rn=17,Js=109,vt=285,ci=38,ei=34,Bs=107,sl=20;function wn(P,e=0){const i=P%9*18,r=13+(Math.floor(P/9)-e)*17;return{x:i,y:r}}p(wn,"calcStarterPosition$1");function Wr(P){const e=Bs/7,t=ci+e/2;return Math.round(t+e*P)}p(Wr,"calcStarterIconY");function il(P,e=6){let t=Bs,s=0;for(let i=0;i<e;i++){const r=Math.abs(P-(Wr(i)-13));r<t&&(s=i,t=r)}return s}p(il,"findClosestStarterIndex");function nl(P,e){const t=Wr(P)-13;let s=Bs,i=0;for(let r=0;r<e;r++){const a=Math.abs(t-wn(r*9).y);a<s&&(i=r,s=a)}return i}p(nl,"findClosestStarterRow");const Jr=class Jr extends at{constructor(){super(L.STARTER_SELECT),this.starterContainers=[],this.filteredStarterContainers=[],this.validStarterContainers=[],this.starterIconsCursorXOffset=-3,this.starterIconsCursorYOffset=1,this.dexAttrCursor=0n,this.abilityCursor=-1,this.natureCursor=-1,this.teraCursor=Te.UNKNOWN,this.filterBarCursor=0,this.allSpecies=[],this.speciesLoaded=new Map,this.starterSpecies=[],this.pokerusSpecies=[],this.starterAttr=[],this.starterAbilityIndexes=[],this.starterNatures=[],this.starterTeras=[],this.starterMovesets=[],this.instructionRowX=0,this.instructionRowY=0,this.instructionRowTextOffset=9,this.filterInstructionRowX=0,this.filterInstructionRowY=0,this.blockInput=!1,this.updateStarters=()=>{this.scrollCursor=0,this.filteredStarterContainers=[],this.validStarterContainers=[],this.pokerusCursorObjs.forEach(t=>t.setVisible(!1)),this.starterCursorObjs.forEach(t=>t.setVisible(!1)),this.filterBar.updateFilterLabels(),n.gameMode.modeId===vs.CHALLENGE?this.starterContainers.forEach(t=>{var r;const s=t.species;let i=!1;if(((r=s.forms)==null?void 0:r.length)>0)for(let a=0;a<s.forms.length;a++){if(!s.forms[a].isStarterSelectable)continue;const o=BigInt(Math.pow(2,a))*Z.DEFAULT_FORM,l=Wt(t.species,n.gameData.getSpeciesDexAttrProps(s,o),!0);i=i||l}else i=Wt(t.species,n.gameData.getSpeciesDexAttrProps(s,n.gameData.getSpeciesDefaultDexAttr(t.species,!1,!0)),!0);i?this.validStarterContainers.push(t):t.setVisible(!1)}):this.validStarterContainers=this.starterContainers;for(let t=0;t<this.validStarterContainers.length;t++){const s=this.validStarterContainers[t],i=s.icon,r=this.getCurrentDexProps(s.species.speciesId),a=n.gameData.getSpeciesDexAttrProps(s.species,r);i.setTexture(s.species.getIconAtlasKey(a.formIndex,a.shiny,a.variant),s.species.getIconId(a.female,a.formIndex,a.shiny,a.variant)),s.checkIconId(a.female,a.formIndex,a.shiny,a.variant)}this.validStarterContainers.forEach(t=>{var de,z;t.setVisible(!1),t.cost=n.gameData.getSpeciesStarterValue(t.species.speciesId);const s=((de=n.gameData.dexData[t.species.speciesId])==null?void 0:de.caughtAttr)||BigInt(0),i=n.gameData.starterData[t.species.speciesId],r=dt.hasOwnProperty(t.species.speciesId),a=this.filterBar.getVals(be.GEN).includes(t.species.generation),o=this.filterBar.getVals(be.TYPES).some(Y=>t.species.isOfType(Y-1)),l=!!(s&Z.NON_SHINY),h=!!(s&Z.SHINY),c=h&&!!(s&Z.DEFAULT_VARIANT),d=h&&!!(s&Z.VARIANT_2),f=h&&!!(s&Z.VARIANT_3),u=!l&&!c&&!d&&!f,C=this.filterBar.getVals(be.CAUGHT).some(Y=>{if(Y==="SHINY3")return f;if(Y==="SHINY2")return d&&!f;if(Y==="SHINY")return c&&!d&&!f;if(Y==="NORMAL")return l&&!c&&!d&&!f;if(Y==="UNCAUGHT")return u}),g=i.passiveAttr>0,v=this.isPassiveAvailable(t.species.speciesId)&&!g,m=this.filterBar.getVals(be.UNLOCKS).some(Y=>{if(Y.val==="PASSIVE"&&Y.state===ee.ON)return g;if(Y.val==="PASSIVE"&&Y.state===ee.EXCLUDE)return r&&!g;if(Y.val==="PASSIVE"&&Y.state===ee.UNLOCKABLE)return v;if(Y.val==="PASSIVE"&&Y.state===ee.OFF)return!0}),b=i.valueReduction===1,E=i.valueReduction===2,w=this.isValueReductionAvailable(t.species.speciesId),_=this.filterBar.getVals(be.UNLOCKS).some(Y=>{if(Y.val==="COST_REDUCTION"&&Y.state===ee.ON)return b||E;if(Y.val==="COST_REDUCTION"&&Y.state===ee.ONE)return b;if(Y.val==="COST_REDUCTION"&&Y.state===ee.TWO)return E;if(Y.val==="COST_REDUCTION"&&Y.state===ee.EXCLUDE)return r&&!(b||E);if(Y.val==="COST_REDUCTION"&&Y.state===ee.UNLOCKABLE)return w;if(Y.val==="COST_REDUCTION"&&Y.state===ee.OFF)return!0}),A=((z=this.starterPreferences[t.species.speciesId])==null?void 0:z.favorite)??!1,D=this.filterBar.getVals(be.MISC).some(Y=>{if(Y.val==="FAVORITE"&&Y.state===ee.ON)return A;if(Y.val==="FAVORITE"&&Y.state===ee.EXCLUDE)return!A;if(Y.val==="FAVORITE"&&Y.state===ee.OFF)return!0}),j=i.classicWinCount>0,B=i.classicWinCount===0,$=i.classicWinCount===void 0,ie=this.filterBar.getVals(be.MISC).some(Y=>{if(Y.val==="WIN"&&Y.state===ee.ON)return j;if(Y.val==="WIN"&&Y.state===ee.EXCLUDE)return B||$;if(Y.val==="WIN"&&Y.state===ee.OFF)return!0}),k=t.species.abilityHidden!==t.species.ability1&&t.species.abilityHidden!==Ui.NONE,U=i.abilityAttr&Xe.ABILITY_HIDDEN,T=this.filterBar.getVals(be.MISC).some(Y=>{if(Y.val==="HIDDEN_ABILITY"&&Y.state===ee.ON)return U;if(Y.val==="HIDDEN_ABILITY"&&Y.state===ee.EXCLUDE)return k&&!U;if(Y.val==="HIDDEN_ABILITY"&&Y.state===ee.OFF)return!0}),F=this.isSameSpeciesEggAvailable(t.species.speciesId),he=this.filterBar.getVals(be.MISC).some(Y=>{if(Y.val==="EGG"&&Y.state===ee.ON)return F;if(Y.val==="EGG"&&Y.state===ee.EXCLUDE)return r&&!F;if(Y.val==="EGG"&&Y.state===ee.OFF)return!0}),W=this.filterBar.getVals(be.MISC).some(Y=>{if(Y.val==="POKERUS"&&Y.state===ee.ON)return this.pokerusSpecies.includes(t.species);if(Y.val==="POKERUS"&&Y.state===ee.EXCLUDE)return!this.pokerusSpecies.includes(t.species);if(Y.val==="POKERUS"&&Y.state===ee.OFF)return!0});a&&o&&C&&m&&_&&D&&ie&&T&&he&&W&&this.filteredStarterContainers.push(t)}),this.starterSelectScrollBar.setTotalRows(Math.max(Math.ceil(this.filteredStarterContainers.length/9),1)),this.starterSelectScrollBar.setScrollCursor(0);const e=this.filterBar.getVals(be.SORT)[0];this.filteredStarterContainers.sort((t,s)=>{switch(e.val){case we.NUMBER:return(t.species.speciesId-s.species.speciesId)*-e.dir;case we.COST:return(t.cost-s.cost)*-e.dir;case we.CANDY:{const i=n.gameData.starterData[t.species.speciesId].candyCount,r=n.gameData.starterData[s.species.speciesId].candyCount;return(i-r)*-e.dir}case we.IV:{const i=n.gameData.dexData[t.species.speciesId].ivs.reduce((a,o)=>a+o,0)/n.gameData.dexData[t.species.speciesId].ivs.length,r=n.gameData.dexData[s.species.speciesId].ivs.reduce((a,o)=>a+o,0)/n.gameData.dexData[s.species.speciesId].ivs.length;return(i-r)*-e.dir}case we.NAME:return t.species.name.localeCompare(s.species.name)*-e.dir;case we.CAUGHT:return(n.gameData.dexData[t.species.speciesId].caughtCount-n.gameData.dexData[s.species.speciesId].caughtCount)*-e.dir;case we.HATCHED:return(n.gameData.dexData[t.species.speciesId].hatchedCount-n.gameData.dexData[s.species.speciesId].hatchedCount)*-e.dir}return 0}),this.updateScroll()},this.updateScroll=()=>{const s=this.scrollCursor*9,i=Math.min(this.filteredStarterContainers.length-1,s+9*9-1);this.starterSelectScrollBar.setScrollCursor(this.scrollCursor);let r=0;this.filteredStarterContainers.forEach((a,o)=>{var d;const l=wn(o,this.scrollCursor);if(a.setPosition(l.x,l.y),o<s||o>i){a.setVisible(!1),this.pokerusSpecies.includes(a.species)&&(this.pokerusCursorObjs[r].setPosition(l.x-1,l.y+1),this.pokerusCursorObjs[r].setVisible(!1),r++),this.starterSpecies.includes(a.species)&&(this.starterCursorObjs[this.starterSpecies.indexOf(a.species)].setPosition(l.x-1,l.y+1),this.starterCursorObjs[this.starterSpecies.indexOf(a.species)].setVisible(!1));return}a.setVisible(!0),this.pokerusSpecies.includes(a.species)&&(this.pokerusCursorObjs[r].setPosition(l.x-1,l.y+1),this.pokerusCursorObjs[r].setVisible(!0),r++),this.starterSpecies.includes(a.species)&&(this.starterCursorObjs[this.starterSpecies.indexOf(a.species)].setPosition(l.x-1,l.y+1),this.starterCursorObjs[this.starterSpecies.indexOf(a.species)].setVisible(!0));const h=a.species.speciesId;this.updateStarterValueLabel(a),a.label.setVisible(!0);const c=h&&n.gameData.dexData[h].caughtAttr&Z.SHINY?[Z.DEFAULT_VARIANT,Z.VARIANT_2,Z.VARIANT_3].filter(f=>!!(n.gameData.dexData[h].caughtAttr&f)):[];for(let f=0;f<3;f++){const u=c.length>f;a.shinyIcons[f].setVisible(u),u&&a.shinyIcons[f].setTint($e(c[f]===Z.DEFAULT_VARIANT?0:c[f]===Z.VARIANT_2?1:2))}a.starterPassiveBgs.setVisible(!!n.gameData.starterData[h].passiveAttr),a.hiddenAbilityIcon.setVisible(!!n.gameData.dexData[h].caughtAttr&&!!(n.gameData.starterData[h].abilityAttr&4)),a.classicWinIcon.setVisible(n.gameData.starterData[h].classicWinCount>0),a.favoriteIcon.setVisible(((d=this.starterPreferences[h])==null?void 0:d.favorite)??!1),n.candyUpgradeDisplay===0?(Ye[h]||(Ye[h]=["ffffff","ffffff"]),a.candyUpgradeIcon.setTint(pt(it(Ye[h][0]))),a.candyUpgradeOverlayIcon.setTint(pt(it(Ye[h][1]))),this.setUpgradeIcon(a)):n.candyUpgradeDisplay===1&&(a.candyUpgradeIcon.setVisible(!1),a.candyUpgradeOverlayIcon.setVisible(!1))})}}setup(){const e=this.getUi(),t=S.resolvedLanguage??"en",s=Object.keys(el).find(R=>t.includes(R))??"en",i=el[s];this.starterSelectContainer=n.add.container(0,-n.game.canvas.height/6),this.starterSelectContainer.setVisible(!1),e.add(this.starterSelectContainer);const r=n.add.rectangle(0,0,n.game.canvas.width/6,n.game.canvas.height/6,26720);r.setOrigin(0,0),this.starterSelectContainer.add(r);const a=n.add.image(0,0,"starter_select_bg");a.setOrigin(0,0),this.starterSelectContainer.add(a),this.shinyOverlay=n.add.image(6,6,"summary_overlay_shiny"),this.shinyOverlay.setOrigin(0,0),this.shinyOverlay.setVisible(!1),this.starterSelectContainer.add(this.shinyOverlay);const o=me(Js,rn+1,175,161),l=n.add.image(Js+1,rn+2,"starter_container_bg");l.setOrigin(0,0),this.starterSelectContainer.add(l),this.starterSelectContainer.add(me(vt,ci-sl,ei,sl,!0)),this.starterSelectContainer.add(me(vt,ci,ei,Bs)),this.starterSelectContainer.add(me(vt,ci+Bs,ei,ei,!0)),this.starterSelectContainer.add(o),this.filterBarContainer=n.add.container(0,0),this.filterBar=new bi(Math.min(Js,vt),1,210,rn);const h=[new fe(1,new se(S.t("starterSelectUiHandler:gen1"))),new fe(2,new se(S.t("starterSelectUiHandler:gen2"))),new fe(3,new se(S.t("starterSelectUiHandler:gen3"))),new fe(4,new se(S.t("starterSelectUiHandler:gen4"))),new fe(5,new se(S.t("starterSelectUiHandler:gen5"))),new fe(6,new se(S.t("starterSelectUiHandler:gen6"))),new fe(7,new se(S.t("starterSelectUiHandler:gen7"))),new fe(8,new se(S.t("starterSelectUiHandler:gen8"))),new fe(9,new se(S.t("starterSelectUiHandler:gen9")))],c=new et(0,0,h,this.updateStarters,Je.HYBRID);this.filterBar.addFilter(be.GEN,S.t("filterBar:genFilter"),c);const d=Object.keys(Te).filter(R=>Number.isNaN(Number(R))),f=[];d.forEach((R,ce)=>{if(ce===0||ce===19)return;const ne=n.add.sprite(0,0,Tt("types"));ne.setScale(.5),ne.setFrame(R.toLowerCase()),f.push(new fe(ce,new se("",ne)))}),this.filterBar.addFilter(be.TYPES,S.t("filterBar:typeFilter"),new et(0,0,f,this.updateStarters,Je.HYBRID,.5));const u=n.add.sprite(0,0,"shiny_icons");u.setOrigin(.15,.2),u.setScale(.6),u.setFrame(ct(0)),u.setTint($e(0));const C=n.add.sprite(0,0,"shiny_icons");C.setOrigin(.15,.2),C.setScale(.6),C.setFrame(ct(1)),C.setTint($e(1));const g=n.add.sprite(0,0,"shiny_icons");g.setOrigin(.15,.2),g.setScale(.6),g.setFrame(ct(2)),g.setTint($e(2));const v=[new fe("SHINY3",new se("",g)),new fe("SHINY2",new se("",C)),new fe("SHINY",new se("",u)),new fe("NORMAL",new se(S.t("filterBar:normal"))),new fe("UNCAUGHT",new se(S.t("filterBar:uncaught")))];this.filterBar.addFilter(be.CAUGHT,S.t("filterBar:caughtFilter"),new et(0,0,v,this.updateStarters,Je.HYBRID));const m=[new se(S.t("filterBar:passive"),void 0,ee.OFF),new se(S.t("filterBar:passiveUnlocked"),void 0,ee.ON),new se(S.t("filterBar:passiveUnlockable"),void 0,ee.UNLOCKABLE),new se(S.t("filterBar:passiveLocked"),void 0,ee.EXCLUDE)],b=[new se(S.t("filterBar:costReduction"),void 0,ee.OFF),new se(S.t("filterBar:costReductionUnlocked"),void 0,ee.ON),new se(S.t("filterBar:costReductionUnlockedOne"),void 0,ee.ONE),new se(S.t("filterBar:costReductionUnlockedTwo"),void 0,ee.TWO),new se(S.t("filterBar:costReductionUnlockable"),void 0,ee.UNLOCKABLE),new se(S.t("filterBar:costReductionLocked"),void 0,ee.EXCLUDE)],E=[new fe("PASSIVE",m),new fe("COST_REDUCTION",b)];this.filterBar.addFilter(be.UNLOCKS,S.t("filterBar:unlocksFilter"),new et(0,0,E,this.updateStarters,Je.RADIAL));const w=[new se(S.t("filterBar:favorite"),void 0,ee.OFF),new se(S.t("filterBar:isFavorite"),void 0,ee.ON),new se(S.t("filterBar:notFavorite"),void 0,ee.EXCLUDE)],_=[new se(S.t("filterBar:ribbon"),void 0,ee.OFF),new se(S.t("filterBar:hasWon"),void 0,ee.ON),new se(S.t("filterBar:hasNotWon"),void 0,ee.EXCLUDE)],A=[new se(S.t("filterBar:hiddenAbility"),void 0,ee.OFF),new se(S.t("filterBar:hasHiddenAbility"),void 0,ee.ON),new se(S.t("filterBar:noHiddenAbility"),void 0,ee.EXCLUDE)],D=[new se(S.t("filterBar:egg"),void 0,ee.OFF),new se(S.t("filterBar:eggPurchasable"),void 0,ee.ON)],j=[new se(S.t("filterBar:pokerus"),void 0,ee.OFF),new se(S.t("filterBar:hasPokerus"),void 0,ee.ON)],B=[new fe("FAVORITE",w),new fe("WIN",_),new fe("HIDDEN_ABILITY",A),new fe("EGG",D),new fe("POKERUS",j)];this.filterBar.addFilter(be.MISC,S.t("filterBar:miscFilter"),new et(0,0,B,this.updateStarters,Je.RADIAL));const $=[new fe(we.NUMBER,new se(S.t("filterBar:sortByNumber"),void 0,ee.ON)),new fe(we.COST,new se(S.t("filterBar:sortByCost"))),new fe(we.CANDY,new se(S.t("filterBar:sortByCandies"))),new fe(we.IV,new se(S.t("filterBar:sortByIVs"))),new fe(we.NAME,new se(S.t("filterBar:sortByName"))),new fe(we.CAUGHT,new se(S.t("filterBar:sortByNumCaught"))),new fe(we.HATCHED,new se(S.t("filterBar:sortByNumHatched")))];this.filterBar.addFilter(be.SORT,S.t("filterBar:sortFilter"),new et(0,0,$,this.updateStarters,Je.SINGLE)),this.filterBarContainer.add(this.filterBar),this.starterSelectContainer.add(this.filterBarContainer),this.filterBar.offsetHybridFilters(),n.uiTheme||o.setVisible(!1),this.iconAnimHandler=new Yi,this.iconAnimHandler.setup(),this.pokemonSprite=n.add.sprite(53,63,"pkmn__sub"),this.pokemonSprite.setPipeline(n.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.starterSelectContainer.add(this.pokemonSprite),this.pokemonNumberText=V(17,1,"0000",x.SUMMARY),this.pokemonNumberText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNumberText),this.pokemonNameText=V(6,112,"",x.SUMMARY),this.pokemonNameText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNameText),this.pokemonGrowthRateLabelText=V(8,106,S.t("starterSelectUiHandler:growthRate"),x.SUMMARY_ALT,{fontSize:"36px"}),this.pokemonGrowthRateLabelText.setOrigin(0,0),this.pokemonGrowthRateLabelText.setVisible(!1),this.starterSelectContainer.add(this.pokemonGrowthRateLabelText),this.pokemonGrowthRateText=V(34,106,"",x.SUMMARY_PINK,{fontSize:"36px"}),this.pokemonGrowthRateText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonGrowthRateText),this.pokemonGenderText=V(96,112,"",x.SUMMARY_ALT),this.pokemonGenderText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonGenderText),this.pokemonUncaughtText=V(6,127,S.t("starterSelectUiHandler:uncaught"),x.SUMMARY_ALT,{fontSize:"56px"}),this.pokemonUncaughtText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonUncaughtText);const ie=(i==null?void 0:i.starterInfoXPos)||31,k=(i==null?void 0:i.starterInfoYOffset)||0,U=(i==null?void 0:i.starterInfoTextSize)||56;this.pokemonAbilityLabelText=V(6,127+k,S.t("starterSelectUiHandler:ability"),x.SUMMARY_ALT,{fontSize:U}),this.pokemonAbilityLabelText.setOrigin(0,0),this.pokemonAbilityLabelText.setVisible(!1),this.starterSelectContainer.add(this.pokemonAbilityLabelText),this.pokemonAbilityText=V(ie,127+k,"",x.SUMMARY_ALT,{fontSize:U}),this.pokemonAbilityText.setOrigin(0,0),this.pokemonAbilityText.setInteractive(new Phaser.Geom.Rectangle(0,0,250,55),Phaser.Geom.Rectangle.Contains),this.starterSelectContainer.add(this.pokemonAbilityText),this.pokemonPassiveLabelText=V(6,136+k,S.t("starterSelectUiHandler:passive"),x.SUMMARY_ALT,{fontSize:U}),this.pokemonPassiveLabelText.setOrigin(0,0),this.pokemonPassiveLabelText.setVisible(!1),this.starterSelectContainer.add(this.pokemonPassiveLabelText),this.pokemonPassiveText=V(ie,136+k,"",x.SUMMARY_ALT,{fontSize:U}),this.pokemonPassiveText.setOrigin(0,0),this.pokemonPassiveText.setInteractive(new Phaser.Geom.Rectangle(0,0,250,55),Phaser.Geom.Rectangle.Contains),this.starterSelectContainer.add(this.pokemonPassiveText),this.pokemonPassiveDisabledIcon=n.add.sprite(ie,137+k,"icon_stop"),this.pokemonPassiveDisabledIcon.setOrigin(0,.5),this.pokemonPassiveDisabledIcon.setScale(.35),this.pokemonPassiveDisabledIcon.setVisible(!1),this.starterSelectContainer.add(this.pokemonPassiveDisabledIcon),this.pokemonPassiveLockedIcon=n.add.sprite(ie,137+k,"icon_lock"),this.pokemonPassiveLockedIcon.setOrigin(0,.5),this.pokemonPassiveLockedIcon.setScale(.42,.38),this.pokemonPassiveLockedIcon.setVisible(!1),this.starterSelectContainer.add(this.pokemonPassiveLockedIcon),this.pokemonNatureLabelText=V(6,145+k,S.t("starterSelectUiHandler:nature"),x.SUMMARY_ALT,{fontSize:U}),this.pokemonNatureLabelText.setOrigin(0,0),this.pokemonNatureLabelText.setVisible(!1),this.starterSelectContainer.add(this.pokemonNatureLabelText),this.pokemonNatureText=yt(ie,145+k,"",x.SUMMARY_ALT,{fontSize:U}),this.pokemonNatureText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNatureText),this.pokemonMoveContainers=[],this.pokemonMoveBgs=[],this.pokemonMoveLabels=[],this.pokemonEggMoveContainers=[],this.pokemonEggMoveBgs=[],this.pokemonEggMoveLabels=[],this.valueLimitLabel=V(vt+17,150,"0/10",x.TOOLTIP_CONTENT),this.valueLimitLabel.setOrigin(.5,0),this.starterSelectContainer.add(this.valueLimitLabel);const T=V(vt+17,162,S.t("common:start"),x.TOOLTIP_CONTENT);T.setOrigin(.5,0),this.starterSelectContainer.add(T),this.startCursorObj=n.add.nineslice(vt+4,160,"select_cursor",void 0,26,15,6,6,6,6),this.startCursorObj.setVisible(!1),this.startCursorObj.setOrigin(0,0),this.starterSelectContainer.add(this.startCursorObj);const F=V(vt+17,23,S.t("starterSelectUiHandler:randomize"),x.TOOLTIP_CONTENT);F.setOrigin(.5,0),this.starterSelectContainer.add(F),this.randomCursorObj=n.add.nineslice(vt+4,21,"select_cursor",void 0,26,15,6,6,6,6),this.randomCursorObj.setVisible(!1),this.randomCursorObj.setOrigin(0,0),this.starterSelectContainer.add(this.randomCursorObj);const he=[],W=n.add.container(Js+6,9);this.starterSelectScrollBar=new _t(161,12,5,o.height-6,9),W.add(this.starterSelectScrollBar),this.pokerusCursorObjs=new Array(xl).fill(null).map(()=>{const R=n.add.image(0,0,"select_cursor_pokerus");return R.setVisible(!1),R.setOrigin(0,0),W.add(R),R}),this.starterCursorObjs=new Array(6).fill(null).map(()=>{const R=n.add.image(0,0,"select_cursor_highlight");return R.setVisible(!1),R.setOrigin(0,0),W.add(R),R}),this.cursorObj=n.add.image(0,0,"select_cursor"),this.cursorObj.setOrigin(0,0),this.starterIconsCursorObj=n.add.image(289,64,"select_gen_cursor"),this.starterIconsCursorObj.setName("starter-icons-cursor"),this.starterIconsCursorObj.setVisible(!1),this.starterIconsCursorObj.setOrigin(0,0),this.starterSelectContainer.add(this.starterIconsCursorObj),W.add(this.cursorObj);for(const R of Re){if(!Le.hasOwnProperty(R.speciesId)||!R.isObtainable())continue;he.push(R.speciesId),this.speciesLoaded.set(R.speciesId,!1),this.allSpecies.push(R);const ce=new _n(R).setVisible(!1);this.iconAnimHandler.addOrUpdate(ce.icon,Ze.NONE),this.starterContainers.push(ce),W.add(ce)}this.starterSelectContainer.add(W),this.starterIcons=new Array(6).fill(null).map((R,ce)=>{const ne=n.add.sprite(vt+7,Wr(ce),"pokemon_icons_0");return ne.setScale(.5),ne.setOrigin(0,0),ne.setFrame("unknown"),this.starterSelectContainer.add(ne),this.iconAnimHandler.addOrUpdate(ne,Ze.PASSIVE),ne}),this.type1Icon=n.add.sprite(8,98,Tt("types")),this.type1Icon.setScale(.5),this.type1Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type1Icon),this.type2Icon=n.add.sprite(26,98,Tt("types")),this.type2Icon.setScale(.5),this.type2Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type2Icon),this.pokemonLuckLabelText=V(8,89,S.t("common:luckIndicator"),x.WINDOW_ALT,{fontSize:"56px"}),this.pokemonLuckLabelText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonLuckLabelText),this.pokemonLuckText=V(8+this.pokemonLuckLabelText.displayWidth+2,89,"0",x.WINDOW,{fontSize:"56px"}),this.pokemonLuckText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonLuckText),this.pokemonCandyContainer=n.add.container(4.5,18),this.pokemonCandyIcon=n.add.sprite(0,0,"candy"),this.pokemonCandyIcon.setScale(.5),this.pokemonCandyIcon.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyIcon),this.pokemonCandyOverlayIcon=n.add.sprite(0,0,"candy_overlay"),this.pokemonCandyOverlayIcon.setScale(.5),this.pokemonCandyOverlayIcon.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyOverlayIcon),this.pokemonCandyDarknessOverlay=n.add.sprite(0,0,"candy"),this.pokemonCandyDarknessOverlay.setScale(.5),this.pokemonCandyDarknessOverlay.setOrigin(0,0),this.pokemonCandyDarknessOverlay.setTint(0),this.pokemonCandyDarknessOverlay.setAlpha(.5),this.pokemonCandyContainer.add(this.pokemonCandyDarknessOverlay),this.pokemonCandyCountText=V(9.5,0,"x0",x.WINDOW_ALT,{fontSize:"56px"}),this.pokemonCandyCountText.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyCountText),this.pokemonCandyContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,30,20),Phaser.Geom.Rectangle.Contains),this.starterSelectContainer.add(this.pokemonCandyContainer),this.pokemonFormText=V(6,42,"Form",x.WINDOW_ALT,{fontSize:"42px"}),this.pokemonFormText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonFormText),this.pokemonCaughtHatchedContainer=n.add.container(2,25),this.pokemonCaughtHatchedContainer.setScale(.5),this.starterSelectContainer.add(this.pokemonCaughtHatchedContainer);const de=n.add.sprite(1,0,"items","pb");de.setOrigin(0,0),de.setScale(.75),this.pokemonCaughtHatchedContainer.add(de),this.pokemonCaughtCountText=V(24,4,"0",x.SUMMARY_ALT),this.pokemonCaughtCountText.setOrigin(0,0),this.pokemonCaughtHatchedContainer.add(this.pokemonCaughtCountText),this.pokemonHatchedIcon=n.add.sprite(1,14,"egg_icons"),this.pokemonHatchedIcon.setOrigin(.15,.2),this.pokemonHatchedIcon.setScale(.8),this.pokemonCaughtHatchedContainer.add(this.pokemonHatchedIcon),this.pokemonShinyIcon=n.add.sprite(14,76,"shiny_icons"),this.pokemonShinyIcon.setOrigin(.15,.2),this.pokemonShinyIcon.setScale(1),this.pokemonCaughtHatchedContainer.add(this.pokemonShinyIcon),this.pokemonHatchedCountText=V(24,19,"0",x.SUMMARY_ALT),this.pokemonHatchedCountText.setOrigin(0,0),this.pokemonCaughtHatchedContainer.add(this.pokemonHatchedCountText),this.pokemonMovesContainer=n.add.container(102,16),this.pokemonMovesContainer.setScale(.375);for(let R=0;R<4;R++){const ce=n.add.container(0,14*R),ne=n.add.nineslice(0,0,"type_bgs","unknown",92,14,2,2,2,2);ne.setOrigin(1,0);const ae=V(-ne.width/2,0,"-",x.PARTY);ae.setOrigin(.5,0),this.pokemonMoveBgs.push(ne),this.pokemonMoveLabels.push(ae),ce.add(ne),ce.add(ae),this.pokemonMoveContainers.push(ce),this.pokemonMovesContainer.add(ce)}this.pokemonAdditionalMoveCountLabel=V(-this.pokemonMoveBgs[0].width/2,56,"(+0)",x.PARTY),this.pokemonAdditionalMoveCountLabel.setOrigin(.5,0),this.pokemonMovesContainer.add(this.pokemonAdditionalMoveCountLabel),this.starterSelectContainer.add(this.pokemonMovesContainer),this.pokemonEggMovesContainer=n.add.container(102,85),this.pokemonEggMovesContainer.setScale(.375);const z=V(-46,0,S.t("starterSelectUiHandler:eggMoves"),x.WINDOW_ALT);z.setOrigin(.5,0),this.pokemonEggMovesContainer.add(z);for(let R=0;R<4;R++){const ce=n.add.container(0,16+14*R),ne=n.add.nineslice(0,0,"type_bgs","unknown",92,14,2,2,2,2);ne.setOrigin(1,0);const ae=V(-ne.width/2,0,"???",x.PARTY);ae.setOrigin(.5,0),this.pokemonEggMoveBgs.push(ne),this.pokemonEggMoveLabels.push(ae),ce.add(ne),ce.add(ae),this.pokemonEggMoveContainers.push(ce),this.pokemonEggMovesContainer.add(ce)}this.starterSelectContainer.add(this.pokemonEggMovesContainer),this.teraIcon=n.add.sprite(85,63,"button_tera"),this.teraIcon.setName("terrastallize-icon"),this.teraIcon.setFrame("fire"),this.starterSelectContainer.add(this.teraIcon);const Y=i.instructionTextSize;this.instructionsContainer=n.add.container(4,156),this.instructionsContainer.setVisible(!0),this.starterSelectContainer.add(this.instructionsContainer),this.shinyIconElement=new Phaser.GameObjects.Sprite(n,this.instructionRowX,this.instructionRowY,"keyboard","R.png"),this.shinyIconElement.setName("sprite-shiny-icon-element"),this.shinyIconElement.setScale(.675),this.shinyIconElement.setOrigin(0,0),this.shinyLabel=V(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,S.t("starterSelectUiHandler:cycleShiny"),x.PARTY,{fontSize:Y}),this.shinyLabel.setName("text-shiny-label"),this.formIconElement=new Phaser.GameObjects.Sprite(n,this.instructionRowX,this.instructionRowY,"keyboard","F.png"),this.formIconElement.setName("sprite-form-icon-element"),this.formIconElement.setScale(.675),this.formIconElement.setOrigin(0,0),this.formLabel=V(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,S.t("starterSelectUiHandler:cycleForm"),x.PARTY,{fontSize:Y}),this.formLabel.setName("text-form-label"),this.genderIconElement=new Phaser.GameObjects.Sprite(n,this.instructionRowX,this.instructionRowY,"keyboard","G.png"),this.genderIconElement.setName("sprite-gender-icon-element"),this.genderIconElement.setScale(.675),this.genderIconElement.setOrigin(0,0),this.genderLabel=V(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,S.t("starterSelectUiHandler:cycleGender"),x.PARTY,{fontSize:Y}),this.genderLabel.setName("text-gender-label"),this.abilityIconElement=new Phaser.GameObjects.Sprite(n,this.instructionRowX,this.instructionRowY,"keyboard","E.png"),this.abilityIconElement.setName("sprite-ability-icon-element"),this.abilityIconElement.setScale(.675),this.abilityIconElement.setOrigin(0,0),this.abilityLabel=V(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,S.t("starterSelectUiHandler:cycleAbility"),x.PARTY,{fontSize:Y}),this.abilityLabel.setName("text-ability-label"),this.natureIconElement=new Phaser.GameObjects.Sprite(n,this.instructionRowX,this.instructionRowY,"keyboard","N.png"),this.natureIconElement.setName("sprite-nature-icon-element"),this.natureIconElement.setScale(.675),this.natureIconElement.setOrigin(0,0),this.natureLabel=V(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,S.t("starterSelectUiHandler:cycleNature"),x.PARTY,{fontSize:Y}),this.natureLabel.setName("text-nature-label"),this.teraIconElement=new Phaser.GameObjects.Sprite(n,this.instructionRowX,this.instructionRowY,"keyboard","V.png"),this.teraIconElement.setName("sprite-tera-icon-element"),this.teraIconElement.setScale(.675),this.teraIconElement.setOrigin(0,0),this.teraLabel=V(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,S.t("starterSelectUiHandler:cycleTera"),x.PARTY,{fontSize:Y}),this.teraLabel.setName("text-tera-label"),this.goFilterIconElement=new Phaser.GameObjects.Sprite(n,this.filterInstructionRowX,this.filterInstructionRowY,"keyboard","C.png"),this.goFilterIconElement.setName("sprite-goFilter-icon-element"),this.goFilterIconElement.setScale(.675),this.goFilterIconElement.setOrigin(0,0),this.goFilterLabel=V(this.filterInstructionRowX+this.instructionRowTextOffset,this.filterInstructionRowY,S.t("starterSelectUiHandler:goFilter"),x.PARTY,{fontSize:Y}),this.goFilterLabel.setName("text-goFilter-label"),this.hideInstructions(),this.filterInstructionsContainer=n.add.container(50,5),this.filterInstructionsContainer.setVisible(!0),this.starterSelectContainer.add(this.filterInstructionsContainer),this.starterSelectMessageBoxContainer=n.add.container(0,n.game.canvas.height/6),this.starterSelectMessageBoxContainer.setVisible(!1),this.starterSelectContainer.add(this.starterSelectMessageBoxContainer),this.starterSelectMessageBox=me(1,-1,318,28),this.starterSelectMessageBox.setOrigin(0,1),this.starterSelectMessageBoxContainer.add(this.starterSelectMessageBox),this.message=V(8,8,"",x.WINDOW,{maxLines:2}),this.message.setOrigin(0,0),this.starterSelectMessageBoxContainer.add(this.message),this.initPromptSprite(this.starterSelectMessageBoxContainer),this.statsContainer=new _l(6,16),n.add.existing(this.statsContainer),this.statsContainer.setVisible(!1),this.starterSelectContainer.add(this.statsContainer);const G=1;this.moveInfoOverlay=new ls({scale:G,top:!0,x:1,y:n.game.canvas.height/6-ls.getHeight(G)-29}),this.starterSelectContainer.add(this.moveInfoOverlay),this.starterSelectContainer.bringToTop(this.filterBarContainer),this.initTutorialOverlay(this.starterSelectContainer),this.starterSelectContainer.bringToTop(this.starterSelectMessageBoxContainer),n.eventTarget.addEventListener(as.CANDY_UPGRADE_NOTIFICATION_CHANGED,R=>this.onCandyUpgradeDisplayChanged(R)),this.updateInstructions()}show(e){return this.starterPreferences||(this.starterPreferences=wl()),this.moveInfoOverlay.clear(),this.pokerusSpecies=Ol(),e.length>=1&&e[0]instanceof Function?(super.show(e),this.starterSelectCallback=e[0],this.starterSelectContainer.setVisible(!0),this.allSpecies.forEach((t,s)=>{const i=this.starterContainers[s].icon,r=n.gameData.dexData[t.speciesId];this.starterPreferences[t.speciesId]=this.initStarterPrefs(t),r.caughtAttr?i.clearTint():r.seenAttr&&i.setTint(8421504),this.setUpgradeAnimation(i,t)}),this.resetFilters(),this.updateStarters(),this.setFilterMode(!1),this.filterBarCursor=0,this.setCursor(0),this.tryUpdateValue(0),ws(Ls.Starter_Select),!0):!1}initStarterPrefs(e){var h;const t=this.starterPreferences[e.speciesId],s=n.gameData.dexData[e.speciesId],i=n.gameData.starterData[e.speciesId];if(!t||!s.caughtAttr)return{};const r=s.caughtAttr,a=r&Z.SHINY,o=r&Z.NON_SHINY;if(t.shiny&&!a?(t.shiny=void 0,t.variant=void 0):t.shiny===!1&&!o&&(t.shiny=void 0),t.variant!==void 0){const c=[a&&r&Z.DEFAULT_VARIANT,a&&r&Z.VARIANT_2,a&&r&Z.VARIANT_3];(Number.isNaN(t.variant)||t.variant<0||!c[t.variant])&&(t.variant=void 0)}if(t.female!==void 0&&((t.female?r&Z.FEMALE:r&Z.MALE)||(t.female=void 0)),t.ability!==void 0){const c=e.ability2===e.ability1,d=i.abilityAttr,f=d&Xe.ABILITY_1,u=d&Xe.ABILITY_2,C=d&Xe.ABILITY_HIDDEN;[f,c?u&&!f:u,C][t.ability]||(t.ability=void 0)}const l=t.form;return l!==void 0&&(!((h=e.forms[l])!=null&&h.isStarterSelectable)||!(r&n.gameData.getFormAttr(l)))&&(t.form=void 0),t.nature!==void 0&&n.gameData.getNaturesForAttr(s.natureAttr).indexOf(t.nature)<0&&(t.nature=void 0),t}resetFilters(){this.filterBar.setValsToDefault(),this.resetCaughtDropdown()}resetCaughtDropdown(){const e=this.filterBar.getFilter(be.CAUGHT);e.resetToDefault();for(let t=0;t<e.options.length;t++)e.options[t].val!=="ALL"&&e.options[t].val!=="UNCAUGHT"&&e.toggleOptionState(t)}showText(e,t,s,i,r,a,o){super.showText(e,t,s,i,r,a);const l=(e==null?void 0:e.indexOf(`
`))===-1;this.starterSelectMessageBox.setSize(318,l?28:42),o?(this.starterSelectMessageBox.setOrigin(0,0),this.starterSelectMessageBoxContainer.setY(0),this.message.setY(4)):(this.starterSelectMessageBoxContainer.setY(n.game.canvas.height/6),this.starterSelectMessageBox.setOrigin(0,1),this.message.setY(l?-22:-37)),this.starterSelectMessageBoxContainer.setVisible(!!(e!=null&&e.length))}isUpgradeIconEnabled(){return n.candyUpgradeNotification!==0&&n.candyUpgradeDisplay===0}isUpgradeAnimationEnabled(){return n.candyUpgradeNotification!==0&&n.candyUpgradeDisplay===1}isPassiveAvailable(e){const t=n.gameData.starterData[e];return t.candyCount>=Os(Le[e])&&!(t.passiveAttr&Ke.UNLOCKED)}isValueReductionAvailable(e){const t=n.gameData.starterData[e];return t.candyCount>=As(Le[e])[t.valueReduction]&&t.valueReduction<tl}isSameSpeciesEggAvailable(e){return n.gameData.starterData[e].candyCount>=ks(Le[e])}setUpgradeAnimation(e,t,s=!1){if(n.tweens.killTweensOf(e),n.candyUpgradeDisplay===0||t.speciesId!==t.getRootSpeciesId(!1))return;e.y=2;const i={targets:e,paused:s,loop:-1,delay:Sl(0,50)*5,loopDelay:1e3,tweens:[{targets:e,y:"-=5",duration:ye(125),ease:"Cubic.easeOut",yoyo:!0},{targets:e,y:"-=3",duration:ye(150),ease:"Cubic.easeOut",yoyo:!0}]};if(this.isPassiveAvailable(t.speciesId)||n.candyUpgradeNotification===2&&(this.isValueReductionAvailable(t.speciesId)||this.isSameSpeciesEggAvailable(t.speciesId))){const r=n.tweens.chain(i);s||r.play()}}setUpgradeIcon(e){const t=e.species,s=!!(t!=null&&t.speciesId);if(!t||n.candyUpgradeNotification===0||t.speciesId!==t.getRootSpeciesId(!1)){e.candyUpgradeIcon.setVisible(!1),e.candyUpgradeOverlayIcon.setVisible(!1);return}const i=this.isPassiveAvailable(t.speciesId),r=this.isValueReductionAvailable(t.speciesId),a=this.isSameSpeciesEggAvailable(t.speciesId);n.candyUpgradeNotification===1?(e.candyUpgradeIcon.setVisible(s&&i),e.candyUpgradeOverlayIcon.setVisible(s&&e.candyUpgradeIcon.visible)):n.candyUpgradeNotification===2&&(e.candyUpgradeIcon.setVisible(s&&(i||r||a)),e.candyUpgradeOverlayIcon.setVisible(s&&e.candyUpgradeIcon.visible))}updateCandyUpgradeDisplay(e){this.isUpgradeIconEnabled()&&this.setUpgradeIcon(e),this.isUpgradeAnimationEnabled()&&this.setUpgradeAnimation(e.icon,this.lastSpecies,!0)}onCandyUpgradeDisplayChanged(e){if(e){if(n.candyUpgradeDisplay===0){this.filteredStarterContainers.forEach(s=>{this.setUpgradeIcon(s)});return}this.filteredStarterContainers.forEach((s,i)=>{const r=this.filteredStarterContainers[i].icon;this.setUpgradeAnimation(r,s.species)})}}processInput(e){var g,v,m;if(this.blockInput)return!1;const t=9,s=9,i=this.filteredStarterContainers.length,r=Math.ceil(i/t),a=Math.floor(this.cursor/t),o=this.scrollCursor*t,l=Math.min(this.filteredStarterContainers.length-1,o+s*t-1),h=l-o+1,c=Math.ceil(h/t),d=Math.floor((this.cursor-o)/t),f=this.getUi();let u=!1,C=!1;if(e===I.SUBMIT)this.tryStart(!0)?u=!0:C=!0;else if(e===I.CANCEL)this.filterMode&&this.filterBar.openDropDown?(this.filterBar.toggleDropDown(this.filterBarCursor),u=!0):this.filterMode&&!this.filterBar.getFilter(this.filterBar.getColumn(this.filterBarCursor)).hasDefaultValues()?(this.filterBar.getColumn(this.filterBarCursor)===be.CAUGHT?this.resetCaughtDropdown():this.filterBar.resetSelection(this.filterBarCursor),this.updateStarters(),u=!0):this.statsMode?(this.toggleStatsMode(!1),u=!0):this.starterSpecies.length?(this.popStarter(this.starterSpecies.length-1),u=!0,this.updateInstructions()):(this.tryExit(),u=!0);else if(e===I.STATS)this.filterMode||(this.startCursorObj.setVisible(!1),this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null),this.filterBarCursor=0,this.setFilterMode(!0),this.filterBar.toggleDropDown(this.filterBarCursor));else if(this.startCursorObj.visible)switch(e){case I.ACTION:this.tryStart(!0)?u=!0:C=!0;break;case I.UP:this.startCursorObj.setVisible(!1),this.starterSpecies.length>0?(this.starterIconsCursorIndex=this.starterSpecies.length-1,this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.startCursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0)),u=!0;break;case I.DOWN:this.startCursorObj.setVisible(!1),this.filterBarCursor=Math.max(1,this.filterBar.numFilters-1),this.setFilterMode(!0),u=!0;break;case I.LEFT:i>0&&(this.startCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o+(c-1)*9+8),u=!0);break;case I.RIGHT:i>0&&(this.startCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o+(c-1)*9),u=!0);break}else if(this.filterMode)switch(e){case I.LEFT:this.filterBarCursor>0?u=this.setCursor(this.filterBarCursor-1):u=this.setCursor(this.filterBar.numFilters-1);break;case I.RIGHT:this.filterBarCursor<this.filterBar.numFilters-1?u=this.setCursor(this.filterBarCursor+1):u=this.setCursor(0);break;case I.UP:if(this.filterBar.openDropDown)u=this.filterBar.decDropDownCursor();else if(this.filterBarCursor===this.filterBar.numFilters-1)this.setFilterMode(!1),this.cursorObj.setVisible(!1),this.starterSpecies.length>0?this.startCursorObj.setVisible(!0):this.randomCursorObj.setVisible(!0),u=!0;else if(i>0){this.setFilterMode(!1),this.scrollCursor=Math.max(0,r-9),this.updateScroll();const b=(this.filterBarCursor+.5)/this.filterBar.numFilters,E=Math.min(8,Math.floor(b*11));i%9>E?this.setCursor(i-i%9+E):this.setCursor(Math.max(i-i%9+E-9,0)),u=!0}break;case I.DOWN:if(this.filterBar.openDropDown)u=this.filterBar.incDropDownCursor();else if(this.filterBarCursor===this.filterBar.numFilters-1)this.setFilterMode(!1),this.cursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0),u=!0;else if(i>0){this.setFilterMode(!1),this.scrollCursor=0,this.updateScroll();const b=this.filterBarCursor/Math.max(1,this.filterBar.numFilters-1),E=Math.min(8,Math.floor(b*11));this.setCursor(Math.min(E,i)),u=!0}break;case I.ACTION:this.filterBar.openDropDown?this.filterBar.toggleOptionState():this.filterBar.toggleDropDown(this.filterBarCursor),u=!0;break}else if(this.randomCursorObj.visible)switch(e){case I.ACTION:if(this.starterSpecies.length>=6){C=!0;break}const b=this.starterSpecies.map(T=>T.generation).reduce((T,F,he)=>T+n.gameData.getSpeciesStarterValue(this.starterSpecies[he].speciesId),0),E=this.filteredStarterContainers.filter(T=>{const F=T.species,[he]=this.isInParty(F),W=n.gameData.getSpeciesStarterValue(F.speciesId),de=Wt(F,n.gameData.getSpeciesDexAttrProps(F,this.getCurrentDexProps(F.speciesId)),this.isPartyValid()),z=n.gameData.dexData[F.speciesId].caughtAttr;return!he&&de&&b+W<=this.getValueLimit()&&z});if(E.length===0){C=!0;break}const _=E[Math.floor(Math.random()*E.length)].species;this.setSpecies(_);const A=this.getCurrentDexProps(_.speciesId),D=n.gameData.getSpeciesDexAttrProps(_,A),j=this.abilityCursor,B=this.natureCursor,$=this.teraCursor,ie=(g=this.starterMoveset)==null?void 0:g.slice(0),k=n.gameData.getSpeciesStarterValue(_.speciesId);Ct(_.speciesId,D.formIndex).loadAssets(D.female,D.formIndex,D.shiny,D.variant,!0).then(()=>{this.tryUpdateValue(k,!0)&&(this.addToParty(_,A,j,B,ie,$,!0),f.playSelect())});break;case I.UP:this.randomCursorObj.setVisible(!1),this.filterBarCursor=this.filterBar.numFilters-1,this.setFilterMode(!0),u=!0;break;case I.DOWN:this.randomCursorObj.setVisible(!1),this.starterSpecies.length>0?(this.starterIconsCursorIndex=0,this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.filterBarCursor=this.filterBar.numFilters-1,this.setFilterMode(!0)),u=!0;break;case I.LEFT:i>0&&(this.randomCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o+8),u=!0);break;case I.RIGHT:i>0&&(this.randomCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o),u=!0);break}else{let b;const E=n.gameData.starterData[this.lastSpecies.speciesId];let w=this.starterPreferences[this.lastSpecies.speciesId];if(this.starterIconsCursorObj.visible?b=this.filteredStarterContainers[this.filteredStarterContainers.findIndex(_=>_.species===this.lastSpecies)]:b=this.filteredStarterContainers[this.cursor],e===I.ACTION){if(!((v=this.speciesStarterDexEntry)!=null&&v.caughtAttr))C=!0;else if(this.starterSpecies.length<=6){const _=this.getUi();let A=[];const[D,j]=this.isInParty(this.lastSpecies),B=this.isPartyValid(),$=Wt(this.lastSpecies,n.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId)),B),ie=this.starterSpecies.map(W=>W.generation).reduce((W,de,z)=>W+=n.gameData.getSpeciesStarterValue(this.starterSpecies[z].speciesId),0),k=n.gameData.getSpeciesStarterValue(this.lastSpecies.speciesId);if(!D&&$&&ie+k<=this.getValueLimit()&&this.starterSpecies.length<pn?A=[{label:S.t("starterSelectUiHandler:addToParty"),handler:p(()=>{var de;_.setMode(L.STARTER_SELECT);const W=this.tryUpdateValue(n.gameData.getSpeciesStarterValue(this.lastSpecies.speciesId),!0);if(!D&&$&&W){const z=this.starterCursorObjs[this.starterSpecies.length];z.setVisible(!0),z.setPosition(this.cursorObj.x,this.cursorObj.y),this.addToParty(this.lastSpecies,this.dexAttrCursor,this.abilityCursor,this.natureCursor,(de=this.starterMoveset)==null?void 0:de.slice(0),this.teraCursor),_.playSelect()}else _.playError();return!0},"handler"),overrideSound:!0}]:D&&(A=[{label:S.t("starterSelectUiHandler:removeFromParty"),handler:p(()=>(this.popStarter(j),_.setMode(L.STARTER_SELECT),!0),"handler")}]),A.push({label:S.t("starterSelectUiHandler:toggleIVs"),handler:p(()=>(this.toggleStatsMode(),_.setMode(L.STARTER_SELECT),!0),"handler")}),this.speciesStarterMoves.length>1){const W=p(de=>{this.blockInput=!0,_.setMode(L.STARTER_SELECT).then(()=>{_.showText(S.t("starterSelectUiHandler:selectMoveSwapOut"),null,()=>{this.moveInfoOverlay.show(_e[de[0]]),_.setModeWithoutClear(L.OPTION_SELECT,{options:de.map((z,Y)=>({label:_e[z].name,handler:p(()=>(this.blockInput=!0,_.setMode(L.STARTER_SELECT).then(()=>{_.showText(`${S.t("starterSelectUiHandler:selectMoveSwapWith")} ${_e[z].name}.`,null,()=>{const R=this.speciesStarterMoves.filter(ce=>ce!==z);this.moveInfoOverlay.show(_e[R[0]]),_.setModeWithoutClear(L.OPTION_SELECT,{options:R.map(ce=>({label:_e[ce].name,handler:p(()=>(this.switchMoveHandler(Y,ce,z),W(this.starterMoveset),!0),"handler"),onHover:p(()=>{this.moveInfoOverlay.show(_e[ce])},"onHover")})).concat({label:S.t("menu:cancel"),handler:p(()=>(W(this.starterMoveset),!0),"handler"),onHover:p(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),!0),"handler"),onHover:p(()=>{this.moveInfoOverlay.show(_e[z])},"onHover")})).concat({label:S.t("menu:cancel"),handler:p(()=>(this.moveInfoOverlay.clear(),this.clearText(),_.setMode(L.STARTER_SELECT),!0),"handler"),onHover:p(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})})},"showSwapOptions");A.push({label:S.t("starterSelectUiHandler:manageMoves"),handler:p(()=>(W(this.starterMoveset),!0),"handler")})}if(this.canCycleNature){const W=p(()=>{this.blockInput=!0,_.setMode(L.STARTER_SELECT).then(()=>{_.showText(S.t("starterSelectUiHandler:selectNature"),null,()=>{var z;const de=n.gameData.getNaturesForAttr((z=this.speciesStarterDexEntry)==null?void 0:z.natureAttr);_.setModeWithoutClear(L.OPTION_SELECT,{options:de.map((Y,G)=>({label:gn(Y,!0,!0,!0,n.uiTheme),handler:p(()=>(w||(w=this.starterPreferences[this.lastSpecies.speciesId]={}),w.nature=Y,this.clearText(),_.setMode(L.STARTER_SELECT),this.setSpeciesDetails(this.lastSpecies,{natureIndex:Y}),this.blockInput=!1,!0),"handler")})).concat({label:S.t("menu:cancel"),handler:p(()=>(this.clearText(),_.setMode(L.STARTER_SELECT),this.blockInput=!1,!0),"handler")}),maxOptions:8,yOffset:19})})})},"showNatureOptions");A.push({label:S.t("starterSelectUiHandler:manageNature"),handler:p(()=>(W(),!0),"handler")})}const U=E.passiveAttr;U&Ke.UNLOCKED&&(U&Ke.ENABLED?A.push({label:S.t("starterSelectUiHandler:disablePassive"),handler:p(()=>(E.passiveAttr^=Ke.ENABLED,_.setMode(L.STARTER_SELECT),this.setSpeciesDetails(this.lastSpecies),!0),"handler")}):A.push({label:S.t("starterSelectUiHandler:enablePassive"),handler:p(()=>(E.passiveAttr|=Ke.ENABLED,_.setMode(L.STARTER_SELECT),this.setSpeciesDetails(this.lastSpecies),!0),"handler")})),(w==null?void 0:w.favorite)??!1?A.push({label:S.t("starterSelectUiHandler:removeFromFavorites"),handler:p(()=>(w.favorite=!1,b&&b.favoriteIcon.setVisible(w.favorite),_.setMode(L.STARTER_SELECT),!0),"handler")}):A.push({label:S.t("starterSelectUiHandler:addToFavorites"),handler:p(()=>(w.favorite=!0,b&&b.favoriteIcon.setVisible(w.favorite),_.setMode(L.STARTER_SELECT),!0),"handler")}),A.push({label:S.t("menu:rename"),handler:p(()=>{_.playSelect();let W=w.nickname?String(w.nickname):"";return W=decodeURIComponent(escape(atob(W))),_.setModeWithoutClear(L.RENAME_POKEMON,{buttonActions:[de=>{_.playSelect(),w.nickname=de;const z=decodeURIComponent(escape(atob(w.nickname)));z.length>0?this.pokemonNameText.setText(z):this.pokemonNameText.setText(this.lastSpecies.name),_.setMode(L.STARTER_SELECT)},()=>{_.setMode(L.STARTER_SELECT)}]},W),!0},"handler")});const F=E.candyCount,he=p(()=>{const W=[];if(!(U&Ke.UNLOCKED)){const Y=Os(Le[this.lastSpecies.speciesId]);W.push({label:`x${Y} ${S.t("starterSelectUiHandler:unlockPassive")} (${Fe[this.lastSpecies.getPassiveAbility()].name})`,handler:p(()=>pe.FREE_CANDY_UPGRADE_OVERRIDE||F>=Y?(E.passiveAttr|=Ke.UNLOCKED|Ke.ENABLED,pe.FREE_CANDY_UPGRADE_OVERRIDE||(E.candyCount-=Y),this.pokemonCandyCountText.setText(`x${E.candyCount}`),n.gameData.saveSystem().then(G=>{if(!G)return n.reset(!0)}),_.setMode(L.STARTER_SELECT),this.setSpeciesDetails(this.lastSpecies),n.playSound("se/buy"),b&&(this.updateCandyUpgradeDisplay(b),b.starterPassiveBgs.setVisible(!!n.gameData.starterData[this.lastSpecies.speciesId].passiveAttr)),!0):!1,"handler"),item:"candy",itemArgs:Ye[this.lastSpecies.speciesId]})}const de=E.valueReduction;if(de<tl){const Y=As(Le[this.lastSpecies.speciesId])[de];W.push({label:`x${Y} ${S.t("starterSelectUiHandler:reduceCost")}`,handler:p(()=>pe.FREE_CANDY_UPGRADE_OVERRIDE||F>=Y?(E.valueReduction++,pe.FREE_CANDY_UPGRADE_OVERRIDE||(E.candyCount-=Y),this.pokemonCandyCountText.setText(`x${E.candyCount}`),n.gameData.saveSystem().then(G=>{if(!G)return n.reset(!0)}),this.tryUpdateValue(0),_.setMode(L.STARTER_SELECT),n.playSound("se/buy"),b&&(this.updateStarterValueLabel(b),this.updateCandyUpgradeDisplay(b)),!0):!1,"handler"),item:"candy",itemArgs:Ye[this.lastSpecies.speciesId]})}const z=ks(Le[this.lastSpecies.speciesId]);W.push({label:`x${z} ${S.t("starterSelectUiHandler:sameSpeciesEgg")}`,handler:p(()=>pe.FREE_CANDY_UPGRADE_OVERRIDE||F>=z?n.gameData.eggs.length>=99&&!pe.UNLIMITED_EGG_COUNT_OVERRIDE?(this.showText(S.t("egg:tooManyEggs"),void 0,()=>this.showText("",0,()=>this.tutorialActive=!1),2e3,!1,void 0,!0),!1):(pe.FREE_CANDY_UPGRADE_OVERRIDE||(E.candyCount-=z),this.pokemonCandyCountText.setText(`x${E.candyCount}`),new Gr({species:this.lastSpecies.speciesId,sourceType:Ll.SAME_SPECIES_EGG}).addEggToGameData(),n.gameData.saveSystem().then(G=>{if(!G)return n.reset(!0)}),_.setMode(L.STARTER_SELECT),n.playSound("se/buy"),b&&this.updateCandyUpgradeDisplay(b),!0):!1,"handler"),item:"candy",itemArgs:Ye[this.lastSpecies.speciesId]}),W.push({label:S.t("menu:cancel"),handler:p(()=>(_.setMode(L.STARTER_SELECT),!0),"handler")}),_.setModeWithoutClear(L.OPTION_SELECT,{options:W,yOffset:47})},"showUseCandies");A.push({label:S.t("menuUiHandler:POKEDEX"),handler:p(()=>(_.setMode(L.STARTER_SELECT).then(()=>{const W={shiny:w.shiny,variant:w.variant,form:w.form,female:w.female};_.setOverlayMode(L.POKEDEX_PAGE,this.lastSpecies,W)}),!0),"handler")}),It.hasOwnProperty(this.lastSpecies.speciesId)||A.push({label:S.t("starterSelectUiHandler:useCandies"),handler:p(()=>(_.setMode(L.STARTER_SELECT).then(()=>he()),!0),"handler")}),A.push({label:S.t("menu:cancel"),handler:p(()=>(_.setMode(L.STARTER_SELECT),!0),"handler")}),_.setModeWithoutClear(L.OPTION_SELECT,{options:A,yOffset:47}),u=!0}}else{const _=n.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId));switch(e){case I.CYCLE_SHINY:if(this.canCycleShiny)if(w.shiny===!1){const A=n.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId)),D=w.variant?w.variant:A.variant;this.setSpeciesDetails(this.lastSpecies,{shiny:!0,variant:D}),n.playSound("se/sparkle");const j=$e(D);this.pokemonShinyIcon.setFrame(ct(D)),this.pokemonShinyIcon.setTint(j),this.pokemonShinyIcon.setVisible(!0),w.shiny=!0}else{let A=_.variant;do if(A=(A+1)%3,A===0){if(this.speciesStarterDexEntry.caughtAttr&Z.DEFAULT_VARIANT)break}else if(A===1){if(this.speciesStarterDexEntry.caughtAttr&Z.VARIANT_2)break}else if(this.speciesStarterDexEntry.caughtAttr&Z.VARIANT_3)break;while(A!==_.variant);if(w.variant=A,this.speciesStarterDexEntry.caughtAttr&Z.NON_SHINY&&A<=_.variant)this.setSpeciesDetails(this.lastSpecies,{shiny:!1,variant:0}),this.pokemonShinyIcon.setVisible(!1),u=!0,w.shiny=!1;else{this.setSpeciesDetails(this.lastSpecies,{variant:A});const D=$e(A);this.pokemonShinyIcon.setFrame(ct(A)),this.pokemonShinyIcon.setTint(D),u=!0}}break;case I.CYCLE_FORM:if(this.canCycleForm){const A=this.lastSpecies.forms.length;let D=_.formIndex;do if(D=(D+1)%A,this.lastSpecies.forms[D].isStarterSelectable&&this.speciesStarterDexEntry.caughtAttr&n.gameData.getFormAttr(D))break;while(D!==_.formIndex);w.form=D,w.tera=this.lastSpecies.forms[D].type1,this.setSpeciesDetails(this.lastSpecies,{formIndex:D,teraType:w.tera}),u=!0}break;case I.CYCLE_GENDER:this.canCycleGender&&(w.female=!_.female,this.setSpeciesDetails(this.lastSpecies,{female:!_.female}),u=!0);break;case I.CYCLE_ABILITY:if(this.canCycleAbility){const A=this.lastSpecies.getAbilityCount(),D=n.gameData.starterData[this.lastSpecies.speciesId].abilityAttr,j=D&Xe.ABILITY_1;let B=this.abilityCursor;do if(B=(B+1)%A,B===0){if(j)break}else if(B===1){this.lastSpecies.ability1===this.lastSpecies.ability2&&j&&(B=(B+1)%A);break}else if(D&Xe.ABILITY_HIDDEN)break;while(B!==this.abilityCursor);w.ability=B;const{visible:$}=n.ui.getTooltip();if($&&this.activeTooltip==="ABILITY"){const ie=Fe[this.lastSpecies.getAbility(B)];n.ui.editTooltip(`${ie.name}`,`${ie.description}`)}this.setSpeciesDetails(this.lastSpecies,{abilityIndex:B}),u=!0}break;case I.CYCLE_NATURE:if(this.canCycleNature){const A=n.gameData.getNaturesForAttr((m=this.speciesStarterDexEntry)==null?void 0:m.natureAttr),D=A.indexOf(this.natureCursor),j=A[D<A.length-1?D+1:0];w.nature=j,this.setSpeciesDetails(this.lastSpecies,{natureIndex:j}),u=!0}break;case I.CYCLE_TERA:if(this.canCycleTera){const A=Ct(this.lastSpecies.speciesId,w.form??0);A.type1===this.teraCursor&&!ve(A.type2)?(w.tera=A.type2,this.setSpeciesDetails(this.lastSpecies,{teraType:A.type2})):(w.tera=A.type1,this.setSpeciesDetails(this.lastSpecies,{teraType:A.type1})),u=!0}break;case I.UP:this.starterIconsCursorObj.visible?(this.starterIconsCursorIndex===0?(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null),this.randomCursorObj.setVisible(!0)):(this.starterIconsCursorIndex--,this.moveStarterIconsCursor(this.starterIconsCursorIndex)),u=!0):a>0?(this.scrollCursor>0&&a-this.scrollCursor===0&&(this.scrollCursor--,this.updateScroll()),u=this.setCursor(this.cursor-9)):(this.filterBarCursor=this.filterBar.getNearestFilter(this.filteredStarterContainers[this.cursor]),this.setFilterMode(!0),u=!0);break;case I.DOWN:this.starterIconsCursorObj.visible?(this.starterIconsCursorIndex<=this.starterSpecies.length-2?(this.starterIconsCursorIndex++,this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null),this.startCursorObj.setVisible(!0)),u=!0):a<r-1?(a-this.scrollCursor===8&&this.scrollCursor++,u=this.setCursor(this.cursor+9),this.updateScroll()):r>1?(this.scrollCursor=0,this.updateScroll(),u=this.setCursor(this.cursor%9)):(this.filterBarCursor=this.filterBar.getNearestFilter(this.filteredStarterContainers[this.cursor]),this.setFilterMode(!0),u=!0);break;case I.LEFT:if(!this.starterIconsCursorObj.visible)this.cursor%9!==0?u=this.setCursor(this.cursor-1):(d===0?(this.cursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0)):this.starterSpecies.length===0?u=this.setCursor(this.cursor+Math.min(8,i-this.cursor)):d<7?(this.cursorObj.setVisible(!1),this.starterIconsCursorIndex=il(this.cursorObj.y-1,this.starterSpecies.length),this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.cursorObj.setVisible(!1),this.setSpecies(null),this.startCursorObj.setVisible(!0)),u=!0);else if(i>0){const A=nl(this.starterIconsCursorIndex,c);this.starterIconsCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(Math.min(o+A*9+8,l)),u=!0}else u=!1;break;case I.RIGHT:if(!this.starterIconsCursorObj.visible)this.cursor%9<(a<r-1?8:(i-1)%9)?u=this.setCursor(this.cursor+1):(d===0?(this.cursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0)):this.starterSpecies.length===0?u=this.setCursor(this.cursor-Math.min(8,this.cursor%9)):d<7?(this.cursorObj.setVisible(!1),this.starterIconsCursorIndex=il(this.cursorObj.y-1,this.starterSpecies.length),this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.cursorObj.setVisible(!1),this.setSpecies(null),this.startCursorObj.setVisible(!0)),u=!0);else if(i>0){const A=nl(this.starterIconsCursorIndex,c);this.starterIconsCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(Math.min(o+A*9,l-l%9)),u=!0}else u=!1;break}}}return u?f.playSelect():C&&f.playError(),u||C}isInParty(e){let t=0,s=!1;for(let i=0;i<this.starterSpecies.length;i++)if(this.starterSpecies[i]===e){s=!0,t=i;break}return[s,t]}addToParty(e,t,s,i,r,a,o=!1){const l=n.gameData.getSpeciesDexAttrProps(e,t);this.starterIcons[this.starterSpecies.length].setTexture(e.getIconAtlasKey(l.formIndex,l.shiny,l.variant)),this.starterIcons[this.starterSpecies.length].setFrame(e.getIconId(l.female,l.formIndex,l.shiny,l.variant)),this.checkIconId(this.starterIcons[this.starterSpecies.length],e,l.female,l.formIndex,l.shiny,l.variant),this.starterSpecies.push(e),this.starterAttr.push(t),this.starterAbilityIndexes.push(s),this.starterNatures.push(i),this.starterTeras.push(a),this.starterMovesets.push(r),(this.speciesLoaded.get(e.speciesId)||o)&&Ct(e.speciesId,l.formIndex).cry(),this.updateInstructions()}updatePartyIcon(e,t){const s=n.gameData.getSpeciesDexAttrProps(e,this.getCurrentDexProps(e.speciesId));this.starterIcons[t].setTexture(e.getIconAtlasKey(s.formIndex,s.shiny,s.variant)),this.starterIcons[t].setFrame(e.getIconId(s.female,s.formIndex,s.shiny,s.variant)),this.checkIconId(this.starterIcons[t],e,s.female,s.formIndex,s.shiny,s.variant)}switchMoveHandler(e,t,s){var o,l,h,c,d;const i=this.lastSpecies.speciesId,r=(o=this.starterMoveset)==null?void 0:o.indexOf(t);this.starterMoveset[e]=t,r>-1&&(this.starterMoveset[r]=s);const a=n.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.dexAttrCursor);if(xt.hasOwnProperty(i)){(!n.gameData.starterData[i].moveset||Array.isArray(n.gameData.starterData[i].moveset))&&(n.gameData.starterData[i].moveset={[a.formIndex]:(l=this.starterMoveset)==null?void 0:l.slice(0)});const f=n.gameData.starterData[i].moveset;f.hasOwnProperty(a.formIndex)||(n.gameData.starterData[i].moveset[a.formIndex]=(h=this.starterMoveset)==null?void 0:h.slice(0)),f.hasOwnProperty(a.formIndex)&&f[a.formIndex][r]!==t&&(n.gameData.starterData[i].moveset[a.formIndex]=(c=this.starterMoveset)==null?void 0:c.slice(0))}else n.gameData.starterData[i].moveset=(d=this.starterMoveset)==null?void 0:d.slice(0);this.setSpeciesDetails(this.lastSpecies,{forSeen:!1}),this.starterMovesets.length&&Array.from({length:this.starterSpecies.length},(f,u)=>{this.starterSpecies[u].speciesId===i&&(this.starterMovesets[u]=this.starterMoveset)})}updateButtonIcon(e,t,s,i){var a;let r;if(t==="touch")switch(t="keyboard",e){case oe.Button_Cycle_Shiny:r="R.png";break;case oe.Button_Cycle_Form:r="F.png";break;case oe.Button_Cycle_Gender:r="G.png";break;case oe.Button_Cycle_Ability:r="E.png";break;case oe.Button_Cycle_Nature:r="N.png";break;case oe.Button_Cycle_Tera:r="V.png";break;case oe.Button_Stats:r="C.png";break}else r=(a=n.inputController)==null?void 0:a.getIconForLatestInputRecorded(e);s.setTexture(t,r),s.setPosition(this.instructionRowX,this.instructionRowY),i.setPosition(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY),s.setVisible(!0),i.setVisible(!0),this.instructionsContainer.add([s,i]),this.instructionRowY+=8,this.instructionRowY>=24&&(this.instructionRowY=0,this.instructionRowX+=50)}updateFilterButtonIcon(e,t,s,i){var a;let r;t==="touch"?(t="keyboard",r="C.png"):r=(a=n.inputController)==null?void 0:a.getIconForLatestInputRecorded(e),s.setTexture(t,r),s.setPosition(this.filterInstructionRowX,this.filterInstructionRowY),i.setPosition(this.filterInstructionRowX+this.instructionRowTextOffset,this.filterInstructionRowY),s.setVisible(!0),i.setVisible(!0),this.filterInstructionsContainer.add([s,i]),this.filterInstructionRowY+=8,this.filterInstructionRowY>=24&&(this.filterInstructionRowY=0,this.filterInstructionRowX+=50)}updateInstructions(){var t;this.instructionRowX=0,this.instructionRowY=0,this.filterInstructionRowX=0,this.filterInstructionRowY=0,this.hideInstructions(),this.instructionsContainer.removeAll(),this.filterInstructionsContainer.removeAll();let e;n.inputMethod==="gamepad"?e=n.inputController.getConfig(n.inputController.selectedDevice[Se.GAMEPAD]).padType:e=n.inputMethod,e&&((t=this.speciesStarterDexEntry)!=null&&t.caughtAttr&&(this.canCycleShiny&&this.updateButtonIcon(oe.Button_Cycle_Shiny,e,this.shinyIconElement,this.shinyLabel),this.canCycleForm&&this.updateButtonIcon(oe.Button_Cycle_Form,e,this.formIconElement,this.formLabel),this.canCycleGender&&this.updateButtonIcon(oe.Button_Cycle_Gender,e,this.genderIconElement,this.genderLabel),this.canCycleAbility&&this.updateButtonIcon(oe.Button_Cycle_Ability,e,this.abilityIconElement,this.abilityLabel),this.canCycleNature&&this.updateButtonIcon(oe.Button_Cycle_Nature,e,this.natureIconElement,this.natureLabel),this.canCycleTera&&this.updateButtonIcon(oe.Button_Cycle_Tera,e,this.teraIconElement,this.teraLabel)),this.filterMode||this.updateFilterButtonIcon(oe.Button_Stats,e,this.goFilterIconElement,this.goFilterLabel))}getValueLimit(){const e=new Jt(0);switch(n.gameMode.modeId){case vs.ENDLESS:case vs.SPLICED_ENDLESS:e.value=15;break;default:e.value=10}return kh(Dh.STARTER_POINTS,e),e.value}destroy(){this.starterContainers=[]}setCursor(e){var s,i;let t=!1;if(this.filterMode)t=this.filterBarCursor!==e,this.filterBarCursor=e,this.filterBar.setCursor(e);else{e=Math.max(Math.min(this.filteredStarterContainers.length-1,e),0),t=super.setCursor(e);const r=wn(e,this.scrollCursor);this.cursorObj.setPosition(r.x-1,r.y+1);const a=(s=this.filteredStarterContainers[e])==null?void 0:s.species;if(a){const o=this.getCurrentDexProps(a.speciesId),l=n.gameData.getSpeciesDexAttrProps(a,o),h=(i=this.starterPreferences[a.speciesId])!=null&&i.variant?this.starterPreferences[a.speciesId].variant:l.variant,c=$e(h);this.pokemonShinyIcon.setFrame(ct(h)),this.pokemonShinyIcon.setTint(c),this.setSpecies(a),this.updateInstructions()}}return t}setFilterMode(e){return this.cursorObj.setVisible(!e),this.filterBar.cursorObj.setVisible(e),e!==this.filterMode?(this.filterMode=e,this.setCursor(e?this.filterBarCursor:this.cursor),e&&(this.setSpecies(null),this.updateInstructions()),!0):!1}moveStarterIconsCursor(e){this.starterIconsCursorObj.x=this.starterIcons[e].x+this.starterIconsCursorXOffset,this.starterIconsCursorObj.y=this.starterIcons[e].y+this.starterIconsCursorYOffset,this.starterSpecies.length>0?(this.starterIconsCursorObj.setVisible(!0),this.setSpecies(this.starterSpecies[e])):(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null))}getFriendship(e){let t=n.gameData.starterData[e].friendship;(!t||t===void 0)&&(t=0);const s=Ur(Le[e]);return{currentFriendship:t,friendshipCap:s}}setSpecies(e){var s,i,r,a;this.speciesStarterDexEntry=e?n.gameData.dexData[e.speciesId]:null,this.dexAttrCursor=e?this.getCurrentDexProps(e.speciesId):0n,this.abilityCursor=e?n.gameData.getStarterSpeciesDefaultAbilityIndex(e):0,this.natureCursor=e?n.gameData.getSpeciesDefaultNature(e):0,this.teraCursor=e?e.type1:Te.UNKNOWN,!e&&n.ui.getTooltip().visible&&n.ui.hideTooltip(),this.pokemonAbilityText.off("pointerover"),this.pokemonPassiveText.off("pointerover");const t=e?{...this.starterPreferences[e.speciesId]}:null;if(t!=null&&t.nature&&(this.natureCursor=t.nature),t!=null&&t.ability&&!Number.isNaN(t.ability)&&(this.abilityCursor=t.ability),t!=null&&t.tera&&(this.teraCursor=t.tera),this.statsMode&&((s=this.speciesStarterDexEntry)!=null&&s.caughtAttr?(this.statsContainer.setVisible(!0),this.showStats()):(this.statsContainer.setVisible(!1),this.statsContainer.updateIvs(null))),this.lastSpecies){const o=this.getCurrentDexProps(this.lastSpecies.speciesId),l=n.gameData.getSpeciesDexAttrProps(this.lastSpecies,o),h=this.allSpecies.indexOf(this.lastSpecies),c=this.starterContainers[h].icon;this.checkIconId(c,this.lastSpecies,l.female,l.formIndex,l.shiny,l.variant),this.iconAnimHandler.addOrUpdate(c,Ze.NONE);const d=this.starterContainers[h].icon;n.tweens.getTweensOf(d).forEach(f=>f.play())}if(this.lastSpecies=e,e&&((i=this.speciesStarterDexEntry)!=null&&i.seenAttr||(r=this.speciesStarterDexEntry)!=null&&r.caughtAttr)){if(this.pokemonNumberText.setText(Ot(e.speciesId,4)),t!=null&&t.nickname){const o=decodeURIComponent(escape(atob(t.nickname)));this.pokemonNameText.setText(o)}else this.pokemonNameText.setText(e.name);if((a=this.speciesStarterDexEntry)!=null&&a.caughtAttr){const o=Ye[e.speciesId],l=n.gameData.getDexAttrLuck(this.speciesStarterDexEntry.caughtAttr);this.pokemonLuckText.setVisible(!!l),this.pokemonLuckText.setText(l.toString()),this.pokemonLuckText.setTint($e(Math.min(l-1,2))),this.pokemonLuckLabelText.setVisible(this.pokemonLuckText.visible);let h=Tl(Al[e.growthRate]);const c=h.replace(" ","_");S.exists("growth:"+c)&&(h=S.t("growth:"+c)),this.pokemonGrowthRateText.setText(h),this.pokemonGrowthRateText.setColor(ui(e.growthRate)),this.pokemonGrowthRateText.setShadowColor(ui(e.growthRate,!0)),this.pokemonGrowthRateLabelText.setVisible(!0),this.pokemonUncaughtText.setVisible(!1),this.pokemonAbilityLabelText.setVisible(!0),this.pokemonPassiveLabelText.setVisible(!0),this.pokemonNatureLabelText.setVisible(!0),this.pokemonCaughtCountText.setText(`${this.speciesStarterDexEntry.caughtCount}`),e.speciesId===ge.MANAPHY||e.speciesId===ge.PHIONE?this.pokemonHatchedIcon.setFrame("manaphy"):this.pokemonHatchedIcon.setFrame(Qt(e)),this.pokemonHatchedCountText.setText(`${this.speciesStarterDexEntry.hatchedCount}`);const d=this.getCurrentDexProps(e.speciesId),f=n.gameData.getSpeciesDexAttrProps(e,d),u=f.variant,C=$e(u);if(this.pokemonShinyIcon.setFrame(ct(u)),this.pokemonShinyIcon.setTint(C),this.pokemonShinyIcon.setVisible(f.shiny),this.pokemonCaughtHatchedContainer.setVisible(!0),this.pokemonFormText.setVisible(!0),It.hasOwnProperty(e.speciesId))this.pokemonCaughtHatchedContainer.setY(16),this.pokemonShinyIcon.setY(135),this.pokemonShinyIcon.setFrame(ct(u)),[this.pokemonCandyContainer,this.pokemonHatchedIcon,this.pokemonHatchedCountText].map(w=>w.setVisible(!1)),this.pokemonFormText.setY(25);else{this.pokemonCaughtHatchedContainer.setY(25),this.pokemonShinyIcon.setY(117),this.pokemonCandyIcon.setTint(pt(it(o[0]))),this.pokemonCandyOverlayIcon.setTint(pt(it(o[1]))),this.pokemonCandyCountText.setText(`x${n.gameData.starterData[e.speciesId].candyCount}`),this.pokemonCandyContainer.setVisible(!0),this.pokemonFormText.setY(42),this.pokemonHatchedIcon.setVisible(!0),this.pokemonHatchedCountText.setVisible(!0);const{currentFriendship:w,friendshipCap:_}=this.getFriendship(this.lastSpecies.speciesId),A=16-16*(w/_);this.pokemonCandyDarknessOverlay.setCrop(0,0,16,A),this.pokemonCandyContainer.on("pointerover",()=>{n.ui.showTooltip("",`${w}/${_}`,!0),this.activeTooltip="CANDY"}),this.pokemonCandyContainer.on("pointerout",()=>{n.ui.hideTooltip(),this.activeTooltip=void 0})}const g=this.allSpecies.indexOf(e),v=this.starterContainers[g].icon;this.isUpgradeAnimationEnabled()&&(n.tweens.getTweensOf(v).forEach(w=>w.pause()),v.x=-2,v.y=2),this.iconAnimHandler.addOrUpdate(v,Ze.PASSIVE);const m=this.starterSpecies.indexOf(e);let b;if(m>-1)b=n.gameData.getSpeciesDexAttrProps(e,this.starterAttr[m]),this.setSpeciesDetails(e,{shiny:b.shiny,formIndex:b.formIndex,female:b.female,variant:b.variant,abilityIndex:this.starterAbilityIndexes[m],natureIndex:this.starterNatures[m],teraType:this.starterTeras[m]});else{const w=this.getCurrentDexProps(e.speciesId),_=(t==null?void 0:t.ability)??n.gameData.getStarterSpeciesDefaultAbilityIndex(e),A=(t==null?void 0:t.nature)||n.gameData.getSpeciesDefaultNature(e);b=n.gameData.getSpeciesDexAttrProps(e,w),t!=null&&t.variant&&!Number.isNaN(t.variant)&&b.shiny&&(b.variant=t.variant),b.formIndex=(t==null?void 0:t.form)??b.formIndex,b.female=(t==null?void 0:t.female)??b.female,this.setSpeciesDetails(e,{shiny:b.shiny,formIndex:b.formIndex,female:b.female,variant:b.variant,abilityIndex:_,natureIndex:A})}const E=Ct(e.speciesId,b.formIndex);this.setTypeIcons(E.type1,E.type2),this.pokemonSprite.clearTint(),this.pokerusSpecies.includes(e)&&ws(Ls.Pokerus)}else{this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1),this.pokemonShinyIcon.setVisible(!1),this.pokemonUncaughtText.setVisible(!0),this.pokemonAbilityLabelText.setVisible(!1),this.pokemonPassiveLabelText.setVisible(!1),this.pokemonNatureLabelText.setVisible(!1),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1),this.teraIcon.setVisible(!1);const o=n.gameData.getSpeciesDefaultDexAttr(e,!0,!0),l=n.gameData.getStarterSpeciesDefaultAbilityIndex(e),h=n.gameData.getSpeciesDefaultNature(e),c=n.gameData.getSpeciesDexAttrProps(e,o);this.setSpeciesDetails(e,{shiny:c.shiny,formIndex:c.formIndex,female:c.female,variant:c.variant,abilityIndex:l,natureIndex:h,forSeen:!0}),this.pokemonSprite.setTint(8421504)}}else this.pokemonNumberText.setText(Ot(0,4)),this.pokemonNameText.setText(e?"???":""),this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1),this.pokemonShinyIcon.setVisible(!1),this.pokemonUncaughtText.setVisible(!!e),this.pokemonAbilityLabelText.setVisible(!1),this.pokemonPassiveLabelText.setVisible(!1),this.pokemonNatureLabelText.setVisible(!1),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1),this.teraIcon.setVisible(!1),this.setSpeciesDetails(e,{shiny:!1,formIndex:0,female:!1,variant:0,abilityIndex:0,natureIndex:0}),this.pokemonSprite.clearTint()}setSpeciesDetails(e,t={}){var v,m,b,E,w,_;let{shiny:s,formIndex:i,female:r,variant:a,abilityIndex:o,natureIndex:l,teraType:h}=t;const c=t.forSeen??!1,d=e?n.gameData.getSpeciesDexAttrProps(e,this.dexAttrCursor):null,f=this.abilityCursor>-1?this.abilityCursor:n.gameData.getStarterSpeciesDefaultAbilityIndex(e),u=this.natureCursor>-1?this.natureCursor:n.gameData.getSpeciesDefaultNature(e);this.dexAttrCursor=0n,this.abilityCursor=-1,this.natureCursor=-1,this.teraCursor=Te.UNKNOWN;const C=(e==null?void 0:e.genderDiffs)&&!ve(r)||!ve(i)||!ve(s)||!ve(a);if(this.activeTooltip==="CANDY")if(this.lastSpecies&&this.pokemonCandyContainer.visible){const{currentFriendship:A,friendshipCap:D}=this.getFriendship(this.lastSpecies.speciesId);n.ui.editTooltip("",`${A}/${D}`)}else n.ui.hideTooltip();if((v=e==null?void 0:e.forms)!=null&&v.find(A=>A.formKey==="female")&&(r!==void 0?i=r?1:0:i!==void 0&&(r=i===1)),e){this.dexAttrCursor|=(s!==void 0?!s:!(s=d==null?void 0:d.shiny))?Z.NON_SHINY:Z.SHINY,this.dexAttrCursor|=(r!==void 0?!r:!(r=d==null?void 0:d.female))?Z.MALE:Z.FEMALE,this.dexAttrCursor|=(a!==void 0?!a:!(a=d==null?void 0:d.variant))?Z.DEFAULT_VARIANT:a===1?Z.VARIANT_2:Z.VARIANT_3,this.dexAttrCursor|=n.gameData.getFormAttr(i!==void 0?i:i=d.formIndex),this.abilityCursor=o!==void 0?o:o=f,this.natureCursor=l!==void 0?l:l=u,this.teraCursor=ve(h)?h=e.type1:h;const[A,D]=this.isInParty(e);A&&this.updatePartyIcon(e,D)}if(this.pokemonSprite.setVisible(!1),this.pokemonPassiveLabelText.setVisible(!1),this.pokemonPassiveText.setVisible(!1),this.pokemonPassiveDisabledIcon.setVisible(!1),this.pokemonPassiveLockedIcon.setVisible(!1),this.teraIcon.setVisible(!1),this.assetLoadCancelled&&(this.assetLoadCancelled.value=!0,this.assetLoadCancelled=null),this.starterMoveset=null,this.speciesStarterMoves=[],e){const A=n.gameData.dexData[e.speciesId],D=n.gameData.starterData[e.speciesId].abilityAttr,j=((m=n.gameData.dexData[e.speciesId])==null?void 0:m.caughtAttr)||BigInt(0);if(!A.caughtAttr){const B=n.gameData.getSpeciesDexAttrProps(e,this.getCurrentDexProps(e.speciesId)),$=n.gameData.getStarterSpeciesDefaultAbilityIndex(e),ie=n.gameData.getSpeciesDefaultNature(e);(s===void 0||s!==B.shiny)&&(s=B.shiny),(i===void 0||i!==B.formIndex)&&(i=B.formIndex),(r===void 0||r!==B.female)&&(r=B.female),(a===void 0||a!==B.variant)&&(a=B.variant),(o===void 0||o!==$)&&(o=$),(l===void 0||l!==ie)&&(l=ie)}if(this.shinyOverlay.setVisible(s??!1),this.pokemonNumberText.setColor(this.getTextColor(s?x.SUMMARY_GOLD:x.SUMMARY,!1)),this.pokemonNumberText.setShadowColor(this.getTextColor(s?x.SUMMARY_GOLD:x.SUMMARY,!0)),c?(b=this.speciesStarterDexEntry)!=null&&b.seenAttr:(E=this.speciesStarterDexEntry)!=null&&E.caughtAttr){const B=this.starterSpecies.indexOf(e);B>-1&&(this.starterAttr[B]=this.dexAttrCursor,this.starterAbilityIndexes[B]=this.abilityCursor,this.starterNatures[B]=this.natureCursor,this.starterTeras[B]=this.teraCursor);const $=new ft(!1);this.assetLoadCancelled=$,C?e.loadAssets(r,i,s,a,!0).then(()=>{$.value||(this.assetLoadCancelled=null,this.speciesLoaded.set(e.speciesId,!0),this.pokemonSprite.play(e.getSpriteKey(r,i,s,a)),this.pokemonSprite.setPipelineData("shiny",s),this.pokemonSprite.setPipelineData("variant",a),this.pokemonSprite.setPipelineData("spriteKey",e.getSpriteKey(r,i,s,a)),this.pokemonSprite.setVisible(!this.statsMode))}):this.pokemonSprite.setVisible(!this.statsMode);const ie=this.filteredStarterContainers.find(Y=>Y.species.speciesId===e.speciesId);ie&&(ie.icon.setTexture(e.getIconAtlasKey(i,s,a),e.getIconId(r,i,s,a)),ie.checkIconId(r,i,s,a));const k=!!(j&Z.NON_SHINY),U=!!(j&Z.SHINY),T=[Z.DEFAULT_VARIANT,Z.VARIANT_2,Z.VARIANT_3].filter(Y=>j&Y);this.canCycleShiny=k&&U||U&&T.length>1;const F=!!(j&Z.MALE),he=!!(j&Z.FEMALE);this.canCycleGender=F&&he;const W=D&Xe.ABILITY_1;let de=D&Xe.ABILITY_2;const z=D&Xe.ABILITY_HIDDEN;W&&de&&e.ability1===e.ability2&&(de=0),this.canCycleAbility=[W,de,z].filter(Y=>Y).length>1,this.canCycleForm=e.forms.filter(Y=>{var G;return Y.isStarterSelectable||!((G=Ms[e.speciesId])!=null&&G.find(R=>R.formKey))}).map((Y,G)=>A.caughtAttr&n.gameData.getFormAttr(G)).filter(Y=>Y).length>1,this.canCycleNature=n.gameData.getNaturesForAttr(A.natureAttr).length>1,this.canCycleTera=!this.statsMode&&n.gameData.achvUnlocks.hasOwnProperty(Ge.TERASTALLIZE.id)&&!ve(Ct(e.speciesId,i??0).type2)}if(A.caughtAttr&&e.malePercent!==null){const B=r?kt.FEMALE:kt.MALE;this.pokemonGenderText.setText(kl(B)),this.pokemonGenderText.setColor(pi(B)),this.pokemonGenderText.setShadowColor(pi(B,!0))}else this.pokemonGenderText.setText("");if(A.caughtAttr){let B;((w=this.lastSpecies.forms)==null?void 0:w.length)>1?B=Fe[this.lastSpecies.forms[i??0].getAbility(o)]:B=Fe[this.lastSpecies.getAbility(o)],this.pokemonAbilityText.setText(B.name);const $=o===(this.lastSpecies.ability2?2:1);this.pokemonAbilityText.setColor(this.getTextColor($?x.SUMMARY_GOLD:x.SUMMARY_ALT)),this.pokemonAbilityText.setShadowColor(this.getTextColor($?x.SUMMARY_GOLD:x.SUMMARY_ALT,!0));const ie=n.gameData.starterData[e.speciesId].passiveAttr,k=Fe[this.lastSpecies.getPassiveAbility(i)];if(this.pokemonAbilityText.visible&&(this.activeTooltip==="ABILITY"&&n.ui.editTooltip(`${B.name}`,`${B.description}`),this.pokemonAbilityText.on("pointerover",()=>{n.ui.showTooltip(`${B.name}`,`${B.description}`,!0),this.activeTooltip="ABILITY"}),this.pokemonAbilityText.on("pointerout",()=>{n.ui.hideTooltip(),this.activeTooltip=void 0})),k){const z=!!(ie&Ke.UNLOCKED),Y=!!(ie&Ke.ENABLED),G=z&&Y?x.SUMMARY_ALT:x.SUMMARY_GRAY,R=z&&Y?1:.5;this.pokemonPassiveLabelText.setVisible(!0),this.pokemonPassiveLabelText.setColor(this.getTextColor(x.SUMMARY_ALT)),this.pokemonPassiveLabelText.setShadowColor(this.getTextColor(x.SUMMARY_ALT,!0)),this.pokemonPassiveText.setVisible(!0),this.pokemonPassiveText.setText(k.name),this.pokemonPassiveText.setColor(this.getTextColor(G)),this.pokemonPassiveText.setAlpha(R),this.pokemonPassiveText.setShadowColor(this.getTextColor(G,!0)),this.activeTooltip==="PASSIVE"&&n.ui.editTooltip(`${k.name}`,`${k.description}`),this.pokemonPassiveText.visible&&(this.pokemonPassiveText.on("pointerover",()=>{n.ui.showTooltip(`${k.name}`,`${k.description}`,!0),this.activeTooltip="PASSIVE"}),this.pokemonPassiveText.on("pointerout",()=>{n.ui.hideTooltip(),this.activeTooltip=void 0}));const ce={x:this.pokemonPassiveText.x+this.pokemonPassiveText.displayWidth+1,y:this.pokemonPassiveText.y+this.pokemonPassiveText.displayHeight/2};this.pokemonPassiveDisabledIcon.setVisible(z&&!Y),this.pokemonPassiveDisabledIcon.setPosition(ce.x,ce.y),this.pokemonPassiveLockedIcon.setVisible(!z),this.pokemonPassiveLockedIcon.setPosition(ce.x,ce.y)}else this.activeTooltip==="PASSIVE"&&n.ui.hideTooltip();this.pokemonNatureText.setText(gn(l,!0,!0,!1,n.uiTheme));let U;if(xt.hasOwnProperty(e.speciesId)&&i&&xt[e.speciesId].hasOwnProperty(i)?U=xt[e.speciesId][i]:U=fi[e.speciesId],this.speciesStarterMoves.push(...U.filter(z=>z[0]>0&&z[0]<=5).map(z=>z[1])),dt.hasOwnProperty(e.speciesId))for(let z=0;z<4;z++)n.gameData.starterData[e.speciesId].eggMoves&1<<z&&this.speciesStarterMoves.push(dt[e.speciesId][z]);const T=n.gameData.starterData[e.speciesId].moveset,F=T?Array.isArray(T)?T:T[i]:null,he=this.speciesStarterMoves.concat(dt.hasOwnProperty(e.speciesId)?dt[e.speciesId].filter((z,Y)=>n.gameData.starterData[e.speciesId].eggMoves&1<<Y):[]);this.starterMoveset=(F||this.speciesStarterMoves.slice(0,4)).filter(z=>he.find(Y=>Y===z)),this.starterMoveset.length<4&&this.starterMoveset.length<he.length&&this.starterMoveset.push(...he.filter(z=>{var Y;return((Y=this.starterMoveset)==null?void 0:Y.indexOf(z))===-1}).slice(0,4-this.starterMoveset.length)),this.starterMoveset=this.starterMoveset.filter((z,Y)=>{var G;return((G=this.starterMoveset)==null?void 0:G.indexOf(z))===Y});const W=Ct(e.speciesId,i),de=e.getFormNameToDisplay(i);this.pokemonFormText.setText(de),this.setTypeIcons(W.type1,W.type2),this.teraIcon.setFrame(Te[this.teraCursor].toLowerCase()),this.teraIcon.setVisible(!this.statsMode&&n.gameData.achvUnlocks.hasOwnProperty(Ge.TERASTALLIZE.id))}else this.pokemonAbilityText.setText(""),this.pokemonPassiveText.setText(""),this.pokemonNatureText.setText(""),this.teraIcon.setVisible(!1),this.setTypeIcons(null,null)}else this.shinyOverlay.setVisible(!1),this.pokemonNumberText.setColor(this.getTextColor(x.SUMMARY)),this.pokemonNumberText.setShadowColor(this.getTextColor(x.SUMMARY,!0)),this.pokemonGenderText.setText(""),this.pokemonAbilityText.setText(""),this.pokemonPassiveText.setText(""),this.pokemonNatureText.setText(""),this.teraIcon.setVisible(!1),this.setTypeIcons(null,null);this.starterMoveset||(this.starterMoveset=this.speciesStarterMoves.slice(0,4));for(let A=0;A<4;A++){const D=A<this.starterMoveset.length?_e[this.starterMoveset[A]]:null;this.pokemonMoveBgs[A].setFrame(Te[D?D.type:Te.UNKNOWN].toString().toLowerCase()),this.pokemonMoveLabels[A].setText(D?D.name:"-"),this.pokemonMoveContainers[A].setVisible(!!D)}const g=e&&dt.hasOwnProperty(e.speciesId);for(let A=0;A<4;A++){const D=g?_e[dt[e.speciesId][A]]:null,j=D&&n.gameData.starterData[e.speciesId].eggMoves&1<<A;this.pokemonEggMoveBgs[A].setFrame(Te[D?D.type:Te.UNKNOWN].toString().toLowerCase()),this.pokemonEggMoveLabels[A].setText(D&&j?D.name:"???")}this.pokemonEggMovesContainer.setVisible(!!((_=this.speciesStarterDexEntry)!=null&&_.caughtAttr)&&g),this.pokemonAdditionalMoveCountLabel.setText(`(+${Math.max(this.speciesStarterMoves.length-4,0)})`),this.pokemonAdditionalMoveCountLabel.setVisible(this.speciesStarterMoves.length>4),this.tryUpdateValue(),this.updateInstructions()}setTypeIcons(e,t){e!==null?(this.type1Icon.setVisible(!0),this.type1Icon.setFrame(Te[e].toLowerCase())):this.type1Icon.setVisible(!1),t!==null?(this.type2Icon.setVisible(!0),this.type2Icon.setFrame(Te[t].toLowerCase())):this.type2Icon.setVisible(!1)}popStarter(e){this.starterSpecies.splice(e,1),this.starterAttr.splice(e,1),this.starterAbilityIndexes.splice(e,1),this.starterNatures.splice(e,1),this.starterTeras.splice(e,1),this.starterMovesets.splice(e,1);for(let t=0;t<this.starterSpecies.length;t++){const s=this.starterSpecies[t],i=this.getCurrentDexProps(s.speciesId),r=n.gameData.getSpeciesDexAttrProps(s,i);this.starterIcons[t].setTexture(s.getIconAtlasKey(r.formIndex,r.shiny,r.variant)),this.starterIcons[t].setFrame(s.getIconId(r.female,r.formIndex,r.shiny,r.variant)),this.checkIconId(this.starterIcons[t],s,r.female,r.formIndex,r.shiny,r.variant),t>=e&&(this.starterCursorObjs[t].setPosition(this.starterCursorObjs[t+1].x,this.starterCursorObjs[t+1].y),this.starterCursorObjs[t].setVisible(this.starterCursorObjs[t+1].visible))}this.starterCursorObjs[this.starterSpecies.length].setVisible(!1),this.starterIcons[this.starterSpecies.length].setTexture("pokemon_icons_0"),this.starterIcons[this.starterSpecies.length].setFrame("unknown"),this.starterIconsCursorObj.visible?(this.starterIconsCursorIndex===this.starterSpecies.length&&(this.starterSpecies.length>0?this.starterIconsCursorIndex--:(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null),this.filterBarCursor=Math.max(1,this.filterBar.numFilters-1),this.setFilterMode(!0))),this.moveStarterIconsCursor(this.starterIconsCursorIndex)):this.startCursorObj.visible&&this.starterSpecies.length===0&&(this.startCursorObj.setVisible(!1),this.filteredStarterContainers.length>0?(this.cursorObj.setVisible(!0),this.setCursor(0+this.scrollCursor*9)):(this.filterBarCursor=Math.max(1,this.filterBar.numFilters-1),this.setFilterMode(!0))),this.tryUpdateValue()}updateStarterValueLabel(e){const t=e.species.speciesId,s=Le[t],i=n.gameData.getSpeciesStarterValue(t);e.cost=i;let r=i.toString();r.startsWith("0.")&&(r=r.slice(1)),e.label.setText(r);let a;switch(s-i){case 0:a=x.WINDOW;break;case 1:case .5:a=x.SUMMARY_BLUE;break;default:a=x.SUMMARY_GOLD;break}s-i>0&&(e.label.setColor(this.getTextColor(a)),e.label.setShadowColor(this.getTextColor(a,!0)))}tryUpdateValue(e,t){const i=this.starterSpecies.map(c=>c.generation).reduce((c,d,f)=>c+=n.gameData.getSpeciesStarterValue(this.starterSpecies[f].speciesId),0)+(e||0),r=this.getValueLimit(),a=i>r;let o=i.toString();if(o.startsWith("0.")&&(o=o.slice(1)),this.valueLimitLabel.setText(`${o}/${r}`),this.valueLimitLabel.setColor(this.getTextColor(a?x.SUMMARY_PINK:x.TOOLTIP_CONTENT)),this.valueLimitLabel.setShadowColor(this.getTextColor(a?x.SUMMARY_PINK:x.TOOLTIP_CONTENT,!0)),a)return n.time.delayedCall(ye(500),()=>this.tryUpdateValue()),!1;let l=this.isPartyValid();if(t){const c=this.filteredStarterContainers[this.cursor].species,d=Wt(c,n.gameData.getSpeciesDexAttrProps(c,this.getCurrentDexProps(c.speciesId)),!1);l=l||d}const h=r-i;for(let c=0;c<this.allSpecies.length;c++){const d=n.gameData.getSpeciesStarterValue(this.allSpecies[c].speciesId),f=this.starterContainers[c].icon,u=Wt(this.allSpecies[c],n.gameData.getSpeciesDexAttrProps(this.allSpecies[c],this.getCurrentDexProps(this.allSpecies[c].speciesId)),l),C=h>=d&&u,g=this.isInParty(this.allSpecies[c])[0];C||g&&h>=d?f.setAlpha(1):f.setAlpha(.375)}return!0}tryExit(){this.blockInput=!0;const e=this.getUi(),t=p(()=>{e.setMode(L.STARTER_SELECT),this.clearText(),this.blockInput=!1},"cancel");return e.showText(S.t("starterSelectUiHandler:confirmExit"),null,()=>{e.setModeWithoutClear(L.CONFIRM,()=>{var s;e.setMode(L.STARTER_SELECT),n.clearPhaseQueue(),n.gameMode.isChallenge?(n.pushPhase(new Mh),n.pushPhase(new Ml)):n.pushPhase(new Yr),this.clearText(),(s=n.getCurrentPhase())==null||s.end()},t,null,null,19)}),!0}tryStart(e=!1){if(!this.starterSpecies.length)return!1;const t=this.getUi(),s=p(()=>{t.setMode(L.STARTER_SELECT),e||this.popStarter(this.starterSpecies.length-1),this.clearText()},"cancel");return this.isPartyValid()?t.showText(S.t("starterSelectUiHandler:confirmStartTeam"),null,()=>{t.setModeWithoutClear(L.CONFIRM,()=>{p(()=>{n.money=n.gameMode.getStartingMoney(),t.setMode(L.STARTER_SELECT);const a=this,o=this.starterSelectCallback;this.starterSelectCallback=null,o==null||o(new Array(this.starterSpecies.length).fill(0).map((l,h)=>{var d;const c=a.starterSpecies[h];return{species:c,dexAttr:a.starterAttr[h],abilityIndex:a.starterAbilityIndexes[h],passive:!(n.gameData.starterData[c.speciesId].passiveAttr^(Ke.ENABLED|Ke.UNLOCKED)),nature:a.starterNatures[h],teraType:a.starterTeras[h],moveset:a.starterMovesets[h],pokerus:a.pokerusSpecies.includes(c),nickname:(d=a.starterPreferences[c.speciesId])==null?void 0:d.nickname}}))},"startRun")()},s,null,null,19)}):(this.tutorialActive=!0,this.showText(S.t("starterSelectUiHandler:invalidParty"),void 0,()=>this.showText("",0,()=>this.tutorialActive=!1),void 0,!0)),!0}isPartyValid(){let e=!1;for(let t=0;t<this.starterSpecies.length;t++){const s=this.starterSpecies[t],i=Wt(s,n.gameData.getSpeciesDexAttrProps(s,this.getCurrentDexProps(s.speciesId)),!1);e=e||i}return e}getCurrentDexProps(e){var i,r,a,o,l,h,c;let t=0n;const s=n.gameData.dexData[e].caughtAttr;return(i=this.starterPreferences[e])!=null&&i.female||(s&Z.FEMALE)>0n&&(s&Z.MALE)===0n?t+=Z.FEMALE:t+=Z.MALE,(r=this.starterPreferences[e])!=null&&r.shiny||(s&Z.SHINY)>0n&&((a=this.starterPreferences[e])==null?void 0:a.shiny)!==!1?(t+=Z.SHINY,((o=this.starterPreferences[e])==null?void 0:o.variant)!==void 0?t+=BigInt(Math.pow(2,(l=this.starterPreferences[e])==null?void 0:l.variant))*Z.DEFAULT_VARIANT:(s&Z.VARIANT_3)>0?t+=Z.VARIANT_3:(s&Z.VARIANT_2)>0?t+=Z.VARIANT_2:t+=Z.DEFAULT_VARIANT):(t+=Z.NON_SHINY,t+=Z.DEFAULT_VARIANT),(h=this.starterPreferences[e])!=null&&h.form?t+=BigInt(Math.pow(2,(c=this.starterPreferences[e])==null?void 0:c.form))*Z.DEFAULT_FORM:t+=n.gameData.getFormAttr(n.gameData.getFormIndex(s)),t}toggleStatsMode(e){var t;if(e===void 0&&(e=!this.statsMode),e)this.showStats(),this.statsMode=!0,this.pokemonSprite.setVisible(!1),this.teraIcon.setVisible(!1),this.canCycleTera=!1,this.updateInstructions();else{this.statsMode=!1,this.statsContainer.setVisible(!1),this.pokemonSprite.setVisible(!!((t=this.speciesStarterDexEntry)!=null&&t.caughtAttr)),this.statsContainer.updateIvs(null),this.teraIcon.setVisible(n.gameData.achvUnlocks.hasOwnProperty(Ge.TERASTALLIZE.id));const i=n.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId)).formIndex;this.canCycleTera=!this.statsMode&&n.gameData.achvUnlocks.hasOwnProperty(Ge.TERASTALLIZE.id)&&!ve(Ct(this.lastSpecies.speciesId,i??0).type2),this.updateInstructions()}}showStats(){this.speciesStarterDexEntry&&(this.statsContainer.setVisible(!0),this.statsContainer.updateIvs(this.speciesStarterDexEntry.ivs))}clearText(){this.starterSelectMessageBoxContainer.setVisible(!1),super.clearText()}hideInstructions(){this.shinyIconElement.setVisible(!1),this.shinyLabel.setVisible(!1),this.formIconElement.setVisible(!1),this.formLabel.setVisible(!1),this.genderIconElement.setVisible(!1),this.genderLabel.setVisible(!1),this.abilityIconElement.setVisible(!1),this.abilityLabel.setVisible(!1),this.natureIconElement.setVisible(!1),this.natureLabel.setVisible(!1),this.teraIconElement.setVisible(!1),this.teraLabel.setVisible(!1),this.goFilterIconElement.setVisible(!1),this.goFilterLabel.setVisible(!1)}clear(){for(super.clear(),Lh(this.starterPreferences),this.cursor=-1,this.hideInstructions(),this.activeTooltip=void 0,n.ui.hideTooltip(),this.starterSelectContainer.setVisible(!1),this.blockInput=!1;this.starterSpecies.length;)this.popStarter(this.starterSpecies.length-1);this.statsMode&&this.toggleStatsMode(!1)}checkIconId(e,t,s,i,r,a){e.frame.name!==t.getIconId(s,i,r,a)&&(console.log(`${t.name}'s icon ${e.frame.name} does not match getIconId with female: ${s}, formIndex: ${i}, shiny: ${r}, variant: ${a}`),e.setTexture(t.getIconAtlasKey(i,!1,a)),e.setFrame(t.getIconId(s,i,!1,a)))}clearStarterPreferences(){this.starterPreferences={}}};p(Jr,"StarterSelectUiHandler");let Rs=Jr;const ea=class ea extends Mt{constructor(){super(L.TARGET_SELECT),this.isMultipleTargets=!1,this.targetBattleInfoMoveTween=[],this.cursor=-1}setup(){}show(e){if(e.length<3)return!1;super.show(e),this.fieldIndex=e[0],this.move=e[1],this.targetSelectCallback=e[2];const t=n.getPlayerField()[this.fieldIndex],s=Ph(t,this.move);return this.targets=s.targets,this.isMultipleTargets=s.multiple??!1,this.targets.length?(this.enemyModifiers=n.getModifierBar(!0),this.fieldIndex===He.PLAYER?this.resetCursor(this.cursor0,t):this.fieldIndex===He.PLAYER_2&&this.resetCursor(this.cursor1,t),!0):!1}resetCursor(e,t){ve(e)||([He.PLAYER,He.PLAYER_2].includes(e)||t.tempSummonData.waveTurnCount===1)&&(e=-1),this.setCursor(this.targets.includes(e)?e:this.targets[0])}processInput(e){const t=this.getUi();let s=!1;if(e===I.ACTION||e===I.CANCEL){const i=this.isMultipleTargets?this.targets:[this.cursor];this.targetSelectCallback(e===I.ACTION?i:[]),s=!0,this.fieldIndex===He.PLAYER?(ve(this.cursor0)||this.cursor0!==this.cursor)&&(this.cursor0=this.cursor):this.fieldIndex===He.PLAYER_2&&(ve(this.cursor1)||this.cursor1!==this.cursor)&&(this.cursor1=this.cursor)}else if(this.isMultipleTargets)s=!1;else switch(e){case I.UP:this.cursor<He.ENEMY&&this.targets.findIndex(i=>i>=He.ENEMY)>-1&&(s=this.setCursor(this.targets.find(i=>i>=He.ENEMY)));break;case I.DOWN:this.cursor>=He.ENEMY&&this.targets.findIndex(i=>i<He.ENEMY)>-1&&(s=this.setCursor(this.targets.find(i=>i<He.ENEMY)));break;case I.LEFT:this.cursor%2&&this.targets.findIndex(i=>i===this.cursor-1)>-1&&(s=this.setCursor(this.cursor-1));break;case I.RIGHT:!(this.cursor%2)&&this.targets.findIndex(i=>i===this.cursor+1)>-1&&(s=this.setCursor(this.cursor+1));break}return s&&t.playSelect(),s}setCursor(e){const t=n.getField()[e],s=this.targets.map(a=>n.getField()[a]);this.targetsHighlighted=this.isMultipleTargets?s:[t];const i=super.setCursor(e);if(this.targetFlashTween){this.targetFlashTween.stop();for(const a of s)a.setAlpha(a.getTag(Ds)?.5:1),this.highlightItems(a.id,1)}if(this.targetFlashTween=n.tweens.add({targets:this.targetsHighlighted,key:{start:1,to:.25},loop:-1,loopDelay:150,duration:ye(450),ease:"Sine.easeInOut",yoyo:!0,onUpdate:p(a=>{for(const o of this.targetsHighlighted)o.setAlpha(a.getValue()),this.highlightItems(o.id,a.getValue())},"onUpdate")}),this.targetBattleInfoMoveTween.length>=1){this.targetBattleInfoMoveTween.filter(a=>a!==void 0).forEach(a=>a.stop());for(const a of s)a.getBattleInfo().resetY()}return this.targetsHighlighted.map(a=>a.getBattleInfo()).map(a=>{this.targetBattleInfoMoveTween.push(n.tweens.add({targets:[a],y:{start:a.getBaseY(),to:a.getBaseY()+1},loop:-1,duration:ye(250),ease:"Linear",yoyo:!0}))}),i}eraseCursor(){this.targetFlashTween&&(this.targetFlashTween.stop(),this.targetFlashTween=null);for(const e of this.targetsHighlighted)e.setAlpha(e.getTag(Ds)?.5:1),this.highlightItems(e.id,1);this.targetBattleInfoMoveTween.length>=1&&(this.targetBattleInfoMoveTween.filter(e=>e!==void 0).forEach(e=>e.stop()),this.targetBattleInfoMoveTween=[]);for(const e of this.targetsHighlighted)e.getBattleInfo().resetY()}highlightItems(e,t){const s=this.enemyModifiers.getAll("name",e.toString());for(const i of s)i.setAlpha(t)}clear(){super.clear(),this.eraseCursor()}};p(ea,"TargetSelectUiHandler");let On=ea;const An="LEFT",Jl="RIGHT",qt=class qt{constructor(){this.selectedMode=L.SETTINGS,this.navigationMenus=new Array,this.modes=[L.SETTINGS,L.SETTINGS_DISPLAY,L.SETTINGS_AUDIO,L.SETTINGS_GAMEPAD,L.SETTINGS_KEYBOARD],this.labels=[S.t("settings:general"),S.t("settings:display"),S.t("settings:audio"),S.t("settings:gamepad"),S.t("settings:keyboard")]}reset(){this.selectedMode=L.SETTINGS,this.updateNavigationMenus()}static getInstance(){return qt.instance||(qt.instance=new qt),qt.instance}navigate(e){const t=this.modes.indexOf(this.selectedMode),s=this.modes.length-1,i=e===An?-1:1;t===0&&e===An?this.selectedMode=this.modes[s]:t===s&&e===Jl?this.selectedMode=this.modes[0]:this.selectedMode=this.modes[t+i],n.ui.setMode(this.selectedMode),this.updateNavigationMenus()}updateNavigationMenus(){for(const e of this.navigationMenus)e.update()}updateIcons(){for(const e of this.navigationMenus)e.updateIcons()}clearNavigationMenus(){this.navigationMenus.length=0}};p(qt,"NavigationManager");let ot=qt;const ta=class ta extends Phaser.GameObjects.Container{constructor(e,t){super(n,e,t),this.headerTitles=new Array,this.setup()}setup(){const e=ot.getInstance(),t=me(0,0,n.game.canvas.width/6-2,24);t.setOrigin(0,0),this.add(t),this.width=t.width,this.height=t.height,this.navigationIcons={};const s=n.add.sprite(8,4,"keyboard");s.setOrigin(0,-.1),s.setPositionRelative(t,8,4),this.navigationIcons.BUTTON_CYCLE_FORM=s;const i=n.add.sprite(0,0,"keyboard");i.setOrigin(0,-.1),i.setPositionRelative(t,t.width-20,4),this.navigationIcons.BUTTON_CYCLE_SHINY=i;let r=s,a=s.width*6;for(const o of e.labels){const l=V(0,0,o,x.SETTINGS_LABEL);l.setOrigin(0,0),l.setPositionRelative(r,6+a/6,0),this.add(l),this.headerTitles.push(l),r=l,a=l.width}this.add(s),this.add(i),e.navigationMenus.push(this),e.updateNavigationMenus()}update(){const e=ot.getInstance(),t=e.modes.indexOf(e.selectedMode);for(const[s,i]of this.headerTitles.entries())Bh(i,s===t?x.SETTINGS_SELECTED:x.SETTINGS_LABEL)}updateIcons(){var t,s;const e={BUTTON_HOME:"HOME.png",BUTTON_DELETE:"DEL.png"};for(const i of Object.keys(this.navigationIcons)){if(Object.keys(e).includes(i)){this.navigationIcons[i].setTexture("keyboard"),this.navigationIcons[i].setFrame(e[i]),this.navigationIcons[i].alpha=1;continue}const r=(t=n.inputController)==null?void 0:t.getIconForLatestInputRecorded(i);if(r){const a=(s=n.inputController)==null?void 0:s.getLastSourceType();this.navigationIcons[i].setTexture(a),this.navigationIcons[i].setFrame(r),this.navigationIcons[i].alpha=1}else this.navigationIcons[i].alpha=0}}navigate(e){const t=ot.getInstance();switch(e){case I.CYCLE_FORM:return t.navigate(An),!0;case I.CYCLE_SHINY:return t.navigate(Jl),!0}return!1}};p(ta,"NavigationMenu");let Ti=ta;const sa=class sa extends at{constructor(e,t=null){super(t),this.settings=mn.filter(s=>{var i;return s.type===e&&!((i=s==null?void 0:s.isHidden)!=null&&i.call(s))}),this.reloadRequired=!1,this.rowsToDisplay=8}setup(){const e=this.getUi();this.settingsContainer=n.add.container(1,-(n.game.canvas.height/6)+1),this.settingsContainer.setName(`settings-${this.title}`),this.settingsContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,n.game.canvas.width/6,n.game.canvas.height/6-20),Phaser.Geom.Rectangle.Contains),this.navigationIcons={},this.navigationContainer=new Ti(0,0),this.optionsBg=me(0,this.navigationContainer.height,n.game.canvas.width/6-2,n.game.canvas.height/6-16-this.navigationContainer.height-2),this.optionsBg.setName("window-options-bg"),this.optionsBg.setOrigin(0,0);const t=me(0,n.game.canvas.height/6-this.navigationContainer.height,n.game.canvas.width/6-2,22);t.setOrigin(0,0);const s=n.add.sprite(0,0,"keyboard");s.setOrigin(0,-.1),s.setPositionRelative(t,this.navigationContainer.width-32,4),this.navigationIcons.BUTTON_ACTION=s;const i=V(0,0,S.t("settings:action"),x.SETTINGS_LABEL);i.setOrigin(0,.15),i.setPositionRelative(s,-i.width/6-2,0);const r=n.add.sprite(0,0,"keyboard");r.setOrigin(0,-.1),r.setPositionRelative(t,this.navigationContainer.width-100,4),this.navigationIcons.BUTTON_CANCEL=r;const a=V(0,0,S.t("settings:back"),x.SETTINGS_LABEL);a.setOrigin(0,.15),a.setPositionRelative(r,-a.width/6-2,0),this.optionsContainer=n.add.container(0,0),this.settingLabels=[],this.optionValueLabels=[],this.reloadSettings=this.settings.filter(h=>h==null?void 0:h.requireReload),this.settings.forEach((h,c)=>{let d=h.label;h!=null&&h.requireReload&&(d+=` (${S.t("settings:requireReload")})`),this.settingLabels[c]=V(8,28+c*16,d,x.SETTINGS_LABEL),this.settingLabels[c].setOrigin(0,0),this.optionsContainer.add(this.settingLabels[c]),this.optionValueLabels.push(h.options.map((m,b)=>{const E=V(0,0,m.label,h.default===b?x.SETTINGS_SELECTED:x.SETTINGS_VALUE);return E.setOrigin(0,0),this.optionsContainer.add(E),E}));const f=this.optionValueLabels[c].map(m=>m.width).reduce((m,b)=>m+=b,0),u=Math.max(78,this.settingLabels[c].displayWidth+8),C=297-u-f/6,g=Math.floor(C/(this.optionValueLabels[c].length-1));let v=0;for(const m of this.optionValueLabels[c])m.setPositionRelative(this.settingLabels[c],u+v,0),v+=m.width/6+g}),this.optionCursors=this.settings.map(h=>h.default),this.scrollBar=new _t(this.optionsBg.width-9,this.optionsBg.y+5,4,this.optionsBg.height-11,this.rowsToDisplay),this.scrollBar.setTotalRows(this.settings.length),this.messageBoxContainer=n.add.container(0,n.scaledCanvas.height),this.messageBoxContainer.setName("settings-message-box"),this.messageBoxContainer.setVisible(!1);const o=me(0,-1,n.scaledCanvas.width-2,48);o.setOrigin(0,1),this.messageBoxContainer.add(o);const l=V(8,-40,"",x.WINDOW,{maxLines:2});l.setWordWrapWidth(n.game.canvas.width-60),l.setName("settings-message"),l.setOrigin(0,0),this.messageBoxContainer.add(l),this.message=l,this.settingsContainer.add(this.optionsBg),this.settingsContainer.add(this.scrollBar),this.settingsContainer.add(this.navigationContainer),this.settingsContainer.add(t),this.settingsContainer.add(this.optionsContainer),this.settingsContainer.add(s),this.settingsContainer.add(r),this.settingsContainer.add(i),this.settingsContainer.add(a),this.settingsContainer.add(this.messageBoxContainer),e.add(this.settingsContainer),this.setCursor(0),this.setScrollCursor(0),this.settingsContainer.setVisible(!1)}updateBindings(){var e,t;for(const s of Object.keys(this.navigationIcons)){if(s==="BUTTON_HOME"){this.navigationIcons[s].setTexture("keyboard"),this.navigationIcons[s].setFrame("HOME.png"),this.navigationIcons[s].alpha=1;continue}const i=(e=n.inputController)==null?void 0:e.getIconForLatestInputRecorded(s);if(i){const r=(t=n.inputController)==null?void 0:t.getLastSourceType();this.navigationIcons[s].setTexture(r),this.navigationIcons[s].setFrame(i),this.navigationIcons[s].alpha=1}else this.navigationIcons[s].alpha=0}ot.getInstance().updateIcons()}show(e){super.show(e),this.updateBindings();const t=localStorage.hasOwnProperty(this.localStorageKey)?JSON.parse(localStorage.getItem(this.localStorageKey)):{};return this.settings.forEach((s,i)=>this.setOptionCursor(i,t.hasOwnProperty(s.key)?t[s.key]:this.settings[i].default)),this.settingsContainer.setVisible(!0),this.setCursor(0),this.setScrollCursor(0),this.getUi().moveTo(this.settingsContainer,this.getUi().length-1),this.getUi().hideTooltip(),!0}processInput(e){const t=this.getUi();let s=!1;if(e===I.CANCEL)s=!0,ot.getInstance().reset(),n.ui.revertMode();else{const i=this.cursor+this.scrollCursor;switch(e){case I.UP:if(i)this.cursor?s=this.setCursor(this.cursor-1):s=this.setScrollCursor(this.scrollCursor-1);else{const a=this.setCursor(this.rowsToDisplay-1),o=this.setScrollCursor(this.optionValueLabels.length-this.rowsToDisplay);s=a&&o}break;case I.DOWN:if(i<this.optionValueLabels.length-1)this.cursor<this.rowsToDisplay-1?s=this.setCursor(this.cursor+1):this.scrollCursor<this.optionValueLabels.length-this.rowsToDisplay&&(s=this.setScrollCursor(this.scrollCursor+1));else{const a=this.setCursor(0),o=this.setScrollCursor(0);s=a&&o}break;case I.LEFT:this.optionCursors[i]&&(s=this.setOptionCursor(i,this.optionCursors[i]-1,!0));break;case I.RIGHT:this.optionCursors[i]<this.optionValueLabels[i].length-1&&(s=this.setOptionCursor(i,this.optionCursors[i]+1,!0));break;case I.CYCLE_FORM:case I.CYCLE_SHINY:s=this.navigationContainer.navigate(e);break;case I.ACTION:const r=this.settings[i];r!=null&&r.activatable&&(s=this.activateSetting(r));break}}return s&&t.playSelect(),s}activateSetting(e){switch(e.key){case ts.Move_Touch_Controls:return n.inputController.moveTouchControlsHandler.enableConfigurationMode(this.getUi()),!0}return!1}setCursor(e){const t=super.setCursor(e);if(!this.cursorObj){const s=n.game.canvas.width/6-(this.scrollBar.visible?16:10);this.cursorObj=n.add.nineslice(0,0,"summary_moves_cursor",void 0,s,16,1,1,1,1),this.cursorObj.setOrigin(0,0),this.optionsContainer.add(this.cursorObj)}return this.cursorObj.setPositionRelative(this.optionsBg,4,4+(this.cursor+this.scrollCursor)*16),t}setOptionCursor(e,t,s){e===-1&&(e=this.cursor+this.scrollCursor);const i=this.settings[e],r=this.optionCursors[e],a=this.optionValueLabels[e][r];a.setColor(this.getTextColor(x.SETTINGS_VALUE)),a.setShadowColor(this.getTextColor(x.SETTINGS_VALUE,!0)),this.optionCursors[e]=t;const o=this.optionValueLabels[e][t];if(o.setColor(this.getTextColor(x.SETTINGS_SELECTED)),o.setShadowColor(this.getTextColor(x.SETTINGS_SELECTED,!0)),s){const l=p(()=>{n.gameData.saveSetting(i.key,t),i.requireReload&&(this.reloadRequired=!0)},"saveSetting");if(i.options[t].needConfirmation){const h=p(()=>{n.ui.revertMode(),this.showText(""),l()},"confirmUpdateSetting"),c=p(()=>{n.ui.revertMode(),this.showText(""),this.setOptionCursor(e,r,!1)},"cancelUpdateSetting"),d=i.options[t].confirmationMessage??S.t("settings:defaultConfirmMessage");n.ui.showText(d,null,()=>{n.ui.setOverlayMode(L.CONFIRM,h,c,null,null,1,750)})}else l()}return!0}setScrollCursor(e){return e===this.scrollCursor?!1:(this.scrollCursor=e,this.scrollBar.setScrollCursor(this.scrollCursor),this.updateSettingsScroll(),this.setCursor(this.cursor),!0)}updateSettingsScroll(){this.optionsContainer.setY(-16*this.scrollCursor);for(let e=0;e<this.settingLabels.length;e++){const t=e>=this.scrollCursor&&e<this.scrollCursor+this.rowsToDisplay;this.settingLabels[e].setVisible(t);for(const s of this.optionValueLabels[e])s.setVisible(t)}}clear(){super.clear(),this.settingsContainer.setVisible(!1),this.setScrollCursor(0),this.eraseCursor(),this.getUi().bgmBar.toggleBgmBar(n.showBgmBar),this.reloadRequired&&(this.reloadRequired=!1,n.reset(!0,!1,!0))}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}showText(e,t,s,i,r,a){this.messageBoxContainer.setVisible(!!(e!=null&&e.length)),super.showText(e,t,s,i,r,a)}};p(sa,"AbstractSettingsUiHandler");let Ns=sa;const ia=class ia extends Ns{constructor(e=null){super(Hr.GENERAL,e),this.title="General",this.localStorageKey="settings"}};p(ia,"SettingsUiHandler");let Si=ia;const eh={padID:"Xbox 360 controller (XInput STANDARD GAMEPAD)",padType:"xbox",deviceMapping:{RC_S:0,RC_E:1,RC_W:2,RC_N:3,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15},icons:{RC_S:"XB_Letter_A_OL.png",RC_E:"XB_Letter_B_OL.png",RC_W:"XB_Letter_X_OL.png",RC_N:"XB_Letter_Y_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LT:"Trigger_L.png",RT:"Trigger_R.png",LS:"LS.png",RS:"RS.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[H.Button_Up]:I.UP,[H.Button_Down]:I.DOWN,[H.Button_Left]:I.LEFT,[H.Button_Right]:I.RIGHT,[H.Button_Action]:I.ACTION,[H.Button_Cancel]:I.CANCEL,[H.Button_Cycle_Nature]:I.CYCLE_NATURE,[H.Button_Cycle_Tera]:I.CYCLE_TERA,[H.Button_Menu]:I.MENU,[H.Button_Stats]:I.STATS,[H.Button_Cycle_Form]:I.CYCLE_FORM,[H.Button_Cycle_Shiny]:I.CYCLE_SHINY,[H.Button_Cycle_Gender]:I.CYCLE_GENDER,[H.Button_Cycle_Ability]:I.CYCLE_ABILITY,[H.Button_Speed_Up]:I.SPEED_UP,[H.Button_Slow_Down]:I.SLOW_DOWN},default:{LC_N:H.Button_Up,LC_S:H.Button_Down,LC_W:H.Button_Left,LC_E:H.Button_Right,RC_S:H.Button_Action,RC_E:H.Button_Cancel,RC_W:H.Button_Cycle_Nature,RC_N:H.Button_Cycle_Tera,START:H.Button_Menu,SELECT:H.Button_Stats,LB:H.Button_Cycle_Form,RB:H.Button_Cycle_Shiny,LT:H.Button_Cycle_Gender,RT:H.Button_Cycle_Ability,LS:H.Button_Speed_Up,RS:H.Button_Slow_Down}},th={padID:"Dualshock",padType:"dualshock",deviceMapping:{RC_S:0,RC_E:1,RC_W:2,RC_N:3,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15,TOUCH:17},icons:{RC_S:"CROSS.png",RC_E:"CIRCLE.png",RC_W:"SQUARE.png",RC_N:"TRIANGLE.png",START:"START.png",SELECT:"SELECT.png",LB:"L1.png",RB:"R1.png",LT:"L2.png",RT:"R2.png",LS:"L3.png",RS:"R3.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png",TOUCH:"TOUCH.png"},settings:{[H.Button_Up]:I.UP,[H.Button_Down]:I.DOWN,[H.Button_Left]:I.LEFT,[H.Button_Right]:I.RIGHT,[H.Button_Action]:I.ACTION,[H.Button_Cancel]:I.CANCEL,[H.Button_Cycle_Nature]:I.CYCLE_NATURE,[H.Button_Cycle_Tera]:I.CYCLE_TERA,[H.Button_Menu]:I.MENU,[H.Button_Stats]:I.STATS,[H.Button_Cycle_Form]:I.CYCLE_FORM,[H.Button_Cycle_Shiny]:I.CYCLE_SHINY,[H.Button_Cycle_Gender]:I.CYCLE_GENDER,[H.Button_Cycle_Ability]:I.CYCLE_ABILITY,[H.Button_Speed_Up]:I.SPEED_UP,[H.Button_Slow_Down]:I.SLOW_DOWN,[H.Button_Submit]:I.SUBMIT},default:{LC_N:H.Button_Up,LC_S:H.Button_Down,LC_W:H.Button_Left,LC_E:H.Button_Right,RC_S:H.Button_Action,RC_E:H.Button_Cancel,RC_W:H.Button_Cycle_Nature,RC_N:H.Button_Cycle_Tera,START:H.Button_Menu,SELECT:H.Button_Stats,LB:H.Button_Cycle_Form,RB:H.Button_Cycle_Shiny,LT:H.Button_Cycle_Gender,RT:H.Button_Cycle_Ability,LS:H.Button_Speed_Up,RS:H.Button_Slow_Down,TOUCH:H.Button_Submit}},sh={padID:"081f-e401",padType:"xbox",deviceMapping:{RC_S:2,RC_E:1,RC_W:3,RC_N:0,START:9,SELECT:8,LB:4,RB:5,LC_N:12,LC_S:13,LC_W:14,LC_E:15},icons:{RC_S:"XB_Letter_A_OL.png",RC_E:"XB_Letter_B_OL.png",RC_W:"XB_Letter_X_OL.png",RC_N:"XB_Letter_Y_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[H.Button_Up]:I.UP,[H.Button_Down]:I.DOWN,[H.Button_Left]:I.LEFT,[H.Button_Right]:I.RIGHT,[H.Button_Action]:I.ACTION,[H.Button_Cancel]:I.CANCEL,[H.Button_Cycle_Nature]:I.CYCLE_NATURE,[H.Button_Cycle_Tera]:I.CYCLE_TERA,[H.Button_Menu]:I.MENU,[H.Button_Stats]:I.STATS,[H.Button_Cycle_Form]:I.CYCLE_FORM,[H.Button_Cycle_Shiny]:I.CYCLE_SHINY,[H.Button_Cycle_Gender]:I.CYCLE_GENDER,[H.Button_Cycle_Ability]:I.CYCLE_ABILITY,[H.Button_Speed_Up]:I.SPEED_UP,[H.Button_Slow_Down]:I.SLOW_DOWN},default:{LC_N:H.Button_Up,LC_S:H.Button_Down,LC_W:H.Button_Left,LC_E:H.Button_Right,RC_S:H.Button_Action,RC_E:H.Button_Cancel,RC_W:H.Button_Cycle_Nature,RC_N:H.Button_Cycle_Tera,START:H.Button_Menu,SELECT:H.Button_Stats,LB:H.Button_Cycle_Form,RB:H.Button_Cycle_Shiny,LT:-1,RT:-1,LS:-1,RS:-1}};function cs(P,e){return Object.keys(P.deviceMapping).find(t=>P.deviceMapping[t]===e)}p(cs,"getKeyWithKeycode");function ih(P,e){const t=cs(P,e);return t?P.custom[t]:null}p(ih,"getSettingNameWithKeycode");function ti(P,e){const t=ih(P,e);return P.settings[t]}p(ti,"getButtonWithKeycode");function ds(P,e){return Object.keys(P.custom).find(t=>P.custom[t]===e)}p(ds,"getKeyWithSettingName");function kn(P,e){return P.custom[e]}p(kn,"getSettingNameWithKey");function _u(P,e){return P.icons[e]}p(_u,"getIconWithKey");function vi(P,e){const t=ds(P,e);return _u(P,t)}p(vi,"getIconWithSettingName");function wu(P,e,t,s){let i;e==="gamepad"?i=P[t[Se.GAMEPAD]]:i=P[t[Se.KEYBOARD]];const r=vi(i,s);if(!r){const a=s.includes("ALT_");let o;return a?o=s.split("ALT_").splice(1)[0]:o=`ALT_${s}`,vi(i,o)}return r}p(wu,"getIconForLatestInput");function Ou(P,e,t){if(!Mu(P,cs(P,t))||!Lu(P,e))return!1;const s=ih(P,t);if(s){const a=ds(P,s);a&&(P.custom[a]=-1)}const i=ds(P,e);i&&(P.custom[i]=-1);const r=cs(P,t);return r&&(P.custom[r]=e),!0}p(Ou,"assign");function Au(P,e,t){if(P.padType==="keyboard")return!1;const s=ds(P,e),i=kn(P,s),r=cs(P,t),a=kn(P,r);return s&&(P.custom[s]=a),r&&(P.custom[r]=i),!0}p(Au,"swap");function ku(P,e){const t=ds(P,e);return P.blacklist.includes(t)?!1:(t&&(P.custom[t]=-1),!0)}p(ku,"deleteBind");function Mu(P,e){var s;const t=kn(P,e);return!((s=P.blacklist)!=null&&s.includes(e))}p(Mu,"canIAssignThisKey");function Lu(P,e){var s;const t=ds(P,e);return!((s=P.blacklist)!=null&&s.includes(t))}p(Lu,"canIOverrideThisSetting");const na=class na extends Mt{constructor(e=null){super(e),this.layout=new Map,this.rowsToDisplay=8}getLocalStorageSetting(){return localStorage.hasOwnProperty(this.localStoragePropertyName)?JSON.parse(localStorage.getItem(this.localStoragePropertyName)):{}}camelize(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,(t,s)=>s===0?t.toLowerCase():t.toUpperCase()).replace(/\s+/g,"")}setup(){const e=this.getUi();this.navigationIcons={},this.settingsContainer=n.add.container(1,-(n.game.canvas.height/6)+1),this.settingsContainer.setName(`settings-${this.titleSelected}`),this.settingsContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,n.game.canvas.width/6,n.game.canvas.height/6),Phaser.Geom.Rectangle.Contains),this.navigationContainer=new Ti(0,0),this.optionsBg=me(0,this.navigationContainer.height,n.game.canvas.width/6-2,n.game.canvas.height/6-16-this.navigationContainer.height-2),this.optionsBg.setOrigin(0,0),this.actionsBg=me(0,n.game.canvas.height/6-this.navigationContainer.height,n.game.canvas.width/6-2,22),this.actionsBg.setOrigin(0,0);const t=n.add.sprite(0,0,"keyboard");t.setOrigin(0,-.1),t.setPositionRelative(this.actionsBg,this.navigationContainer.width-32,4),this.navigationIcons.BUTTON_ACTION=t;const s=V(0,0,S.t("settings:action"),x.SETTINGS_LABEL);s.setOrigin(0,.15),s.setPositionRelative(t,-s.width/6-2,0);const i=n.add.sprite(0,0,"keyboard");i.setOrigin(0,-.1),i.setPositionRelative(this.actionsBg,this.navigationContainer.width-100,4),this.navigationIcons.BUTTON_CANCEL=i;const r=V(0,0,S.t("settings:back"),x.SETTINGS_LABEL);r.setOrigin(0,.15),r.setPositionRelative(i,-r.width/6-2,0);const a=n.add.sprite(0,0,"keyboard");a.setOrigin(0,-.1),a.setPositionRelative(this.actionsBg,this.navigationContainer.width-180,4),this.navigationIcons.BUTTON_HOME=a;const o=V(0,0,S.t("settings:reset"),x.SETTINGS_LABEL);o.setOrigin(0,.15),o.setPositionRelative(a,-o.width/6-2,0),this.settingsContainer.add(this.optionsBg),this.settingsContainer.add(this.actionsBg),this.settingsContainer.add(this.navigationContainer),this.settingsContainer.add(t),this.settingsContainer.add(i),this.settingsContainer.add(a),this.settingsContainer.add(s),this.settingsContainer.add(r),this.settingsContainer.add(o);for(const l of this.configs){this.layout[l.padType]=new Map;const h=n.add.container(0,0);h.setVisible(!1);const c=Object.keys(l.settings),d=[],f=[],u={},g=[...Object.keys(this.setting).slice(0,this.commonSettingsCount).map(b=>this.setting[b]),...Object.keys(l.settings)],v=Object.values(Object.keys(this.settingDeviceDefaults).filter(b=>g.includes(b)).map(b=>this.settingDeviceDefaults[b]));Object.keys(this.setting).filter(b=>g.includes(this.setting[b])).forEach((b,E)=>{const w=b.replace(/\_/g," "),_=this.settingBlacklisted.includes(this.setting[b]),A=_?x.SETTINGS_LOCKED:x.SETTINGS_LABEL;let D;const j=this.camelize(w.replace("Alt ",""));w.toLowerCase().includes("alt")?D=`${S.t(`settings:${j}`)}${S.t("settings:alt")}`:D=S.t(`settings:${j}`),d[E]=V(8,28+E*16,D,A),d[E].setOrigin(0,0),h.add(d[E]);const B=[];for(const[F,he]of this.settingDeviceOptions[this.setting[b]].entries()){if(c.includes(this.setting[b])){if(F){const z=V(0,0,_?"":he,x.WINDOW);z.setOrigin(0,0),h.add(z),B.push(z);continue}const de=n.add.sprite(0,0,this.textureOverride?this.textureOverride:l.padType);de.setOrigin(0,-.15),u[this.setting[b]]=de,h.add(de),B.push(de);continue}const W=V(0,0,he,this.settingDeviceDefaults[this.setting[b]]===F?x.SETTINGS_SELECTED:x.WINDOW);W.setOrigin(0,0),h.add(W),B.push(W)}f.push(B);const $=f[E].map(F=>F.width).reduce((F,he)=>F+=he,0),ie=Math.max(130,d[E].displayWidth+8),k=297-ie-$/6,U=Math.floor(k/(f[E].length-1));let T=0;for(const F of f[E])F.setPositionRelative(d[E],ie+T,0),T+=F.width/6+U}),this.layout[l.padType].optionsContainer=h,this.layout[l.padType].inputsIcons=u,this.layout[l.padType].settingLabels=d,this.layout[l.padType].optionValueLabels=f,this.layout[l.padType].optionCursors=v,this.layout[l.padType].keys=g,this.layout[l.padType].bindingSettings=c,this.settingsContainer.add(h)}this.scrollBar=new _t(this.optionsBg.width-9,this.optionsBg.y+5,4,this.optionsBg.height-11,this.rowsToDisplay),this.settingsContainer.add(this.scrollBar),e.add(this.settingsContainer),this.settingsContainer.setVisible(!1)}getActiveConfig(){return n.inputController.getActiveConfig(this.device)}updateBindings(){Object.keys(this.layout).forEach(s=>this.layout[s].optionsContainer.setVisible(!1));const e=this.getActiveConfig();if(!this.setLayout(e))return;const t=this.getLocalStorageSetting();if(this.keys.forEach((s,i)=>{this.setOptionCursor(i,t.hasOwnProperty(s)?t[s]:this.optionCursors[i])}),!!e.custom){for(const s of this.bindingSettings){const i=vi(e,s);i?(this.inputsIcons[s].setFrame(i),this.inputsIcons[s].alpha=1):this.inputsIcons[s].alpha=0}this.setCursor(this.cursor),this.setScrollCursor(this.scrollCursor)}}updateNavigationDisplay(){var t,s;const e={BUTTON_HOME:"HOME.png",BUTTON_DELETE:"DEL.png"};for(const i of Object.keys(this.navigationIcons)){if(Object.keys(e).includes(i)){this.navigationIcons[i].setTexture("keyboard"),this.navigationIcons[i].setFrame(e[i]),this.navigationIcons[i].alpha=1;continue}const r=(t=n.inputController)==null?void 0:t.getIconForLatestInputRecorded(i);if(r){const a=(s=n.inputController)==null?void 0:s.getLastSourceType();this.navigationIcons[i].setTexture(a),this.navigationIcons[i].setFrame(r),this.navigationIcons[i].alpha=1}else this.navigationIcons[i].alpha=0}}show(e){return super.show(e),this.updateNavigationDisplay(),ot.getInstance().updateIcons(),this.updateBindings(),this.settingsContainer.setVisible(!0),this.resetScroll(),this.getUi().moveTo(this.settingsContainer,this.getUi().length-1),this.getUi().hideTooltip(),!0}setLayout(e){if(!e)return this.layout.noGamepads.optionsContainer.setVisible(!0),!1;const t=e.padType,s=this.layout[t];return this.keys=s.keys,this.optionsContainer=s.optionsContainer,this.optionsContainer.setVisible(!0),this.settingLabels=s.settingLabels,this.optionValueLabels=s.optionValueLabels,this.optionCursors=s.optionCursors,this.inputsIcons=s.inputsIcons,this.bindingSettings=s.bindingSettings,this.scrollBar.setTotalRows(s.settingLabels.length),this.scrollBar.setScrollCursor(0),!0}processInput(e){const t=this.getUi();let s=!1;if(this.updateNavigationDisplay(),e===I.CANCEL)s=!0,ot.getInstance().reset(),n.ui.revertMode();else{const i=this.cursor+this.scrollCursor,r=this.setting[Object.keys(this.setting)[i]];switch(e){case I.ACTION:if(!this.optionCursors||!this.optionValueLabels)return!1;this.settingBlacklisted.includes(r)||!r.includes("BUTTON_")?s=!1:s=this.setSetting(r,1);break;case I.UP:if(!this.optionValueLabels)return!1;if(i)this.cursor?s=this.setCursor(this.cursor-1):s=this.setScrollCursor(this.scrollCursor-1);else{const a=this.setCursor(this.rowsToDisplay-1),o=this.setScrollCursor(this.optionValueLabels.length-this.rowsToDisplay);s=a&&o}break;case I.DOWN:if(!this.optionValueLabels)return!1;if(i<this.optionValueLabels.length-1)this.cursor<this.rowsToDisplay-1?s=this.setCursor(this.cursor+1):this.scrollCursor<this.optionValueLabels.length-this.rowsToDisplay&&(s=this.setScrollCursor(this.scrollCursor+1));else{const a=this.setCursor(0),o=this.setScrollCursor(0);s=a&&o}break;case I.LEFT:if(!this.optionCursors||!this.optionValueLabels)return!1;this.settingBlacklisted.includes(r)||r.includes("BUTTON_")?s=!1:this.optionCursors[i]&&(s=this.setOptionCursor(i,this.optionCursors[i]-1,!0));break;case I.RIGHT:if(!this.optionCursors||!this.optionValueLabels)return!1;this.settingBlacklisted.includes(r)||r.includes("BUTTON_")?s=!1:this.optionCursors[i]<this.optionValueLabels[i].length-1&&(s=this.setOptionCursor(i,this.optionCursors[i]+1,!0));break;case I.CYCLE_FORM:case I.CYCLE_SHINY:s=this.navigationContainer.navigate(e);break}}return s&&t.playSelect(),s}resetScroll(){var e;(e=this.cursorObj)==null||e.destroy(),this.cursorObj=null,this.cursor=0,this.setCursor(0),this.setScrollCursor(0),this.updateSettingsScroll()}setCursor(e){const t=super.setCursor(e);if(!this.optionsContainer)return t;if(!this.cursorObj){const s=n.game.canvas.width/6-(this.scrollBar.visible?16:10);this.cursorObj=n.add.nineslice(0,0,"summary_moves_cursor",void 0,s,16,1,1,1,1),this.cursorObj.setOrigin(0,0),this.optionsContainer.add(this.cursorObj)}return this.cursorObj.setPositionRelative(this.optionsBg,4,4+(this.cursor+this.scrollCursor)*16),t}setScrollCursor(e){return e===this.scrollCursor?!1:(this.scrollCursor=e,this.scrollBar.setScrollCursor(this.scrollCursor),this.updateSettingsScroll(),this.setCursor(this.cursor),!0)}setOptionCursor(e,t,s){const i=this.setting[Object.keys(this.setting)[e]],r=this.optionCursors[e];if(!this.bindingSettings.includes(i)&&!i.includes("BUTTON_")){const a=this.optionValueLabels[e][r];a.setColor(this.getTextColor(x.WINDOW)),a.setShadowColor(this.getTextColor(x.WINDOW,!0)),this.optionCursors[e]=t;const o=this.optionValueLabels[e][t];o.setColor(this.getTextColor(x.SETTINGS_SELECTED)),o.setShadowColor(this.getTextColor(x.SETTINGS_SELECTED,!0))}return s&&this.saveSettingToLocalStorage(i,t),!0}updateSettingsScroll(){if(this.optionsContainer){this.optionsContainer.setY(-16*this.scrollCursor);for(let e=0;e<this.settingLabels.length;e++){const t=e>=this.scrollCursor&&e<this.scrollCursor+this.rowsToDisplay;this.settingLabels[e].setVisible(t);for(const s of this.optionValueLabels[e])s.setVisible(t)}}}clear(){super.clear(),this.settingsContainer.setVisible(!1),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};p(na,"AbstractControlSettingsUiHandler");let Ii=na;const ra=class ra extends Ii{constructor(e=null){super(e),this.setSetting=Rh,this.titleSelected="Gamepad",this.setting=H,this.settingDeviceDefaults=Nh,this.settingDeviceOptions=Fh,this.configs=[eh,th,sh],this.commonSettingsCount=2,this.localStoragePropertyName="settingsGamepad",this.settingBlacklisted=Vh,this.device=Se.GAMEPAD}setup(){super.setup(),this.layout.noGamepads=new Map;const e=n.add.container(0,0);e.setVisible(!1);const t=V(8,28,S.t("settings:gamepadPleasePlug"),x.SETTINGS_LABEL);t.setOrigin(0,0),e.add(t),this.settingsContainer.add(e),this.layout.noGamepads.optionsContainer=e,this.layout.noGamepads.label=t}setLayout(e){return e?super.setLayout(e):(this.layout.noGamepads.optionsContainer.setVisible(!0),!1)}updateChosenGamepadDisplay(){this.updateBindings(),this.resetScroll();for(const[e,t]of Object.keys(this.setting).entries())if(this.setting[t]===this.setting.Controller)for(const i of Object.keys(this.layout))i!=="noGamepads"&&this.layout[i].optionValueLabels[e][0].setText(vl(n.inputController.selectedDevice[Se.GAMEPAD],20))}saveSettingToLocalStorage(e,t){this.setting[e]!==this.setting.Controller&&n.gameData.saveControlSetting(this.device,this.localStoragePropertyName,e,this.settingDeviceDefaults,t)}};p(ra,"SettingsGamepadUiHandler");let Ei=ra;const aa=class aa extends Mt{constructor(e=null){super(e),this.leftArrowGap=90,this.arrowSpacing=3}setup(){const e=this.getUi();this.widestTextBox=0,this.challengesContainer=n.add.container(1,-(n.game.canvas.height/6)+1),this.challengesContainer.setName("challenges"),this.challengesContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,n.game.canvas.width/6,n.game.canvas.height/6),Phaser.Geom.Rectangle.Contains);const t=n.add.rectangle(-1,-1,n.scaledCanvas.width,n.scaledCanvas.height,4342338,.8);t.setName("rect-challenge-overlay"),t.setOrigin(0,0),this.challengesContainer.add(t);const s=me(0,0,n.game.canvas.width/6,24);s.setName("window-header-bg"),s.setOrigin(0,0);const i=V(0,0,S.t("challenges:title"),x.SETTINGS_LABEL);i.setName("text-header"),i.setOrigin(0,0),i.setPositionRelative(s,8,4),this.optionsWidth=n.scaledCanvas.width*.6,this.optionsBg=me(0,s.height,this.optionsWidth,n.scaledCanvas.height-s.height-2),this.optionsBg.setName("window-options-bg"),this.optionsBg.setOrigin(0,0);const r=me(0,s.height,n.scaledCanvas.width-this.optionsWidth,n.scaledCanvas.height-s.height-26);r.setName("window-desc-bg"),r.setOrigin(0,0),r.setPositionRelative(this.optionsBg,this.optionsBg.width,0),this.descriptionText=new ah(n,r.x+6,r.y+4,"",{fontFamily:"emerald",fontSize:84,color:Ao.ORANGE,padding:{bottom:6},wrap:{mode:"word",width:(r.width-12)*6}}),this.descriptionText.setName("text-desc"),n.add.existing(this.descriptionText),this.descriptionText.setScale(1/6),this.descriptionText.setShadow(4,5,ko.ORANGE),this.descriptionText.setOrigin(0,0),this.startBg=me(0,0,r.width,24),this.startBg.setName("window-start-bg"),this.startBg.setOrigin(0,0),this.startBg.setPositionRelative(r,0,r.height),this.startText=V(0,0,S.t("challenges:noneSelected"),x.SETTINGS_LABEL),this.startText.setName("text-start"),this.startText.setOrigin(0,0),this.startText.setPositionRelative(this.startBg,(this.startBg.width-this.startText.displayWidth)/2,4),this.startCursor=n.add.nineslice(0,0,"summary_moves_cursor",void 0,r.width-8,16,1,1,1,1),this.startCursor.setName("9s-start-cursor"),this.startCursor.setOrigin(0,0),this.startCursor.setPositionRelative(this.startBg,4,3),this.startCursor.setVisible(!1),this.valuesContainer=n.add.container(0,0),this.valuesContainer.setName("values"),this.challengeLabels=[];for(let a=0;a<9;a++){const o=V(8,28+a*16,"",x.SETTINGS_LABEL);o.setName(`text-challenge-label-${a}`),o.setOrigin(0,0),this.valuesContainer.add(o);const l=n.add.image(0,0,"cursor_reverse");l.setName(`challenge-left-arrow-${a}`),l.setOrigin(0,0),l.setVisible(!1),l.setScale(.75),this.valuesContainer.add(l);const h=n.add.image(0,0,"cursor");h.setName(`challenge-right-arrow-${a}`),h.setOrigin(0,0),h.setScale(.75),h.setVisible(!1),this.valuesContainer.add(h);const c=V(0,28+a*16,"",x.SETTINGS_LABEL);c.setName(`challenge-value-text-${a}`),c.setPositionRelative(o,100,0),this.valuesContainer.add(c),this.challengeLabels[a]={label:o,value:c,leftArrow:l,rightArrow:h}}this.monoTypeValue=n.add.sprite(8,98,Tt("types")),this.monoTypeValue.setName("challenge-value-monotype-sprite"),this.monoTypeValue.setScale(.86),this.monoTypeValue.setVisible(!1),this.valuesContainer.add(this.monoTypeValue),this.challengesContainer.add(s),this.challengesContainer.add(i),this.challengesContainer.add(this.optionsBg),this.challengesContainer.add(r),this.challengesContainer.add(this.descriptionText),this.challengesContainer.add(this.startBg),this.challengesContainer.add(this.startText),this.challengesContainer.add(this.startCursor),this.challengesContainer.add(this.valuesContainer),e.add(this.challengesContainer),this.setCursor(0),this.setScrollCursor(0),this.challengesContainer.setVisible(!1)}setDescription(e){this.descriptionText.setText(`[color=${Ao.ORANGE}][shadow=${ko.ORANGE}]${e}`)}initLabels(){this.setDescription(n.gameMode.challenges[0].getDescription()),this.widestTextBox=0;for(let e=0;e<9;e++)if(e<n.gameMode.challenges.length){this.challengeLabels[e].label.setVisible(!0),this.challengeLabels[e].value.setVisible(!0),this.challengeLabels[e].leftArrow.setVisible(!0),this.challengeLabels[e].rightArrow.setVisible(!0);const t=V(0,0,"",x.SETTINGS_LABEL);for(let s=0;s<=n.gameMode.challenges[e].maxValue;s++)n.gameMode.challenges[e].id!==Mo.SINGLE_TYPE&&(t.setText(n.gameMode.challenges[e].getValue(s)),t.displayWidth>this.widestTextBox&&(this.widestTextBox=t.displayWidth));t.destroy()}}updateText(){this.setDescription(this.getActiveChallenge().getDescription());let e=!1;for(let t=0;t<Math.min(9,n.gameMode.challenges.length);t++){const s=n.gameMode.challenges[this.scrollCursor+t],i=this.challengeLabels[t];i.label.setText(s.getName()),i.leftArrow.setPositionRelative(i.label,this.leftArrowGap,4.5),i.leftArrow.setVisible(s.value!==0),i.rightArrow.setPositionRelative(i.leftArrow,Math.max(this.monoTypeValue.width,this.widestTextBox)+i.leftArrow.displayWidth+2*this.arrowSpacing,0),i.rightArrow.setVisible(s.value!==s.maxValue),i.rightArrow.x+i.rightArrow.width+this.optionsBg.rightWidth+this.arrowSpacing>this.optionsWidth&&i.rightArrow.setX(this.optionsWidth-this.arrowSpacing-this.optionsBg.rightWidth);const r=Math.round((i.leftArrow.x+i.rightArrow.x+i.leftArrow.displayWidth)/2);s.id===Mo.SINGLE_TYPE?(this.monoTypeValue.setX(r),this.monoTypeValue.setY(i.label.y+8),this.monoTypeValue.setFrame(s.getValue()),this.monoTypeValue.setVisible(!0),i.value.setVisible(!1),e=!0):(i.value.setText(s.getValue()),i.value.setX(r),i.value.setOrigin(.5,0),i.value.setVisible(!0))}e||this.monoTypeValue.setVisible(!1),this.hasSelectedChallenge=n.gameMode.challenges.some(t=>t.value!==0),this.hasSelectedChallenge?(this.startText.setText(S.t("common:start")),this.startText.setAlpha(1),this.startText.setPositionRelative(this.startBg,(this.startBg.width-this.startText.displayWidth)/2,4)):(this.startText.setText(S.t("challenges:noneSelected")),this.startText.setAlpha(.5),this.startText.setPositionRelative(this.startBg,(this.startBg.width-this.startText.displayWidth)/2,4)),this.challengesContainer.update()}show(e){return super.show(e),this.startCursor.setVisible(!1),this.updateChallengeArrows(!1),this.challengesContainer.setVisible(!0),this.hasSelectedChallenge=n.gameMode.challenges.some(t=>t.value!==0),this.setCursor(0),this.initLabels(),this.updateText(),this.getUi().moveTo(this.challengesContainer,this.getUi().length-1),this.getUi().hideTooltip(),!0}updateChallengeArrows(e){for(let t=0;t<Math.min(9,n.gameMode.challenges.length);t++){const s=this.challengeLabels[t];e?(s.leftArrow.setTint(8421504),s.rightArrow.setTint(8421504)):(s.leftArrow.clearTint(),s.rightArrow.clearTint())}}processInput(e){var r,a,o,l,h;const t=this.getUi(),s=9;let i=!1;if(e===I.CANCEL)this.startCursor.visible?(this.startCursor.setVisible(!1),(r=this.cursorObj)==null||r.setVisible(!0),this.updateChallengeArrows(this.startCursor.visible)):(n.clearPhaseQueue(),n.pushPhase(new Yr),(a=n.getCurrentPhase())==null||a.end()),i=!0;else if(e===I.SUBMIT||e===I.ACTION)this.hasSelectedChallenge?(this.startCursor.visible?(n.unshiftPhase(new Uh),(o=n.getCurrentPhase())==null||o.end()):(this.startCursor.setVisible(!0),(l=this.cursorObj)==null||l.setVisible(!1),this.updateChallengeArrows(this.startCursor.visible)),i=!0):i=!1;else if((h=this.cursorObj)!=null&&h.visible&&!this.startCursor.visible)switch(e){case I.UP:if(this.cursor===0)if(this.scrollCursor===0)if(n.gameMode.challenges.length>s){const c=this.setCursor(s-1),d=this.setScrollCursor(n.gameMode.challenges.length-s);i=c&&d}else i=this.setCursor(n.gameMode.challenges.length-1);else i=this.setScrollCursor(this.scrollCursor-1);else i=this.setCursor(this.cursor-1);i&&this.updateText();break;case I.DOWN:if(this.cursor===s-1)if(this.scrollCursor<n.gameMode.challenges.length-s)i=this.setScrollCursor(this.scrollCursor+1);else{const c=this.setCursor(0),d=this.setScrollCursor(0);i=c&&d}else n.gameMode.challenges.length<s&&this.cursor===n.gameMode.challenges.length-1?i=this.setCursor(0):i=this.setCursor(this.cursor+1);i&&this.updateText();break;case I.LEFT:i=this.getActiveChallenge().decreaseValue(),i&&this.updateText();break;case I.RIGHT:i=this.getActiveChallenge().increaseValue(),i&&this.updateText();break}return i&&t.playSelect(),i}setCursor(e){let t=super.setCursor(e);return this.cursorObj||(this.cursorObj=n.add.nineslice(0,0,"summary_moves_cursor",void 0,this.optionsWidth-8,16,1,1,1,1),this.cursorObj.setOrigin(0,0),this.valuesContainer.add(this.cursorObj)),t||(t=!this.cursorObj.visible),this.cursorObj.setVisible(!0),this.cursorObj.setPositionRelative(this.optionsBg,4,4+(this.cursor+this.scrollCursor)*16),t}setScrollCursor(e){return e===this.scrollCursor?!1:(this.scrollCursor=e,this.setCursor(this.cursor),!0)}getActiveChallenge(){return n.gameMode.challenges[this.cursor+this.scrollCursor]}clear(){super.clear(),this.challengesContainer.setVisible(!1),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};p(aa,"GameChallengesUiHandler");let Mn=aa;const oa=class oa extends Phaser.GameObjects.Container{constructor(){super(n,n.game.canvas.width/6,0),this.queue=[],this.playerGender=n.gameData.gender}setup(){this.defaultWidth=200,this.defaultHeight=40,this.bg=n.add.nineslice(0,0,"achv_bar",void 0,this.defaultWidth,this.defaultHeight,41,6,16,4),this.bg.setOrigin(0,0),this.add(this.bg),this.icon=n.add.sprite(4,4,"items"),this.icon.setOrigin(0,0),this.add(this.icon),this.titleText=V(40,3,"",x.MESSAGE,{fontSize:"72px"}),this.titleText.setOrigin(0,0),this.add(this.titleText),this.scoreText=V(150,3,"",x.MESSAGE,{fontSize:"72px"}),this.scoreText.setOrigin(1,0),this.add(this.scoreText),this.descriptionText=V(43,16,"",x.WINDOW_ALT,{fontSize:"72px"}),this.descriptionText.setOrigin(0,0),this.add(this.descriptionText),this.descriptionText.setWordWrapWidth(664),this.descriptionText.setLineSpacing(-5),this.setScale(.5),this.shown=!1}showAchv(e){if(this.shown){this.queue.push(e);return}const t=e.getTier();this.bg.setTexture(`achv_bar${t?`_${t+1}`:""}`),this.icon.setFrame(e.getIconImage()),this.titleText.setText(e.getName(this.playerGender)),this.scoreText.setVisible(e instanceof Ki),e instanceof Ki?this.descriptionText.setText(Dl(e.localizationKey)):e instanceof Yh&&this.descriptionText.setText(e.description),e instanceof Ki&&this.scoreText.setText(`+${e.score}pt`),this.bg.width=Math.max(this.defaultWidth,this.icon.displayWidth+this.titleText.displayWidth+this.scoreText.displayWidth+16),this.scoreText.x=this.bg.width-2,this.descriptionText.width=this.bg.width-this.icon.displayWidth-16,this.descriptionText.setWordWrapWidth(this.descriptionText.width*6),this.bg.height=Math.max(this.defaultHeight,this.titleText.displayHeight+this.descriptionText.displayHeight+8),this.icon.y=this.bg.height/2-this.icon.height/2,n.playSound("se/achv"),n.tweens.add({targets:this,x:n.game.canvas.width/6-this.bg.width/2,duration:500,ease:"Sine.easeOut"}),n.time.delayedCall(1e4,()=>this.hide(this.playerGender)),this.setVisible(!0),this.shown=!0}hide(e){this.shown&&n.tweens.add({targets:this,x:n.game.canvas.width/6,duration:500,ease:"Sine.easeIn",onComplete:p(()=>{if(this.shown=!1,this.setVisible(!1),this.queue.length){const t=this.queue.shift();t&&this.showAchv(t)}},"onComplete")})}};p(oa,"AchvBar");let Ln=oa;const rl=-150,Du=0,al=0,la=class la extends Phaser.GameObjects.Container{constructor(){super(n,rl,al)}setup(){this.defaultWidth=230,this.defaultHeight=100,this.bg=n.add.nineslice(-5,-5,"bgm_bar",void 0,this.defaultWidth,this.defaultHeight,0,0,10,10),this.bg.setOrigin(0,0),this.add(this.bg),this.musicText=V(5,5,"",x.BGM_BAR),this.musicText.setOrigin(0,0),this.musicText.setWordWrapWidth(650,!0),this.add(this.musicText),this.setVisible(!1),this.shown=!1}setBgmToBgmBar(e){this.musicText.setText(`${S.t("bgmName:music")}${this.getRealBgmName(e)}`),this.musicText.width=this.bg.width-20,this.musicText.setWordWrapWidth(this.defaultWidth*4),this.bg.width=Math.min(this.defaultWidth,this.musicText.displayWidth+23),this.bg.height=Math.min(this.defaultHeight,this.musicText.displayHeight+20),n.fieldUI.bringToTop(this),this.y=al}toggleBgmBar(e){if(this.musicText.text===""){this.setVisible(!1);return}if(!n.showBgmBar){this.setVisible(!1);return}n.tweens.add({targets:this,x:e?Du:rl,duration:500,ease:"Sine.easeInOut",onComplete:p(()=>{this.setVisible(!0)},"onComplete")})}getRealBgmName(e){return S.t([`bgmName:${e}`,"bgmName:missing_entries"],{name:di(e)})}};p(la,"BgmBar");let Dn=la;const ha=class ha extends Mt{constructor(e=null){super(e),this.buttonContainers=[],this.buttonBgs=[],this.buttonLabels=[]}getButtonTopMargin(){return 0}setup(){const e=this.getUi();this.modalContainer=n.add.container(0,0),this.modalContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,n.game.canvas.width/6,n.game.canvas.height/6),Phaser.Geom.Rectangle.Contains),this.modalBg=me(0,0,0,0),this.modalContainer.add(this.modalBg),this.titleText=V(0,4,"",x.SETTINGS_LABEL),this.titleText.setOrigin(.5,0),this.modalContainer.add(this.titleText),e.add(this.modalContainer);const t=this.getButtonLabels();for(const s of t)this.addButton(s);this.modalContainer.setVisible(!1)}addButton(e){const t=this.getButtonTopMargin(),s=V(0,8,e,x.TOOLTIP_CONTENT);s.setOrigin(.5,.5);const i=me(0,0,s.getBounds().width+8,16,!1,!1,0,0,gt.THIN);i.setOrigin(.5,0),i.setInteractive(new Phaser.Geom.Rectangle(0,0,i.width,i.height),Phaser.Geom.Rectangle.Contains);const r=n.add.container(0,t);this.buttonLabels.push(s),this.buttonBgs.push(i),this.buttonContainers.push(r),r.add(i),r.add(s),this.addInteractionHoverEffect(i),this.modalContainer.add(r)}show(e){if(e.length>=1&&"buttonActions"in e[0]){if(super.show(e),e[0].hasOwnProperty("fadeOut")&&typeof e[0].fadeOut=="function"){const[s,i,r,a]=this.getMargin(),o=n.add.rectangle((this.getWidth()+a+i)/2,(this.getHeight()+s+r)/2,n.game.canvas.width/6,n.game.canvas.height/6,0);o.setOrigin(.5,.5),o.setName("rect-ui-overlay-modal"),o.setAlpha(0),this.modalContainer.add(o),this.modalContainer.moveTo(o,0),n.tweens.add({targets:o,alpha:1,duration:250,ease:"Sine.easeOut",onComplete:e[0].fadeOut})}const t=e[0];this.updateContainer(t),this.modalContainer.setVisible(!0),this.getUi().moveTo(this.modalContainer,this.getUi().length-1);for(let s=0;s<this.buttonBgs.length;s++)s<this.buttonBgs.length&&this.buttonBgs[s].on("pointerdown",i=>{n.tweens.getTweensOf(this.modalContainer).length===0&&t.buttonActions[s]()});return!0}return!1}updateContainer(e){const[t,s,i,r]=this.getMargin(e),[a,o]=[this.getWidth(e),this.getHeight(e)];this.modalContainer.setPosition((n.game.canvas.width/6-(a+(s-r)))/2,(-n.game.canvas.height/6-(o+(i-t)))/2),this.modalBg.setSize(a,o);const l=this.getModalTitle(e);this.titleText.setText(l),this.titleText.setX(a/2),this.titleText.setVisible(!!l);for(let h=0;h<this.buttonContainers.length;h++){const c=a/(this.buttonContainers.length+1);this.buttonContainers[h].setPosition(c*(h+1),this.modalBg.height-(this.buttonBgs[h].height+8))}}processInput(e){return!1}clear(){super.clear(),this.modalContainer.setVisible(!1),this.buttonBgs.map(e=>e.off("pointerdown"))}addInteractionHoverEffect(e){e.on("pointerover",()=>{this.setMouseCursorStyle("pointer"),e.setTint(12303291)}),e.on("pointerout",()=>{this.setMouseCursorStyle("default"),e.clearTint()})}};p(ha,"ModalUiHandler");let us=ha;const ca=class ca extends us{constructor(e=null){super(e),this.editing=!1,this.inputContainers=[],this.inputs=[],this.formLabels=[]}getHeight(e){return 20*this.getInputFieldConfigs().length+(this.getModalTitle()?26:0)+(e!=null&&e.errorMessage?12:0)+this.getButtonTopMargin()+28}getReadableErrorMessage(e){return(e==null?void 0:e.indexOf("connection refused"))>-1?"Could not connect to the server":e}setup(){super.setup();const e=this.getInputFieldConfigs(),t=!!this.getModalTitle();e.length>=1&&this.updateFields(e,t),this.errorMessage=V(10,(t?31:5)+20*(e.length-1)+16+this.getButtonTopMargin(),"",x.TOOLTIP_CONTENT),this.errorMessage.setColor(this.getTextColor(x.SUMMARY_PINK)),this.errorMessage.setShadowColor(this.getTextColor(x.SUMMARY_PINK,!0)),this.errorMessage.setVisible(!1),this.modalContainer.add(this.errorMessage)}updateFields(e,t){this.inputContainers=[],this.inputs=[],this.formLabels=[],e.forEach((s,i)=>{const r=V(10,(t?31:5)+20*i,s.label,x.TOOLTIP_CONTENT);r.name="formLabel"+i,this.formLabels.push(r),this.modalContainer.add(this.formLabels[this.formLabels.length-1]);const a=n.add.container(70,(t?28:2)+20*i);a.setVisible(!1);const o=me(0,0,80,16,!1,!1,0,0,gt.XTHIN),l=s==null?void 0:s.isPassword,h=s==null?void 0:s.isReadOnly,c=Gh(4,-2,440,116,x.TOOLTIP_CONTENT,{type:l?"password":"text",maxLength:l?64:20,readOnly:h});c.setOrigin(0,0),a.add(o),a.add(c),this.inputContainers.push(a),this.modalContainer.add(a),this.inputs.push(c)})}show(e){if(super.show(e)){this.inputContainers.map(s=>s.setVisible(!0));const t=e[0];return this.submitAction=t.buttonActions.length?t.buttonActions[0]:null,this.buttonBgs.length&&(this.buttonBgs[0].off("pointerdown"),this.buttonBgs[0].on("pointerdown",()=>{this.submitAction&&n.tweens.getTweensOf(this.modalContainer).length===0&&this.submitAction()})),this.modalContainer.y+=24,this.modalContainer.setAlpha(0),this.tween=n.tweens.add({targets:this.modalContainer,duration:ye(1e3),ease:"Sine.easeInOut",y:"-=24",alpha:1}),!0}return!1}processInput(e){return e===I.SUBMIT&&this.submitAction?(this.submitAction(),!0):!1}sanitizeInputs(){for(const e of this.inputs)e.text=e.text.trim()}updateContainer(e){super.updateContainer(e),this.errorMessage.setText(this.getReadableErrorMessage((e==null?void 0:e.errorMessage)||"")),this.errorMessage.setVisible(!!this.errorMessage.text)}clear(){super.clear(),this.modalContainer.setVisible(!1),this.inputContainers.map(e=>e.setVisible(!1)),this.submitAction=null,this.tween&&this.tween.remove()}};p(ca,"FormModalUiHandler");let Yt=ca;const da=class da extends Yt{constructor(e=null){super(e),this.buttonGap=10,this.httpUserNotFoundErrorCode=404,this.ERR_REQUIRED_FIELD=t=>t==="username"?`${di(t)} is required`:`${di(t)} Id is required`,this.SUCCESS_SERVICE_MODE=(t,s)=>`Username and ${t} successfully ${s.toLowerCase()}ed`}getModalTitle(){return"Admin panel"}getWidth(){return this.adminMode===2?180:160}getMargin(){return[0,0,0,0]}getButtonLabels(){switch(this.adminMode){case 0:return["Link Account","Cancel"];case 1:return["Find account","Cancel"];case 2:return["Back to search","Cancel"];default:return["Activate ADMIN","Cancel"]}}getInputFieldConfigs(){const e=[];switch(this.adminMode){case 0:e.push({label:"Username"}),e.push({label:"Discord ID"});break;case 1:e.push({label:"Username"});break;case 2:const t=this.adminResult??{discordId:"",googleId:""};e.push({label:"Username",isReadOnly:!0}),e.push({label:"Discord ID",isReadOnly:t.discordId!==""}),e.push({label:"Google ID",isReadOnly:t.googleId!==""}),e.push({label:"Last played",isReadOnly:!0}),e.push({label:"Registered",isReadOnly:!0});break}return e}processInput(e){return e===I.SUBMIT&&this.submitAction?(this.submitAction(),!0):!1}show(e){this.config=e[0],this.adminMode=e[1],this.adminResult=e[2]??{username:"",discordId:"",googleId:"",lastLoggedIn:"",registered:""};const t=e[3],s=this.getInputFieldConfigs(),i=!!this.getModalTitle();this.updateFields(s,i),this.updateContainer(this.config);const r=this.getButtonLabels();for(let a=0;a<r.length;a++)this.buttonLabels[a].setText(r[a]);if(this.errorMessage.setPosition(10,(i?31:5)+20*(s.length-1)+16+this.getButtonTopMargin()),t?(this.errorMessage.setColor(this.getTextColor(x.SUMMARY_PINK)),this.errorMessage.setShadowColor(this.getTextColor(x.SUMMARY_PINK,!0))):(this.errorMessage.setColor(this.getTextColor(x.SUMMARY_GREEN)),this.errorMessage.setShadowColor(this.getTextColor(x.SUMMARY_GREEN,!0))),super.show(e)){this.populateFields(this.adminMode,this.adminResult);const a=this.submitAction;return this.submitAction=o=>{this.submitAction=a;const l=this.convertInputsToAdmin(),h=this.areFieldsValid(this.adminMode);if(h.error)return n.ui.setMode(L.LOADING,{buttonActions:[]}),this.showMessage(h.errorMessage??"",l,!0);n.ui.setMode(L.LOADING,{buttonActions:[]}),this.adminMode===0?this.adminLinkUnlink(l,"discord","Link").then(c=>c.error?this.showMessage(c.errorType,l,!0):this.showMessage(this.SUCCESS_SERVICE_MODE("discord","link"),l,!1)):this.adminMode===1?this.adminSearch(l).then(c=>{if(c.error)return this.showMessage(c.errorType,l,!0);this.updateAdminPanelInfo(c.adminSearchResult??l)}):this.adminMode===2&&this.updateAdminPanelInfo(l,1)},!0}return!1}showMessage(e,t,s){n.ui.setMode(L.ADMIN,Object.assign(this.config,{errorMessage:e==null?void 0:e.trim()}),this.adminMode,t,s),s?n.ui.playError():n.ui.playSelect()}populateFields(e,t){switch(e){case 0:this.inputs[0].setText(t.username),this.inputs[1].setText(t.discordId);break;case 1:this.inputs[0].setText(t.username);break;case 2:Object.keys(t).forEach((s,i)=>{if(this.inputs[i].setText(t[s]),s==="discordId"||s==="googleId"){const r=this.inputContainers[i].list.find(o=>o.type==="NineSlice"),a=n.add.image(this.inputContainers[i].x+r.width+this.buttonGap,this.inputContainers[i].y+Math.floor(r.height/2),t[s]===""?"link_icon":"unlink_icon");a.setName(`adminBtn_${s}`),a.setOrigin(.5,.5),a.setInteractive(),a.on("pointerdown",()=>{const o=s.toLowerCase().replace("id",""),l=t[s]===""?"Link":"Unlink",h=this.areFieldsValid(this.adminMode,o);if(h.error)return n.ui.setMode(L.LOADING,{buttonActions:[]}),this.showMessage(h.errorMessage??"",t,!0);this.adminLinkUnlink(this.convertInputsToAdmin(),o,l).then(c=>{if(c.error)return n.ui.setMode(L.LOADING,{buttonActions:[]}),this.showMessage(c.errorType,t,!0);n.ui.setMode(L.LOADING,{buttonActions:[]}),this.adminSearch(t).then(d=>d.error?this.showMessage(d.errorType,t,!0):this.showMessage(this.SUCCESS_SERVICE_MODE(o,l),d.adminSearchResult??t,!1))})}),this.addInteractionHoverEffect(a),this.modalContainer.add(a)}});break}}areFieldsValid(e,t){switch(e){case 0:if(!this.inputs[0].text)return{error:!0,errorMessage:this.ERR_REQUIRED_FIELD("username")};if(!this.inputs[1].text)return{error:!0,errorMessage:this.ERR_REQUIRED_FIELD("discord")};break;case 1:if(!this.inputs[0].text)return{error:!0,errorMessage:this.ERR_REQUIRED_FIELD("username")};break;case 2:if(!this.inputs[1].text&&t==="discord")return{error:!0,errorMessage:this.ERR_REQUIRED_FIELD(t)};if(!this.inputs[2].text&&t==="google")return{error:!0,errorMessage:this.ERR_REQUIRED_FIELD(t)};break}return{error:!1}}convertInputsToAdmin(){var e,t,s,i,r,a,o,l,h;return{username:(e=this.inputs[0])!=null&&e.node?this.inputs[0].text:"",discordId:(t=this.inputs[1])!=null&&t.node?(s=this.inputs[1])==null?void 0:s.text:"",googleId:(i=this.inputs[2])!=null&&i.node?(r=this.inputs[2])==null?void 0:r.text:"",lastLoggedIn:(a=this.inputs[3])!=null&&a.node?(o=this.inputs[3])==null?void 0:o.text:"",registered:(l=this.inputs[4])!=null&&l.node?(h=this.inputs[4])==null?void 0:h.text:""}}async adminSearch(e){try{const[t,s]=await Et.admin.searchAccount({username:e.username});return s||!t?{adminSearchResult:e,error:!0,errorType:s}:{adminSearchResult:t,error:!1}}catch(t){return console.error(t),{error:!0,errorType:t}}}async adminLinkUnlink(e,t,s){try{let i=null;return t==="discord"?s==="Link"?i=await Et.admin.linkAccountToDiscord({discordId:e.discordId,username:e.username}):s==="Unlink"?i=await Et.admin.unlinkAccountFromDiscord({discordId:e.discordId,username:e.username}):console.warn("Unknown mode",s,"for service",t):t==="google"?s==="Link"?i=await Et.admin.linkAccountToGoogleId({googleId:e.googleId,username:e.username}):s==="Unlink"?i=await Et.admin.unlinkAccountFromGoogleId({googleId:e.googleId,username:e.username}):console.warn("Unknown mode",s,"for service",t):console.warn("Unknown service",t),i?{adminSearchResult:e,error:!0,errorType:i}:{adminSearchResult:e,error:!1}}catch(i){return console.error(i),{error:!0,errorType:i}}}updateAdminPanelInfo(e,t){t=t??2,n.ui.setMode(L.ADMIN,{buttonActions:[()=>{n.ui.revertMode(),n.ui.revertMode()},()=>{n.ui.revertMode(),n.ui.revertMode()}]},t,e)}clear(){super.clear();const e=["formLabel","adminBtn"],t=[],s=this.modalContainer.list;for(let i=s.length-1;i>=0;i--)(e.some(r=>s[i].name.includes(r))||s[i].type==="Container"&&s[i].list.find(r=>r.type==="rexInputText"))&&t.push(s[i]);for(;t.length>0;)this.modalContainer.remove(t.pop(),!0)}};p(da,"AdminUiHandler");let Pn=da;var Ft=(P=>(P[P.GAME_SETTINGS=0]="GAME_SETTINGS",P[P.ACHIEVEMENTS=1]="ACHIEVEMENTS",P[P.STATS=2]="STATS",P[P.EGG_LIST=3]="EGG_LIST",P[P.EGG_GACHA=4]="EGG_GACHA",P[P.POKEDEX=5]="POKEDEX",P[P.MANAGE_DATA=6]="MANAGE_DATA",P[P.COMMUNITY=7]="COMMUNITY",P[P.SAVE_AND_QUIT=8]="SAVE_AND_QUIT",P[P.LOG_OUT=9]="LOG_OUT",P))(Ft||{});let ol="https://wiki.pokerogue.net/start";const Pu="https://discord.gg/uWpTfdKG49",Bu="https://github.com/pagefaultgames/pokerogue",Ru="https://www.reddit.com/r/pokerogue",Nu="https://github.com/sponsors/pagefaultgames",ua=class ua extends at{constructor(e=null){super(e),this.textPadding=8,this.defaultMessageBoxWidth=220,this.defaultWordWrapWidth=1224,this.scale=.1666666667,this.excludedMenus=()=>[{condition:[L.COMMAND,L.TITLE].includes(e??L.TITLE),options:[4,3]},{condition:yn,options:[9]}],this.menuOptions=es(Ft).map(t=>Number.parseInt(Ft[t])).filter(t=>!this.excludedMenus().some(s=>s.condition&&s.options.includes(t)))}setup(){var s;const e=this.getUi(),t=(s=S.resolvedLanguage)==null?void 0:s.substring(0,2);["de","fr","ko","zh"].includes(t)&&(ol=`https://wiki.pokerogue.net/${t}:start`),this.bgmBar=new Dn,this.bgmBar.setup(),e.bgmBar=this.bgmBar,this.menuContainer=n.add.container(1,-(n.game.canvas.height/6)+1),this.menuContainer.setName("menu"),this.menuContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,n.game.canvas.width/6,n.game.canvas.height/6),Phaser.Geom.Rectangle.Contains),this.menuOverlay=new Phaser.GameObjects.Rectangle(n,-1,-1,n.scaledCanvas.width,n.scaledCanvas.height,16777215,.3),this.menuOverlay.setName("menu-overlay"),this.menuOverlay.setOrigin(0,0),this.menuContainer.add(this.menuOverlay),this.menuContainer.add(this.bgmBar),this.menuContainer.setVisible(!1)}render(){const e=this.getUi();this.excludedMenus=()=>[{condition:n.getCurrentPhase()instanceof Hh,options:[4]},{condition:yn,options:[9]}],this.menuOptions=es(Ft).map(a=>Number.parseInt(Ft[a])).filter(a=>!this.excludedMenus().some(o=>o.condition&&o.options.includes(a))),this.optionSelectText=V(0,0,this.menuOptions.map(a=>`${S.t(`menuUiHandler:${Ft[a]}`)}`).join(`
`),x.WINDOW,{maxLines:this.menuOptions.length}),this.optionSelectText.setLineSpacing(12),this.scale=Vi(x.WINDOW,n.uiTheme).scale,this.menuBg=me(n.game.canvas.width/6-(this.optionSelectText.displayWidth+25),0,this.optionSelectText.displayWidth+19+24*this.scale,n.game.canvas.height/6-2),this.menuBg.setOrigin(0,0),this.optionSelectText.setPositionRelative(this.menuBg,10+24*this.scale,6),this.menuContainer.add(this.menuBg),this.menuContainer.add(this.optionSelectText),e.add(this.menuContainer),this.menuMessageBoxContainer=n.add.container(0,130),this.menuMessageBoxContainer.setName("menu-message-box"),this.menuMessageBoxContainer.setVisible(!1),this.menuMessageBox=me(0,0,this.defaultMessageBoxWidth,48),this.menuMessageBox.setOrigin(0,0),this.menuMessageBoxContainer.add(this.menuMessageBox),this.dialogueMessageBox=me(-this.textPadding,0,n.game.canvas.width/6+this.textPadding*2,49,!1,!1,0,0,gt.THIN),this.dialogueMessageBox.setOrigin(0,0),this.menuMessageBoxContainer.add(this.dialogueMessageBox);const t=V(this.textPadding,this.textPadding,"",x.WINDOW,{maxLines:2});t.setName("menu-message"),t.setOrigin(0,0),this.menuMessageBoxContainer.add(t),this.initTutorialOverlay(this.menuContainer),this.initPromptSprite(this.menuMessageBoxContainer),this.message=t,this.setDialogTestMode(!1),this.menuContainer.add(this.menuMessageBoxContainer);const s=[],i=p((a,o,l)=>{e.revertMode(),e.showText(a,null,()=>{const h={options:new Array(5).fill(null).map((c,d)=>d).filter(o).map(c=>({label:S.t("menuUiHandler:slot",{slotNumber:c+1}),handler:p(()=>(l(c),e.revertMode(),e.showText("",0),!0),"handler")})).concat([{label:S.t("menuUiHandler:cancel"),handler:p(()=>(e.revertMode(),e.showText("",0),!0),"handler")}]),xOffset:98};e.setOverlayMode(L.MENU_OPTION_SELECT,h)})},"confirmSlot");(Hi||nn)&&s.push({label:S.t("menuUiHandler:importSession"),handler:p(()=>(i(S.t("menuUiHandler:importSlotSelect"),()=>!0,a=>n.gameData.importData(ns.SESSION,a)),!0),"handler"),keepOpen:!0}),s.push({label:S.t("menuUiHandler:exportSession"),handler:p(()=>{const a=[];return Promise.all(new Array(5).fill(null).map((o,l)=>{const h=l;return n.gameData.getSession(h).then(c=>{c&&a.push(h)})})).then(()=>{i(S.t("menuUiHandler:exportSlotSelect"),o=>a.indexOf(o)>-1,o=>n.gameData.tryExportData(ns.SESSION,o))}),!0},"handler"),keepOpen:!0}),s.push({label:S.t("menuUiHandler:importRunHistory"),handler:p(()=>(n.gameData.importData(ns.RUN_HISTORY),!0),"handler"),keepOpen:!0}),s.push({label:S.t("menuUiHandler:exportRunHistory"),handler:p(()=>(n.gameData.tryExportData(ns.RUN_HISTORY),!0),"handler"),keepOpen:!0}),(Hi||nn)&&s.push({label:S.t("menuUiHandler:importData"),handler:p(()=>(e.revertMode(),n.gameData.importData(ns.SYSTEM),!0),"handler"),keepOpen:!0}),s.push({label:S.t("menuUiHandler:exportData"),handler:p(()=>(n.gameData.tryExportData(ns.SYSTEM),!0),"handler"),keepOpen:!0},{label:S.t("menuUiHandler:consentPreferences"),handler:p(()=>{const a=document.querySelector(".termly-display-preferences"),o=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});return a.dispatchEvent(o),a.focus(),!0},"handler"),keepOpen:!0}),(Hi||nn)&&s.push({label:"Test Dialogue",handler:p(()=>{e.playSelect();const a="",o={};return o.buttonActions=[l=>{e.revertMode(),e.playSelect();const c=decodeURIComponent(escape(atob(l))),d=e.getHandler();d.tutorialActive=!0;const f={},u=c.split(" "),C=u[0],g=/\{\{(\w*)\}\}/g,v=S.t(C).match(g)??[];if(v.length>0)for(let m=0;m<v.length;m++)typeof u[m+1]<"u"&&(f[v[m].replace(/\W/g,"")]=S.t(u[m+1]));this.setDialogTestMode(!0),e.showText(String(S.t(C,f)),null,()=>n.ui.showText("",0,()=>{d.tutorialActive=!1,this.setDialogTestMode(!1)}),null,!0)},()=>{e.revertMode()}],e.setMode(L.TEST_DIALOGUE,o,a),!0},"handler"),keepOpen:!0}),s.push({label:S.t("menuUiHandler:cancel"),handler:p(()=>(n.ui.revertMode(),!0),"handler"),keepOpen:!0}),this.manageDataConfig={xOffset:98,options:s,maxOptions:7};const r=[{label:"Wiki",handler:p(()=>{var a;return(a=window.open(ol,"_blank"))==null||a.focus(),!0},"handler"),keepOpen:!0},{label:"Discord",handler:p(()=>{var a;return(a=window.open(Pu,"_blank"))==null||a.focus(),!0},"handler"),keepOpen:!0},{label:"GitHub",handler:p(()=>{var a;return(a=window.open(Bu,"_blank"))==null||a.focus(),!0},"handler"),keepOpen:!0},{label:"Reddit",handler:p(()=>{var a;return(a=window.open(Ru,"_blank"))==null||a.focus(),!0},"handler"),keepOpen:!0},{label:S.t("menuUiHandler:donate"),handler:p(()=>{var a;return(a=window.open(Nu,"_blank"))==null||a.focus(),!0},"handler"),keepOpen:!0}];r.push({label:S.t("menuUiHandler:cancel"),handler:p(()=>(n.ui.revertMode(),!0),"handler")}),this.communityConfig={xOffset:98,options:r},this.setCursor(0)}show(e){return this.render(),super.show(e),this.menuOptions=es(Ft).map(t=>Number.parseInt(Ft[t])).filter(t=>!this.excludedMenus().some(s=>s.condition&&s.options.includes(t))),this.menuContainer.setVisible(!0),this.setCursor(0),this.getUi().moveTo(this.menuContainer,this.getUi().length-1),this.getUi().hideTooltip(),n.playSound("ui/menu_open"),this.menuContainer.bringToTop(this.tutorialOverlay),this.menuContainer.bringToTop(this.menuMessageBoxContainer),ws(Ls.Menu),this.bgmBar.toggleBgmBar(!0),!0}processInput(e){const t=this.getUi();let s=!1,i=!1;if(e===I.ACTION){let r=this.cursor;const a=this.excludedMenus().find(o=>o.condition);if(a!==void 0&&a.options!==void 0&&a.options.length>0){const o=a.options.sort();for(const l of o)if(r>=l)r++;else break}switch(this.showText("",0),r){case 0:t.setOverlayMode(L.SETTINGS),s=!0;break;case 1:t.setOverlayMode(L.ACHIEVEMENTS),s=!0;break;case 2:t.setOverlayMode(L.GAME_STATS),s=!0;break;case 3:n.gameData.eggs.length?(t.revertMode(),t.setOverlayMode(L.EGG_LIST),s=!0):(t.showText(S.t("menuUiHandler:noEggs"),null,()=>t.showText(""),ye(1500)),i=!0);break;case 4:t.revertMode(),t.setOverlayMode(L.EGG_GACHA),s=!0;break;case 5:t.revertMode(),t.setOverlayMode(L.POKEDEX),s=!0;break;case 6:t.setOverlayMode(L.MENU_OPTION_SELECT,this.manageDataConfig),s=!0;break;case 7:t.setOverlayMode(L.MENU_OPTION_SELECT,this.communityConfig),s=!0;break;case 8:if(n.currentBattle){s=!0;const l=p(()=>{t.setMode(L.LOADING,{buttonActions:[],fadeOut:p(()=>n.gameData.saveAll(!0,!0,!0,!0).then(()=>{n.reset(!0)}),"fadeOut")})},"doSaveQuit");n.currentBattle.turn>1?t.showText(S.t("menuUiHandler:losingProgressionWarning"),null,()=>{if(!this.active){this.showText("",0);return}t.setOverlayMode(L.CONFIRM,l,()=>{t.revertMode(),this.showText("",0)},!1,-98)}):l()}else i=!0;break;case 9:s=!0;const o=p(()=>{t.setMode(L.LOADING,{buttonActions:[],fadeOut:p(()=>Et.account.logout().then(()=>{Is().then(()=>n.reset(!0,!0))}),"fadeOut")})},"doLogout");n.currentBattle?t.showText(S.t("menuUiHandler:losingProgressionWarning"),null,()=>{if(!this.active){this.showText("",0);return}t.setOverlayMode(L.CONFIRM,o,()=>{t.revertMode(),this.showText("",0)},!1,-98)}):o();break}}else if(e===I.CANCEL)s=!0,t.revertMode().then(r=>{r||t.setMode(L.MESSAGE)});else switch(e){case I.UP:this.cursor?s=this.setCursor(this.cursor-1):s=this.setCursor(this.menuOptions.length-1);break;case I.DOWN:this.cursor+1<this.menuOptions.length?s=this.setCursor(this.cursor+1):s=this.setCursor(0);break}return s?t.playSelect():i&&t.playError(),s||i}setDialogTestMode(e){this.menuMessageBox.setVisible(!e),this.dialogueMessageBox.setVisible(e),this.message.setWordWrapWidth(e?n.ui.getMessageHandler().wordWrapWidth:this.defaultWordWrapWidth),this.message.setX(e?this.textPadding+1:this.textPadding),this.message.setY(e?this.textPadding+.4:this.textPadding)}showText(e,t,s,i,r,a){this.menuMessageBoxContainer.setVisible(!!e),super.showText(e,t,s,i,r,a)}setCursor(e){const t=super.setCursor(e);return this.cursorObj||(this.cursorObj=n.add.image(0,0,"cursor"),this.cursorObj.setOrigin(0,0),this.menuContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.menuBg,7,6+(18+this.cursor*96)*this.scale),t}clear(){super.clear(),this.menuContainer.setVisible(!1),this.bgmBar.toggleBgmBar(!1),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};p(ua,"MenuUiHandler");let Bn=ua;const Fu={de:{TextSize:"80px"}},pa=class pa extends at{constructor(e=null){super(e),this.ROWS=4,this.COLS=17,this.achvsTotal=Object.keys(Ge).length,this.vouchersTotal=Object.keys(Vt).length,this.scrollCursor=0}setup(){var u;const e=this.getUi();this.mainContainer=n.add.container(1,-(n.game.canvas.height/6)+1),this.mainContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,n.game.canvas.width/6,n.game.canvas.height/6),Phaser.Geom.Rectangle.Contains),this.headerBg=me(0,0,n.game.canvas.width/6-2,24),this.headerBg.setOrigin(0,0),this.headerText=V(0,0,"",x.SETTINGS_LABEL),this.headerText.setOrigin(0,0),this.headerText.setPositionRelative(this.headerBg,8,4),this.headerActionButton=new Phaser.GameObjects.Sprite(n,0,0,"keyboard","ACTION.png"),this.headerActionButton.setOrigin(0,0),this.headerActionButton.setPositionRelative(this.headerBg,236,6),this.headerActionText=V(0,0,"",x.WINDOW,{fontSize:"60px"}),this.headerActionText.setOrigin(0,0),this.headerActionText.setPositionRelative(this.headerBg,264,8);const t=n.gameData.gender??bt.MALE,s=bt[t].toLowerCase();this.achvsName=S.t("achv:Achievements.name",{context:s}),this.vouchersName=S.t("voucher:vouchers"),this.iconsBg=me(0,this.headerBg.height,n.game.canvas.width/6-2,n.game.canvas.height/6-this.headerBg.height-68),this.iconsBg.setOrigin(0,0);const i=6;this.scrollBar=new _t(this.iconsBg.width-9,this.iconsBg.y+i,4,this.iconsBg.height-i*2,this.ROWS),this.iconsContainer=n.add.container(5,this.headerBg.height+8),this.icons=[];for(let C=0;C<this.ROWS*this.COLS;C++){const g=C%this.COLS*18,v=Math.floor(C/this.COLS)*18,m=n.add.sprite(g,v,"items","unknown");m.setOrigin(0,0),m.setScale(.5),this.icons.push(m),this.iconsContainer.add(m)}const r=me(0,this.headerBg.height+this.iconsBg.height,174,24);r.setOrigin(0,0),this.titleBg=r,this.titleText=V(0,0,"",x.WINDOW);const a=((u=Fu[S.language])==null?void 0:u.TextSize)??this.titleText.style.fontSize;this.titleText.setFontSize(a);const o=r.x+r.width/2,l=r.y+r.height/2;this.titleText.setOrigin(.5,.5),this.titleText.setPosition(o,l),this.scoreContainer=n.add.container(r.x+r.width,r.y);const h=me(0,0,46,24);h.setOrigin(0,0),this.scoreContainer.add(h),this.scoreText=V(h.width/2,h.height/2,"",x.WINDOW),this.scoreText.setOrigin(.5,.5),this.scoreContainer.add(this.scoreText);const c=me(this.scoreContainer.x+h.width,r.y,98,24);c.setOrigin(0,0),this.unlockText=V(0,0,"",x.WINDOW),this.unlockText.setOrigin(.5,.5),this.unlockText.setPositionRelative(c,c.width/2,c.height/2);const d=me(0,r.y+r.height,n.game.canvas.width/6-2,42);d.setOrigin(0,0);const f=V(0,0,"",x.WINDOW,{maxLines:2});f.setWordWrapWidth(1870),f.setOrigin(0,0),f.setPositionRelative(d,8,4),this.message=f,this.mainContainer.add(this.headerBg),this.mainContainer.add(this.headerActionButton),this.mainContainer.add(this.headerText),this.mainContainer.add(this.headerActionText),this.mainContainer.add(this.iconsBg),this.mainContainer.add(this.scrollBar),this.mainContainer.add(this.iconsContainer),this.mainContainer.add(r),this.mainContainer.add(this.titleText),this.mainContainer.add(this.scoreContainer),this.mainContainer.add(c),this.mainContainer.add(this.unlockText),this.mainContainer.add(d),this.mainContainer.add(f),e.add(this.mainContainer),this.currentPage=0,this.mainContainer.setVisible(!1)}show(e){return super.show(e),this.headerBgX=this.headerBg.getTopRight().x,this.updateAchvIcons(),this.mainContainer.setVisible(!0),this.setCursor(0),this.setScrollCursor(0),this.scrollBar.setTotalRows(Math.ceil(this.currentTotal/this.COLS)),this.scrollBar.setScrollCursor(0),this.getUi().moveTo(this.mainContainer,this.getUi().length-1),this.getUi().hideTooltip(),!0}showAchv(e){const t=n.gameData.gender??bt.MALE,s=bt[t].toLowerCase();e.name=S.t(`achv:${e.localizationKey}.name`,{context:s}),e.description=Dl(e.localizationKey);const i=n.gameData.achvUnlocks,r=i.hasOwnProperty(e.id),a=!r&&e.secret&&(!e.parentId||!i.hasOwnProperty(e.parentId));this.titleText.setText(r?e.name:"???"),this.showText(a?"":e.description),this.scoreText.setText(`${e.score}pt`),this.unlockText.setText(r?new Date(i[e.id]).toLocaleDateString():S.t("achv:Locked.name"))}showVoucher(e){const t=n.gameData.voucherUnlocks,s=t.hasOwnProperty(e.id);this.titleText.setText(Wh(e.voucherType)),this.showText(e.description),this.unlockText.setText(s?new Date(t[e.id]).toLocaleDateString():S.t("voucher:locked"))}processInput(e){const t=this.getUi();let s=!1;if(e===I.ACTION&&(s=!0,this.setScrollCursor(0),this.currentPage===0?(this.currentPage=1,this.updateVoucherIcons()):this.currentPage===1&&(this.currentPage=0,this.updateAchvIcons()),this.setCursor(0,!0),this.scrollBar.setTotalRows(Math.ceil(this.currentTotal/this.COLS)),this.scrollBar.setScrollCursor(0),this.mainContainer.update()),e===I.CANCEL)s=!0,n.ui.revertMode();else{const i=Math.floor(this.cursor/this.COLS),r=this.scrollCursor*this.COLS;switch(e){case I.UP:if(this.cursor<this.COLS)if(this.scrollCursor)s=this.setScrollCursor(this.scrollCursor-1);else{s=this.setScrollCursor(Math.ceil(this.currentTotal/this.COLS)-this.ROWS);let o=this.cursor+(this.ROWS-1)*this.COLS;o>this.currentTotal-this.scrollCursor*this.COLS-1&&(o-=this.COLS),s=s&&this.setCursor(o)}else s=this.setCursor(this.cursor-this.COLS);break;case I.DOWN:const a=r+1<this.currentTotal;i>=this.ROWS-1?this.scrollCursor<Math.ceil(this.currentTotal/this.COLS)-this.ROWS&&a?s=this.setScrollCursor(this.scrollCursor+1):s=this.setScrollCursor(0)&&this.setCursor(this.cursor%this.COLS):a&&(s=this.setCursor(Math.min(this.cursor+this.COLS,this.currentTotal-r-1)));break;case I.LEFT:this.cursor%this.COLS===0?s=this.setCursor(Math.min(this.cursor+this.COLS-1,this.currentTotal-r-1)):s=this.setCursor(this.cursor-1);break;case I.RIGHT:(this.cursor+1)%this.COLS===0||this.cursor+r===this.currentTotal-1?s=this.setCursor(this.cursor-this.cursor%this.COLS):s=this.setCursor(this.cursor+1);break}}return s&&t.playSelect(),s}setCursor(e,t){const s=super.setCursor(e);let i=s;if(this.cursorObj||(this.cursorObj=n.add.nineslice(0,0,"select_cursor_highlight",void 0,16,16,1,1,1,1),this.cursorObj.setOrigin(0,0),this.iconsContainer.add(this.cursorObj),i=!0),this.cursorObj.setPositionRelative(this.icons[this.cursor],0,0),i||t)switch(this.currentPage){case 0:t&&(this.titleBg.width=174,this.titleText.x=this.titleBg.width/2,this.scoreContainer.setVisible(!0)),this.showAchv(Ge[Object.keys(Ge)[e+this.scrollCursor*this.COLS]]);break;case 1:t&&(this.titleBg.width=220,this.titleText.x=this.titleBg.width/2,this.scoreContainer.setVisible(!1)),this.showVoucher(Vt[Object.keys(Vt)[e+this.scrollCursor*this.COLS]]);break}return s}setScrollCursor(e){if(e===this.scrollCursor)return!1;this.scrollCursor=e,this.scrollBar.setScrollCursor(this.scrollCursor);const t=Math.min(this.cursor,this.currentTotal-this.scrollCursor*this.COLS-1);switch(t!==this.cursor&&this.setCursor(t),this.currentPage){case 0:this.updateAchvIcons(),this.showAchv(Ge[Object.keys(Ge)[this.cursor+this.scrollCursor*this.COLS]]);break;case 1:this.updateVoucherIcons(),this.showVoucher(Vt[Object.keys(Vt)[this.cursor+this.scrollCursor*this.COLS]]);break}return!0}updateAchvIcons(){this.headerText.text=this.achvsName,this.headerActionText.text=this.vouchersName;const e=this.headerBgX-this.headerActionText.displayWidth-8;this.headerActionText.setX(e),this.headerActionButton.setX(e-this.headerActionButton.displayWidth-4);const t=n.gameData.achvUnlocks,s=this.scrollCursor*this.COLS,i=this.ROWS*this.COLS,r=Object.values(Ge).slice(s,i+s);r.forEach((a,o)=>{const l=this.icons[o],h=t.hasOwnProperty(a.id),c=!h&&a.secret&&(!a.parentId||!t.hasOwnProperty(a.parentId)),d=!c&&!h;l.setFrame(c?"unknown":a.iconImage),l.setVisible(!0),d?l.setTintFill(0):l.clearTint()}),r.length<this.icons.length&&this.icons.slice(r.length).map(a=>a.setVisible(!1)),this.currentTotal=this.achvsTotal}updateVoucherIcons(){this.headerText.text=this.vouchersName,this.headerActionText.text=this.achvsName;const e=this.headerBgX-this.headerActionText.displayWidth-8;this.headerActionText.setX(e),this.headerActionButton.setX(e-this.headerActionButton.displayWidth-4);const t=n.gameData.voucherUnlocks,s=this.scrollCursor*this.COLS,i=this.ROWS*this.COLS,r=Object.values(Vt).slice(s,i+s);r.forEach((a,o)=>{const l=this.icons[o],h=t.hasOwnProperty(a.id);l.setFrame(jt(a.voucherType)),l.setVisible(!0),h?l.clearTint():l.setTintFill(0)}),r.length<this.icons.length&&this.icons.slice(r.length).map(a=>a.setVisible(!1)),this.currentTotal=this.vouchersTotal}clear(){super.clear(),this.currentPage=0,this.mainContainer.setVisible(!1),this.setScrollCursor(0),this.setCursor(0,!0),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};p(pa,"AchvsUiHandler");let Rn=pa;const fa=class fa extends Pl{constructor(e=L.OPTION_SELECT){super(e)}getWindowWidth(){return 64}};p(fa,"OptionSelectUiHandler");let Fs=fa;const ga=class ga extends Mt{constructor(){super(L.EGG_HATCH_SCENE),this.eventTarget=new EventTarget}setup(){this.eggHatchContainer=n.add.container(0,-n.game.canvas.height/6),n.fieldUI.add(this.eggHatchContainer);const e=n.anims.generateFrameNames("egg_lightrays",{start:0,end:3});n.anims.exists("egg_lightrays")||n.anims.create({key:"egg_lightrays",frames:e,frameRate:32})}show(e){return super.show(e),this.getUi().showText("",0),n.setModifiersVisible(!1),!0}processInput(e){if(e===I.ACTION||e===I.CANCEL){const t=n.getCurrentPhase();if(t instanceof Kh&&t.trySkip())return!0}return n.ui.getMessageHandler().processInput(e)}setCursor(e){return!1}clear(){super.clear(),this.eggHatchContainer.removeAll(!0),this.getUi().hideTooltip()}};p(ga,"EggHatchSceneHandler");let Nn=ga;const ma=class ma{constructor(e,t,s){this.handler=e,this.ROWS=t,this.COLUMNS=s,this.scrollCursor=0,this.cursor=0,this.totalElements=t*s}withScrollBar(e){return this.scrollBar=e,this.scrollBar.setTotalRows(Math.ceil(this.totalElements/this.COLUMNS)),this}withUpdateGridCallBack(e){return this.updateGridCallback=e,this}withUpdateSingleElementCallback(e){return this.updateDetailsCallback=e,this}setTotalElements(e){this.totalElements=e,this.scrollBar&&this.scrollBar.setTotalRows(Math.ceil(this.totalElements/this.COLUMNS)),this.setScrollCursor(0)}getItemOffset(){return this.scrollCursor*this.COLUMNS}processInput(e){let t=!1;const s=Math.min(this.ROWS,Math.ceil(this.totalElements/this.COLUMNS)),i=Math.max(0,Math.ceil(this.totalElements/this.COLUMNS)-s),r=Math.floor(this.cursor/this.COLUMNS),a=this.cursor%this.COLUMNS,o=this.scrollCursor*this.COLUMNS,l=Math.min(this.totalElements-1,this.totalElements-i*this.COLUMNS-1);switch(e){case I.UP:if(r>0)t=this.setCursor(this.cursor-this.COLUMNS);else if(this.scrollCursor>0)t=this.setScrollCursor(this.scrollCursor-1);else{let h=this.cursor+(s-1)*this.COLUMNS;h>l&&(h-=this.COLUMNS),t=this.setScrollCursor(i,h)}break;case I.DOWN:r<s-1?t=this.setCursor(Math.min(this.cursor+this.COLUMNS,this.totalElements-o-1)):this.scrollCursor<i?t=this.setScrollCursor(this.scrollCursor+1):t=this.setScrollCursor(0,this.cursor%this.COLUMNS);break;case I.LEFT:a>0?t=this.setCursor(this.cursor-1):this.scrollCursor===i&&r===s-1?t=this.setCursor(l):t=this.setCursor(this.cursor+this.COLUMNS-1);break;case I.RIGHT:a<this.COLUMNS-1&&this.cursor+o<this.totalElements-1?t=this.setCursor(this.cursor+1):t=this.setCursor(this.cursor-a);break}return t}reset(){this.setScrollCursor(0),this.setCursor(0)}setCursor(e){return this.cursor=e,this.handler.setCursor(e)}setScrollCursor(e,t){const s=e!==this.scrollCursor;s&&(this.scrollCursor=e,this.scrollBar&&this.scrollBar.setScrollCursor(e),this.updateGridCallback&&this.updateGridCallback());let i=!1;const r=this.cursor+this.scrollCursor*this.COLUMNS;return t!==void 0?i=this.setCursor(t):r>=this.totalElements?i=this.setCursor(this.totalElements-this.scrollCursor*this.COLUMNS-1):s&&this.updateDetailsCallback&&this.updateDetailsCallback(r),s||i}};p(ma,"ScrollableGridUiHandler");let xi=ma;const ya=class ya extends at{constructor(){super(L.EGG_LIST),this.ROWS=9,this.COLUMNS=11}setup(){const e=this.getUi();this.eggListContainer=n.add.container(0,-n.game.canvas.height/6),this.eggListContainer.setVisible(!1),e.add(this.eggListContainer);const t=n.add.rectangle(0,0,n.game.canvas.width/6,n.game.canvas.height/6,26720);t.setOrigin(0,0),this.eggListContainer.add(t);const s=n.add.image(0,0,"egg_list_bg");s.setOrigin(0,0),this.eggListContainer.add(s),this.eggListContainer.add(me(1,85,106,22)),this.eggListContainer.add(me(1,102,106,50,!0)),this.eggListContainer.add(me(1,147,106,32,!0)),this.eggListContainer.add(me(107,1,212,178)),this.iconAnimHandler=new Yi,this.iconAnimHandler.setup(),this.eggNameText=V(8,68,"",x.SUMMARY),this.eggNameText.setOrigin(0,0),this.eggListContainer.add(this.eggNameText),this.eggDateText=V(8,91,"",x.TOOLTIP_CONTENT),this.eggListContainer.add(this.eggDateText),this.eggHatchWavesText=V(8,108,"",x.TOOLTIP_CONTENT),this.eggHatchWavesText.setWordWrapWidth(540),this.eggListContainer.add(this.eggHatchWavesText),this.eggGachaInfoText=V(8,152,"",x.TOOLTIP_CONTENT),this.eggGachaInfoText.setWordWrapWidth(540),this.eggListContainer.add(this.eggGachaInfoText),this.eggListIconContainer=n.add.container(113,5),this.eggListContainer.add(this.eggListIconContainer),this.cursorObj=n.add.image(0,0,"select_cursor"),this.cursorObj.setOrigin(0,0),this.eggListContainer.add(this.cursorObj),this.eggSprite=n.add.sprite(54,37,"egg"),this.eggListContainer.add(this.eggSprite);const i=new _t(310,5,4,170,this.ROWS);this.eggListContainer.add(i),this.scrollGridHandler=new xi(this,this.ROWS,this.COLUMNS).withScrollBar(i).withUpdateGridCallBack(()=>this.updateEggIcons()).withUpdateSingleElementCallback(a=>this.setEggDetails(a)),this.eggListMessageBoxContainer=n.add.container(0,n.game.canvas.height/6),this.eggListMessageBoxContainer.setVisible(!1),this.eggListContainer.add(this.eggListMessageBoxContainer);const r=me(1,-1,318,28);r.setOrigin(0,1),this.eggListMessageBoxContainer.add(r),this.message=V(8,-8,"",x.WINDOW,{maxLines:1}),this.message.setOrigin(0,1),this.eggListMessageBoxContainer.add(this.message),this.cursor=-1}show(e){return super.show(e),this.initEggIcons(),this.getUi().bringToTop(this.eggListContainer),this.eggListContainer.setVisible(!0),this.scrollGridHandler.setTotalElements(n.gameData.eggs.length),this.updateEggIcons(),this.setCursor(0),!0}initEggIcons(){this.eggIcons=[];for(let e=0;e<Math.min(this.ROWS*this.COLUMNS,n.gameData.eggs.length);e++){const t=e%this.COLUMNS*18,s=Math.floor(e/this.COLUMNS)*18,i=n.add.sprite(t-2,s+2,"egg_icons");i.setScale(.5),i.setOrigin(0,0),this.eggListIconContainer.add(i),this.eggIcons.push(i)}}updateEggIcons(){const e=this.scrollGridHandler.getItemOffset(),t=Math.min(this.eggIcons.length,n.gameData.eggs.length-e);this.eggIcons.forEach((s,i)=>{if(i!==this.cursor&&this.iconAnimHandler.addOrUpdate(s,Ze.NONE),i<t){const r=n.gameData.eggs[i+e];s.setFrame(r.getKey()),s.setVisible(!0)}else s.setVisible(!1)})}setEggDetails(e){const t=n.gameData.eggs[e];this.eggSprite.setFrame(`egg_${t.getKey()}`),this.eggNameText.setText(`${S.t("egg:egg")} (${t.getEggDescriptor()})`),this.eggDateText.setText(new Date(t.timestamp).toLocaleString(void 0,{weekday:"short",year:"numeric",month:"2-digit",day:"numeric"})),this.eggHatchWavesText.setText(t.getEggHatchWavesMessage()),this.eggGachaInfoText.setText(t.getEggTypeDescriptor())}processInput(e){const t=this.getUi();let s=!1;const i=!1;return e===I.CANCEL?(t.revertMode(),s=!0):s=this.scrollGridHandler.processInput(e),s&&t.playSelect(),s||i}setCursor(e){let t=!1;const s=this.cursor;if(t=super.setCursor(e),t){const i=this.eggIcons[e];this.cursorObj.setPositionRelative(i,114,5),s>-1&&this.iconAnimHandler.addOrUpdate(this.eggIcons[s],Ze.NONE),this.iconAnimHandler.addOrUpdate(i,Ze.ACTIVE),this.setEggDetails(e+this.scrollGridHandler.getItemOffset())}return t}clear(){super.clear(),this.scrollGridHandler.reset(),this.cursor=-1,this.eggListContainer.setVisible(!1),this.iconAnimHandler.removeAll(),this.eggListIconContainer.removeAll(!0),this.eggIcons=[]}};p(ya,"EggListUiHandler");let Fn=ya;const Ca=class Ca extends at{constructor(){super(L.EGG_GACHA),this.scale=.1666666667,this.gachaContainers=[],this.gachaKnobs=[],this.gachaHatches=[],this.gachaInfoContainers=[],this.voucherCountLabels=[],this.defaultText=S.t("egg:selectMachine")}setup(){this.gachaCursor=0,this.scale=Vi(x.WINDOW,n.uiTheme).scale;const e=this.getUi();this.eggGachaContainer=n.add.container(0,-n.game.canvas.height/6),this.eggGachaContainer.setVisible(!1),e.add(this.eggGachaContainer);const t=n.add.nineslice(0,0,"default_bg",void 0,320,180,0,0,16,0);t.setOrigin(0,0),this.eggGachaContainer.add(t);const s=n.anims.generateFrameNames("gacha_hatch",{suffix:".png",start:1,end:4});n.anims.exists("open")||n.anims.create({key:"open",frames:s,frameRate:12}),n.anims.exists("close")||n.anims.create({key:"close",frames:s.reverse(),frameRate:12}),Ss(Kt).forEach((u,C)=>{const g=Kt[u].toString().toLowerCase(),v=n.add.container(180*C,18),m=n.add.sprite(0,0,`gacha_${g}`);m.setOrigin(0,0);const b=n.add.sprite(115,80,`gacha_underlay_${g}`);b.setOrigin(0,0);const E=n.add.sprite(0,0,"gacha_eggs");E.setOrigin(0,0);const w=n.add.sprite(0,0,"gacha_glass");w.setOrigin(0,0);const _=n.add.container(160,46),A=S.resolvedLanguage??"en";let D=x.WINDOW_ALT,j=4,B=0,$=-20,ie=6;["de","es-ES","fr","ko","pt-BR"].includes(A)&&(D=x.SMALLER_WINDOW_ALT,j=2,B=2);let k=j,U=B;["de","es-ES"].includes(A)&&($=-25,ie=10,k=-6,U=0);const T=V(j,B,S.t("egg:legendaryUPGacha"),D);switch(T.setOrigin(0,0),_.add(T),u){case Kt.LEGENDARY:["de","es-ES"].includes(A)&&(T.setAlign("center"),T.setY(0)),["pt-BR"].includes(A)?T.setX(k-2):T.setX(k),T.setY(U);const W=n.add.sprite($,ie,"pokemon_icons_0");["pt-BR"].includes(A)&&W.setX($-2),W.setScale(.5),W.setOrigin(0,.5),_.add(W);break;case Kt.MOVE:["de","es-ES","fr","pt-BR"].includes(A)&&(T.setAlign("center"),T.setY(0)),T.setText(S.t("egg:moveUPGacha")),T.setX(0),T.setOrigin(.5,0);break;case Kt.SHINY:["de","fr","ko"].includes(A)&&(T.setAlign("center"),T.setY(0)),T.setText(S.t("egg:shinyUPGacha")),T.setX(0),T.setOrigin(.5,0);break}const F=n.add.sprite(191,89,"gacha_knob"),he=n.add.sprite(115,73,"gacha_hatch");he.setOrigin(0,0),v.add(E),v.add(b),v.add(m),v.add(w),v.add(F),v.add(he),v.add(_),w.setAlpha(.5),he.setAlpha(.9),he.on("animationupdate",(W,de)=>b.setFrame(de.textureFrame==="4.png"?"open_hatch":"default")),this.gachaContainers.push(v),this.gachaKnobs.push(F),this.gachaHatches.push(he),this.gachaInfoContainers.push(_),this.eggGachaContainer.add(v),this.updateGachaInfo(C)}),this.eggGachaOptionsContainer=n.add.container(),this.eggGachaOptionsContainer=n.add.container(n.game.canvas.width/6,148),this.eggGachaContainer.add(this.eggGachaOptionsContainer),this.eggGachaOptionSelectBg=me(0,0,96,16+576*this.scale),this.eggGachaOptionSelectBg.setOrigin(1,1),this.eggGachaOptionsContainer.add(this.eggGachaOptionSelectBg);const i="x1",a=[{multiplier:i,description:`1 ${S.t("egg:pull")}`,icon:jt(je.REGULAR)},{multiplier:"x10",description:`10 ${S.t("egg:pulls")}`,icon:jt(je.REGULAR)},{multiplier:i,description:`5 ${S.t("egg:pulls")}`,icon:jt(je.PLUS)},{multiplier:i,description:`10 ${S.t("egg:pulls")}`,icon:jt(je.PREMIUM)},{multiplier:i,description:`25 ${S.t("egg:pulls")}`,icon:jt(je.GOLDEN)}],o=S.resolvedLanguage??"en",l=a.map(u=>{const C=u.description.split(" ");return C[0].length<2&&(C[0]+=["zh","ko"].includes(o.substring(0,2))?" ":"  "),u.multiplier===i&&(C[0]=" "+C[0]),`     ${u.multiplier.padEnd(5)}${C.join(" ")}`}).join(`
`),h=V(0,0,`${l}
${S.t("menu:cancel")}`,x.WINDOW);h.setLineSpacing(28),h.setFontSize("80px"),this.eggGachaOptionsContainer.add(h),h.setPositionRelative(this.eggGachaOptionSelectBg,16,9),a.forEach((u,C)=>{const g=n.add.sprite(0,0,"items",u.icon);g.setScale(3*this.scale),g.setPositionRelative(this.eggGachaOptionSelectBg,20,9+(48+C*96)*this.scale),this.eggGachaOptionsContainer.add(g)}),this.eggGachaContainer.add(this.eggGachaOptionsContainer),new Array(es(je).length).fill(null).map((u,C)=>{const g=n.add.container(n.game.canvas.width/6-56*C,0),v=me(0,0,56,22);v.setOrigin(1,0),g.add(v);const m=V(-48,3,"0",x.WINDOW);m.setOrigin(0,0),g.add(m),this.voucherCountLabels.push(m);const b=jt(C),E=n.add.sprite(-19,2,"items",b);E.setOrigin(0,0),E.setScale(.5),g.add(E),this.eggGachaContainer.add(g)}),this.eggGachaOverlay=n.add.rectangle(0,0,t.displayWidth,t.displayHeight,0),this.eggGachaOverlay.setOrigin(0,0),this.eggGachaOverlay.setAlpha(0),this.eggGachaContainer.add(this.eggGachaOverlay),this.eggGachaSummaryContainer=n.add.container(0,0),this.eggGachaSummaryContainer.setVisible(!1),this.eggGachaContainer.add(this.eggGachaSummaryContainer);const c=n.add.container(0,148),d=me(0,0,320,32);d.setOrigin(0,0),c.add(d),this.eggGachaMessageBox=d;const f=V(8,8,"",x.WINDOW,{maxLines:2});f.setOrigin(0,0),c.add(f),this.message=f,this.initTutorialOverlay(this.eggGachaContainer),this.eggGachaContainer.add(c),this.initPromptSprite(c),this.setCursor(0)}show(e){super.show(e),this.getUi().showText(this.defaultText,0),this.setGachaCursor(1);for(let t=0;t<this.gachaContainers.length;t++)this.updateGachaInfo(t);return this.updateVoucherCounts(),this.getUi().bringToTop(this.eggGachaContainer),this.eggGachaContainer.setVisible(!0),ws(Ls.Egg_Gacha),!0}getDelayValue(e){return this.transitioning&&this.transitionCancelled&&(e=Math.ceil(e/5)),ye(e)}pull(e=0,t=0,s){pe.EGG_GACHA_PULL_COUNT_OVERRIDE&&!t&&(e=pe.EGG_GACHA_PULL_COUNT_OVERRIDE),this.eggGachaOptionsContainer.setVisible(!1),this.setTransitioning(!0);const i=p(()=>{if(this.transitionCancelled)return this.showSummary(s);const r=n.add.sprite(127,75,"egg",`egg_${s[t].getKey()}`);r.setScale(.5),this.gachaContainers[this.gachaCursor].add(r),this.gachaContainers[this.gachaCursor].moveTo(r,2);const a=p(()=>{n.playSound("se/gacha_running",{loop:!0}),n.time.delayedCall(this.getDelayValue(t?500:1250),()=>{n.playSound("se/gacha_dispense"),n.time.delayedCall(this.getDelayValue(750),()=>{n.sound.stopByKey("se/gacha_running"),n.tweens.add({targets:r,duration:this.getDelayValue(350),y:95,ease:"Bounce.easeOut",onComplete:p(()=>{n.time.delayedCall(this.getDelayValue(125),()=>{n.playSound("se/pb_catch"),this.gachaHatches[this.gachaCursor].play("open"),n.tweens.add({targets:r,duration:this.getDelayValue(350),scale:.75,ease:"Sine.easeIn"}),n.tweens.add({targets:r,y:110,duration:this.getDelayValue(350),ease:"Back.easeOut",onComplete:p(()=>{this.gachaHatches[this.gachaCursor].play("close"),n.tweens.add({targets:r,y:200,duration:this.getDelayValue(350),ease:"Cubic.easeIn",onComplete:p(()=>{++t<e?this.pull(e,t,s):this.showSummary(s)},"onComplete")})},"onComplete")})})},"onComplete")})})})},"doPullAnim");t?a():(n.playSound("se/gacha_dial"),n.tweens.add({targets:this.gachaKnobs[this.gachaCursor],duration:this.getDelayValue(350),angle:90,ease:"Cubic.easeInOut",onComplete:p(()=>{n.tweens.add({targets:this.gachaKnobs[this.gachaCursor],duration:this.getDelayValue(350),angle:0,ease:"Sine.easeInOut"}),n.time.delayedCall(this.getDelayValue(350),a)},"onComplete")}))},"doPull");if(e||(e=1),t||(t=0),!s){s=[];for(let r=1;r<=e;r++){const a={pulled:!0,sourceType:this.gachaCursor};if(r===e){const l=this.getGuaranteedEggTierFromPullCount(e);!s.some(h=>h.tier>=l)&&l!==ys.COMMON&&(a.tier=l)}const o=new Gr(a);s.push(o)}s=Il(s),(n.currentBattle?n.gameData.saveAll(!0,!0,!0):n.gameData.saveSystem()).then(r=>{if(!r)return n.reset(!0);i()});return}i()}getGuaranteedEggTierFromPullCount(e){switch(e){case 10:return ys.RARE;case 25:return ys.EPIC;default:return ys.COMMON}}showSummary(e){const t=this.getDelayValue(750);this.summaryFinished=!1,this.transitionCancelled=!1,this.setTransitioning(!0),this.eggGachaSummaryContainer.setVisible(!0);const s=e.length<20?1:.5;n.tweens.add({targets:this.eggGachaOverlay,alpha:.5,ease:"Sine.easeOut",duration:t,onComplete:p(()=>{const r=Math.ceil(e.length/5),a=Math.min(e.length,5),o=this.eggGachaOverlay.displayHeight-this.eggGachaMessageBox.displayHeight;e.map((h,c)=>{const d=c%5,f=Math.floor(c/5),u=this.eggGachaOverlay.displayWidth/(a+2),C=o/(r+2),g=C/2*(f/Math.max(r-1,1))+C/4,v=n.add.container(u*(d+1)+u*.5,C*(f+1)+g);v.setScale(1e-4);const m=n.add.sprite(0,0,"egg",`egg_${h.getKey()}`);v.add(m);const b=V(0,14,h.getEggDescriptor(),x.PARTY,{align:"center"});return b.setOrigin(.5,0),b.setTint(zh(h.isManaphyEgg()?ys.EPIC:h.tier)),v.add(b),this.eggGachaSummaryContainer.addAt(v,0),v}).forEach((h,c)=>{const d=this.transitionCancelled?0:this.getDelayValue(c*100);n.time.delayedCall(d,()=>n.tweens.add({targets:h,duration:this.getDelayValue(350),scale:s,ease:"Sine.easeOut",onComplete:p(()=>{c===e.length-1&&(this.setTransitioning(!1),this.summaryFinished=!0)},"onComplete")}))})},"onComplete")})}hideSummary(){this.setTransitioning(!0),n.tweens.add({targets:[this.eggGachaOverlay,this.eggGachaSummaryContainer],alpha:0,duration:this.getDelayValue(250),ease:"Cubic.easeIn",onComplete:p(()=>{this.eggGachaSummaryContainer.setVisible(!1),this.eggGachaSummaryContainer.setAlpha(1),this.eggGachaSummaryContainer.removeAll(!0),this.setTransitioning(!1),this.summaryFinished=!1,this.eggGachaOptionsContainer.setVisible(!0)},"onComplete")})}updateGachaInfo(e){const t=this.gachaInfoContainers[e];switch(e){case Kt.LEGENDARY:const s=hs(jh(new Date().getTime()));t.getAt(1).setTexture(s.getIconAtlasKey(),s.getIconId(!1));break}}consumeVouchers(e,t){n.gameData.voucherCounts[e]=Math.max(n.gameData.voucherCounts[e]-t,0),this.updateVoucherCounts()}updateVoucherCounts(){this.voucherCountLabels.forEach((e,t)=>{e.setText(n.gameData.voucherCounts[t].toString())})}showText(e,t,s,i,r,a){e||(e=this.defaultText),(e==null?void 0:e.indexOf(`
`))===-1?(this.eggGachaMessageBox.setSize(320,32),this.eggGachaMessageBox.setY(0),this.message.setY(8)):(this.eggGachaMessageBox.setSize(320,46),this.eggGachaMessageBox.setY(-14),this.message.setY(-6)),super.showText(e,t,s,i,r,a)}showError(e){this.showText(e,void 0,()=>this.showText(this.defaultText),ye(1500))}setTransitioning(e){this.transitioning!==e&&(this.transitioning=e,this.transitionCancelled=!1)}processInput(e){const t=this.getUi();let s=!1,i=!1;if(this.transitioning)if(!this.transitionCancelled&&(e===I.ACTION||e===I.CANCEL))this.transitionCancelled=!0,s=!0;else return!1;else if(this.eggGachaSummaryContainer.visible)this.summaryFinished&&(e===I.ACTION||e===I.CANCEL)&&(this.hideSummary(),s=!0);else switch(e){case I.ACTION:switch(this.cursor){case 0:!n.gameData.voucherCounts[je.REGULAR]&&!pe.EGG_FREE_GACHA_PULLS_OVERRIDE?(i=!0,this.showError(S.t("egg:notEnoughVouchers"))):n.gameData.eggs.length<99||pe.UNLIMITED_EGG_COUNT_OVERRIDE?(pe.EGG_FREE_GACHA_PULLS_OVERRIDE||this.consumeVouchers(je.REGULAR,1),this.pull(),s=!0):(i=!0,this.showError(S.t("egg:tooManyEggs")));break;case 2:!n.gameData.voucherCounts[je.PLUS]&&!pe.EGG_FREE_GACHA_PULLS_OVERRIDE?(i=!0,this.showError(S.t("egg:notEnoughVouchers"))):n.gameData.eggs.length<95||pe.UNLIMITED_EGG_COUNT_OVERRIDE?(pe.EGG_FREE_GACHA_PULLS_OVERRIDE||this.consumeVouchers(je.PLUS,1),this.pull(5),s=!0):(i=!0,this.showError(S.t("egg:tooManyEggs")));break;case 1:case 3:this.cursor===1&&n.gameData.voucherCounts[je.REGULAR]<10&&!pe.EGG_FREE_GACHA_PULLS_OVERRIDE||this.cursor===3&&!n.gameData.voucherCounts[je.PREMIUM]&&!pe.EGG_FREE_GACHA_PULLS_OVERRIDE?(i=!0,this.showError(S.t("egg:notEnoughVouchers"))):n.gameData.eggs.length<90||pe.UNLIMITED_EGG_COUNT_OVERRIDE?(this.cursor===3?pe.EGG_FREE_GACHA_PULLS_OVERRIDE||this.consumeVouchers(je.PREMIUM,1):pe.EGG_FREE_GACHA_PULLS_OVERRIDE||this.consumeVouchers(je.REGULAR,10),this.pull(10),s=!0):(i=!0,this.showError(S.t("egg:tooManyEggs")));break;case 4:!n.gameData.voucherCounts[je.GOLDEN]&&!pe.EGG_FREE_GACHA_PULLS_OVERRIDE?(i=!0,this.showError(S.t("egg:notEnoughVouchers"))):n.gameData.eggs.length<75||pe.UNLIMITED_EGG_COUNT_OVERRIDE?(pe.EGG_FREE_GACHA_PULLS_OVERRIDE||this.consumeVouchers(je.GOLDEN,1),this.pull(25),s=!0):(i=!0,this.showError(S.t("egg:tooManyEggs")));break;case 5:t.revertMode(),s=!0;break}break;case I.CANCEL:this.getUi().revertMode(),s=!0;break;case I.UP:this.cursor&&(s=this.setCursor(this.cursor-1));break;case I.DOWN:this.cursor<5&&(s=this.setCursor(this.cursor+1));break;case I.LEFT:this.gachaCursor&&(s=this.setGachaCursor(this.gachaCursor-1));break;case I.RIGHT:this.gachaCursor<es(Kt).length-1&&(s=this.setGachaCursor(this.gachaCursor+1));break}return s?t.playSelect():i&&t.playError(),s||i}setCursor(e){const t=super.setCursor(e);return this.cursorObj||(this.cursorObj=n.add.image(0,0,"cursor"),this.eggGachaOptionsContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.eggGachaOptionSelectBg,10,9+(48+this.cursor*96)*this.scale),t}setGachaCursor(e){const s=this.gachaCursor!==e;return s&&(this.gachaCursor=e,this.setTransitioning(!0),n.tweens.add({targets:this.gachaContainers,duration:this.eggGachaContainer.visible?500:0,x:p((i,r,a,o)=>180*(o-e),"x"),ease:"Cubic.easeInOut",onComplete:p(()=>this.setTransitioning(!1),"onComplete")})),s}clear(){super.clear(),this.setGachaCursor(-1),this.eggGachaContainer.setVisible(!1)}};p(Ca,"EggGachaUiHandler");let Vn=Ca;const ba=class ba extends Phaser.GameObjects.Container{constructor(e,t={}){super(n,0,0),this.shinyIcons=[],this.cost=0,this.setSpecies(e,t);const s=n.add.image(2,5,"passive_bg");s.setOrigin(0,0),s.setScale(.75),s.setVisible(!1),this.add(s),this.starterPassiveBgs=s;for(let b=0;b<3;b++){const E=n.add.image(b*-3+12,2,"shiny_star_small");E.setScale(.5),E.setOrigin(0,0),E.setVisible(!1),this.shinyIcons.push(E)}this.add(this.shinyIcons);const i=V(1,2,"0",x.WINDOW,{fontSize:"32px"});i.setShadowOffset(2,2),i.setOrigin(0,0),i.setVisible(!1),this.add(i),this.label=i;const r=n.add.image(12,7,"ha_capsule");r.setOrigin(0,0),r.setScale(.5),r.setVisible(!1),this.add(r),this.hiddenAbilityIcon=r;const a=n.add.image(0,7,"favorite");a.setOrigin(0,0),a.setScale(.5),a.setVisible(!1),this.add(a),this.favoriteIcon=a;const o=n.add.image(0,12,"champion_ribbon");o.setOrigin(0,0),o.setScale(.5),o.setVisible(!1),this.add(o),this.classicWinIcon=o;const l=n.add.image(12,12,"candy");l.setOrigin(0,0),l.setScale(.25),l.setVisible(!1),this.add(l),this.candyUpgradeIcon=l;const h=n.add.image(12,12,"candy_overlay");h.setOrigin(0,0),h.setScale(.25),h.setVisible(!1),this.add(h),this.candyUpgradeOverlayIcon=h;const c=n.add.image(0,12,"mystery_egg");c.setOrigin(0,0),c.setScale(.25),c.setVisible(!1),this.add(c),this.eggMove1Icon=c;const d=n.add.image(0,12,"normal_memory");d.setOrigin(0,0),d.setScale(.25),d.setVisible(!1),this.add(d),this.tmMove1Icon=d;const f=n.add.image(7,12,"mystery_egg");f.setOrigin(0,0),f.setScale(.25),f.setVisible(!1),this.add(f),this.eggMove2Icon=f;const u=n.add.image(7,12,"normal_memory");u.setOrigin(0,0),u.setScale(.25),u.setVisible(!1),this.add(u),this.tmMove2Icon=u;const C=n.add.image(3,3,"candy");C.setOrigin(0,0),C.setScale(.25),C.setVisible(!1),this.add(C),this.passive1Icon=C;const g=n.add.image(12,12,"candy_overlay");g.setOrigin(0,0),g.setScale(.25),g.setVisible(!1),this.add(g),this.passive1OverlayIcon=g;const v=n.add.image(12,3,"candy");v.setOrigin(0,0),v.setScale(.25),v.setVisible(!1),this.add(v),this.passive2Icon=v;const m=n.add.image(12,12,"candy_overlay");m.setOrigin(0,0),m.setScale(.25),m.setVisible(!1),this.add(m),this.passive2OverlayIcon=m}setSpecies(e,t={}){this.species=e;const{shiny:s,formIndex:i,female:r,variant:a}=t,o=n.gameData.getSpeciesDefaultDexAttr(e,!1,!0),l=n.gameData.getSpeciesDexAttrProps(e,o);ve(i)||(l.formIndex=i),ve(s)||(l.shiny=s),ve(a)||(l.variant=a),ve(r)||(l.female=r),this.icon&&(this.remove(this.icon),this.icon.destroy()),this.icon=n.add.sprite(-2,2,e.getIconAtlasKey(l.formIndex,l.shiny,l.variant)),this.icon.setScale(.5),this.icon.setOrigin(0,0),this.icon.setFrame(e.getIconId(l.female,l.formIndex,l.shiny,l.variant)),this.checkIconId(l.female,l.formIndex,l.shiny,l.variant),this.add(this.icon)}checkIconId(e,t,s,i){this.icon.frame.name!==this.species.getIconId(e,t,s,i)&&(console.log(`${this.species.name}'s variant icon does not exist. Replacing with default.`),this.icon.setTexture(this.species.getIconAtlasKey(t,!1,i)),this.icon.setFrame(this.species.getIconId(e,t,!1,i)))}};p(ba,"PokedexMonContainer");let _i=ba;var Ne=(P=>(P[P.NAME=0]="NAME",P[P.MOVE_1=1]="MOVE_1",P[P.MOVE_2=2]="MOVE_2",P[P.ABILITY_1=3]="ABILITY_1",P[P.ABILITY_2=4]="ABILITY_2",P))(Ne||{});const Ta=class Ta extends Phaser.GameObjects.Container{constructor(e,t,s,i,r){super(n,e,t),this.labels=[],this.selections=[],this.rows=[],this.numFilters=0,this.lastCursor=-1,this.textPadding=8,this.defaultWordWrapWidth=1224,this.defaultText="---",this.onChange=r,this.width=s,this.height=i,this.window=me(0,0,s,i,!1,!1,void 0,void 0,gt.THIN),this.add(this.window),this.cursorObj=n.add.image(1,1,"cursor"),this.cursorObj.setScale(.5),this.cursorObj.setVisible(!1),this.cursorObj.setOrigin(0,0),this.add(this.cursorObj),this.menuMessageBoxContainer=n.add.container(0,130),this.menuMessageBoxContainer.setName("menu-message-box"),this.menuMessageBoxContainer.setVisible(!1),this.dialogueMessageBox=me(-this.textPadding,0,n.game.canvas.width/6+this.textPadding*2,49,!1,!1,0,0,gt.THIN),this.dialogueMessageBox.setOrigin(0,0),this.menuMessageBoxContainer.add(this.dialogueMessageBox);const a=V(this.textPadding,this.textPadding,"",x.WINDOW,{maxLines:2});a.setName("menu-message"),a.setOrigin(0,0),this.menuMessageBoxContainer.add(a),this.message=a}addFilter(e,t){if(this.rows.includes(e))return!1;this.rows.push(e);const a=V(14,3,t,x.TOOLTIP_CONTENT);this.labels.push(a),this.add(a);const o=V(54,3,this.defaultText,x.TOOLTIP_CONTENT);return this.selections.push(o),this.add(o),this.calcFilterPositions(),this.numFilters++,!0}resetSelection(e){this.selections[e].setText(this.defaultText),this.onChange()}setValsToDefault(){for(let e=0;e<this.numFilters;e++)this.resetSelection(e)}startSearch(e,t){t.playSelect();const s="",i={};i.buttonActions=[r=>{t.playSelect();const o=decodeURIComponent(escape(atob(r))),l=t.getHandler();l.tutorialActive=!0,this.selections[e].setText(o===""?this.defaultText:String(S.t(o))),t.revertMode(),this.onChange()},()=>{t.revertMode(),this.onChange}],t.setOverlayMode(L.POKEDEX_SCAN,i,s,e)}setCursor(e){this.cursorObj.setPosition(8,this.labels[e].y+3),this.lastCursor=e}updateFilterLabels(){for(let e=0;e<this.numFilters;e++)this.selections[e].text===this.defaultText?this.labels[e].setColor(At(x.TOOLTIP_CONTENT,!1,n.uiTheme)):this.labels[e].setColor(At(x.STATS_LABEL,!1,n.uiTheme))}calcFilterPositions(){let t=16;this.labels.forEach(i=>{t+=i.displayHeight});const s=(this.height-t)/(this.labels.length-1);for(let i=0;i<this.labels.length;i++)if(i===0)this.labels[i].y=8,this.selections[i].y=8;else{const r=this.labels[i-1].y+this.labels[i-1].displayHeight;this.labels[i].y=r+s,this.selections[i].y=r+s}}getValue(e){return this.selections[e].getWrappedText()[0]}setValue(e,t){this.selections[e].setText(t),this.onChange()}getNearestFilter(e){const t=e.y+e.icon.displayHeight/2;let s=0,i=1e3;for(let r=0;r<this.labels.length;r++){const a=Math.abs(t-(this.labels[r].y+this.labels[r].displayHeight/3));a<i&&(s=r,i=a)}return s}};p(Ta,"FilterText");let Un=Ta;const ll={en:{starterInfoTextSize:"56px",instructionTextSize:"38px"},de:{starterInfoTextSize:"48px",instructionTextSize:"35px",starterInfoXPos:33},"es-ES":{starterInfoTextSize:"56px",instructionTextSize:"35px"},fr:{starterInfoTextSize:"54px",instructionTextSize:"38px"},it:{starterInfoTextSize:"56px",instructionTextSize:"38px"},pt_BR:{starterInfoTextSize:"47px",instructionTextSize:"38px",starterInfoXPos:33},zh:{starterInfoTextSize:"47px",instructionTextSize:"38px",starterInfoYOffset:1,starterInfoXPos:24},pt:{starterInfoTextSize:"48px",instructionTextSize:"42px",starterInfoXPos:33},ko:{starterInfoTextSize:"52px",instructionTextSize:"38px"},ja:{starterInfoTextSize:"51px",instructionTextSize:"38px"},"ca-ES":{starterInfoTextSize:"56px",instructionTextSize:"38px"}},Vu=2,si=17,ii=143;function an(P){const s=P%9*18,i=13+Math.floor(P/9)*17;return{x:s,y:i}}p(an,"calcStarterPosition");const Sa=class Sa extends at{constructor(){super(L.POKEDEX),this.pokemonContainers=[],this.filteredPokemonData=[],this.filterBarCursor=0,this.oldCursor=-1,this.speciesLoaded=new Map,this.pokerusSpecies=[],this.blockInput=!1,this.textPadding=8,this.defaultMessageBoxWidth=220,this.defaultWordWrapWidth=1224,this.scale=.1666666667,this.filterTextCursor=0,this.showDecorations=!1,this.trayContainers=[],this.trayCursor=0,this.showingTray=!1,this.updateStarters=()=>{this.scrollCursor=0,this.filteredPokemonData=[],this.pokerusCursorObjs.forEach(t=>t.setVisible(!1)),this.filterBar.updateFilterLabels(),this.filterText.updateFilterLabels(),this.filteredPokemonData=[],Re.forEach(t=>{var gs,Gs,Hs,Ws,ms;const s=this.getStarterSpeciesId(t.speciesId),i=this.getCurrentDexProps(t.speciesId),r=this.getSanitizedProps(n.gameData.getSpeciesDexAttrProps(t,i)),a={species:t,cost:n.gameData.getSpeciesStarterValue(s),props:r},o=(((gs=n.gameData.dexData[t.speciesId])==null?void 0:gs.caughtAttr)||BigInt(0))&(((Gs=n.gameData.dexData[this.getStarterSpeciesId(t.speciesId)])==null?void 0:Gs.caughtAttr)||BigInt(0))&t.getFullUnlocksData(),l=n.gameData.starterData[s],h=dt.hasOwnProperty(s),c=this.filterText.getValue(Ne.NAME),d=t.name===c||c===this.filterText.defaultText,f=fi[t.speciesId].map(q=>_e[q[1]].name),u=((Hs=dt[s])==null?void 0:Hs.map(q=>_e[q].name))??[],C=((Ws=Bl[t.speciesId])==null?void 0:Ws.map(q=>_e[Array.isArray(q)?q[1]:q].name))??[],g=this.filterText.getValue(Ne.MOVE_1),v=this.filterText.getValue(Ne.MOVE_2),m=t.forms.some(q=>this.hasFormLevelMove(q,g)),b=t.forms.some(q=>this.hasFormLevelMove(q,v)),E=f.includes(g)||m,w=u.includes(g),_=C.includes(g),A=f.includes(v)||b,D=u.includes(v),j=C.includes(v),B=E||w||_||g===this.filterText.defaultText,$=A||D||j||v===this.filterText.defaultText,ie=B&&$;if(w&&!E){const q=u.findIndex(st=>st===g);(l.eggMoves&1<<q)===0?a.eggMove1=!1:a.eggMove1=!0}else _&&!E&&(a.tmMove1=!0);if(D&&!A){const q=u.findIndex(st=>st===v);(l.eggMoves&1<<q)===0?a.eggMove2=!1:a.eggMove2=!0}else j&&!A&&(a.tmMove2=!0);const k=[t.ability1,t.ability2,t.abilityHidden].map(q=>Fe[q].name),U=[t.getPassiveAbility()];for(const q of t.forms)U.push(q.getPassiveAbility());const T=this.filterText.getValue(Ne.ABILITY_1),F=t.forms.some(q=>[q.ability1,q.ability2,q.abilityHidden].map(st=>Fe[st].name).includes(T)),he=k.includes(T)||F||T===this.filterText.defaultText,W=Object.values(U).some(q=>Fe[q].name===T),de=this.filterText.getValue(Ne.ABILITY_2),z=t.forms.some(q=>[q.ability1,q.ability2,q.abilityHidden].map(st=>Fe[st].name).includes(de)),Y=k.includes(de)||z||de===this.filterText.defaultText,G=Object.values(U).some(q=>Fe[q].name===de),R=he&&(G||de===this.filterText.defaultText)||Y&&(W||T===this.filterText.defaultText);(W||G)&&(W?l.passiveAttr>0?a.passive1=!0:a.passive1=!1:l.passiveAttr>0?a.passive2=!0:a.passive2=!1);const ce=this.filterBar.getVals(be.GEN).includes(t.generation),ne=this.filterBar.getVals(be.TYPES).some(q=>t.isOfType(q-1)),ae=new Map(Object.values(Ue).map((q,st)=>typeof q=="string"?[st,q]:void 0).filter(q=>q!==void 0));ae.set(35,"Uncatchable");const ke=gi[t.speciesId].concat(gi[s]).map(q=>Ue[q.biome]);ke.length===0&&ke.push("Uncatchable");const We=ke.length===0&&this.filterBar.getVals(be.BIOME).length===36,Ie=this.filterBar.getVals(be.BIOME).some(q=>ke.includes(ae.get(q)??""))||We,xe=!!(o&Z.NON_SHINY),Be=!!(o&Z.SHINY),Me=Be&&!!(o&Z.DEFAULT_VARIANT),qe=Be&&!!(o&Z.VARIANT_2),ze=Be&&!!(o&Z.VARIANT_3),y=!xe&&!Me&&!qe&&!ze,Q=this.filterBar.getVals(be.CAUGHT).some(q=>{if(q==="SHINY3")return ze;if(q==="SHINY2")return qe&&!ze;if(q==="SHINY")return Me&&!qe&&!ze;if(q==="NORMAL")return xe&&!Me&&!qe&&!ze;if(q==="UNCAUGHT")return y}),X=l.passiveAttr>0,M=this.isPassiveAvailable(t.speciesId)&&!X,O=this.filterBar.getVals(be.UNLOCKS).some(q=>{if(q.val==="PASSIVE"&&q.state===ee.ON)return X;if(q.val==="PASSIVE"&&q.state===ee.EXCLUDE)return h&&!X;if(q.val==="PASSIVE"&&q.state===ee.UNLOCKABLE)return M;if(q.val==="PASSIVE"&&q.state===ee.OFF)return!0}),N=l.valueReduction===1,J=l.valueReduction===2,te=this.isValueReductionAvailable(t.speciesId),K=this.filterBar.getVals(be.UNLOCKS).some(q=>{if(q.val==="COST_REDUCTION"&&q.state===ee.ON)return N||J;if(q.val==="COST_REDUCTION"&&q.state===ee.ONE)return N;if(q.val==="COST_REDUCTION"&&q.state===ee.TWO)return J;if(q.val==="COST_REDUCTION"&&q.state===ee.EXCLUDE)return h&&!(N||J);if(q.val==="COST_REDUCTION"&&q.state===ee.UNLOCKABLE)return te;if(q.val==="COST_REDUCTION"&&q.state===ee.OFF)return!0}),re=this.getStarterSpeciesId(t.speciesId)===t.speciesId,ue=this.filterBar.getVals(be.MISC).some(q=>{if(q.val==="STARTER"&&q.state===ee.ON)return re;if(q.val==="STARTER"&&q.state===ee.EXCLUDE)return!re;if(q.val==="STARTER"&&q.state===ee.OFF)return!0}),le=((ms=this.starterPreferences[t.speciesId])==null?void 0:ms.favorite)??!1,Ce=this.filterBar.getVals(be.MISC).some(q=>{if(q.val==="FAVORITE"&&q.state===ee.ON)return le;if(q.val==="FAVORITE"&&q.state===ee.EXCLUDE)return!le;if(q.val==="FAVORITE"&&q.state===ee.OFF)return!0}),Oe=l.classicWinCount>0,Ee=l.classicWinCount===0,tt=l.classicWinCount===void 0,Gt=this.filterBar.getVals(be.MISC).some(q=>{if(q.val==="WIN"&&q.state===ee.ON)return Oe;if(q.val==="WIN"&&q.state===ee.EXCLUDE)return Ee||tt;if(q.val==="WIN"&&q.state===ee.OFF)return!0}),lt=t.abilityHidden!==t.ability1&&t.abilityHidden!==Ui.NONE,Lt=l.abilityAttr&Xe.ABILITY_HIDDEN,De=this.filterBar.getVals(be.MISC).some(q=>{if(q.val==="HIDDEN_ABILITY"&&q.state===ee.ON)return Lt;if(q.val==="HIDDEN_ABILITY"&&q.state===ee.EXCLUDE)return lt&&!Lt;if(q.val==="HIDDEN_ABILITY"&&q.state===ee.OFF)return!0}),Ht=this.isSameSpeciesEggAvailable(t.speciesId),fs=this.filterBar.getVals(be.MISC).some(q=>{if(q.val==="EGG"&&q.state===ee.ON)return Ht;if(q.val==="EGG"&&q.state===ee.EXCLUDE)return h&&!Ht;if(q.val==="EGG"&&q.state===ee.OFF)return!0}),mt=this.filterBar.getVals(be.MISC).some(q=>{if(q.val==="POKERUS"&&q.state===ee.ON)return this.pokerusSpecies.includes(t);if(q.val==="POKERUS"&&q.state===ee.EXCLUDE)return!this.pokerusSpecies.includes(t);if(q.val==="POKERUS"&&q.state===ee.OFF)return!0});d&&R&&ie&&ce&&Ie&&ne&&Q&&O&&K&&ue&&Ce&&Gt&&De&&fs&&mt&&this.filteredPokemonData.push(a)}),this.starterSelectScrollBar.setTotalRows(Math.max(Math.ceil(this.filteredPokemonData.length/9),1)),this.starterSelectScrollBar.setScrollCursor(0);const e=this.filterBar.getVals(be.SORT)[0];this.filteredPokemonData.sort((t,s)=>{switch(e.val){case we.NUMBER:return(t.species.speciesId-s.species.speciesId)*-e.dir;case we.COST:return(t.cost-s.cost)*-e.dir;case we.CANDY:{const i=n.gameData.starterData[this.getStarterSpeciesId(t.species.speciesId)].candyCount,r=n.gameData.starterData[this.getStarterSpeciesId(s.species.speciesId)].candyCount;return(i-r)*-e.dir}case we.IV:{const i=n.gameData.dexData[t.species.speciesId].ivs.reduce((a,o)=>a+o,0)/n.gameData.dexData[t.species.speciesId].ivs.length,r=n.gameData.dexData[s.species.speciesId].ivs.reduce((a,o)=>a+o,0)/n.gameData.dexData[s.species.speciesId].ivs.length;return(i-r)*-e.dir}case we.NAME:return t.species.name.localeCompare(s.species.name)*-e.dir;case we.CAUGHT:return(n.gameData.dexData[t.species.speciesId].caughtCount-n.gameData.dexData[s.species.speciesId].caughtCount)*-e.dir;case we.HATCHED:return(n.gameData.dexData[this.getStarterSpeciesId(t.species.speciesId)].hatchedCount-n.gameData.dexData[this.getStarterSpeciesId(s.species.speciesId)].hatchedCount)*-e.dir}return 0}),this.filteredIndices=this.filteredPokemonData.map(t=>t.species.speciesId),this.updateScroll()},this.updateScroll=()=>{const t=this.scrollCursor*9;this.starterSelectScrollBar.setScrollCursor(this.scrollCursor),this.pokerusCursorObjs.forEach(i=>i.setVisible(!1));let s=0;this.pokemonContainers.forEach((i,r)=>{var o;const a=r+t;if(a>=this.filteredPokemonData.length)i.setVisible(!1);else{i.setVisible(!0);const l=this.filteredPokemonData[a],h=l.props;i.setSpecies(l.species,h),i.icon.setTexture(l.species.getIconAtlasKey(h.formIndex,h.shiny,h.variant),i.species.getIconId(h.female,h.formIndex,h.shiny,h.variant)),i.checkIconId(h.female,h.formIndex,h.shiny,h.variant);const d=l.species.speciesId,f=n.gameData.dexData[d],u=f.caughtAttr&n.gameData.dexData[this.getStarterSpeciesId(d)].caughtAttr&l.species.getFullUnlocksData();if(u&l.species.getFullUnlocksData()||n.dexForDevs?i.icon.clearTint():this.isSeen(l.species,f)?i.icon.setTint(8421504):i.icon.setTint(0),[[l.eggMove1,i.eggMove1Icon],[l.eggMove2,i.eggMove2Icon],[l.tmMove1,i.tmMove1Icon],[l.tmMove2,i.tmMove2Icon],[l.passive1,i.passive1Icon],[l.passive2,i.passive2Icon]].forEach(([g,v])=>{g?(v.setVisible(!0),v.clearTint()):g===!1?(v.setVisible(!0),v.setTint(8421504)):v.setVisible(!1)}),this.showDecorations){this.pokerusSpecies.includes(l.species)&&(this.pokerusCursorObjs[s].setPosition(i.x-1,i.y+1),this.pokerusCursorObjs[s].setVisible(!0),s++),this.updateStarterValueLabel(i),i.label.setVisible(!0);const g=d&&u&Z.SHINY?[Z.DEFAULT_VARIANT,Z.VARIANT_2,Z.VARIANT_3].filter(v=>!!(u&v)):[];for(let v=0;v<3;v++){const m=g.length>v;i.shinyIcons[v].setVisible(m),m&&i.shinyIcons[v].setTint($e(g[v]===Z.DEFAULT_VARIANT?0:g[v]===Z.VARIANT_2?1:2))}i.starterPassiveBgs.setVisible(!!n.gameData.starterData[this.getStarterSpeciesId(d)].passiveAttr),i.hiddenAbilityIcon.setVisible(!!u&&!!(n.gameData.starterData[this.getStarterSpeciesId(d)].abilityAttr&4)),i.classicWinIcon.setVisible(n.gameData.starterData[this.getStarterSpeciesId(d)].classicWinCount>0),i.favoriteIcon.setVisible(((o=this.starterPreferences[d])==null?void 0:o.favorite)??!1),n.candyUpgradeDisplay===0?(Ye[this.getStarterSpeciesId(d)]||(Ye[this.getStarterSpeciesId(d)]=["ffffff","ffffff"]),i.candyUpgradeIcon.setTint(pt(it(Ye[this.getStarterSpeciesId(d)][0]))),i.candyUpgradeOverlayIcon.setTint(pt(it(Ye[this.getStarterSpeciesId(d)][1])))):n.candyUpgradeDisplay===1&&(i.candyUpgradeIcon.setVisible(!1),i.candyUpgradeOverlayIcon.setVisible(!1))}else{i.label.setVisible(!1);for(let g=0;g<3;g++)i.shinyIcons[g].setVisible(!1);i.starterPassiveBgs.setVisible(!1),i.hiddenAbilityIcon.setVisible(!1),i.classicWinIcon.setVisible(!1),i.favoriteIcon.setVisible(!1),i.candyUpgradeIcon.setVisible(!1),i.candyUpgradeOverlayIcon.setVisible(!1)}}})}}setup(){const e=this.getUi(),t=S.resolvedLanguage??"en",s=Object.keys(ll).find(F=>t.includes(F))??"en",i=ll[s];this.starterSelectContainer=n.add.container(0,-n.game.canvas.height/6),this.starterSelectContainer.setVisible(!1),e.add(this.starterSelectContainer);const r=n.add.rectangle(0,0,n.game.canvas.width/6,n.game.canvas.height/6,26720);r.setOrigin(0,0),this.starterSelectContainer.add(r);const a=me(ii,si+1,175,161),o=n.add.image(ii+1,si+2,"starter_container_bg");o.setOrigin(0,0),this.starterSelectContainer.add(o),this.starterSelectContainer.add(a),this.filterTextContainer=n.add.container(0,0),this.filterText=new Un(1,si+2,140,100,this.updateStarters),this.filterText.addFilter(Ne.NAME,S.t("filterText:nameField")),this.filterText.addFilter(Ne.MOVE_1,S.t("filterText:move1Field")),this.filterText.addFilter(Ne.MOVE_2,S.t("filterText:move2Field")),this.filterText.addFilter(Ne.ABILITY_1,S.t("filterText:ability1Field")),this.filterText.addFilter(Ne.ABILITY_2,S.t("filterText:ability2Field")),this.filterTextContainer.add(this.filterText),this.starterSelectContainer.add(this.filterTextContainer),this.filterBarContainer=n.add.container(0,0),this.filterBar=new bi(ii,1,175,si,2,0,6);const l=[new fe(1,new se(S.t("pokedexUiHandler:gen1"))),new fe(2,new se(S.t("pokedexUiHandler:gen2"))),new fe(3,new se(S.t("pokedexUiHandler:gen3"))),new fe(4,new se(S.t("pokedexUiHandler:gen4"))),new fe(5,new se(S.t("pokedexUiHandler:gen5"))),new fe(6,new se(S.t("pokedexUiHandler:gen6"))),new fe(7,new se(S.t("pokedexUiHandler:gen7"))),new fe(8,new se(S.t("pokedexUiHandler:gen8"))),new fe(9,new se(S.t("pokedexUiHandler:gen9")))],h=new et(0,0,l,this.updateStarters,Je.HYBRID);this.filterBar.addFilter(be.GEN,S.t("filterBar:genFilter"),h);const c=Object.keys(Te).filter(F=>Number.isNaN(Number(F))),d=[];c.forEach((F,he)=>{if(he===0||he===19)return;const W=n.add.sprite(0,0,Tt("types"));W.setScale(.5),W.setFrame(F.toLowerCase()),d.push(new fe(he,new se("",W)))}),this.filterBar.addFilter(be.TYPES,S.t("filterBar:typeFilter"),new et(0,0,d,this.updateStarters,Je.HYBRID,.5));const f=Object.values(Ue).filter(F=>typeof F=="number").map((F,he)=>new fe(he,new se(S.t(`biome:${Ue[F].toUpperCase()}`))));f.push(new fe(f.length,new se(S.t("filterBar:uncatchable"))));const u=new et(0,0,f,this.updateStarters,Je.HYBRID);this.filterBar.addFilter(be.BIOME,S.t("filterBar:biomeFilter"),u);const C=n.add.sprite(0,0,"shiny_icons");C.setOrigin(.15,.2),C.setScale(.6),C.setFrame(ct(0)),C.setTint($e(0));const g=n.add.sprite(0,0,"shiny_icons");g.setOrigin(.15,.2),g.setScale(.6),g.setFrame(ct(1)),g.setTint($e(1));const v=n.add.sprite(0,0,"shiny_icons");v.setOrigin(.15,.2),v.setScale(.6),v.setFrame(ct(2)),v.setTint($e(2));const m=[new fe("SHINY3",new se("",v)),new fe("SHINY2",new se("",g)),new fe("SHINY",new se("",C)),new fe("NORMAL",new se(S.t("filterBar:normal"))),new fe("UNCAUGHT",new se(S.t("filterBar:uncaught")))];this.filterBar.addFilter(be.CAUGHT,S.t("filterBar:caughtFilter"),new et(0,0,m,this.updateStarters,Je.HYBRID));const b=[new se(S.t("filterBar:passive"),void 0,ee.OFF),new se(S.t("filterBar:passiveUnlocked"),void 0,ee.ON),new se(S.t("filterBar:passiveUnlockable"),void 0,ee.UNLOCKABLE),new se(S.t("filterBar:passiveLocked"),void 0,ee.EXCLUDE)],E=[new se(S.t("filterBar:costReduction"),void 0,ee.OFF),new se(S.t("filterBar:costReductionUnlocked"),void 0,ee.ON),new se(S.t("filterBar:costReductionUnlockedOne"),void 0,ee.ONE),new se(S.t("filterBar:costReductionUnlockedTwo"),void 0,ee.TWO),new se(S.t("filterBar:costReductionUnlockable"),void 0,ee.UNLOCKABLE),new se(S.t("filterBar:costReductionLocked"),void 0,ee.EXCLUDE)],w=[new fe("PASSIVE",b),new fe("COST_REDUCTION",E)];this.filterBar.addFilter(be.UNLOCKS,S.t("filterBar:unlocksFilter"),new et(0,0,w,this.updateStarters,Je.RADIAL));const _=[new se(S.t("filterBar:starter"),void 0,ee.OFF),new se(S.t("filterBar:isStarter"),void 0,ee.ON),new se(S.t("filterBar:notStarter"),void 0,ee.EXCLUDE)],A=[new se(S.t("filterBar:favorite"),void 0,ee.OFF),new se(S.t("filterBar:isFavorite"),void 0,ee.ON),new se(S.t("filterBar:notFavorite"),void 0,ee.EXCLUDE)],D=[new se(S.t("filterBar:ribbon"),void 0,ee.OFF),new se(S.t("filterBar:hasWon"),void 0,ee.ON),new se(S.t("filterBar:hasNotWon"),void 0,ee.EXCLUDE)],j=[new se(S.t("filterBar:hiddenAbility"),void 0,ee.OFF),new se(S.t("filterBar:hasHiddenAbility"),void 0,ee.ON),new se(S.t("filterBar:noHiddenAbility"),void 0,ee.EXCLUDE)],B=[new se(S.t("filterBar:egg"),void 0,ee.OFF),new se(S.t("filterBar:eggPurchasable"),void 0,ee.ON)],$=[new se(S.t("filterBar:pokerus"),void 0,ee.OFF),new se(S.t("filterBar:hasPokerus"),void 0,ee.ON)],ie=[new fe("STARTER",_),new fe("FAVORITE",A),new fe("WIN",D),new fe("HIDDEN_ABILITY",j),new fe("EGG",B),new fe("POKERUS",$)];this.filterBar.addFilter(be.MISC,S.t("filterBar:miscFilter"),new et(0,0,ie,this.updateStarters,Je.RADIAL));const k=[new fe(we.NUMBER,new se(S.t("filterBar:sortByNumber"),void 0,ee.ON)),new fe(we.COST,new se(S.t("filterBar:sortByCost"))),new fe(we.CANDY,new se(S.t("filterBar:sortByCandies"))),new fe(we.IV,new se(S.t("filterBar:sortByIVs"))),new fe(we.NAME,new se(S.t("filterBar:sortByName"))),new fe(we.CAUGHT,new se(S.t("filterBar:sortByNumCaught"))),new fe(we.HATCHED,new se(S.t("filterBar:sortByNumHatched")))];this.filterBar.addFilter(be.SORT,S.t("filterBar:sortFilter"),new et(0,0,k,this.updateStarters,Je.SINGLE)),this.filterBarContainer.add(this.filterBar),this.starterSelectContainer.add(this.filterBarContainer),this.filterBar.offsetHybridFilters(),n.uiTheme||a.setVisible(!1),this.iconAnimHandler=new Yi,this.iconAnimHandler.setup(),this.pokemonNumberText=V(6,141,"",x.SUMMARY),this.pokemonNumberText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNumberText),this.pokemonNameText=V(6,128,"",x.SUMMARY),this.pokemonNameText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNameText),this.pokemonFormText=V(6,121,"",x.PARTY,{fontSize:i.instructionTextSize}),this.pokemonFormText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonFormText);const U=n.add.container(ii+6,9);this.starterSelectScrollBar=new _t(161,12,5,a.height-6,9),U.add(this.starterSelectScrollBar),this.pokerusCursorObjs=new Array(xl).fill(null).map(()=>{const F=n.add.image(0,0,"select_cursor_pokerus");return F.setVisible(!1),F.setOrigin(0,0),U.add(F),F}),this.cursorObj=n.add.image(0,0,"select_cursor"),this.cursorObj.setOrigin(0,0),U.add(this.cursorObj);for(const F of Re)this.speciesLoaded.set(F.speciesId,!1);for(let F=0;F<81;F++){const he=new _i(Re[F]).setVisible(!1),W=an(F);he.setPosition(W.x,W.y),this.iconAnimHandler.addOrUpdate(he.icon,Ze.NONE),this.pokemonContainers.push(he),U.add(he)}this.formTrayContainer=n.add.container(0,0),this.trayBg=me(0,0,0,0),this.trayBg.setOrigin(0,0),this.formTrayContainer.add(this.trayBg),this.trayCursorObj=n.add.image(0,0,"select_cursor"),this.trayCursorObj.setOrigin(0,0),this.formTrayContainer.add(this.trayCursorObj),U.add(this.formTrayContainer),U.bringToTop(this.formTrayContainer),this.formTrayContainer.setVisible(!1),this.starterSelectContainer.add(U),this.pokemonSprite=n.add.sprite(96,143,"pkmn__sub"),this.pokemonSprite.setPipeline(n.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.starterSelectContainer.add(this.pokemonSprite),this.type1Icon=n.add.sprite(10,158,Tt("types")),this.type1Icon.setScale(.5),this.type1Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type1Icon),this.type2Icon=n.add.sprite(28,158,Tt("types")),this.type2Icon.setScale(.5),this.type2Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type2Icon),this.starterSelectMessageBoxContainer=n.add.container(0,n.game.canvas.height/6),this.starterSelectMessageBoxContainer.setVisible(!1),this.starterSelectContainer.add(this.starterSelectMessageBoxContainer),this.starterSelectMessageBox=me(1,-1,318,28),this.starterSelectMessageBox.setOrigin(0,1),this.starterSelectMessageBoxContainer.add(this.starterSelectMessageBox);const T=i.instructionTextSize;this.goFilterIconElement1=new Phaser.GameObjects.Sprite(n,10,2,"keyboard","C.png"),this.goFilterIconElement1.setName("sprite-goFilter1-icon-element"),this.goFilterIconElement1.setScale(.675),this.goFilterIconElement1.setOrigin(0,0),this.goFilterIconElement2=new Phaser.GameObjects.Sprite(n,20,2,"keyboard","V.png"),this.goFilterIconElement2.setName("sprite-goFilter2-icon-element"),this.goFilterIconElement2.setScale(.675),this.goFilterIconElement2.setOrigin(0,0),this.goFilterLabel=V(30,2,S.t("pokedexUiHandler:goFilters"),x.PARTY,{fontSize:T}),this.goFilterLabel.setName("text-goFilter-label"),this.starterSelectContainer.add(this.goFilterIconElement1),this.starterSelectContainer.add(this.goFilterIconElement2),this.starterSelectContainer.add(this.goFilterLabel),this.toggleDecorationsIconElement=new Phaser.GameObjects.Sprite(n,10,10,"keyboard","R.png"),this.toggleDecorationsIconElement.setName("sprite-toggleDecorations-icon-element"),this.toggleDecorationsIconElement.setScale(.675),this.toggleDecorationsIconElement.setOrigin(0,0),this.toggleDecorationsLabel=V(20,10,S.t("pokedexUiHandler:toggleDecorations"),x.PARTY,{fontSize:T}),this.toggleDecorationsLabel.setName("text-toggleDecorations-label"),this.starterSelectContainer.add(this.toggleDecorationsIconElement),this.starterSelectContainer.add(this.toggleDecorationsLabel),this.showFormTrayIconElement=new Phaser.GameObjects.Sprite(n,6,168,"keyboard","F.png"),this.showFormTrayIconElement.setName("sprite-showFormTray-icon-element"),this.showFormTrayIconElement.setScale(.675),this.showFormTrayIconElement.setOrigin(0,0),this.showFormTrayLabel=V(16,168,S.t("pokedexUiHandler:showForms"),x.PARTY,{fontSize:T}),this.showFormTrayLabel.setName("text-showFormTray-label"),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),this.starterSelectContainer.add(this.showFormTrayIconElement),this.starterSelectContainer.add(this.showFormTrayLabel),this.message=V(8,8,"",x.WINDOW,{maxLines:2}),this.message.setOrigin(0,0),this.starterSelectMessageBoxContainer.add(this.message),this.initPromptSprite(this.starterSelectMessageBoxContainer),this.starterSelectContainer.bringToTop(this.filterBarContainer),this.initTutorialOverlay(this.starterSelectContainer),this.starterSelectContainer.bringToTop(this.starterSelectMessageBoxContainer),this.starterSelectContainer.bringToTop(this.pokemonNameText),this.starterSelectContainer.bringToTop(this.pokemonFormText)}show(e){return this.starterPreferences||(this.starterPreferences=wl()),this.pokerusSpecies=Ol(),e.length>=1&&e[0]==="refresh"?!1:(super.show(e),this.starterSelectContainer.setVisible(!0),this.getUi().bringToTop(this.starterSelectContainer),this.pokemonContainers.forEach(t=>{const s=t.icon,i=t.species;this.starterPreferences[i.speciesId]=this.initStarterPrefs(i),this.setUpgradeAnimation(s,i)}),this.resetFilters(),this.updateStarters(),this.setFilterMode(!1),this.filterBarCursor=0,this.setFilterTextMode(!1),this.filterTextCursor=0,this.setCursor(0),this.filterTextContainer.setVisible(!0),!0)}initStarterPrefs(e){var h;const t=this.starterPreferences[e.speciesId],s=n.gameData.dexData[e.speciesId],i=n.gameData.starterData[e.speciesId];if(!t||!s.caughtAttr)return{};const r=s.caughtAttr&e.getFullUnlocksData(),a=r&Z.SHINY,o=r&Z.NON_SHINY;if(t.shiny&&!a?(t.shiny=void 0,t.variant=void 0):t.shiny===!1&&!o&&(t.shiny=void 0),t.variant!==void 0){const c=[a&&r&Z.DEFAULT_VARIANT,a&&r&Z.VARIANT_2,a&&r&Z.VARIANT_3];(Number.isNaN(t.variant)||t.variant<0||!c[t.variant])&&(t.variant=void 0)}if(t.female!==void 0&&((t.female?r&Z.FEMALE:r&Z.MALE)||(t.female=void 0)),t.ability!==void 0){const c=e.ability2===e.ability1,d=i.abilityAttr,f=d&Xe.ABILITY_1,u=d&Xe.ABILITY_2,C=d&Xe.ABILITY_HIDDEN;[f,c?u&&!f:u,C][t.ability]||(t.ability=void 0)}const l=t.form;return l!==void 0&&(!((h=e.forms[l])!=null&&h.isStarterSelectable)||!(r&n.gameData.getFormAttr(l)))&&(t.form=void 0),t.nature!==void 0&&n.gameData.getNaturesForAttr(s.natureAttr).indexOf(t.nature)<0&&(t.nature=void 0),t}resetFilters(){this.filterBar.setValsToDefault(),this.filterText.setValsToDefault()}showText(e,t,s,i,r,a,o){super.showText(e,t,s,i,r,a);const l=(e==null?void 0:e.indexOf(`
`))===-1;this.starterSelectMessageBox.setSize(318,l?28:42),o?(this.starterSelectMessageBox.setOrigin(0,0),this.starterSelectMessageBoxContainer.setY(0),this.message.setY(4)):(this.starterSelectMessageBoxContainer.setY(n.game.canvas.height/6),this.starterSelectMessageBox.setOrigin(0,1),this.message.setY(l?-22:-37)),this.starterSelectMessageBoxContainer.setVisible(!!(e!=null&&e.length))}isSeen(e,t){if(t!=null&&t.seenAttr)return!0;const s=n.gameData.dexData[this.getStarterSpeciesId(e.speciesId)];return!!(s!=null&&s.caughtAttr)}isUpgradeIconEnabled(){return n.candyUpgradeNotification!==0&&n.candyUpgradeDisplay===0}isUpgradeAnimationEnabled(){return n.candyUpgradeNotification!==0&&n.candyUpgradeDisplay===1}getStarterSpeciesId(e){return Le.hasOwnProperty(e)?e:Cn[e]}isPassiveAvailable(e){const t=n.gameData.starterData[this.getStarterSpeciesId(e)];return t.candyCount>=Os(Le[this.getStarterSpeciesId(e)])&&!(t.passiveAttr&Ke.UNLOCKED)}isValueReductionAvailable(e){const t=n.gameData.starterData[this.getStarterSpeciesId(e)];return t.candyCount>=As(Le[this.getStarterSpeciesId(e)])[t.valueReduction]&&t.valueReduction<Vu}isSameSpeciesEggAvailable(e){return n.gameData.starterData[this.getStarterSpeciesId(e)].candyCount>=ks(Le[this.getStarterSpeciesId(e)])}setUpgradeAnimation(e,t,s=!1){if(n.tweens.killTweensOf(e),n.candyUpgradeDisplay===0||t.speciesId!==t.getRootSpeciesId(!1))return;e.y=2;const i={targets:e,loop:-1,paused:s,delay:Sl(0,50)*5,loopDelay:1e3,tweens:[{targets:e,y:-3,duration:ye(125),ease:"Cubic.easeOut",yoyo:!0},{targets:e,y:-1,duration:ye(150),ease:"Cubic.easeOut",yoyo:!0}]};if(this.isPassiveAvailable(t.speciesId)||n.candyUpgradeNotification===2&&(this.isValueReductionAvailable(t.speciesId)||this.isSameSpeciesEggAvailable(t.speciesId))){const r=n.tweens.chain(i);s||r.play()}}setUpgradeIcon(e){const t=e.species,s=!!(t!=null&&t.speciesId);if(!t||n.candyUpgradeNotification===0||t.speciesId!==t.getRootSpeciesId(!1)){e.candyUpgradeIcon.setVisible(!1),e.candyUpgradeOverlayIcon.setVisible(!1);return}const i=this.isPassiveAvailable(t.speciesId),r=this.isValueReductionAvailable(t.speciesId),a=this.isSameSpeciesEggAvailable(t.speciesId);n.candyUpgradeNotification===1?(e.candyUpgradeIcon.setVisible(s&&i),e.candyUpgradeOverlayIcon.setVisible(s&&e.candyUpgradeIcon.visible)):n.candyUpgradeNotification===2&&(e.candyUpgradeIcon.setVisible(s&&(i||r||a)),e.candyUpgradeOverlayIcon.setVisible(s&&e.candyUpgradeIcon.visible))}updateCandyUpgradeDisplay(e){this.isUpgradeIconEnabled()&&this.setUpgradeIcon(e),this.isUpgradeAnimationEnabled()&&this.setUpgradeAnimation(e.icon,this.lastSpecies,!0)}processInput(e){if(this.blockInput)return!1;const t=9,s=this.filteredPokemonData.length,i=Math.ceil(s/t),r=this.scrollCursor*t,a=Math.floor((r+this.cursor)/t),o=this.getUi();let l=!1,h=!1;if(e===I.SUBMIT)h=!0;else if(e===I.CANCEL)this.filterMode&&this.filterBar.openDropDown?(this.filterBar.toggleDropDown(this.filterBarCursor),l=!0):this.filterMode&&!this.filterBar.getFilter(this.filterBarCursor).hasDefaultValues()?(this.filterBar.resetSelection(this.filterBarCursor),this.updateStarters(),l=!0):this.filterTextMode&&this.filterText.getValue(this.filterTextCursor)!==this.filterText.defaultText?(this.filterText.resetSelection(this.filterTextCursor),l=!0):this.showingTray?l=this.closeFormTray():(this.tryExit(),l=!0);else if(e===I.STATS)!this.filterMode&&!this.showingTray?(this.cursorObj.setVisible(!1),this.setSpecies(null),this.filterText.cursorObj.setVisible(!1),this.filterTextMode=!1,this.filterBarCursor=0,this.setFilterMode(!0)):h=!0;else if(e===I.CYCLE_TERA)!this.filterTextMode&&!this.showingTray?(this.cursorObj.setVisible(!1),this.setSpecies(null),this.filterBar.cursorObj.setVisible(!1),this.filterMode=!1,this.filterTextCursor=0,this.setFilterTextMode(!0)):h=!0;else if(e===I.CYCLE_SHINY)this.showingTray?h=!0:(this.showDecorations=!this.showDecorations,this.updateScroll(),l=!0);else if(this.filterMode)switch(e){case I.LEFT:this.filterBarCursor>0?l=this.setCursor(this.filterBarCursor-1):l=this.setCursor(this.filterBar.numFilters-1);break;case I.RIGHT:this.filterBarCursor<this.filterBar.numFilters-1?l=this.setCursor(this.filterBarCursor+1):l=this.setCursor(0);break;case I.UP:if(this.filterBar.openDropDown)l=this.filterBar.decDropDownCursor();else if(s>0){this.setFilterMode(!1),this.scrollCursor=Math.max(0,i-9),this.updateScroll();const c=this.filterBarCursor/Math.max(1,this.filterBar.numFilters-1),d=Math.min(8,c<.5?Math.floor(c*8):Math.ceil(c*8));s%9>d?this.setCursor(s-s%9+d-this.scrollCursor*9):this.setCursor(Math.max(s-s%9+d-9-this.scrollCursor*9,0)),l=!0}break;case I.DOWN:if(this.filterBar.openDropDown)l=this.filterBar.incDropDownCursor();else if(s>0){this.setFilterMode(!1),this.scrollCursor=0,this.updateScroll();const c=this.filterBarCursor/Math.max(1,this.filterBar.numFilters-1),d=Math.min(8,c<.5?Math.floor(c*8):Math.ceil(c*8));this.setCursor(Math.min(d,s-1)),l=!0}break;case I.ACTION:this.filterBar.openDropDown?this.filterBar.toggleOptionState():this.filterBar.toggleDropDown(this.filterBarCursor),l=!0;break}else if(this.filterTextMode)switch(e){case I.LEFT:if(s>0){this.setFilterTextMode(!1);const c=this.filterTextCursor;this.setCursor(c<i-1?(c+1)*t-1:s-1),l=!0}break;case I.RIGHT:if(s>0){this.setFilterTextMode(!1);const c=this.filterTextCursor;this.setCursor(c<i?c*t:(i-1)*t),l=!0}break;case I.UP:this.filterTextCursor>0?l=this.setCursor(this.filterTextCursor-1):l=this.setCursor(this.filterText.numFilters-1);break;case I.DOWN:this.filterTextCursor<this.filterText.numFilters-1?l=this.setCursor(this.filterTextCursor+1):l=this.setCursor(0);break;case I.ACTION:this.filterText.startSearch(this.filterTextCursor,this.getUi()),l=!0;break}else if(this.showingTray)if(e===I.ACTION){const c=this.trayForms[this.trayCursor].formIndex;o.setOverlayMode(L.POKEDEX_PAGE,this.lastSpecies,{form:c},this.filteredIndices),l=!0}else{const c=this.trayContainers.length,d=Math.ceil(c/t),f=Math.floor(this.trayCursor/t);switch(e){case I.UP:if(f>0)l=this.setTrayCursor(this.trayCursor-9);else{const u=this.trayCursor;c%9>u?l=this.setTrayCursor(c-c%9+u):l=this.setTrayCursor(Math.max(c-c%9+u-9,0))}break;case I.DOWN:f<d-1?l=this.setTrayCursor(this.trayCursor+9):l=this.setTrayCursor(this.trayCursor%9);break;case I.LEFT:this.trayCursor%9!==0?l=this.setTrayCursor(this.trayCursor-1):l=this.setTrayCursor(f<d-1?(f+1)*t-1:c-1);break;case I.RIGHT:this.trayCursor%9<(f<d-1?8:(c-1)%9)?l=this.setTrayCursor(this.trayCursor+1):l=this.setTrayCursor(f*9);break;case I.CYCLE_FORM:l=this.closeFormTray();break}}else if(e===I.ACTION)o.setOverlayMode(L.POKEDEX_PAGE,this.lastSpecies,null,this.filteredIndices),l=!0;else switch(e){case I.UP:a>0?this.scrollCursor>0&&a-this.scrollCursor===0?(this.scrollCursor--,this.updateScroll(),l=this.setCursor(this.cursor)):l=this.setCursor(this.cursor-9):(this.filterBarCursor=this.filterBar.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterMode(!0),l=!0);break;case I.DOWN:a<i-1&&this.cursor+9<this.filteredPokemonData.length?a-this.scrollCursor===8?(this.scrollCursor++,this.updateScroll(),l=this.setCursor(this.cursor)):l=this.setCursor(this.cursor+9):i>1?(this.scrollCursor=0,this.updateScroll(),l=this.setCursor(this.cursor%9)):(this.filterBarCursor=this.filterBar.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterMode(!0),l=!0);break;case I.LEFT:this.cursor%9!==0?l=this.setCursor(this.cursor-1):(this.filterTextCursor=this.filterText.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterTextMode(!0),l=!0);break;case I.RIGHT:this.cursor%9<(a<i-1?8:(s-1)%9)?l=this.setCursor(this.cursor+1):(this.filterTextCursor=this.filterText.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterTextMode(!0),l=!0);break;case I.CYCLE_FORM:{const c=this.pokemonContainers[this.cursor].species;this.canShowFormTray&&(l=this.openFormTray(c));break}}return l?o.playSelect():h&&o.playError(),l||h}updateButtonIcon(e,t,s,i){var a;let r;if(t==="touch")switch(t="keyboard",e){case oe.Button_Cycle_Shiny:r="R.png";break;case oe.Button_Cycle_Form:r="F.png";break;case oe.Button_Stats:r="C.png";break}else r=(a=n.inputController)==null?void 0:a.getIconForLatestInputRecorded(e);s.setTexture(t,r),s.setVisible(!0),i.setVisible(!0)}updateFilterButtonIcon(e,t,s,i){var a;let r;t==="touch"?(t="keyboard",r="C.png"):r=(a=n.inputController)==null?void 0:a.getIconForLatestInputRecorded(e),s.setTexture(t,r),s.setVisible(!0),i.setVisible(!0)}getSanitizedProps(e){return{shiny:!1,female:e.female,variant:0,formIndex:e.formIndex}}hasFormLevelMove(e,t){return!xt.hasOwnProperty(e.speciesId)||!xt[e.speciesId].hasOwnProperty(e.formIndex)?!1:xt[e.speciesId][e.formIndex].map(i=>_e[i[1]].name).includes(t)}setCursor(e){var s;let t=!1;if(this.oldCursor=this.cursor,this.filterMode)t=this.filterBarCursor!==e,this.filterBarCursor=e,this.filterBar.setCursor(e);else if(this.filterTextMode)t=this.filterTextCursor!==e,this.filterTextCursor=e,this.filterText.setCursor(e);else{e=Math.max(Math.min(this.pokemonContainers.length-1,e),0),t=super.setCursor(e);const i=an(e);this.cursorObj.setPosition(i.x-1,i.y+1);const r=(s=this.pokemonContainers[e])==null?void 0:s.species;if(r)return this.setSpecies(r),!0}return t}setFilterMode(e){return this.cursorObj.setVisible(!e),this.filterBar.cursorObj.setVisible(e),this.pokemonSprite.setVisible(!1),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),e!==this.filterMode?(this.filterMode=e,this.setCursor(e?this.filterBarCursor:this.cursor),e&&this.setSpecies(null),!0):!1}setFilterTextMode(e){return this.cursorObj.setVisible(!e),this.filterText.cursorObj.setVisible(e),this.pokemonSprite.setVisible(!1),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),e!==this.filterTextMode?(this.filterTextMode=e,this.setCursor(e?this.filterTextCursor:this.cursor),e&&this.setSpecies(null),!0):!1}openFormTray(e){this.trayForms=e.forms.filter(g=>!g.isUnobtainable),this.trayNumIcons=this.trayForms.length,this.trayRows=Math.floor(this.trayNumIcons/9)+(this.trayNumIcons%9===0?0:1),this.trayColumns=Math.min(this.trayNumIcons,9);const t=9,s=this.cursor,i=Math.floor(s/t),r=s-i*9,a=8-i,o=9-r,l=an(this.cursor),h=this.trayRows<=a-1?0:1,c=this.trayColumns<=o?0:1;this.trayBg.setSize(13+this.trayColumns*17,8+this.trayRows*18),this.formTrayContainer.setX((c?l.x-18*(this.trayColumns-o):l.x)-3),this.formTrayContainer.setY(h?l.y-this.trayBg.height:l.y+17);const d=n.gameData.dexData[e.speciesId],f=this.getCurrentDexProps(e.speciesId),u=this.getSanitizedProps(n.gameData.getSpeciesDexAttrProps(this.lastSpecies,f));this.trayContainers=[];const C=this.isSeen(e,d);return this.trayForms.map((g,v)=>{const m=d?(d.caughtAttr&e.getFullUnlocksData()&n.gameData.getFormAttr(g.formIndex??0))>0n:!1,b=new _i(e,{formIndex:g.formIndex,female:u.female,shiny:u.shiny,variant:u.variant});this.iconAnimHandler.addOrUpdate(b.icon,Ze.NONE),m||n.dexForDevs?b.icon.clearTint():C?b.icon.setTint(8421504):b.icon.setTint(0),b.setPosition(5+v%9*18,4+Math.floor(v/9)*17),this.formTrayContainer.add(b),this.trayContainers.push(b)}),this.showingTray=!0,this.setTrayCursor(0),this.formTrayContainer.setVisible(!0),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),!0}closeFormTray(){return this.trayContainers.forEach(e=>{this.formTrayContainer.remove(e,!0)}),this.trayContainers=[],this.formTrayContainer.setVisible(!1),this.showingTray=!1,this.setSpeciesDetails(this.lastSpecies),!0}setTrayCursor(e){if(!this.showingTray)return!1;e=Phaser.Math.Clamp(this.trayContainers.length-1,e,0);const t=this.trayCursor!==e;t&&(this.trayCursor=e),this.trayCursorObj.setPosition(5+e%9*18,4+Math.floor(e/9)*17);const s=this.lastSpecies,i=this.trayForms[e].formIndex;return this.setSpeciesDetails(s,{formIndex:i}),t}getFriendship(e){let t=n.gameData.starterData[this.getStarterSpeciesId(e)].friendship;(!t||t===void 0)&&(t=0);const s=Ur(Le[e]);return{currentFriendship:t,friendshipCap:s}}startIconAnimation(e){const s=this.pokemonContainers[e].icon;this.isUpgradeAnimationEnabled()&&(n.tweens.getTweensOf(s).forEach(i=>i.pause()),s.x=-2,s.y=2),this.iconAnimHandler.addOrUpdate(s,Ze.PASSIVE)}stopIconAnimation(e){const t=this.pokemonContainers[e];if(t){const s=t.icon,i=this.getCurrentDexProps(t.species.speciesId),r=this.getSanitizedProps(n.gameData.getSpeciesDexAttrProps(t.species,i));this.checkIconId(s,t.species,r.female,r.formIndex,r.shiny,r.variant),this.iconAnimHandler.addOrUpdate(s,Ze.NONE),n.tweens.getTweensOf(s).forEach(a=>a.play())}}setSpecies(e){var t,s,i;if(this.speciesStarterDexEntry=e?n.gameData.dexData[e.speciesId]:null,!e&&n.ui.getTooltip().visible&&n.ui.hideTooltip(),this.lastSpecies&&this.stopIconAnimation(this.oldCursor),e&&(this.lastSpecies=e),e&&((t=this.speciesStarterDexEntry)!=null&&t.seenAttr||(s=this.speciesStarterDexEntry)!=null&&s.caughtAttr||n.dexForDevs))if(this.pokemonNumberText.setText(S.t("pokedexUiHandler:pokemonNumber")+Ot(e.speciesId,4)),this.pokemonNameText.setText(e.name),(i=this.speciesStarterDexEntry)!=null&&i.caughtAttr||n.dexForDevs){this.startIconAnimation(this.cursor);const r=Ct(e.speciesId,0);this.setTypeIcons(r.type1,r.type2),this.setSpeciesDetails(e,{}),this.pokemonSprite.clearTint(),this.type1Icon.clearTint(),this.type2Icon.clearTint()}else this.type1Icon.setVisible(!0),this.type2Icon.setVisible(!0),this.setSpeciesDetails(e),this.pokemonSprite.setTint(8421504);else this.pokemonNumberText.setText(e?S.t("pokedexUiHandler:pokemonNumber")+Ot(e.speciesId,4):""),this.pokemonNameText.setText(e?"???":""),this.pokemonFormText.setText(""),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),e&&(this.pokemonSprite.setTint(0),this.setSpeciesDetails(e,{}))}setSpeciesDetails(e,t={}){var o,l;let{shiny:s,formIndex:i,female:r,variant:a}=t;if((o=e==null?void 0:e.forms)!=null&&o.find(h=>h.formKey==="female")&&(r!==void 0?i=r?1:0:i!==void 0&&(r=i===1)),this.pokemonSprite.setVisible(!1),this.assetLoadCancelled&&(this.assetLoadCancelled.value=!0,this.assetLoadCancelled=null),e){const h=n.gameData.dexData[e.speciesId],c=h.caughtAttr&n.gameData.dexData[this.getStarterSpeciesId(e.speciesId)].caughtAttr&e.getFullUnlocksData();if(c){const C=this.getSanitizedProps(n.gameData.getSpeciesDexAttrProps(e,this.getCurrentDexProps(e.speciesId)));s===void 0&&(s=C.shiny),i===void 0&&(i=C.formIndex),r===void 0&&(r=C.female),a===void 0&&(a=C.variant)}const d=h?(c&n.gameData.getFormAttr(i??0))>0n:!1,f=this.isSeen(e,h),u=new ft(!1);if(this.assetLoadCancelled=u,e.loadAssets(r,i,s,a,!0).then(()=>{u.value||(this.assetLoadCancelled=null,this.speciesLoaded.set(e.speciesId,!0),this.pokemonSprite.play(e.getSpriteKey(r,i,s,a)),this.pokemonSprite.setPipelineData("shiny",s),this.pokemonSprite.setPipelineData("variant",a),this.pokemonSprite.setPipelineData("spriteKey",e.getSpriteKey(r,i,s,a)),this.pokemonSprite.setVisible(!0))}),d||n.dexForDevs?this.pokemonSprite.clearTint():f?this.pokemonSprite.setTint(8421504):this.pokemonSprite.setTint(0),d||f||n.dexForDevs?Rl.includes(e.speciesId)&&!i?this.pokemonFormText.setText(""):this.pokemonFormText.setText(e.getFormNameToDisplay(i,!1)):this.pokemonFormText.setText(""),d||f||n.dexForDevs){const C=Ct(e.speciesId,i??0);this.setTypeIcons(C.type1,C.type2)}else this.setTypeIcons(null,null);((l=e==null?void 0:e.forms)==null?void 0:l.filter(C=>!C.isUnobtainable).length)>1?(this.showingTray||(this.showFormTrayIconElement.setVisible(!0),this.showFormTrayLabel.setVisible(!0)),this.canShowFormTray=!0):(this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),this.canShowFormTray=!1)}else this.setTypeIcons(null,null)}setTypeIcons(e,t){e!==null?(this.type1Icon.setVisible(!0),this.type1Icon.setFrame(Te[e].toLowerCase())):this.type1Icon.setVisible(!1),t!==null?(this.type2Icon.setVisible(!0),this.type2Icon.setFrame(Te[t].toLowerCase())):this.type2Icon.setVisible(!1)}updateStarterValueLabel(e){const t=e.species.speciesId,s=Le[t],i=n.gameData.getSpeciesStarterValue(this.getStarterSpeciesId(t));e.cost=i;let r=i.toString();r.startsWith("0.")&&(r=r.slice(1)),e.label.setText(r);let a;switch(s-i){case 0:a=x.WINDOW;break;case 1:case .5:a=x.SUMMARY_BLUE;break;default:a=x.SUMMARY_GOLD;break}s-i>0&&(e.label.setColor(this.getTextColor(a)),e.label.setShadowColor(this.getTextColor(a,!0)))}tryExit(){this.blockInput=!0;const e=this.getUi(),t=p(()=>{e.setMode(L.POKEDEX,"refresh"),this.clearText(),this.blockInput=!1},"cancel");return e.showText(S.t("pokedexUiHandler:confirmExit"),null,()=>{e.setModeWithoutClear(L.CONFIRM,()=>{e.setMode(L.POKEDEX,"refresh"),this.clearText(),this.clear(),e.revertMode()},t,null,null,19)}),!0}getCurrentDexProps(e){var r,a,o,l,h,c,d;let t=0n;const s=Re.find(f=>f.speciesId===e),i=n.gameData.dexData[e].caughtAttr&n.gameData.dexData[this.getStarterSpeciesId(e)].caughtAttr&((s==null?void 0:s.getFullUnlocksData())??0n);return(r=this.starterPreferences[e])!=null&&r.female||(i&Z.FEMALE)>0n&&(i&Z.MALE)===0n?t+=Z.FEMALE:t+=Z.MALE,(a=this.starterPreferences[e])!=null&&a.shiny||(i&Z.SHINY)>0n&&((o=this.starterPreferences[e])==null?void 0:o.shiny)!==!1?(t+=Z.SHINY,((l=this.starterPreferences[e])==null?void 0:l.variant)!==void 0?t+=BigInt(Math.pow(2,(h=this.starterPreferences[e])==null?void 0:h.variant))*Z.DEFAULT_VARIANT:(i&Z.VARIANT_3)>0?t+=Z.VARIANT_3:(i&Z.VARIANT_2)>0?t+=Z.VARIANT_2:t+=Z.DEFAULT_VARIANT):(t+=Z.NON_SHINY,t+=Z.DEFAULT_VARIANT),(c=this.starterPreferences[e])!=null&&c.form?t+=BigInt(Math.pow(2,(d=this.starterPreferences[e])==null?void 0:d.form))*Z.DEFAULT_FORM:t+=n.gameData.getFormAttr(n.gameData.getFormIndex(i)),t}destroy(){this.pokemonContainers=[],this.filteredPokemonData=[]}clearText(){this.starterSelectMessageBoxContainer.setVisible(!1),super.clearText()}clear(){super.clear(),this.cursor=-1,this.oldCursor=-1,n.ui.hideTooltip(),this.starterSelectContainer.setVisible(!1),this.blockInput=!1}checkIconId(e,t,s,i,r,a){e.frame.name!==t.getIconId(s,i,r,a)&&(console.log(`${t.name}'s icon ${e.frame.name} does not match getIconId with female: ${s}, formIndex: ${i}, shiny: ${r}, variant: ${a}`),e.setTexture(t.getIconAtlasKey(i,!1,a)),e.setFrame(t.getIconId(s,i,!1,a)))}};p(Sa,"PokedexUiHandler");let Vs=Sa;var on={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var hl;function Uu(){return hl||(hl=1,function(P,e){(function(t){P.exports=t()})(function(){return p(function t(s,i,r){function a(h,c){if(!i[h]){if(!s[h]){var d=typeof zs=="function"&&zs;if(!c&&d)return d(h,!0);if(o)return o(h,!0);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var u=i[h]={exports:{}};s[h][0].call(u.exports,function(C){var g=s[h][1][C];return a(g||C)},u,u.exports,t,s,i,r)}return i[h].exports}p(a,"u");for(var o=typeof zs=="function"&&zs,l=0;l<r.length;l++)a(r[l]);return a},"s")({1:[function(t,s,i){var r=t("./utils"),a=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var h,c,d,f,u,C,g,v=[],m=0,b=l.length,E=b,w=r.getTypeOf(l)!=="string";m<l.length;)E=b-m,d=w?(h=l[m++],c=m<b?l[m++]:0,m<b?l[m++]:0):(h=l.charCodeAt(m++),c=m<b?l.charCodeAt(m++):0,m<b?l.charCodeAt(m++):0),f=h>>2,u=(3&h)<<4|c>>4,C=1<E?(15&c)<<2|d>>6:64,g=2<E?63&d:64,v.push(o.charAt(f)+o.charAt(u)+o.charAt(C)+o.charAt(g));return v.join("")},i.decode=function(l){var h,c,d,f,u,C,g=0,v=0,m="data:";if(l.substr(0,m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");var b,E=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&E--,l.charAt(l.length-2)===o.charAt(64)&&E--,E%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=a.uint8array?new Uint8Array(0|E):new Array(0|E);g<l.length;)h=o.indexOf(l.charAt(g++))<<2|(f=o.indexOf(l.charAt(g++)))>>4,c=(15&f)<<4|(u=o.indexOf(l.charAt(g++)))>>2,d=(3&u)<<6|(C=o.indexOf(l.charAt(g++))),b[v++]=h,u!==64&&(b[v++]=c),C!==64&&(b[v++]=d);return b}},{"./support":30,"./utils":32}],2:[function(t,s,i){var r=t("./external"),a=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function h(c,d,f,u,C){this.compressedSize=c,this.uncompressedSize=d,this.crc32=f,this.compression=u,this.compressedContent=C}p(h,"o"),h.prototype={getContentWorker:p(function(){var c=new a(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return c.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},"getContentWorker"),getCompressedWorker:p(function(){return new a(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)},"getCompressedWorker")},h.createWorkerFrom=function(c,d,f){return c.pipe(new o).pipe(new l("uncompressedSize")).pipe(d.compressWorker(f)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},s.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,s,i){var r=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:p(function(){return new r("STORE compression")},"compressWorker"),uncompressWorker:p(function(){return new r("STORE decompression")},"uncompressWorker")},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,s,i){var r=t("./utils"),a=function(){for(var o,l=[],h=0;h<256;h++){o=h;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;l[h]=o}return l}();s.exports=function(o,l){return o!==void 0&&o.length?r.getTypeOf(o)!=="string"?function(h,c,d,f){var u=a,C=f+d;h^=-1;for(var g=f;g<C;g++)h=h>>>8^u[255&(h^c[g])];return-1^h}(0|l,o,o.length,0):function(h,c,d,f){var u=a,C=f+d;h^=-1;for(var g=f;g<C;g++)h=h>>>8^u[255&(h^c.charCodeAt(g))];return-1^h}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(t,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,s,i){var r=null;r=typeof Promise<"u"?Promise:t("lie"),s.exports={Promise:r}},{lie:37}],7:[function(t,s,i){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=t("pako"),o=t("./utils"),l=t("./stream/GenericWorker"),h=r?"uint8array":"array";function c(d,f){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=f,this.meta={}}p(c,"h"),i.magic="\b\0",o.inherits(c,l),c.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(h,d.data),!1)},c.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(f){d.push({data:f,meta:d.meta})}},i.compressWorker=function(d){return new c("Deflate",d)},i.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,s,i){function r(u,C){var g,v="";for(g=0;g<C;g++)v+=String.fromCharCode(255&u),u>>>=8;return v}p(r,"A");function a(u,C,g,v,m,b){var E,w,_=u.file,A=u.compression,D=b!==h.utf8encode,j=o.transformTo("string",b(_.name)),B=o.transformTo("string",h.utf8encode(_.name)),$=_.comment,ie=o.transformTo("string",b($)),k=o.transformTo("string",h.utf8encode($)),U=B.length!==_.name.length,T=k.length!==$.length,F="",he="",W="",de=_.dir,z=_.date,Y={crc32:0,compressedSize:0,uncompressedSize:0};C&&!g||(Y.crc32=u.crc32,Y.compressedSize=u.compressedSize,Y.uncompressedSize=u.uncompressedSize);var G=0;C&&(G|=8),D||!U&&!T||(G|=2048);var R=0,ce=0;de&&(R|=16),m==="UNIX"?(ce=798,R|=function(ae,ke){var We=ae;return ae||(We=ke?16893:33204),(65535&We)<<16}(_.unixPermissions,de)):(ce=20,R|=function(ae){return 63&(ae||0)}(_.dosPermissions)),E=z.getUTCHours(),E<<=6,E|=z.getUTCMinutes(),E<<=5,E|=z.getUTCSeconds()/2,w=z.getUTCFullYear()-1980,w<<=4,w|=z.getUTCMonth()+1,w<<=5,w|=z.getUTCDate(),U&&(he=r(1,1)+r(c(j),4)+B,F+="up"+r(he.length,2)+he),T&&(W=r(1,1)+r(c(ie),4)+k,F+="uc"+r(W.length,2)+W);var ne="";return ne+=`
\0`,ne+=r(G,2),ne+=A.magic,ne+=r(E,2),ne+=r(w,2),ne+=r(Y.crc32,4),ne+=r(Y.compressedSize,4),ne+=r(Y.uncompressedSize,4),ne+=r(j.length,2),ne+=r(F.length,2),{fileRecord:d.LOCAL_FILE_HEADER+ne+j+F,dirRecord:d.CENTRAL_FILE_HEADER+r(ce,2)+ne+r(ie.length,2)+"\0\0\0\0"+r(R,4)+r(v,4)+j+F+ie}}p(a,"n");var o=t("../utils"),l=t("../stream/GenericWorker"),h=t("../utf8"),c=t("../crc32"),d=t("../signature");function f(u,C,g,v){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=C,this.zipPlatform=g,this.encodeFileName=v,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}p(f,"s"),o.inherits(f,l),f.prototype.push=function(u){var C=u.meta.percent||0,g=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,l.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:g?(C+100*(g-v-1))/g:100}}))},f.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var C=this.streamFiles&&!u.file.dir;if(C){var g=a(u,C,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(u){this.accumulate=!1;var C=this.streamFiles&&!u.file.dir,g=a(u,C,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),C)this.push({data:function(v){return d.DATA_DESCRIPTOR+r(v.crc32,4)+r(v.compressedSize,4)+r(v.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var u=this.bytesWritten,C=0;C<this.dirRecords.length;C++)this.push({data:this.dirRecords[C],meta:{percent:100}});var g=this.bytesWritten-u,v=function(m,b,E,w,_){var A=o.transformTo("string",_(w));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(m,2)+r(m,2)+r(b,4)+r(E,4)+r(A.length,2)+A}(this.dirRecords.length,g,u,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(u){this._sources.push(u);var C=this;return u.on("data",function(g){C.processChunk(g)}),u.on("end",function(){C.closedSource(C.previous.streamInfo),C._sources.length?C.prepareNextSource():C.end()}),u.on("error",function(g){C.error(g)}),this},f.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(u){var C=this._sources;if(!l.prototype.error.call(this,u))return!1;for(var g=0;g<C.length;g++)try{C[g].error(u)}catch{}return!0},f.prototype.lock=function(){l.prototype.lock.call(this);for(var u=this._sources,C=0;C<u.length;C++)u[C].lock()},s.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,s,i){var r=t("../compressions"),a=t("./ZipFileWorker");i.generateWorker=function(o,l,h){var c=new a(l.streamFiles,h,l.platform,l.encodeFileName),d=0;try{o.forEach(function(f,u){d++;var C=function(b,E){var w=b||E,_=r[w];if(!_)throw new Error(w+" is not a valid compression method !");return _}(u.options.compression,l.compression),g=u.options.compressionOptions||l.compressionOptions||{},v=u.dir,m=u.date;u._compressWorker(C,g).withStreamInfo("file",{name:f,dir:v,date:m,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(c)}),c.entriesCount=d}catch(f){c.error(f)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,s,i){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new r;for(var o in this)typeof this[o]!="function"&&(a[o]=this[o]);return a}}p(r,"n"),(r.prototype=t("./object")).loadAsync=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.version="3.10.1",r.loadAsync=function(a,o){return new r().loadAsync(a,o)},r.external=t("./external"),s.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,s,i){var r=t("./utils"),a=t("./external"),o=t("./utf8"),l=t("./zipEntries"),h=t("./stream/Crc32Probe"),c=t("./nodejsUtils");function d(f){return new a.Promise(function(u,C){var g=f.decompressed.getContentWorker().pipe(new h);g.on("error",function(v){C(v)}).on("end",function(){g.streamInfo.crc32!==f.decompressed.crc32?C(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}p(d,"f"),s.exports=function(f,u){var C=this;return u=r.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(f)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",f,!0,u.optimizedBinaryString,u.base64).then(function(g){var v=new l(u);return v.load(g),v}).then(function(g){var v=[a.Promise.resolve(g)],m=g.files;if(u.checkCRC32)for(var b=0;b<m.length;b++)v.push(d(m[b]));return a.Promise.all(v)}).then(function(g){for(var v=g.shift(),m=v.files,b=0;b<m.length;b++){var E=m[b],w=E.fileNameStr,_=r.resolve(E.fileNameStr);C.file(_,E.decompressed,{binary:!0,optimizedBinaryString:!0,date:E.date,dir:E.dir,comment:E.fileCommentStr.length?E.fileCommentStr:null,unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions,createFolders:u.createFolders}),E.dir||(C.file(_).unsafeOriginalName=w)}return v.zipComment.length&&(C.comment=v.zipComment),C})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,s,i){var r=t("../utils"),a=t("../stream/GenericWorker");function o(l,h){a.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(h)}p(o,"s"),r.inherits(o,a),o.prototype._bindStream=function(l){var h=this;(this._stream=l).pause(),l.on("data",function(c){h.push({data:c,meta:{percent:0}})}).on("error",function(c){h.isPaused?this.generatedError=c:h.error(c)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},o.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,s,i){var r=t("readable-stream").Readable;function a(o,l,h){r.call(this,l),this._helper=o;var c=this;o.on("data",function(d,f){c.push(d)||c._helper.pause(),h&&h(f)}).on("error",function(d){c.emit("error",d)}).on("end",function(){c.push(null)})}p(a,"n"),t("../utils").inherits(a,r),a.prototype._read=function(){this._helper.resume()},s.exports=a},{"../utils":32,"readable-stream":16}],14:[function(t,s,i){s.exports={isNode:typeof Buffer<"u",newBufferFrom:p(function(r,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,a);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,a)},"newBufferFrom"),allocBuffer:p(function(r){if(Buffer.alloc)return Buffer.alloc(r);var a=new Buffer(r);return a.fill(0),a},"allocBuffer"),isBuffer:p(function(r){return Buffer.isBuffer(r)},"isBuffer"),isStream:p(function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"},"isStream")}},{}],15:[function(t,s,i){function r(_,A,D){var j,B=o.getTypeOf(A),$=o.extend(D||{},c);$.date=$.date||new Date,$.compression!==null&&($.compression=$.compression.toUpperCase()),typeof $.unixPermissions=="string"&&($.unixPermissions=parseInt($.unixPermissions,8)),$.unixPermissions&&16384&$.unixPermissions&&($.dir=!0),$.dosPermissions&&16&$.dosPermissions&&($.dir=!0),$.dir&&(_=m(_)),$.createFolders&&(j=v(_))&&b.call(this,j,!0);var ie=B==="string"&&$.binary===!1&&$.base64===!1;D&&D.binary!==void 0||($.binary=!ie),(A instanceof d&&A.uncompressedSize===0||$.dir||!A||A.length===0)&&($.base64=!1,$.binary=!0,A="",$.compression="STORE",B="string");var k=null;k=A instanceof d||A instanceof l?A:C.isNode&&C.isStream(A)?new g(_,A):o.prepareContent(_,A,$.binary,$.optimizedBinaryString,$.base64);var U=new f(_,k,$);this.files[_]=U}p(r,"s");var a=t("./utf8"),o=t("./utils"),l=t("./stream/GenericWorker"),h=t("./stream/StreamHelper"),c=t("./defaults"),d=t("./compressedObject"),f=t("./zipObject"),u=t("./generate"),C=t("./nodejsUtils"),g=t("./nodejs/NodejsStreamInputAdapter"),v=p(function(_){_.slice(-1)==="/"&&(_=_.substring(0,_.length-1));var A=_.lastIndexOf("/");return 0<A?_.substring(0,A):""},"_"),m=p(function(_){return _.slice(-1)!=="/"&&(_+="/"),_},"g"),b=p(function(_,A){return A=A!==void 0?A:c.createFolders,_=m(_),this.files[_]||r.call(this,_,null,{dir:!0,createFolders:A}),this.files[_]},"b");function E(_){return Object.prototype.toString.call(_)==="[object RegExp]"}p(E,"h");var w={load:p(function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},"load"),forEach:p(function(_){var A,D,j;for(A in this.files)j=this.files[A],(D=A.slice(this.root.length,A.length))&&A.slice(0,this.root.length)===this.root&&_(D,j)},"forEach"),filter:p(function(_){var A=[];return this.forEach(function(D,j){_(D,j)&&A.push(j)}),A},"filter"),file:p(function(_,A,D){if(arguments.length!==1)return _=this.root+_,r.call(this,_,A,D),this;if(E(_)){var j=_;return this.filter(function($,ie){return!ie.dir&&j.test($)})}var B=this.files[this.root+_];return B&&!B.dir?B:null},"file"),folder:p(function(_){if(!_)return this;if(E(_))return this.filter(function(B,$){return $.dir&&_.test(B)});var A=this.root+_,D=b.call(this,A),j=this.clone();return j.root=D.name,j},"folder"),remove:p(function(_){_=this.root+_;var A=this.files[_];if(A||(_.slice(-1)!=="/"&&(_+="/"),A=this.files[_]),A&&!A.dir)delete this.files[_];else for(var D=this.filter(function(B,$){return $.name.slice(0,_.length)===_}),j=0;j<D.length;j++)delete this.files[D[j].name];return this},"remove"),generate:p(function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},"generate"),generateInternalStream:p(function(_){var A,D={};try{if((D=o.extend(_||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=D.type.toLowerCase(),D.compression=D.compression.toUpperCase(),D.type==="binarystring"&&(D.type="string"),!D.type)throw new Error("No output type specified.");o.checkSupport(D.type),D.platform!=="darwin"&&D.platform!=="freebsd"&&D.platform!=="linux"&&D.platform!=="sunos"||(D.platform="UNIX"),D.platform==="win32"&&(D.platform="DOS");var j=D.comment||this.comment||"";A=u.generateWorker(this,D,j)}catch(B){(A=new l("error")).error(B)}return new h(A,D.type||"string",D.mimeType)},"generateInternalStream"),generateAsync:p(function(_,A){return this.generateInternalStream(_).accumulate(A)},"generateAsync"),generateNodeStream:p(function(_,A){return(_=_||{}).type||(_.type="nodebuffer"),this.generateInternalStream(_).toNodejsStream(A)},"generateNodeStream")};s.exports=w},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,s,i){s.exports=t("stream")},{stream:void 0}],17:[function(t,s,i){var r=t("./DataReader");function a(o){r.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}p(a,"i"),t("../utils").inherits(a,r),a.prototype.byteAt=function(o){return this.data[this.zero+o]},a.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),d=o.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===l&&this.data[f+1]===h&&this.data[f+2]===c&&this.data[f+3]===d)return f-this.zero;return-1},a.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),d=o.charCodeAt(3),f=this.readData(4);return l===f[0]&&h===f[1]&&c===f[2]&&d===f[3]},a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./DataReader":18}],18:[function(t,s,i){var r=t("../utils");function a(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}p(a,"i"),a.prototype={checkOffset:p(function(o){this.checkIndex(this.index+o)},"checkOffset"),checkIndex:p(function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},"checkIndex"),setIndex:p(function(o){this.checkIndex(o),this.index=o},"setIndex"),skip:p(function(o){this.setIndex(this.index+o)},"skip"),byteAt:p(function(){},"byteAt"),readInt:p(function(o){var l,h=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)h=(h<<8)+this.byteAt(l);return this.index+=o,h},"readInt"),readString:p(function(o){return r.transformTo("string",this.readData(o))},"readString"),readData:p(function(){},"readData"),lastIndexOfSignature:p(function(){},"lastIndexOfSignature"),readAndCheckSignature:p(function(){},"readAndCheckSignature"),readDate:p(function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))},"readDate")},s.exports=a},{"../utils":32}],19:[function(t,s,i){var r=t("./Uint8ArrayReader");function a(o){r.call(this,o)}p(a,"i"),t("../utils").inherits(a,r),a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,s,i){var r=t("./DataReader");function a(o){r.call(this,o)}p(a,"i"),t("../utils").inherits(a,r),a.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},a.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},a.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./DataReader":18}],21:[function(t,s,i){var r=t("./ArrayReader");function a(o){r.call(this,o)}p(a,"i"),t("../utils").inherits(a,r),a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(t,s,i){var r=t("../utils"),a=t("../support"),o=t("./ArrayReader"),l=t("./StringReader"),h=t("./NodeBufferReader"),c=t("./Uint8ArrayReader");s.exports=function(d){var f=r.getTypeOf(d);return r.checkSupport(f),f!=="string"||a.uint8array?f==="nodebuffer"?new h(d):a.uint8array?new c(r.transformTo("uint8array",d)):new o(r.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,s,i){var r=t("./GenericWorker"),a=t("../utils");function o(l){r.call(this,"ConvertWorker to "+l),this.destType=l}p(o,"s"),a.inherits(o,r),o.prototype.processChunk=function(l){this.push({data:a.transformTo(this.destType,l.data),meta:l.meta})},s.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,s,i){var r=t("./GenericWorker"),a=t("../crc32");function o(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}p(o,"s"),t("../utils").inherits(o,r),o.prototype.processChunk=function(l){this.streamInfo.crc32=a(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,s,i){var r=t("../utils"),a=t("./GenericWorker");function o(l){a.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}p(o,"s"),r.inherits(o,a),o.prototype.processChunk=function(l){if(l){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+l.data.length}a.prototype.processChunk.call(this,l)},s.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,s,i){var r=t("../utils"),a=t("./GenericWorker");function o(l){a.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(c){h.dataIsReady=!0,h.data=c,h.max=c&&c.length||0,h.type=r.getTypeOf(c),h.isPaused||h._tickAndRepeat()},function(c){h.error(c)})}p(o,"s"),r.inherits(o,a),o.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,h);break;case"uint8array":l=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":l=this.data.slice(this.index,h)}return this.index=h,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,s,i){function r(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}p(r,"n"),r.prototype={push:p(function(a){this.emit("data",a)},"push"),end:p(function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},"end"),error:p(function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},"error"),on:p(function(a,o){return this._listeners[a].push(o),this},"on"),cleanUp:p(function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},"cleanUp"),emit:p(function(a,o){if(this._listeners[a])for(var l=0;l<this._listeners[a].length;l++)this._listeners[a][l].call(this,o)},"emit"),pipe:p(function(a){return a.registerPrevious(this)},"pipe"),registerPrevious:p(function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var o=this;return a.on("data",function(l){o.processChunk(l)}),a.on("end",function(){o.end()}),a.on("error",function(l){o.error(l)}),this},"registerPrevious"),pause:p(function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},"pause"),resume:p(function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},"resume"),flush:p(function(){},"flush"),processChunk:p(function(a){this.push(a)},"processChunk"),withStreamInfo:p(function(a,o){return this.extraStreamInfo[a]=o,this.mergeStreamInfo(),this},"withStreamInfo"),mergeStreamInfo:p(function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},"mergeStreamInfo"),lock:p(function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},"lock"),toString:p(function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a},"toString")},s.exports=r},{}],29:[function(t,s,i){var r=t("../utils"),a=t("./ConvertWorker"),o=t("./GenericWorker"),l=t("../base64"),h=t("../support"),c=t("../external"),d=null;if(h.nodestream)try{d=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(C,g){return new c.Promise(function(v,m){var b=[],E=C._internalType,w=C._outputType,_=C._mimeType;C.on("data",function(A,D){b.push(A),g&&g(D)}).on("error",function(A){b=[],m(A)}).on("end",function(){try{var A=function(D,j,B){switch(D){case"blob":return r.newBlob(r.transformTo("arraybuffer",j),B);case"base64":return l.encode(j);default:return r.transformTo(D,j)}}(w,function(D,j){var B,$=0,ie=null,k=0;for(B=0;B<j.length;B++)k+=j[B].length;switch(D){case"string":return j.join("");case"array":return Array.prototype.concat.apply([],j);case"uint8array":for(ie=new Uint8Array(k),B=0;B<j.length;B++)ie.set(j[B],$),$+=j[B].length;return ie;case"nodebuffer":return Buffer.concat(j);default:throw new Error("concat : unsupported type '"+D+"'")}}(E,b),_);v(A)}catch(D){m(D)}b=[]}).resume()})}p(f,"l");function u(C,g,v){var m=g;switch(g){case"blob":case"arraybuffer":m="uint8array";break;case"base64":m="string"}try{this._internalType=m,this._outputType=g,this._mimeType=v,r.checkSupport(m),this._worker=C.pipe(new a(m)),C.lock()}catch(b){this._worker=new o("error"),this._worker.error(b)}}p(u,"f"),u.prototype={accumulate:p(function(C){return f(this,C)},"accumulate"),on:p(function(C,g){var v=this;return C==="data"?this._worker.on(C,function(m){g.call(v,m.data,m.meta)}):this._worker.on(C,function(){r.delay(g,arguments,v)}),this},"on"),resume:p(function(){return r.delay(this._worker.resume,[],this._worker),this},"resume"),pause:p(function(){return this._worker.pause(),this},"pause"),toNodejsStream:p(function(C){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},C)},"toNodejsStream")},s.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var r=new ArrayBuffer(0);try{i.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(r),i.blob=a.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(t,s,i){for(var r=t("./utils"),a=t("./support"),o=t("./nodejsUtils"),l=t("./stream/GenericWorker"),h=new Array(256),c=0;c<256;c++)h[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;h[254]=h[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}p(d,"a");function f(){l.call(this,"utf-8 encode")}p(f,"l"),i.utf8encode=function(u){return a.nodebuffer?o.newBufferFrom(u,"utf-8"):function(C){var g,v,m,b,E,w=C.length,_=0;for(b=0;b<w;b++)(64512&(v=C.charCodeAt(b)))==55296&&b+1<w&&(64512&(m=C.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(m-56320),b++),_+=v<128?1:v<2048?2:v<65536?3:4;for(g=a.uint8array?new Uint8Array(_):new Array(_),b=E=0;E<_;b++)(64512&(v=C.charCodeAt(b)))==55296&&b+1<w&&(64512&(m=C.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(m-56320),b++),v<128?g[E++]=v:(v<2048?g[E++]=192|v>>>6:(v<65536?g[E++]=224|v>>>12:(g[E++]=240|v>>>18,g[E++]=128|v>>>12&63),g[E++]=128|v>>>6&63),g[E++]=128|63&v);return g}(u)},i.utf8decode=function(u){return a.nodebuffer?r.transformTo("nodebuffer",u).toString("utf-8"):function(C){var g,v,m,b,E=C.length,w=new Array(2*E);for(g=v=0;g<E;)if((m=C[g++])<128)w[v++]=m;else if(4<(b=h[m]))w[v++]=65533,g+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&g<E;)m=m<<6|63&C[g++],b--;1<b?w[v++]=65533:m<65536?w[v++]=m:(m-=65536,w[v++]=55296|m>>10&1023,w[v++]=56320|1023&m)}return w.length!==v&&(w.subarray?w=w.subarray(0,v):w.length=v),r.applyFromCharCode(w)}(u=r.transformTo(a.uint8array?"uint8array":"array",u))},r.inherits(d,l),d.prototype.processChunk=function(u){var C=r.transformTo(a.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var g=C;(C=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),C.set(g,this.leftOver.length)}else C=this.leftOver.concat(C);this.leftOver=null}var v=function(b,E){var w;for((E=E||b.length)>b.length&&(E=b.length),w=E-1;0<=w&&(192&b[w])==128;)w--;return w<0||w===0?E:w+h[b[w]]>E?w:E}(C),m=C;v!==C.length&&(a.uint8array?(m=C.subarray(0,v),this.leftOver=C.subarray(v,C.length)):(m=C.slice(0,v),this.leftOver=C.slice(v,C.length))),this.push({data:i.utf8decode(m),meta:u.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=d,r.inherits(f,l),f.prototype.processChunk=function(u){this.push({data:i.utf8encode(u.data),meta:u.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,s,i){var r=t("./support"),a=t("./base64"),o=t("./nodejsUtils"),l=t("./external");function h(g){return g}p(h,"n");function c(g,v){for(var m=0;m<g.length;++m)v[m]=255&g.charCodeAt(m);return v}p(c,"l"),t("setimmediate"),i.newBlob=function(g,v){i.checkSupport("blob");try{return new Blob([g],{type:v})}catch{try{var m=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return m.append(g),m.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:p(function(g,v,m){var b=[],E=0,w=g.length;if(w<=m)return String.fromCharCode.apply(null,g);for(;E<w;)v==="array"||v==="nodebuffer"?b.push(String.fromCharCode.apply(null,g.slice(E,Math.min(E+m,w)))):b.push(String.fromCharCode.apply(null,g.subarray(E,Math.min(E+m,w)))),E+=m;return b.join("")},"stringifyByChunk"),stringifyByChar:p(function(g){for(var v="",m=0;m<g.length;m++)v+=String.fromCharCode(g[m]);return v},"stringifyByChar"),applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function f(g){var v=65536,m=i.getTypeOf(g),b=!0;if(m==="uint8array"?b=d.applyCanBeUsed.uint8array:m==="nodebuffer"&&(b=d.applyCanBeUsed.nodebuffer),b)for(;1<v;)try{return d.stringifyByChunk(g,m,v)}catch{v=Math.floor(v/2)}return d.stringifyByChar(g)}p(f,"s");function u(g,v){for(var m=0;m<g.length;m++)v[m]=g[m];return v}p(u,"f"),i.applyFromCharCode=f;var C={};C.string={string:h,array:p(function(g){return c(g,new Array(g.length))},"array"),arraybuffer:p(function(g){return C.string.uint8array(g).buffer},"arraybuffer"),uint8array:p(function(g){return c(g,new Uint8Array(g.length))},"uint8array"),nodebuffer:p(function(g){return c(g,o.allocBuffer(g.length))},"nodebuffer")},C.array={string:f,array:h,arraybuffer:p(function(g){return new Uint8Array(g).buffer},"arraybuffer"),uint8array:p(function(g){return new Uint8Array(g)},"uint8array"),nodebuffer:p(function(g){return o.newBufferFrom(g)},"nodebuffer")},C.arraybuffer={string:p(function(g){return f(new Uint8Array(g))},"string"),array:p(function(g){return u(new Uint8Array(g),new Array(g.byteLength))},"array"),arraybuffer:h,uint8array:p(function(g){return new Uint8Array(g)},"uint8array"),nodebuffer:p(function(g){return o.newBufferFrom(new Uint8Array(g))},"nodebuffer")},C.uint8array={string:f,array:p(function(g){return u(g,new Array(g.length))},"array"),arraybuffer:p(function(g){return g.buffer},"arraybuffer"),uint8array:h,nodebuffer:p(function(g){return o.newBufferFrom(g)},"nodebuffer")},C.nodebuffer={string:f,array:p(function(g){return u(g,new Array(g.length))},"array"),arraybuffer:p(function(g){return C.nodebuffer.uint8array(g).buffer},"arraybuffer"),uint8array:p(function(g){return u(g,new Uint8Array(g.length))},"uint8array"),nodebuffer:h},i.transformTo=function(g,v){if(v=v||"",!g)return v;i.checkSupport(g);var m=i.getTypeOf(v);return C[m][g](v)},i.resolve=function(g){for(var v=g.split("/"),m=[],b=0;b<v.length;b++){var E=v[b];E==="."||E===""&&b!==0&&b!==v.length-1||(E===".."?m.pop():m.push(E))}return m.join("/")},i.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":r.nodebuffer&&o.isBuffer(g)?"nodebuffer":r.uint8array&&g instanceof Uint8Array?"uint8array":r.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(g){if(!r[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(g){var v,m,b="";for(m=0;m<(g||"").length;m++)b+="\\x"+((v=g.charCodeAt(m))<16?"0":"")+v.toString(16).toUpperCase();return b},i.delay=function(g,v,m){setImmediate(function(){g.apply(m||null,v||[])})},i.inherits=function(g,v){function m(){}p(m,"r"),m.prototype=v.prototype,g.prototype=new m},i.extend=function(){var g,v,m={};for(g=0;g<arguments.length;g++)for(v in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],v)&&m[v]===void 0&&(m[v]=arguments[g][v]);return m},i.prepareContent=function(g,v,m,b,E){return l.Promise.resolve(v).then(function(w){return r.blob&&(w instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(w))!==-1)&&typeof FileReader<"u"?new l.Promise(function(_,A){var D=new FileReader;D.onload=function(j){_(j.target.result)},D.onerror=function(j){A(j.target.error)},D.readAsArrayBuffer(w)}):w}).then(function(w){var _=i.getTypeOf(w);return _?(_==="arraybuffer"?w=i.transformTo("uint8array",w):_==="string"&&(E?w=a.decode(w):m&&b!==!0&&(w=function(A){return c(A,r.uint8array?new Uint8Array(A.length):new Array(A.length))}(w))),w):l.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,s,i){var r=t("./reader/readerFor"),a=t("./utils"),o=t("./signature"),l=t("./zipEntry"),h=t("./support");function c(d){this.files=[],this.loadOptions=d}p(c,"h"),c.prototype={checkSignature:p(function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(f)+", expected "+a.pretty(d)+")")}},"checkSignature"),isSignature:p(function(d,f){var u=this.reader.index;this.reader.setIndex(d);var C=this.reader.readString(4)===f;return this.reader.setIndex(u),C},"isSignature"),readBlockEndOfCentral:p(function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),f=h.uint8array?"uint8array":"array",u=a.transformTo(f,d);this.zipComment=this.loadOptions.decodeFileName(u)},"readBlockEndOfCentral"),readBlockZip64EndOfCentral:p(function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,f,u,C=this.zip64EndOfCentralSize-44;0<C;)d=this.reader.readInt(2),f=this.reader.readInt(4),u=this.reader.readData(f),this.zip64ExtensibleData[d]={id:d,length:f,value:u}},"readBlockZip64EndOfCentral"),readBlockZip64EndOfCentralLocator:p(function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},"readBlockZip64EndOfCentralLocator"),readLocalFiles:p(function(){var d,f;for(d=0;d<this.files.length;d++)f=this.files[d],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},"readLocalFiles"),readCentralDir:p(function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},"readCentralDir"),readEndOfCentral:p(function(){var d=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var f=d;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var C=f-u;if(0<C)this.isSignature(f,o.CENTRAL_FILE_HEADER)||(this.reader.zero=C);else if(C<0)throw new Error("Corrupted zip: missing "+Math.abs(C)+" bytes.")},"readEndOfCentral"),prepareReader:p(function(d){this.reader=r(d)},"prepareReader"),load:p(function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()},"load")},s.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,s,i){var r=t("./reader/readerFor"),a=t("./utils"),o=t("./compressedObject"),l=t("./crc32"),h=t("./utf8"),c=t("./compressions"),d=t("./support");function f(u,C){this.options=u,this.loadOptions=C}p(f,"l"),f.prototype={isEncrypted:p(function(){return(1&this.bitFlag)==1},"isEncrypted"),useUTF8:p(function(){return(2048&this.bitFlag)==2048},"useUTF8"),readLocalPart:p(function(u){var C,g;if(u.skip(22),this.fileNameLength=u.readInt(2),g=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((C=function(v){for(var m in c)if(Object.prototype.hasOwnProperty.call(c,m)&&c[m].magic===v)return c[m];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,C,u.readData(this.compressedSize))},"readLocalPart"),readCentralPart:p(function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var C=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(C),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},"readCentralPart"),processAttributes:p(function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},"processAttributes"),parseZIP64ExtraField:p(function(){if(this.extraFields[1]){var u=r(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},"parseZIP64ExtraField"),readExtraFields:p(function(u){var C,g,v,m=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<m;)C=u.readInt(2),g=u.readInt(2),v=u.readData(g),this.extraFields[C]={id:C,length:g,value:v};u.setIndex(m)},"readExtraFields"),handleUTF8:p(function(){var u=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var C=this.findExtraFieldUnicodePath();if(C!==null)this.fileNameStr=C;else{var g=a.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var m=a.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(m)}}},"handleUTF8"),findExtraFieldUnicodePath:p(function(){var u=this.extraFields[28789];if(u){var C=r(u.value);return C.readInt(1)!==1||l(this.fileName)!==C.readInt(4)?null:h.utf8decode(C.readData(u.length-5))}return null},"findExtraFieldUnicodePath"),findExtraFieldUnicodeComment:p(function(){var u=this.extraFields[25461];if(u){var C=r(u.value);return C.readInt(1)!==1||l(this.fileComment)!==C.readInt(4)?null:h.utf8decode(C.readData(u.length-5))}return null},"findExtraFieldUnicodeComment")},s.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,s,i){function r(C,g,v){this.name=C,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=g,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}p(r,"n");var a=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),l=t("./utf8"),h=t("./compressedObject"),c=t("./stream/GenericWorker");r.prototype={internalStream:p(function(C){var g=null,v="string";try{if(!C)throw new Error("No output type specified.");var m=(v=C.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),g=this._decompressWorker();var b=!this._dataBinary;b&&!m&&(g=g.pipe(new l.Utf8EncodeWorker)),!b&&m&&(g=g.pipe(new l.Utf8DecodeWorker))}catch(E){(g=new c("error")).error(E)}return new a(g,v,"")},"internalStream"),async:p(function(C,g){return this.internalStream(C).accumulate(g)},"async"),nodeStream:p(function(C,g){return this.internalStream(C||"nodebuffer").toNodejsStream(g)},"nodeStream"),_compressWorker:p(function(C,g){if(this._data instanceof h&&this._data.compression.magic===C.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new l.Utf8EncodeWorker)),h.createWorkerFrom(v,C,g)},"_compressWorker"),_decompressWorker:p(function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof c?this._data:new o(this._data)},"_decompressWorker")};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<d.length;u++)r.prototype[d[u]]=f;s.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,s,i){(function(r){var a,o,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var h=0,c=new l(C),d=r.document.createTextNode("");c.observe(d,{characterData:!0}),a=p(function(){d.data=h=++h%2},"r")}else if(r.setImmediate||r.MessageChannel===void 0)a="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var g=r.document.createElement("script");g.onreadystatechange=function(){C(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},r.document.documentElement.appendChild(g)}:function(){setTimeout(C,0)};else{var f=new r.MessageChannel;f.port1.onmessage=C,a=p(function(){f.port2.postMessage(0)},"r")}var u=[];function C(){var g,v;o=!0;for(var m=u.length;m;){for(v=u,u=[],g=-1;++g<m;)v[g]();m=u.length}o=!1}p(C,"u"),s.exports=function(g){u.push(g)!==1||o||a()}}).call(this,typeof Ks<"u"?Ks:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,s,i){var r=t("immediate");function a(){}p(a,"u");var o={},l=["REJECTED"],h=["FULFILLED"],c=["PENDING"];function d(m){if(typeof m!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,m!==a&&g(this,m)}p(d,"o");function f(m,b,E){this.promise=m,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}p(f,"h");function u(m,b,E){r(function(){var w;try{w=b(E)}catch(_){return o.reject(m,_)}w===m?o.reject(m,new TypeError("Cannot resolve promise with itself")):o.resolve(m,w)})}p(u,"f");function C(m){var b=m&&m.then;if(m&&(typeof m=="object"||typeof m=="function")&&typeof b=="function")return function(){b.apply(m,arguments)}}p(C,"c");function g(m,b){var E=!1;function w(D){E||(E=!0,o.reject(m,D))}p(w,"n");function _(D){E||(E=!0,o.resolve(m,D))}p(_,"i");var A=v(function(){b(_,w)});A.status==="error"&&w(A.value)}p(g,"d");function v(m,b){var E={};try{E.value=m(b),E.status="success"}catch(w){E.status="error",E.value=w}return E}p(v,"p"),(s.exports=d).prototype.finally=function(m){if(typeof m!="function")return this;var b=this.constructor;return this.then(function(E){return b.resolve(m()).then(function(){return E})},function(E){return b.resolve(m()).then(function(){throw E})})},d.prototype.catch=function(m){return this.then(null,m)},d.prototype.then=function(m,b){if(typeof m!="function"&&this.state===h||typeof b!="function"&&this.state===l)return this;var E=new this.constructor(a);return this.state!==c?u(E,this.state===h?m:b,this.outcome):this.queue.push(new f(E,m,b)),E},f.prototype.callFulfilled=function(m){o.resolve(this.promise,m)},f.prototype.otherCallFulfilled=function(m){u(this.promise,this.onFulfilled,m)},f.prototype.callRejected=function(m){o.reject(this.promise,m)},f.prototype.otherCallRejected=function(m){u(this.promise,this.onRejected,m)},o.resolve=function(m,b){var E=v(C,b);if(E.status==="error")return o.reject(m,E.value);var w=E.value;if(w)g(m,w);else{m.state=h,m.outcome=b;for(var _=-1,A=m.queue.length;++_<A;)m.queue[_].callFulfilled(b)}return m},o.reject=function(m,b){m.state=l,m.outcome=b;for(var E=-1,w=m.queue.length;++E<w;)m.queue[E].callRejected(b);return m},d.resolve=function(m){return m instanceof this?m:o.resolve(new this(a),m)},d.reject=function(m){var b=new this(a);return o.reject(b,m)},d.all=function(m){var b=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=m.length,w=!1;if(!E)return this.resolve([]);for(var _=new Array(E),A=0,D=-1,j=new this(a);++D<E;)B(m[D],D);return j;function B($,ie){b.resolve($).then(function(k){_[ie]=k,++A!==E||w||(w=!0,o.resolve(j,_))},function(k){w||(w=!0,o.reject(j,k))})}},d.race=function(m){var b=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=m.length,w=!1;if(!E)return this.resolve([]);for(var _=-1,A=new this(a);++_<E;)D=m[_],b.resolve(D).then(function(j){w||(w=!0,o.resolve(A,j))},function(j){w||(w=!0,o.reject(A,j))});var D;return A}},{immediate:36}],38:[function(t,s,i){var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),s.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,s,i){var r=t("./zlib/deflate"),a=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/messages"),h=t("./zlib/zstream"),c=Object.prototype.toString,d=0,f=-1,u=0,C=8;function g(m){if(!(this instanceof g))return new g(m);this.options=a.assign({level:f,method:C,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},m||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var E=r.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(E!==d)throw new Error(l[E]);if(b.header&&r.deflateSetHeader(this.strm,b.header),b.dictionary){var w;if(w=typeof b.dictionary=="string"?o.string2buf(b.dictionary):c.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(E=r.deflateSetDictionary(this.strm,w))!==d)throw new Error(l[E]);this._dict_set=!0}}p(g,"p");function v(m,b){var E=new g(b);if(E.push(m,!0),E.err)throw E.msg||l[E.err];return E.result}p(v,"n"),g.prototype.push=function(m,b){var E,w,_=this.strm,A=this.options.chunkSize;if(this.ended)return!1;w=b===~~b?b:b===!0?4:0,typeof m=="string"?_.input=o.string2buf(m):c.call(m)==="[object ArrayBuffer]"?_.input=new Uint8Array(m):_.input=m,_.next_in=0,_.avail_in=_.input.length;do{if(_.avail_out===0&&(_.output=new a.Buf8(A),_.next_out=0,_.avail_out=A),(E=r.deflate(_,w))!==1&&E!==d)return this.onEnd(E),!(this.ended=!0);_.avail_out!==0&&(_.avail_in!==0||w!==4&&w!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(a.shrinkBuf(_.output,_.next_out))):this.onData(a.shrinkBuf(_.output,_.next_out)))}while((0<_.avail_in||_.avail_out===0)&&E!==1);return w===4?(E=r.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===d):w!==2||(this.onEnd(d),!(_.avail_out=0))},g.prototype.onData=function(m){this.chunks.push(m)},g.prototype.onEnd=function(m){m===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Deflate=g,i.deflate=v,i.deflateRaw=function(m,b){return(b=b||{}).raw=!0,v(m,b)},i.gzip=function(m,b){return(b=b||{}).gzip=!0,v(m,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,s,i){var r=t("./zlib/inflate"),a=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/constants"),h=t("./zlib/messages"),c=t("./zlib/zstream"),d=t("./zlib/gzheader"),f=Object.prototype.toString;function u(g){if(!(this instanceof u))return new u(g);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},g||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||g&&g.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&(15&v.windowBits)==0&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var m=r.inflateInit2(this.strm,v.windowBits);if(m!==l.Z_OK)throw new Error(h[m]);this.header=new d,r.inflateGetHeader(this.strm,this.header)}p(u,"a");function C(g,v){var m=new u(v);if(m.push(g,!0),m.err)throw m.msg||h[m.err];return m.result}p(C,"o"),u.prototype.push=function(g,v){var m,b,E,w,_,A,D=this.strm,j=this.options.chunkSize,B=this.options.dictionary,$=!1;if(this.ended)return!1;b=v===~~v?v:v===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof g=="string"?D.input=o.binstring2buf(g):f.call(g)==="[object ArrayBuffer]"?D.input=new Uint8Array(g):D.input=g,D.next_in=0,D.avail_in=D.input.length;do{if(D.avail_out===0&&(D.output=new a.Buf8(j),D.next_out=0,D.avail_out=j),(m=r.inflate(D,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&B&&(A=typeof B=="string"?o.string2buf(B):f.call(B)==="[object ArrayBuffer]"?new Uint8Array(B):B,m=r.inflateSetDictionary(this.strm,A)),m===l.Z_BUF_ERROR&&$===!0&&(m=l.Z_OK,$=!1),m!==l.Z_STREAM_END&&m!==l.Z_OK)return this.onEnd(m),!(this.ended=!0);D.next_out&&(D.avail_out!==0&&m!==l.Z_STREAM_END&&(D.avail_in!==0||b!==l.Z_FINISH&&b!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(E=o.utf8border(D.output,D.next_out),w=D.next_out-E,_=o.buf2string(D.output,E),D.next_out=w,D.avail_out=j-w,w&&a.arraySet(D.output,D.output,E,w,0),this.onData(_)):this.onData(a.shrinkBuf(D.output,D.next_out)))),D.avail_in===0&&D.avail_out===0&&($=!0)}while((0<D.avail_in||D.avail_out===0)&&m!==l.Z_STREAM_END);return m===l.Z_STREAM_END&&(b=l.Z_FINISH),b===l.Z_FINISH?(m=r.inflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===l.Z_OK):b!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(D.avail_out=0))},u.prototype.onData=function(g){this.chunks.push(g)},u.prototype.onEnd=function(g){g===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},i.Inflate=u,i.inflate=C,i.inflateRaw=function(g,v){return(v=v||{}).raw=!0,C(g,v)},i.ungzip=C},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,s,i){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(l){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var c=h.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(l[d]=c[d])}}return l},i.shrinkBuf=function(l,h){return l.length===h?l:l.subarray?l.subarray(0,h):(l.length=h,l)};var a={arraySet:p(function(l,h,c,d,f){if(h.subarray&&l.subarray)l.set(h.subarray(c,c+d),f);else for(var u=0;u<d;u++)l[f+u]=h[c+u]},"arraySet"),flattenChunks:p(function(l){var h,c,d,f,u,C;for(h=d=0,c=l.length;h<c;h++)d+=l[h].length;for(C=new Uint8Array(d),h=f=0,c=l.length;h<c;h++)u=l[h],C.set(u,f),f+=u.length;return C},"flattenChunks")},o={arraySet:p(function(l,h,c,d,f){for(var u=0;u<d;u++)l[f+u]=h[c+u]},"arraySet"),flattenChunks:p(function(l){return[].concat.apply([],l)},"flattenChunks")};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,a)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(r)},{}],42:[function(t,s,i){var r=t("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new r.Buf8(256),h=0;h<256;h++)l[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function c(d,f){if(f<65537&&(d.subarray&&o||!d.subarray&&a))return String.fromCharCode.apply(null,r.shrinkBuf(d,f));for(var u="",C=0;C<f;C++)u+=String.fromCharCode(d[C]);return u}p(c,"l"),l[254]=l[254]=1,i.string2buf=function(d){var f,u,C,g,v,m=d.length,b=0;for(g=0;g<m;g++)(64512&(u=d.charCodeAt(g)))==55296&&g+1<m&&(64512&(C=d.charCodeAt(g+1)))==56320&&(u=65536+(u-55296<<10)+(C-56320),g++),b+=u<128?1:u<2048?2:u<65536?3:4;for(f=new r.Buf8(b),g=v=0;v<b;g++)(64512&(u=d.charCodeAt(g)))==55296&&g+1<m&&(64512&(C=d.charCodeAt(g+1)))==56320&&(u=65536+(u-55296<<10)+(C-56320),g++),u<128?f[v++]=u:(u<2048?f[v++]=192|u>>>6:(u<65536?f[v++]=224|u>>>12:(f[v++]=240|u>>>18,f[v++]=128|u>>>12&63),f[v++]=128|u>>>6&63),f[v++]=128|63&u);return f},i.buf2binstring=function(d){return c(d,d.length)},i.binstring2buf=function(d){for(var f=new r.Buf8(d.length),u=0,C=f.length;u<C;u++)f[u]=d.charCodeAt(u);return f},i.buf2string=function(d,f){var u,C,g,v,m=f||d.length,b=new Array(2*m);for(u=C=0;u<m;)if((g=d[u++])<128)b[C++]=g;else if(4<(v=l[g]))b[C++]=65533,u+=v-1;else{for(g&=v===2?31:v===3?15:7;1<v&&u<m;)g=g<<6|63&d[u++],v--;1<v?b[C++]=65533:g<65536?b[C++]=g:(g-=65536,b[C++]=55296|g>>10&1023,b[C++]=56320|1023&g)}return c(b,C)},i.utf8border=function(d,f){var u;for((f=f||d.length)>d.length&&(f=d.length),u=f-1;0<=u&&(192&d[u])==128;)u--;return u<0||u===0?f:u+l[d[u]]>f?u:f}},{"./common":41}],43:[function(t,s,i){s.exports=function(r,a,o,l){for(var h=65535&r|0,c=r>>>16&65535|0,d=0;o!==0;){for(o-=d=2e3<o?2e3:o;c=c+(h=h+a[l++]|0)|0,--d;);h%=65521,c%=65521}return h|c<<16|0}},{}],44:[function(t,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,s,i){var r=function(){for(var a,o=[],l=0;l<256;l++){a=l;for(var h=0;h<8;h++)a=1&a?3988292384^a>>>1:a>>>1;o[l]=a}return o}();s.exports=function(a,o,l,h){var c=r,d=h+l;a^=-1;for(var f=h;f<d;f++)a=a>>>8^c[255&(a^o[f])];return-1^a}},{}],46:[function(t,s,i){var r,a=t("../utils/common"),o=t("./trees"),l=t("./adler32"),h=t("./crc32"),c=t("./messages"),d=0,f=4,u=0,C=-2,g=-1,v=4,m=2,b=8,E=9,w=286,_=30,A=19,D=2*w+1,j=15,B=3,$=258,ie=$+B+1,k=42,U=113,T=1,F=2,he=3,W=4;function de(y,Q){return y.msg=c[Q],Q}p(de,"R");function z(y){return(y<<1)-(4<y?9:0)}p(z,"T");function Y(y){for(var Q=y.length;0<=--Q;)y[Q]=0}p(Y,"D");function G(y){var Q=y.state,X=Q.pending;X>y.avail_out&&(X=y.avail_out),X!==0&&(a.arraySet(y.output,Q.pending_buf,Q.pending_out,X,y.next_out),y.next_out+=X,Q.pending_out+=X,y.total_out+=X,y.avail_out-=X,Q.pending-=X,Q.pending===0&&(Q.pending_out=0))}p(G,"F");function R(y,Q){o._tr_flush_block(y,0<=y.block_start?y.block_start:-1,y.strstart-y.block_start,Q),y.block_start=y.strstart,G(y.strm)}p(R,"N");function ce(y,Q){y.pending_buf[y.pending++]=Q}p(ce,"U");function ne(y,Q){y.pending_buf[y.pending++]=Q>>>8&255,y.pending_buf[y.pending++]=255&Q}p(ne,"P");function ae(y,Q){var X,M,O=y.max_chain_length,N=y.strstart,J=y.prev_length,te=y.nice_match,K=y.strstart>y.w_size-ie?y.strstart-(y.w_size-ie):0,re=y.window,ue=y.w_mask,le=y.prev,Ce=y.strstart+$,Oe=re[N+J-1],Ee=re[N+J];y.prev_length>=y.good_match&&(O>>=2),te>y.lookahead&&(te=y.lookahead);do if(re[(X=Q)+J]===Ee&&re[X+J-1]===Oe&&re[X]===re[N]&&re[++X]===re[N+1]){N+=2,X++;do;while(re[++N]===re[++X]&&re[++N]===re[++X]&&re[++N]===re[++X]&&re[++N]===re[++X]&&re[++N]===re[++X]&&re[++N]===re[++X]&&re[++N]===re[++X]&&re[++N]===re[++X]&&N<Ce);if(M=$-(Ce-N),N=Ce-$,J<M){if(y.match_start=Q,te<=(J=M))break;Oe=re[N+J-1],Ee=re[N+J]}}while((Q=le[Q&ue])>K&&--O!=0);return J<=y.lookahead?J:y.lookahead}p(ae,"L");function ke(y){var Q,X,M,O,N,J,te,K,re,ue,le=y.w_size;do{if(O=y.window_size-y.lookahead-y.strstart,y.strstart>=le+(le-ie)){for(a.arraySet(y.window,y.window,le,le,0),y.match_start-=le,y.strstart-=le,y.block_start-=le,Q=X=y.hash_size;M=y.head[--Q],y.head[Q]=le<=M?M-le:0,--X;);for(Q=X=le;M=y.prev[--Q],y.prev[Q]=le<=M?M-le:0,--X;);O+=le}if(y.strm.avail_in===0)break;if(J=y.strm,te=y.window,K=y.strstart+y.lookahead,re=O,ue=void 0,ue=J.avail_in,re<ue&&(ue=re),X=ue===0?0:(J.avail_in-=ue,a.arraySet(te,J.input,J.next_in,ue,K),J.state.wrap===1?J.adler=l(J.adler,te,ue,K):J.state.wrap===2&&(J.adler=h(J.adler,te,ue,K)),J.next_in+=ue,J.total_in+=ue,ue),y.lookahead+=X,y.lookahead+y.insert>=B)for(N=y.strstart-y.insert,y.ins_h=y.window[N],y.ins_h=(y.ins_h<<y.hash_shift^y.window[N+1])&y.hash_mask;y.insert&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[N+B-1])&y.hash_mask,y.prev[N&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=N,N++,y.insert--,!(y.lookahead+y.insert<B)););}while(y.lookahead<ie&&y.strm.avail_in!==0)}p(ke,"j");function We(y,Q){for(var X,M;;){if(y.lookahead<ie){if(ke(y),y.lookahead<ie&&Q===d)return T;if(y.lookahead===0)break}if(X=0,y.lookahead>=B&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+B-1])&y.hash_mask,X=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),X!==0&&y.strstart-X<=y.w_size-ie&&(y.match_length=ae(y,X)),y.match_length>=B)if(M=o._tr_tally(y,y.strstart-y.match_start,y.match_length-B),y.lookahead-=y.match_length,y.match_length<=y.max_lazy_match&&y.lookahead>=B){for(y.match_length--;y.strstart++,y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+B-1])&y.hash_mask,X=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart,--y.match_length!=0;);y.strstart++}else y.strstart+=y.match_length,y.match_length=0,y.ins_h=y.window[y.strstart],y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+1])&y.hash_mask;else M=o._tr_tally(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++;if(M&&(R(y,!1),y.strm.avail_out===0))return T}return y.insert=y.strstart<B-1?y.strstart:B-1,Q===f?(R(y,!0),y.strm.avail_out===0?he:W):y.last_lit&&(R(y,!1),y.strm.avail_out===0)?T:F}p(We,"Z");function Ie(y,Q){for(var X,M,O;;){if(y.lookahead<ie){if(ke(y),y.lookahead<ie&&Q===d)return T;if(y.lookahead===0)break}if(X=0,y.lookahead>=B&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+B-1])&y.hash_mask,X=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),y.prev_length=y.match_length,y.prev_match=y.match_start,y.match_length=B-1,X!==0&&y.prev_length<y.max_lazy_match&&y.strstart-X<=y.w_size-ie&&(y.match_length=ae(y,X),y.match_length<=5&&(y.strategy===1||y.match_length===B&&4096<y.strstart-y.match_start)&&(y.match_length=B-1)),y.prev_length>=B&&y.match_length<=y.prev_length){for(O=y.strstart+y.lookahead-B,M=o._tr_tally(y,y.strstart-1-y.prev_match,y.prev_length-B),y.lookahead-=y.prev_length-1,y.prev_length-=2;++y.strstart<=O&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+B-1])&y.hash_mask,X=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),--y.prev_length!=0;);if(y.match_available=0,y.match_length=B-1,y.strstart++,M&&(R(y,!1),y.strm.avail_out===0))return T}else if(y.match_available){if((M=o._tr_tally(y,0,y.window[y.strstart-1]))&&R(y,!1),y.strstart++,y.lookahead--,y.strm.avail_out===0)return T}else y.match_available=1,y.strstart++,y.lookahead--}return y.match_available&&(M=o._tr_tally(y,0,y.window[y.strstart-1]),y.match_available=0),y.insert=y.strstart<B-1?y.strstart:B-1,Q===f?(R(y,!0),y.strm.avail_out===0?he:W):y.last_lit&&(R(y,!1),y.strm.avail_out===0)?T:F}p(Ie,"W");function xe(y,Q,X,M,O){this.good_length=y,this.max_lazy=Q,this.nice_length=X,this.max_chain=M,this.func=O}p(xe,"M");function Be(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*D),this.dyn_dtree=new a.Buf16(2*(2*_+1)),this.bl_tree=new a.Buf16(2*(2*A+1)),Y(this.dyn_ltree),Y(this.dyn_dtree),Y(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(j+1),this.heap=new a.Buf16(2*w+1),Y(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*w+1),Y(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}p(Be,"H");function Me(y){var Q;return y&&y.state?(y.total_in=y.total_out=0,y.data_type=m,(Q=y.state).pending=0,Q.pending_out=0,Q.wrap<0&&(Q.wrap=-Q.wrap),Q.status=Q.wrap?k:U,y.adler=Q.wrap===2?0:1,Q.last_flush=d,o._tr_init(Q),u):de(y,C)}p(Me,"G");function qe(y){var Q=Me(y);return Q===u&&function(X){X.window_size=2*X.w_size,Y(X.head),X.max_lazy_match=r[X.level].max_lazy,X.good_match=r[X.level].good_length,X.nice_match=r[X.level].nice_length,X.max_chain_length=r[X.level].max_chain,X.strstart=0,X.block_start=0,X.lookahead=0,X.insert=0,X.match_length=X.prev_length=B-1,X.match_available=0,X.ins_h=0}(y.state),Q}p(qe,"K");function ze(y,Q,X,M,O,N){if(!y)return C;var J=1;if(Q===g&&(Q=6),M<0?(J=0,M=-M):15<M&&(J=2,M-=16),O<1||E<O||X!==b||M<8||15<M||Q<0||9<Q||N<0||v<N)return de(y,C);M===8&&(M=9);var te=new Be;return(y.state=te).strm=y,te.wrap=J,te.gzhead=null,te.w_bits=M,te.w_size=1<<te.w_bits,te.w_mask=te.w_size-1,te.hash_bits=O+7,te.hash_size=1<<te.hash_bits,te.hash_mask=te.hash_size-1,te.hash_shift=~~((te.hash_bits+B-1)/B),te.window=new a.Buf8(2*te.w_size),te.head=new a.Buf16(te.hash_size),te.prev=new a.Buf16(te.w_size),te.lit_bufsize=1<<O+6,te.pending_buf_size=4*te.lit_bufsize,te.pending_buf=new a.Buf8(te.pending_buf_size),te.d_buf=1*te.lit_bufsize,te.l_buf=3*te.lit_bufsize,te.level=Q,te.strategy=N,te.method=X,qe(y)}p(ze,"Y"),r=[new xe(0,0,0,0,function(y,Q){var X=65535;for(X>y.pending_buf_size-5&&(X=y.pending_buf_size-5);;){if(y.lookahead<=1){if(ke(y),y.lookahead===0&&Q===d)return T;if(y.lookahead===0)break}y.strstart+=y.lookahead,y.lookahead=0;var M=y.block_start+X;if((y.strstart===0||y.strstart>=M)&&(y.lookahead=y.strstart-M,y.strstart=M,R(y,!1),y.strm.avail_out===0)||y.strstart-y.block_start>=y.w_size-ie&&(R(y,!1),y.strm.avail_out===0))return T}return y.insert=0,Q===f?(R(y,!0),y.strm.avail_out===0?he:W):(y.strstart>y.block_start&&(R(y,!1),y.strm.avail_out),T)}),new xe(4,4,8,4,We),new xe(4,5,16,8,We),new xe(4,6,32,32,We),new xe(4,4,16,16,Ie),new xe(8,16,32,32,Ie),new xe(8,16,128,128,Ie),new xe(8,32,128,256,Ie),new xe(32,128,258,1024,Ie),new xe(32,258,258,4096,Ie)],i.deflateInit=function(y,Q){return ze(y,Q,b,15,8,0)},i.deflateInit2=ze,i.deflateReset=qe,i.deflateResetKeep=Me,i.deflateSetHeader=function(y,Q){return y&&y.state?y.state.wrap!==2?C:(y.state.gzhead=Q,u):C},i.deflate=function(y,Q){var X,M,O,N;if(!y||!y.state||5<Q||Q<0)return y?de(y,C):C;if(M=y.state,!y.output||!y.input&&y.avail_in!==0||M.status===666&&Q!==f)return de(y,y.avail_out===0?-5:C);if(M.strm=y,X=M.last_flush,M.last_flush=Q,M.status===k)if(M.wrap===2)y.adler=0,ce(M,31),ce(M,139),ce(M,8),M.gzhead?(ce(M,(M.gzhead.text?1:0)+(M.gzhead.hcrc?2:0)+(M.gzhead.extra?4:0)+(M.gzhead.name?8:0)+(M.gzhead.comment?16:0)),ce(M,255&M.gzhead.time),ce(M,M.gzhead.time>>8&255),ce(M,M.gzhead.time>>16&255),ce(M,M.gzhead.time>>24&255),ce(M,M.level===9?2:2<=M.strategy||M.level<2?4:0),ce(M,255&M.gzhead.os),M.gzhead.extra&&M.gzhead.extra.length&&(ce(M,255&M.gzhead.extra.length),ce(M,M.gzhead.extra.length>>8&255)),M.gzhead.hcrc&&(y.adler=h(y.adler,M.pending_buf,M.pending,0)),M.gzindex=0,M.status=69):(ce(M,0),ce(M,0),ce(M,0),ce(M,0),ce(M,0),ce(M,M.level===9?2:2<=M.strategy||M.level<2?4:0),ce(M,3),M.status=U);else{var J=b+(M.w_bits-8<<4)<<8;J|=(2<=M.strategy||M.level<2?0:M.level<6?1:M.level===6?2:3)<<6,M.strstart!==0&&(J|=32),J+=31-J%31,M.status=U,ne(M,J),M.strstart!==0&&(ne(M,y.adler>>>16),ne(M,65535&y.adler)),y.adler=1}if(M.status===69)if(M.gzhead.extra){for(O=M.pending;M.gzindex<(65535&M.gzhead.extra.length)&&(M.pending!==M.pending_buf_size||(M.gzhead.hcrc&&M.pending>O&&(y.adler=h(y.adler,M.pending_buf,M.pending-O,O)),G(y),O=M.pending,M.pending!==M.pending_buf_size));)ce(M,255&M.gzhead.extra[M.gzindex]),M.gzindex++;M.gzhead.hcrc&&M.pending>O&&(y.adler=h(y.adler,M.pending_buf,M.pending-O,O)),M.gzindex===M.gzhead.extra.length&&(M.gzindex=0,M.status=73)}else M.status=73;if(M.status===73)if(M.gzhead.name){O=M.pending;do{if(M.pending===M.pending_buf_size&&(M.gzhead.hcrc&&M.pending>O&&(y.adler=h(y.adler,M.pending_buf,M.pending-O,O)),G(y),O=M.pending,M.pending===M.pending_buf_size)){N=1;break}N=M.gzindex<M.gzhead.name.length?255&M.gzhead.name.charCodeAt(M.gzindex++):0,ce(M,N)}while(N!==0);M.gzhead.hcrc&&M.pending>O&&(y.adler=h(y.adler,M.pending_buf,M.pending-O,O)),N===0&&(M.gzindex=0,M.status=91)}else M.status=91;if(M.status===91)if(M.gzhead.comment){O=M.pending;do{if(M.pending===M.pending_buf_size&&(M.gzhead.hcrc&&M.pending>O&&(y.adler=h(y.adler,M.pending_buf,M.pending-O,O)),G(y),O=M.pending,M.pending===M.pending_buf_size)){N=1;break}N=M.gzindex<M.gzhead.comment.length?255&M.gzhead.comment.charCodeAt(M.gzindex++):0,ce(M,N)}while(N!==0);M.gzhead.hcrc&&M.pending>O&&(y.adler=h(y.adler,M.pending_buf,M.pending-O,O)),N===0&&(M.status=103)}else M.status=103;if(M.status===103&&(M.gzhead.hcrc?(M.pending+2>M.pending_buf_size&&G(y),M.pending+2<=M.pending_buf_size&&(ce(M,255&y.adler),ce(M,y.adler>>8&255),y.adler=0,M.status=U)):M.status=U),M.pending!==0){if(G(y),y.avail_out===0)return M.last_flush=-1,u}else if(y.avail_in===0&&z(Q)<=z(X)&&Q!==f)return de(y,-5);if(M.status===666&&y.avail_in!==0)return de(y,-5);if(y.avail_in!==0||M.lookahead!==0||Q!==d&&M.status!==666){var te=M.strategy===2?function(K,re){for(var ue;;){if(K.lookahead===0&&(ke(K),K.lookahead===0)){if(re===d)return T;break}if(K.match_length=0,ue=o._tr_tally(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++,ue&&(R(K,!1),K.strm.avail_out===0))return T}return K.insert=0,re===f?(R(K,!0),K.strm.avail_out===0?he:W):K.last_lit&&(R(K,!1),K.strm.avail_out===0)?T:F}(M,Q):M.strategy===3?function(K,re){for(var ue,le,Ce,Oe,Ee=K.window;;){if(K.lookahead<=$){if(ke(K),K.lookahead<=$&&re===d)return T;if(K.lookahead===0)break}if(K.match_length=0,K.lookahead>=B&&0<K.strstart&&(le=Ee[Ce=K.strstart-1])===Ee[++Ce]&&le===Ee[++Ce]&&le===Ee[++Ce]){Oe=K.strstart+$;do;while(le===Ee[++Ce]&&le===Ee[++Ce]&&le===Ee[++Ce]&&le===Ee[++Ce]&&le===Ee[++Ce]&&le===Ee[++Ce]&&le===Ee[++Ce]&&le===Ee[++Ce]&&Ce<Oe);K.match_length=$-(Oe-Ce),K.match_length>K.lookahead&&(K.match_length=K.lookahead)}if(K.match_length>=B?(ue=o._tr_tally(K,1,K.match_length-B),K.lookahead-=K.match_length,K.strstart+=K.match_length,K.match_length=0):(ue=o._tr_tally(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++),ue&&(R(K,!1),K.strm.avail_out===0))return T}return K.insert=0,re===f?(R(K,!0),K.strm.avail_out===0?he:W):K.last_lit&&(R(K,!1),K.strm.avail_out===0)?T:F}(M,Q):r[M.level].func(M,Q);if(te!==he&&te!==W||(M.status=666),te===T||te===he)return y.avail_out===0&&(M.last_flush=-1),u;if(te===F&&(Q===1?o._tr_align(M):Q!==5&&(o._tr_stored_block(M,0,0,!1),Q===3&&(Y(M.head),M.lookahead===0&&(M.strstart=0,M.block_start=0,M.insert=0))),G(y),y.avail_out===0))return M.last_flush=-1,u}return Q!==f?u:M.wrap<=0?1:(M.wrap===2?(ce(M,255&y.adler),ce(M,y.adler>>8&255),ce(M,y.adler>>16&255),ce(M,y.adler>>24&255),ce(M,255&y.total_in),ce(M,y.total_in>>8&255),ce(M,y.total_in>>16&255),ce(M,y.total_in>>24&255)):(ne(M,y.adler>>>16),ne(M,65535&y.adler)),G(y),0<M.wrap&&(M.wrap=-M.wrap),M.pending!==0?u:1)},i.deflateEnd=function(y){var Q;return y&&y.state?(Q=y.state.status)!==k&&Q!==69&&Q!==73&&Q!==91&&Q!==103&&Q!==U&&Q!==666?de(y,C):(y.state=null,Q===U?de(y,-3):u):C},i.deflateSetDictionary=function(y,Q){var X,M,O,N,J,te,K,re,ue=Q.length;if(!y||!y.state||(N=(X=y.state).wrap)===2||N===1&&X.status!==k||X.lookahead)return C;for(N===1&&(y.adler=l(y.adler,Q,ue,0)),X.wrap=0,ue>=X.w_size&&(N===0&&(Y(X.head),X.strstart=0,X.block_start=0,X.insert=0),re=new a.Buf8(X.w_size),a.arraySet(re,Q,ue-X.w_size,X.w_size,0),Q=re,ue=X.w_size),J=y.avail_in,te=y.next_in,K=y.input,y.avail_in=ue,y.next_in=0,y.input=Q,ke(X);X.lookahead>=B;){for(M=X.strstart,O=X.lookahead-(B-1);X.ins_h=(X.ins_h<<X.hash_shift^X.window[M+B-1])&X.hash_mask,X.prev[M&X.w_mask]=X.head[X.ins_h],X.head[X.ins_h]=M,M++,--O;);X.strstart=M,X.lookahead=B-1,ke(X)}return X.strstart+=X.lookahead,X.block_start=X.strstart,X.insert=X.lookahead,X.lookahead=0,X.match_length=X.prev_length=B-1,X.match_available=0,y.next_in=te,y.input=K,y.avail_in=J,X.wrap=N,u},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,s,i){s.exports=function(r,a){var o,l,h,c,d,f,u,C,g,v,m,b,E,w,_,A,D,j,B,$,ie,k,U,T,F;o=r.state,l=r.next_in,T=r.input,h=l+(r.avail_in-5),c=r.next_out,F=r.output,d=c-(a-r.avail_out),f=c+(r.avail_out-257),u=o.dmax,C=o.wsize,g=o.whave,v=o.wnext,m=o.window,b=o.hold,E=o.bits,w=o.lencode,_=o.distcode,A=(1<<o.lenbits)-1,D=(1<<o.distbits)-1;e:do{E<15&&(b+=T[l++]<<E,E+=8,b+=T[l++]<<E,E+=8),j=w[b&A];t:for(;;){if(b>>>=B=j>>>24,E-=B,(B=j>>>16&255)===0)F[c++]=65535&j;else{if(!(16&B)){if((64&B)==0){j=w[(65535&j)+(b&(1<<B)-1)];continue t}if(32&B){o.mode=12;break e}r.msg="invalid literal/length code",o.mode=30;break e}$=65535&j,(B&=15)&&(E<B&&(b+=T[l++]<<E,E+=8),$+=b&(1<<B)-1,b>>>=B,E-=B),E<15&&(b+=T[l++]<<E,E+=8,b+=T[l++]<<E,E+=8),j=_[b&D];s:for(;;){if(b>>>=B=j>>>24,E-=B,!(16&(B=j>>>16&255))){if((64&B)==0){j=_[(65535&j)+(b&(1<<B)-1)];continue s}r.msg="invalid distance code",o.mode=30;break e}if(ie=65535&j,E<(B&=15)&&(b+=T[l++]<<E,(E+=8)<B&&(b+=T[l++]<<E,E+=8)),u<(ie+=b&(1<<B)-1)){r.msg="invalid distance too far back",o.mode=30;break e}if(b>>>=B,E-=B,(B=c-d)<ie){if(g<(B=ie-B)&&o.sane){r.msg="invalid distance too far back",o.mode=30;break e}if(U=m,(k=0)===v){if(k+=C-B,B<$){for($-=B;F[c++]=m[k++],--B;);k=c-ie,U=F}}else if(v<B){if(k+=C+v-B,(B-=v)<$){for($-=B;F[c++]=m[k++],--B;);if(k=0,v<$){for($-=B=v;F[c++]=m[k++],--B;);k=c-ie,U=F}}}else if(k+=v-B,B<$){for($-=B;F[c++]=m[k++],--B;);k=c-ie,U=F}for(;2<$;)F[c++]=U[k++],F[c++]=U[k++],F[c++]=U[k++],$-=3;$&&(F[c++]=U[k++],1<$&&(F[c++]=U[k++]))}else{for(k=c-ie;F[c++]=F[k++],F[c++]=F[k++],F[c++]=F[k++],2<($-=3););$&&(F[c++]=F[k++],1<$&&(F[c++]=F[k++]))}break}}break}}while(l<h&&c<f);l-=$=E>>3,b&=(1<<(E-=$<<3))-1,r.next_in=l,r.next_out=c,r.avail_in=l<h?h-l+5:5-(l-h),r.avail_out=c<f?f-c+257:257-(c-f),o.hold=b,o.bits=E}},{}],49:[function(t,s,i){var r=t("../utils/common"),a=t("./adler32"),o=t("./crc32"),l=t("./inffast"),h=t("./inftrees"),c=1,d=2,f=0,u=-2,C=1,g=852,v=592;function m(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}p(m,"L");function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}p(b,"s");function E(k){var U;return k&&k.state?(U=k.state,k.total_in=k.total_out=U.total=0,k.msg="",U.wrap&&(k.adler=1&U.wrap),U.mode=C,U.last=0,U.havedict=0,U.dmax=32768,U.head=null,U.hold=0,U.bits=0,U.lencode=U.lendyn=new r.Buf32(g),U.distcode=U.distdyn=new r.Buf32(v),U.sane=1,U.back=-1,f):u}p(E,"a");function w(k){var U;return k&&k.state?((U=k.state).wsize=0,U.whave=0,U.wnext=0,E(k)):u}p(w,"o");function _(k,U){var T,F;return k&&k.state?(F=k.state,U<0?(T=0,U=-U):(T=1+(U>>4),U<48&&(U&=15)),U&&(U<8||15<U)?u:(F.window!==null&&F.wbits!==U&&(F.window=null),F.wrap=T,F.wbits=U,w(k))):u}p(_,"h");function A(k,U){var T,F;return k?(F=new b,(k.state=F).window=null,(T=_(k,U))!==f&&(k.state=null),T):u}p(A,"u");var D,j,B=!0;function $(k){if(B){var U;for(D=new r.Buf32(512),j=new r.Buf32(32),U=0;U<144;)k.lens[U++]=8;for(;U<256;)k.lens[U++]=9;for(;U<280;)k.lens[U++]=7;for(;U<288;)k.lens[U++]=8;for(h(c,k.lens,0,288,D,0,k.work,{bits:9}),U=0;U<32;)k.lens[U++]=5;h(d,k.lens,0,32,j,0,k.work,{bits:5}),B=!1}k.lencode=D,k.lenbits=9,k.distcode=j,k.distbits=5}p($,"j");function ie(k,U,T,F){var he,W=k.state;return W.window===null&&(W.wsize=1<<W.wbits,W.wnext=0,W.whave=0,W.window=new r.Buf8(W.wsize)),F>=W.wsize?(r.arraySet(W.window,U,T-W.wsize,W.wsize,0),W.wnext=0,W.whave=W.wsize):(F<(he=W.wsize-W.wnext)&&(he=F),r.arraySet(W.window,U,T-F,he,W.wnext),(F-=he)?(r.arraySet(W.window,U,T-F,F,0),W.wnext=F,W.whave=W.wsize):(W.wnext+=he,W.wnext===W.wsize&&(W.wnext=0),W.whave<W.wsize&&(W.whave+=he))),0}p(ie,"Z"),i.inflateReset=w,i.inflateReset2=_,i.inflateResetKeep=E,i.inflateInit=function(k){return A(k,15)},i.inflateInit2=A,i.inflate=function(k,U){var T,F,he,W,de,z,Y,G,R,ce,ne,ae,ke,We,Ie,xe,Be,Me,qe,ze,y,Q,X,M,O=0,N=new r.Buf8(4),J=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return u;(T=k.state).mode===12&&(T.mode=13),de=k.next_out,he=k.output,Y=k.avail_out,W=k.next_in,F=k.input,z=k.avail_in,G=T.hold,R=T.bits,ce=z,ne=Y,Q=f;e:for(;;)switch(T.mode){case C:if(T.wrap===0){T.mode=13;break}for(;R<16;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}if(2&T.wrap&&G===35615){N[T.check=0]=255&G,N[1]=G>>>8&255,T.check=o(T.check,N,2,0),R=G=0,T.mode=2;break}if(T.flags=0,T.head&&(T.head.done=!1),!(1&T.wrap)||(((255&G)<<8)+(G>>8))%31){k.msg="incorrect header check",T.mode=30;break}if((15&G)!=8){k.msg="unknown compression method",T.mode=30;break}if(R-=4,y=8+(15&(G>>>=4)),T.wbits===0)T.wbits=y;else if(y>T.wbits){k.msg="invalid window size",T.mode=30;break}T.dmax=1<<y,k.adler=T.check=1,T.mode=512&G?10:12,R=G=0;break;case 2:for(;R<16;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}if(T.flags=G,(255&T.flags)!=8){k.msg="unknown compression method",T.mode=30;break}if(57344&T.flags){k.msg="unknown header flags set",T.mode=30;break}T.head&&(T.head.text=G>>8&1),512&T.flags&&(N[0]=255&G,N[1]=G>>>8&255,T.check=o(T.check,N,2,0)),R=G=0,T.mode=3;case 3:for(;R<32;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}T.head&&(T.head.time=G),512&T.flags&&(N[0]=255&G,N[1]=G>>>8&255,N[2]=G>>>16&255,N[3]=G>>>24&255,T.check=o(T.check,N,4,0)),R=G=0,T.mode=4;case 4:for(;R<16;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}T.head&&(T.head.xflags=255&G,T.head.os=G>>8),512&T.flags&&(N[0]=255&G,N[1]=G>>>8&255,T.check=o(T.check,N,2,0)),R=G=0,T.mode=5;case 5:if(1024&T.flags){for(;R<16;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}T.length=G,T.head&&(T.head.extra_len=G),512&T.flags&&(N[0]=255&G,N[1]=G>>>8&255,T.check=o(T.check,N,2,0)),R=G=0}else T.head&&(T.head.extra=null);T.mode=6;case 6:if(1024&T.flags&&(z<(ae=T.length)&&(ae=z),ae&&(T.head&&(y=T.head.extra_len-T.length,T.head.extra||(T.head.extra=new Array(T.head.extra_len)),r.arraySet(T.head.extra,F,W,ae,y)),512&T.flags&&(T.check=o(T.check,F,ae,W)),z-=ae,W+=ae,T.length-=ae),T.length))break e;T.length=0,T.mode=7;case 7:if(2048&T.flags){if(z===0)break e;for(ae=0;y=F[W+ae++],T.head&&y&&T.length<65536&&(T.head.name+=String.fromCharCode(y)),y&&ae<z;);if(512&T.flags&&(T.check=o(T.check,F,ae,W)),z-=ae,W+=ae,y)break e}else T.head&&(T.head.name=null);T.length=0,T.mode=8;case 8:if(4096&T.flags){if(z===0)break e;for(ae=0;y=F[W+ae++],T.head&&y&&T.length<65536&&(T.head.comment+=String.fromCharCode(y)),y&&ae<z;);if(512&T.flags&&(T.check=o(T.check,F,ae,W)),z-=ae,W+=ae,y)break e}else T.head&&(T.head.comment=null);T.mode=9;case 9:if(512&T.flags){for(;R<16;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}if(G!==(65535&T.check)){k.msg="header crc mismatch",T.mode=30;break}R=G=0}T.head&&(T.head.hcrc=T.flags>>9&1,T.head.done=!0),k.adler=T.check=0,T.mode=12;break;case 10:for(;R<32;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}k.adler=T.check=m(G),R=G=0,T.mode=11;case 11:if(T.havedict===0)return k.next_out=de,k.avail_out=Y,k.next_in=W,k.avail_in=z,T.hold=G,T.bits=R,2;k.adler=T.check=1,T.mode=12;case 12:if(U===5||U===6)break e;case 13:if(T.last){G>>>=7&R,R-=7&R,T.mode=27;break}for(;R<3;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}switch(T.last=1&G,R-=1,3&(G>>>=1)){case 0:T.mode=14;break;case 1:if($(T),T.mode=20,U!==6)break;G>>>=2,R-=2;break e;case 2:T.mode=17;break;case 3:k.msg="invalid block type",T.mode=30}G>>>=2,R-=2;break;case 14:for(G>>>=7&R,R-=7&R;R<32;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}if((65535&G)!=(G>>>16^65535)){k.msg="invalid stored block lengths",T.mode=30;break}if(T.length=65535&G,R=G=0,T.mode=15,U===6)break e;case 15:T.mode=16;case 16:if(ae=T.length){if(z<ae&&(ae=z),Y<ae&&(ae=Y),ae===0)break e;r.arraySet(he,F,W,ae,de),z-=ae,W+=ae,Y-=ae,de+=ae,T.length-=ae;break}T.mode=12;break;case 17:for(;R<14;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}if(T.nlen=257+(31&G),G>>>=5,R-=5,T.ndist=1+(31&G),G>>>=5,R-=5,T.ncode=4+(15&G),G>>>=4,R-=4,286<T.nlen||30<T.ndist){k.msg="too many length or distance symbols",T.mode=30;break}T.have=0,T.mode=18;case 18:for(;T.have<T.ncode;){for(;R<3;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}T.lens[J[T.have++]]=7&G,G>>>=3,R-=3}for(;T.have<19;)T.lens[J[T.have++]]=0;if(T.lencode=T.lendyn,T.lenbits=7,X={bits:T.lenbits},Q=h(0,T.lens,0,19,T.lencode,0,T.work,X),T.lenbits=X.bits,Q){k.msg="invalid code lengths set",T.mode=30;break}T.have=0,T.mode=19;case 19:for(;T.have<T.nlen+T.ndist;){for(;xe=(O=T.lencode[G&(1<<T.lenbits)-1])>>>16&255,Be=65535&O,!((Ie=O>>>24)<=R);){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}if(Be<16)G>>>=Ie,R-=Ie,T.lens[T.have++]=Be;else{if(Be===16){for(M=Ie+2;R<M;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}if(G>>>=Ie,R-=Ie,T.have===0){k.msg="invalid bit length repeat",T.mode=30;break}y=T.lens[T.have-1],ae=3+(3&G),G>>>=2,R-=2}else if(Be===17){for(M=Ie+3;R<M;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}R-=Ie,y=0,ae=3+(7&(G>>>=Ie)),G>>>=3,R-=3}else{for(M=Ie+7;R<M;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}R-=Ie,y=0,ae=11+(127&(G>>>=Ie)),G>>>=7,R-=7}if(T.have+ae>T.nlen+T.ndist){k.msg="invalid bit length repeat",T.mode=30;break}for(;ae--;)T.lens[T.have++]=y}}if(T.mode===30)break;if(T.lens[256]===0){k.msg="invalid code -- missing end-of-block",T.mode=30;break}if(T.lenbits=9,X={bits:T.lenbits},Q=h(c,T.lens,0,T.nlen,T.lencode,0,T.work,X),T.lenbits=X.bits,Q){k.msg="invalid literal/lengths set",T.mode=30;break}if(T.distbits=6,T.distcode=T.distdyn,X={bits:T.distbits},Q=h(d,T.lens,T.nlen,T.ndist,T.distcode,0,T.work,X),T.distbits=X.bits,Q){k.msg="invalid distances set",T.mode=30;break}if(T.mode=20,U===6)break e;case 20:T.mode=21;case 21:if(6<=z&&258<=Y){k.next_out=de,k.avail_out=Y,k.next_in=W,k.avail_in=z,T.hold=G,T.bits=R,l(k,ne),de=k.next_out,he=k.output,Y=k.avail_out,W=k.next_in,F=k.input,z=k.avail_in,G=T.hold,R=T.bits,T.mode===12&&(T.back=-1);break}for(T.back=0;xe=(O=T.lencode[G&(1<<T.lenbits)-1])>>>16&255,Be=65535&O,!((Ie=O>>>24)<=R);){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}if(xe&&(240&xe)==0){for(Me=Ie,qe=xe,ze=Be;xe=(O=T.lencode[ze+((G&(1<<Me+qe)-1)>>Me)])>>>16&255,Be=65535&O,!(Me+(Ie=O>>>24)<=R);){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}G>>>=Me,R-=Me,T.back+=Me}if(G>>>=Ie,R-=Ie,T.back+=Ie,T.length=Be,xe===0){T.mode=26;break}if(32&xe){T.back=-1,T.mode=12;break}if(64&xe){k.msg="invalid literal/length code",T.mode=30;break}T.extra=15&xe,T.mode=22;case 22:if(T.extra){for(M=T.extra;R<M;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}T.length+=G&(1<<T.extra)-1,G>>>=T.extra,R-=T.extra,T.back+=T.extra}T.was=T.length,T.mode=23;case 23:for(;xe=(O=T.distcode[G&(1<<T.distbits)-1])>>>16&255,Be=65535&O,!((Ie=O>>>24)<=R);){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}if((240&xe)==0){for(Me=Ie,qe=xe,ze=Be;xe=(O=T.distcode[ze+((G&(1<<Me+qe)-1)>>Me)])>>>16&255,Be=65535&O,!(Me+(Ie=O>>>24)<=R);){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}G>>>=Me,R-=Me,T.back+=Me}if(G>>>=Ie,R-=Ie,T.back+=Ie,64&xe){k.msg="invalid distance code",T.mode=30;break}T.offset=Be,T.extra=15&xe,T.mode=24;case 24:if(T.extra){for(M=T.extra;R<M;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}T.offset+=G&(1<<T.extra)-1,G>>>=T.extra,R-=T.extra,T.back+=T.extra}if(T.offset>T.dmax){k.msg="invalid distance too far back",T.mode=30;break}T.mode=25;case 25:if(Y===0)break e;if(ae=ne-Y,T.offset>ae){if((ae=T.offset-ae)>T.whave&&T.sane){k.msg="invalid distance too far back",T.mode=30;break}ke=ae>T.wnext?(ae-=T.wnext,T.wsize-ae):T.wnext-ae,ae>T.length&&(ae=T.length),We=T.window}else We=he,ke=de-T.offset,ae=T.length;for(Y<ae&&(ae=Y),Y-=ae,T.length-=ae;he[de++]=We[ke++],--ae;);T.length===0&&(T.mode=21);break;case 26:if(Y===0)break e;he[de++]=T.length,Y--,T.mode=21;break;case 27:if(T.wrap){for(;R<32;){if(z===0)break e;z--,G|=F[W++]<<R,R+=8}if(ne-=Y,k.total_out+=ne,T.total+=ne,ne&&(k.adler=T.check=T.flags?o(T.check,he,ne,de-ne):a(T.check,he,ne,de-ne)),ne=Y,(T.flags?G:m(G))!==T.check){k.msg="incorrect data check",T.mode=30;break}R=G=0}T.mode=28;case 28:if(T.wrap&&T.flags){for(;R<32;){if(z===0)break e;z--,G+=F[W++]<<R,R+=8}if(G!==(4294967295&T.total)){k.msg="incorrect length check",T.mode=30;break}R=G=0}T.mode=29;case 29:Q=1;break e;case 30:Q=-3;break e;case 31:return-4;case 32:default:return u}return k.next_out=de,k.avail_out=Y,k.next_in=W,k.avail_in=z,T.hold=G,T.bits=R,(T.wsize||ne!==k.avail_out&&T.mode<30&&(T.mode<27||U!==4))&&ie(k,k.output,k.next_out,ne-k.avail_out)?(T.mode=31,-4):(ce-=k.avail_in,ne-=k.avail_out,k.total_in+=ce,k.total_out+=ne,T.total+=ne,T.wrap&&ne&&(k.adler=T.check=T.flags?o(T.check,he,ne,k.next_out-ne):a(T.check,he,ne,k.next_out-ne)),k.data_type=T.bits+(T.last?64:0)+(T.mode===12?128:0)+(T.mode===20||T.mode===15?256:0),(ce==0&&ne===0||U===4)&&Q===f&&(Q=-5),Q)},i.inflateEnd=function(k){if(!k||!k.state)return u;var U=k.state;return U.window&&(U.window=null),k.state=null,f},i.inflateGetHeader=function(k,U){var T;return k&&k.state?(2&(T=k.state).wrap)==0?u:((T.head=U).done=!1,f):u},i.inflateSetDictionary=function(k,U){var T,F=U.length;return k&&k.state?(T=k.state).wrap!==0&&T.mode!==11?u:T.mode===11&&a(1,U,F,0)!==T.check?-3:ie(k,U,F,F)?(T.mode=31,-4):(T.havedict=1,f):u},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,s,i){var r=t("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(c,d,f,u,C,g,v,m){var b,E,w,_,A,D,j,B,$,ie=m.bits,k=0,U=0,T=0,F=0,he=0,W=0,de=0,z=0,Y=0,G=0,R=null,ce=0,ne=new r.Buf16(16),ae=new r.Buf16(16),ke=null,We=0;for(k=0;k<=15;k++)ne[k]=0;for(U=0;U<u;U++)ne[d[f+U]]++;for(he=ie,F=15;1<=F&&ne[F]===0;F--);if(F<he&&(he=F),F===0)return C[g++]=20971520,C[g++]=20971520,m.bits=1,0;for(T=1;T<F&&ne[T]===0;T++);for(he<T&&(he=T),k=z=1;k<=15;k++)if(z<<=1,(z-=ne[k])<0)return-1;if(0<z&&(c===0||F!==1))return-1;for(ae[1]=0,k=1;k<15;k++)ae[k+1]=ae[k]+ne[k];for(U=0;U<u;U++)d[f+U]!==0&&(v[ae[d[f+U]]++]=U);if(D=c===0?(R=ke=v,19):c===1?(R=a,ce-=257,ke=o,We-=257,256):(R=l,ke=h,-1),k=T,A=g,de=U=G=0,w=-1,_=(Y=1<<(W=he))-1,c===1&&852<Y||c===2&&592<Y)return 1;for(;;){for(j=k-de,$=v[U]<D?(B=0,v[U]):v[U]>D?(B=ke[We+v[U]],R[ce+v[U]]):(B=96,0),b=1<<k-de,T=E=1<<W;C[A+(G>>de)+(E-=b)]=j<<24|B<<16|$|0,E!==0;);for(b=1<<k-1;G&b;)b>>=1;if(b!==0?(G&=b-1,G+=b):G=0,U++,--ne[k]==0){if(k===F)break;k=d[f+v[U]]}if(he<k&&(G&_)!==w){for(de===0&&(de=he),A+=T,z=1<<(W=k-de);W+de<F&&!((z-=ne[W+de])<=0);)W++,z<<=1;if(Y+=1<<W,c===1&&852<Y||c===2&&592<Y)return 1;C[w=G&_]=he<<24|W<<16|A-g|0}}return G!==0&&(C[A+G]=k-de<<24|64<<16|0),m.bits=he,0}},{"../utils/common":41}],51:[function(t,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,s,i){var r=t("../utils/common"),a=0,o=1;function l(O){for(var N=O.length;0<=--N;)O[N]=0}p(l,"n");var h=0,c=29,d=256,f=d+1+c,u=30,C=19,g=2*f+1,v=15,m=16,b=7,E=256,w=16,_=17,A=18,D=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],$=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ie=new Array(2*(f+2));l(ie);var k=new Array(2*u);l(k);var U=new Array(512);l(U);var T=new Array(256);l(T);var F=new Array(c);l(F);var he,W,de,z=new Array(u);function Y(O,N,J,te,K){this.static_tree=O,this.extra_bits=N,this.extra_base=J,this.elems=te,this.max_length=K,this.has_stree=O&&O.length}p(Y,"D");function G(O,N){this.dyn_tree=O,this.max_code=0,this.stat_desc=N}p(G,"F");function R(O){return O<256?U[O]:U[256+(O>>>7)]}p(R,"N");function ce(O,N){O.pending_buf[O.pending++]=255&N,O.pending_buf[O.pending++]=N>>>8&255}p(ce,"U");function ne(O,N,J){O.bi_valid>m-J?(O.bi_buf|=N<<O.bi_valid&65535,ce(O,O.bi_buf),O.bi_buf=N>>m-O.bi_valid,O.bi_valid+=J-m):(O.bi_buf|=N<<O.bi_valid&65535,O.bi_valid+=J)}p(ne,"P");function ae(O,N,J){ne(O,J[2*N],J[2*N+1])}p(ae,"L");function ke(O,N){for(var J=0;J|=1&O,O>>>=1,J<<=1,0<--N;);return J>>>1}p(ke,"j");function We(O,N,J){var te,K,re=new Array(v+1),ue=0;for(te=1;te<=v;te++)re[te]=ue=ue+J[te-1]<<1;for(K=0;K<=N;K++){var le=O[2*K+1];le!==0&&(O[2*K]=ke(re[le]++,le))}}p(We,"Z");function Ie(O){var N;for(N=0;N<f;N++)O.dyn_ltree[2*N]=0;for(N=0;N<u;N++)O.dyn_dtree[2*N]=0;for(N=0;N<C;N++)O.bl_tree[2*N]=0;O.dyn_ltree[2*E]=1,O.opt_len=O.static_len=0,O.last_lit=O.matches=0}p(Ie,"W");function xe(O){8<O.bi_valid?ce(O,O.bi_buf):0<O.bi_valid&&(O.pending_buf[O.pending++]=O.bi_buf),O.bi_buf=0,O.bi_valid=0}p(xe,"M");function Be(O,N,J,te){var K=2*N,re=2*J;return O[K]<O[re]||O[K]===O[re]&&te[N]<=te[J]}p(Be,"H");function Me(O,N,J){for(var te=O.heap[J],K=J<<1;K<=O.heap_len&&(K<O.heap_len&&Be(N,O.heap[K+1],O.heap[K],O.depth)&&K++,!Be(N,te,O.heap[K],O.depth));)O.heap[J]=O.heap[K],J=K,K<<=1;O.heap[J]=te}p(Me,"G");function qe(O,N,J){var te,K,re,ue,le=0;if(O.last_lit!==0)for(;te=O.pending_buf[O.d_buf+2*le]<<8|O.pending_buf[O.d_buf+2*le+1],K=O.pending_buf[O.l_buf+le],le++,te===0?ae(O,K,N):(ae(O,(re=T[K])+d+1,N),(ue=D[re])!==0&&ne(O,K-=F[re],ue),ae(O,re=R(--te),J),(ue=j[re])!==0&&ne(O,te-=z[re],ue)),le<O.last_lit;);ae(O,E,N)}p(qe,"K");function ze(O,N){var J,te,K,re=N.dyn_tree,ue=N.stat_desc.static_tree,le=N.stat_desc.has_stree,Ce=N.stat_desc.elems,Oe=-1;for(O.heap_len=0,O.heap_max=g,J=0;J<Ce;J++)re[2*J]!==0?(O.heap[++O.heap_len]=Oe=J,O.depth[J]=0):re[2*J+1]=0;for(;O.heap_len<2;)re[2*(K=O.heap[++O.heap_len]=Oe<2?++Oe:0)]=1,O.depth[K]=0,O.opt_len--,le&&(O.static_len-=ue[2*K+1]);for(N.max_code=Oe,J=O.heap_len>>1;1<=J;J--)Me(O,re,J);for(K=Ce;J=O.heap[1],O.heap[1]=O.heap[O.heap_len--],Me(O,re,1),te=O.heap[1],O.heap[--O.heap_max]=J,O.heap[--O.heap_max]=te,re[2*K]=re[2*J]+re[2*te],O.depth[K]=(O.depth[J]>=O.depth[te]?O.depth[J]:O.depth[te])+1,re[2*J+1]=re[2*te+1]=K,O.heap[1]=K++,Me(O,re,1),2<=O.heap_len;);O.heap[--O.heap_max]=O.heap[1],function(Ee,tt){var Gt,lt,Lt,De,Ht,fs,mt=tt.dyn_tree,gs=tt.max_code,Gs=tt.stat_desc.static_tree,Hs=tt.stat_desc.has_stree,Ws=tt.stat_desc.extra_bits,ms=tt.stat_desc.extra_base,q=tt.stat_desc.max_length,st=0;for(De=0;De<=v;De++)Ee.bl_count[De]=0;for(mt[2*Ee.heap[Ee.heap_max]+1]=0,Gt=Ee.heap_max+1;Gt<g;Gt++)q<(De=mt[2*mt[2*(lt=Ee.heap[Gt])+1]+1]+1)&&(De=q,st++),mt[2*lt+1]=De,gs<lt||(Ee.bl_count[De]++,Ht=0,ms<=lt&&(Ht=Ws[lt-ms]),fs=mt[2*lt],Ee.opt_len+=fs*(De+Ht),Hs&&(Ee.static_len+=fs*(Gs[2*lt+1]+Ht)));if(st!==0){do{for(De=q-1;Ee.bl_count[De]===0;)De--;Ee.bl_count[De]--,Ee.bl_count[De+1]+=2,Ee.bl_count[q]--,st-=2}while(0<st);for(De=q;De!==0;De--)for(lt=Ee.bl_count[De];lt!==0;)gs<(Lt=Ee.heap[--Gt])||(mt[2*Lt+1]!==De&&(Ee.opt_len+=(De-mt[2*Lt+1])*mt[2*Lt],mt[2*Lt+1]=De),lt--)}}(O,N),We(re,Oe,O.bl_count)}p(ze,"Y");function y(O,N,J){var te,K,re=-1,ue=N[1],le=0,Ce=7,Oe=4;for(ue===0&&(Ce=138,Oe=3),N[2*(J+1)+1]=65535,te=0;te<=J;te++)K=ue,ue=N[2*(te+1)+1],++le<Ce&&K===ue||(le<Oe?O.bl_tree[2*K]+=le:K!==0?(K!==re&&O.bl_tree[2*K]++,O.bl_tree[2*w]++):le<=10?O.bl_tree[2*_]++:O.bl_tree[2*A]++,re=K,Oe=(le=0)===ue?(Ce=138,3):K===ue?(Ce=6,3):(Ce=7,4))}p(y,"X");function Q(O,N,J){var te,K,re=-1,ue=N[1],le=0,Ce=7,Oe=4;for(ue===0&&(Ce=138,Oe=3),te=0;te<=J;te++)if(K=ue,ue=N[2*(te+1)+1],!(++le<Ce&&K===ue)){if(le<Oe)for(;ae(O,K,O.bl_tree),--le!=0;);else K!==0?(K!==re&&(ae(O,K,O.bl_tree),le--),ae(O,w,O.bl_tree),ne(O,le-3,2)):le<=10?(ae(O,_,O.bl_tree),ne(O,le-3,3)):(ae(O,A,O.bl_tree),ne(O,le-11,7));re=K,Oe=(le=0)===ue?(Ce=138,3):K===ue?(Ce=6,3):(Ce=7,4)}}p(Q,"V"),l(z);var X=!1;function M(O,N,J,te){ne(O,(h<<1)+(te?1:0),3),function(K,re,ue,le){xe(K),ce(K,ue),ce(K,~ue),r.arraySet(K.pending_buf,K.window,re,ue,K.pending),K.pending+=ue}(O,N,J)}p(M,"J"),i._tr_init=function(O){X||(function(){var N,J,te,K,re,ue=new Array(v+1);for(K=te=0;K<c-1;K++)for(F[K]=te,N=0;N<1<<D[K];N++)T[te++]=K;for(T[te-1]=K,K=re=0;K<16;K++)for(z[K]=re,N=0;N<1<<j[K];N++)U[re++]=K;for(re>>=7;K<u;K++)for(z[K]=re<<7,N=0;N<1<<j[K]-7;N++)U[256+re++]=K;for(J=0;J<=v;J++)ue[J]=0;for(N=0;N<=143;)ie[2*N+1]=8,N++,ue[8]++;for(;N<=255;)ie[2*N+1]=9,N++,ue[9]++;for(;N<=279;)ie[2*N+1]=7,N++,ue[7]++;for(;N<=287;)ie[2*N+1]=8,N++,ue[8]++;for(We(ie,f+1,ue),N=0;N<u;N++)k[2*N+1]=5,k[2*N]=ke(N,5);he=new Y(ie,D,d+1,f,v),W=new Y(k,j,0,u,v),de=new Y(new Array(0),B,0,C,b)}(),X=!0),O.l_desc=new G(O.dyn_ltree,he),O.d_desc=new G(O.dyn_dtree,W),O.bl_desc=new G(O.bl_tree,de),O.bi_buf=0,O.bi_valid=0,Ie(O)},i._tr_stored_block=M,i._tr_flush_block=function(O,N,J,te){var K,re,ue=0;0<O.level?(O.strm.data_type===2&&(O.strm.data_type=function(le){var Ce,Oe=4093624447;for(Ce=0;Ce<=31;Ce++,Oe>>>=1)if(1&Oe&&le.dyn_ltree[2*Ce]!==0)return a;if(le.dyn_ltree[18]!==0||le.dyn_ltree[20]!==0||le.dyn_ltree[26]!==0)return o;for(Ce=32;Ce<d;Ce++)if(le.dyn_ltree[2*Ce]!==0)return o;return a}(O)),ze(O,O.l_desc),ze(O,O.d_desc),ue=function(le){var Ce;for(y(le,le.dyn_ltree,le.l_desc.max_code),y(le,le.dyn_dtree,le.d_desc.max_code),ze(le,le.bl_desc),Ce=C-1;3<=Ce&&le.bl_tree[2*$[Ce]+1]===0;Ce--);return le.opt_len+=3*(Ce+1)+5+5+4,Ce}(O),K=O.opt_len+3+7>>>3,(re=O.static_len+3+7>>>3)<=K&&(K=re)):K=re=J+5,J+4<=K&&N!==-1?M(O,N,J,te):O.strategy===4||re===K?(ne(O,2+(te?1:0),3),qe(O,ie,k)):(ne(O,4+(te?1:0),3),function(le,Ce,Oe,Ee){var tt;for(ne(le,Ce-257,5),ne(le,Oe-1,5),ne(le,Ee-4,4),tt=0;tt<Ee;tt++)ne(le,le.bl_tree[2*$[tt]+1],3);Q(le,le.dyn_ltree,Ce-1),Q(le,le.dyn_dtree,Oe-1)}(O,O.l_desc.max_code+1,O.d_desc.max_code+1,ue+1),qe(O,O.dyn_ltree,O.dyn_dtree)),Ie(O),te&&xe(O)},i._tr_tally=function(O,N,J){return O.pending_buf[O.d_buf+2*O.last_lit]=N>>>8&255,O.pending_buf[O.d_buf+2*O.last_lit+1]=255&N,O.pending_buf[O.l_buf+O.last_lit]=255&J,O.last_lit++,N===0?O.dyn_ltree[2*J]++:(O.matches++,N--,O.dyn_ltree[2*(T[J]+d+1)]++,O.dyn_dtree[2*R(N)]++),O.last_lit===O.lit_bufsize-1},i._tr_align=function(O){ne(O,2,3),ae(O,E,ie),function(N){N.bi_valid===16?(ce(N,N.bi_buf),N.bi_buf=0,N.bi_valid=0):8<=N.bi_valid&&(N.pending_buf[N.pending++]=255&N.bi_buf,N.bi_buf>>=8,N.bi_valid-=8)}(O)}},{"../utils/common":41}],53:[function(t,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,s,i){(function(r){(function(a,o){if(!a.setImmediate){var l,h,c,d,f=1,u={},C=!1,g=a.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(a);v=v&&v.setTimeout?v:a,l={}.toString.call(a.process)==="[object process]"?function(w){process.nextTick(function(){b(w)})}:function(){if(a.postMessage&&!a.importScripts){var w=!0,_=a.onmessage;return a.onmessage=function(){w=!1},a.postMessage("","*"),a.onmessage=_,w}}()?(d="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",E,!1):a.attachEvent("onmessage",E),function(w){a.postMessage(d+w,"*")}):a.MessageChannel?((c=new MessageChannel).port1.onmessage=function(w){b(w.data)},function(w){c.port2.postMessage(w)}):g&&"onreadystatechange"in g.createElement("script")?(h=g.documentElement,function(w){var _=g.createElement("script");_.onreadystatechange=function(){b(w),_.onreadystatechange=null,h.removeChild(_),_=null},h.appendChild(_)}):function(w){setTimeout(b,0,w)},v.setImmediate=function(w){typeof w!="function"&&(w=new Function(""+w));for(var _=new Array(arguments.length-1),A=0;A<_.length;A++)_[A]=arguments[A+1];var D={callback:w,args:_};return u[f]=D,l(f),f++},v.clearImmediate=m}function m(w){delete u[w]}p(m,"f");function b(w){if(C)setTimeout(b,0,w);else{var _=u[w];if(_){C=!0;try{(function(A){var D=A.callback,j=A.args;switch(j.length){case 0:D();break;case 1:D(j[0]);break;case 2:D(j[0],j[1]);break;case 3:D(j[0],j[1],j[2]);break;default:D.apply(o,j)}})(_)}finally{m(w),C=!1}}}}p(b,"c");function E(w){w.source===a&&typeof w.data=="string"&&w.data.indexOf(d)===0&&b(+w.data.slice(d.length))}p(E,"d")})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof Ks<"u"?Ks:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(on)),on.exports}p(Uu,"requireJszip_min");var Yu=Uu();const Gu=oh(Yu),va=class va extends Yt{constructor(e=null){super(e),this.ERR_USERNAME="invalid username",this.ERR_PASSWORD="invalid password",this.ERR_ACCOUNT_EXIST="account doesn't exist",this.ERR_PASSWORD_MATCH="password doesn't match",this.ERR_NO_SAVES="No save files found",this.ERR_TOO_MANY_SAVES="Too many save files found"}setup(){super.setup(),this.buildExternalPartyContainer(),this.buildInfoContainer()}buildExternalPartyContainer(){this.externalPartyContainer=n.add.container(0,0),this.externalPartyContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,n.game.canvas.width/12,n.game.canvas.height/12),Phaser.Geom.Rectangle.Contains),this.externalPartyTitle=V(0,4,"",x.SETTINGS_LABEL),this.externalPartyTitle.setOrigin(.5,0),this.externalPartyBg=me(0,0,0,0),this.externalPartyContainer.add(this.externalPartyBg),this.externalPartyContainer.add(this.externalPartyTitle),this.googleImage=this.buildInteractableImage("google","google-icon"),this.discordImage=this.buildInteractableImage("discord","discord-icon"),this.externalPartyContainer.add(this.googleImage),this.externalPartyContainer.add(this.discordImage),this.getUi().add(this.externalPartyContainer),this.externalPartyContainer.add(this.googleImage),this.externalPartyContainer.add(this.discordImage),this.externalPartyContainer.setVisible(!1)}buildInfoContainer(){this.infoContainer=n.add.container(0,0),this.usernameInfoImage=this.buildInteractableImage("settings_icon","username-info-icon",{x:20,scale:.5}),this.saveDownloadImage=this.buildInteractableImage("saving_icon","save-download-icon",{x:0,scale:.75}),this.infoContainer.add(this.usernameInfoImage),this.infoContainer.add(this.saveDownloadImage),this.getUi().add(this.infoContainer),this.infoContainer.setVisible(!1),this.infoContainer.disableInteractive()}getModalTitle(e){return S.t("menu:login")}getWidth(e){return 160}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return[S.t("menu:login"),S.t("menu:register")]}getReadableErrorMessage(e){const t=e==null?void 0:e.indexOf(":");switch(t>0&&(e=e.slice(0,t)),e){case this.ERR_USERNAME:return S.t("menu:invalidLoginUsername");case this.ERR_PASSWORD:return S.t("menu:invalidLoginPassword");case this.ERR_ACCOUNT_EXIST:return S.t("menu:accountNonExistent");case this.ERR_PASSWORD_MATCH:return S.t("menu:unmatchingPassword");case this.ERR_NO_SAVES:return"P01: "+S.t("menu:noSaves");case this.ERR_TOO_MANY_SAVES:return"P02: "+S.t("menu:tooManySaves")}return super.getReadableErrorMessage(e)}getInputFieldConfigs(){const e=[];return e.push({label:S.t("menu:username")}),e.push({label:S.t("menu:password"),isPassword:!0}),e}show(e){if(super.show(e)){const t=e[0];this.processExternalProvider(t);const s=this.submitAction;return this.submitAction=i=>{if(n.tweens.getTweensOf(this.modalContainer).length===0){this.submitAction=s,this.sanitizeInputs(),n.ui.setMode(L.LOADING,{buttonActions:[]});const r=p(l=>{n.ui.setMode(L.LOGIN_FORM,Object.assign(t,{errorMessage:l==null?void 0:l.trim()})),n.ui.playError()},"onFail");if(!this.inputs[0].text)return r(S.t("menu:emptyUsername"));const[a,o]=this.inputs;Et.account.login({username:a.text,password:o.text}).then(l=>{!l&&s?s():r(l)})}},!0}return!1}clear(){super.clear(),this.externalPartyContainer.setVisible(!1),this.infoContainer.setVisible(!1),this.setMouseCursorStyle("default"),[this.discordImage,this.googleImage,this.usernameInfoImage,this.saveDownloadImage].forEach(e=>e.off("pointerdown"))}processExternalProvider(e){this.externalPartyTitle.setText(S.t("menu:orUse")??""),this.externalPartyTitle.setX(20+this.externalPartyTitle.text.length),this.externalPartyTitle.setVisible(!0),this.externalPartyContainer.setPositionRelative(this.modalContainer,175,0),this.externalPartyContainer.setVisible(!0),this.externalPartyBg.setSize(this.externalPartyTitle.text.length+50,this.modalBg.height),this.getUi().moveTo(this.externalPartyContainer,this.getUi().length-1),this.googleImage.setPosition(this.externalPartyBg.width/3.1,this.externalPartyBg.height-60),this.discordImage.setPosition(this.externalPartyBg.width/3.1,this.externalPartyBg.height-40),this.infoContainer.setPosition(5,-76),this.infoContainer.setVisible(!0),this.getUi().moveTo(this.infoContainer,this.getUi().length-1),this.usernameInfoImage.setPositionRelative(this.infoContainer,0,0),this.saveDownloadImage.setPositionRelative(this.infoContainer,20,0),this.discordImage.on("pointerdown",()=>{const r=`https://discord.com/api/oauth2/authorize?client_id=1234567890&redirect_uri=${encodeURIComponent("http://localhost:8001/auth/discord/callback")}&response_type=code&scope=identify&prompt=none`;window.open(r,"_self")}),this.googleImage.on("pointerdown",()=>{const r=`https://accounts.google.com/o/oauth2/auth?client_id=1234567890&redirect_uri=${encodeURIComponent("http://localhost:8001/auth/google/callback")}&response_type=code&scope=openid`;window.open(r,"_self")});const t=p(s=>{n.ui.setMode(L.LOADING,{buttonActions:[]}),n.ui.setModeForceTransition(L.LOGIN_FORM,Object.assign(e,{errorMessage:s==null?void 0:s.trim()})),n.ui.playError()},"onFail");this.usernameInfoImage.on("pointerdown",()=>{if(n.tweens.getTweensOf(this.infoContainer).length===0){const s=Object.keys(localStorage),i="data_",r=s.filter(a=>a.indexOf(i)>=0);if(r.length>0&&r.length<=2){const a=[];for(let o=0;o<r.length;o++)a.push({label:r[o].replace(i,""),handler:p(()=>(n.ui.revertMode(),this.infoContainer.disableInteractive(),!0),"handler")});n.ui.setOverlayMode(L.OPTION_SELECT,{options:a,delay:1e3}),this.infoContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,n.game.canvas.width,n.game.canvas.height),Phaser.Geom.Rectangle.Contains)}else return r.length>2?t(this.ERR_TOO_MANY_SAVES):t(this.ERR_NO_SAVES)}}),this.saveDownloadImage.on("pointerdown",()=>{const s=Object.keys(localStorage),i="data_",r="sessionData",a=s.filter(l=>l.indexOf(i)>=0),o=s.filter(l=>l.indexOf(r)>=0);if(a.length>0||o.length>0){const l=new Gu;for(let h=0;h<a.length;h++)l.file(a[h]+".prsv",localStorage.getItem(a[h]));for(let h=0;h<o.length;h++)l.file(o[h]+".prsv",localStorage.getItem(o[h]));l.generateAsync({type:"blob"}).then(h=>{const c=URL.createObjectURL(h),d=document.createElement("a");d.href=c,d.download="pokerogue_saves.zip",d.click(),URL.revokeObjectURL(c)})}else return t(this.ERR_NO_SAVES)}),this.externalPartyContainer.setAlpha(0),n.tweens.add({targets:this.externalPartyContainer,duration:ye(1e3),ease:"Sine.easeInOut",y:"-=24",alpha:1}),this.infoContainer.setAlpha(0),n.tweens.add({targets:this.infoContainer,duration:ye(1e3),ease:"Sine.easeInOut",y:"-=24",alpha:1})}buildInteractableImage(e,t,s={}){const{scale:i=.07,x:r=0,y:a=0,origin:o={x:0,y:0}}=s,l=n.add.image(r,a,e);return l.setName(t),l.setOrigin(o.x,o.y),l.setScale(i),l.setInteractive(),this.addInteractionHoverEffect(l),l}};p(va,"LoginFormUiHandler");let Yn=va;const ln={"es-ES":{inputFieldFontSize:"50px",errorMessageFontSize:"40px"}},Ia=class Ia extends Yt{getModalTitle(e){return S.t("menu:register")}getWidth(e){return 160}getMargin(e){return[0,0,48,0]}getButtonTopMargin(){return 8}getButtonLabels(e){return[S.t("menu:register"),S.t("menu:backToLogin")]}getReadableErrorMessage(e){const t=e==null?void 0:e.indexOf(":");switch(t>0&&(e=e.slice(0,t)),e){case"invalid username":return S.t("menu:invalidRegisterUsername");case"invalid password":return S.t("menu:invalidRegisterPassword");case"failed to add account record":return S.t("menu:usernameAlreadyUsed")}return super.getReadableErrorMessage(e)}getInputFieldConfigs(){const e=[];return e.push({label:S.t("menu:username")}),e.push({label:S.t("menu:password"),isPassword:!0}),e.push({label:S.t("menu:confirmPassword"),isPassword:!0}),e}setup(){var s;super.setup(),this.modalContainer.list.forEach(i=>{var r;if(i instanceof Phaser.GameObjects.Text&&i!==this.titleText){const a=(r=ln[S.resolvedLanguage])==null?void 0:r.inputFieldFontSize;a&&i.setFontSize(a)}});const e=((s=ln[S.resolvedLanguage])==null?void 0:s.warningMessageFontSize)??"42px",t=V(10,87,S.t("menu:registrationAgeWarning"),x.TOOLTIP_CONTENT,{fontSize:e});this.modalContainer.add(t)}show(e){if(super.show(e)){const t=e[0],s=this.submitAction;return this.submitAction=i=>{if(n.tweens.getTweensOf(this.modalContainer).length===0){this.submitAction=s,this.sanitizeInputs(),n.ui.setMode(L.LOADING,{buttonActions:[]});const r=p(l=>{var c;n.ui.setMode(L.REGISTRATION_FORM,Object.assign(t,{errorMessage:l==null?void 0:l.trim()})),n.ui.playError();const h=(c=ln[S.resolvedLanguage])==null?void 0:c.errorMessageFontSize;h&&this.errorMessage.setFontSize(h)},"onFail");if(!this.inputs[0].text)return r(S.t("menu:emptyUsername"));if(!this.inputs[1].text)return r(this.getReadableErrorMessage("invalid password"));if(this.inputs[1].text!==this.inputs[2].text)return r(S.t("menu:passwordNotMatchingConfirmPassword"));const[a,o]=this.inputs;Et.account.register({username:a.text,password:o.text}).then(l=>{l?r(l):Et.account.login({username:a.text,password:o.text}).then(h=>{h?r(h):s==null||s()})})}},!0}return!1}};p(Ia,"RegistrationFormUiHandler");let Gn=Ia;const Ea=class Ea extends us{constructor(e=null){super(e)}getModalTitle(){return""}getWidth(){return 80}getHeight(){return 32}getMargin(){return[0,0,48,0]}getButtonLabels(){return[]}setup(){super.setup();const e=V(this.getWidth()/2,this.getHeight()/2,S.t("menu:loading"),x.WINDOW);e.setOrigin(.5,.5),this.modalContainer.add(e)}};p(Ea,"LoadingModalUiHandler");let Hn=Ea;const Hu=15,Wu=10,cl=15,Ku=[...Array(Hu).fill("battlesWon"),...Array(Wu).fill("underratedPokemon"),"joinTheDiscord","infiniteLevels","everythingIsStackable","optionalSaveScumming","biomes","openSource","playWithSpeed","liveBugTesting","heavyInfluence","pokemonRiskAndPokemonRain","nowWithMoreSalt","infiniteFusionAtHome","brokenEggMoves","magnificent","doPeopleReadThis","thatsCrazy","gottaCatchEmAll","questionableBalancing","coolShaders","aiFree","suddenDifficultySpikes","basedOnAnUnfinishedFlashGame","moreAddictiveThanIntended","mostlyConsistentSeeds","achievementPointsDontDoAnything","nothingBeatsAJellyFilledDonut","dontTalkAboutThePokemonIncident","alsoTryPokengine","alsoTryEmeraldRogue","alsoTryRadicalRed","eeveeExpo","checkOutYnoproject","breedersInSpace","alsoTryPokemonUnbound","tryTheJohtoDragonChallenge","basicReadingAbilityRecommended","shoutoutsToTheArtists","gamblingNotEncouraged","dontForgetToTakeABreak","wEvent","ifItsNotAccurateItsAccurate","everyLossIsProgressMade","liveWoChienReaction","itsAFeatureNotABug","theEggsAreNotForEating","7.8outOf10TooManyWaterBiomes","butNothingHappened","thePowerOfScienceIsAmazing","freeToPlay","theresATimeAndPlaceForEverything","nowWithShinierShinies","smilesGoForMiles","certainlyNotDragonFree","haveANiceDay","redacted","hi","transRights","shinyOddsHigherThanYouThink","noFalseTrades","notForProfit","timeForYourDailyRun","moreEggsThanADaycare","disclaimerHarshSunDoesNotGiveVitaminD","whoNeedsAMap","luxrayIsNotADarkType","selfDestructiveEncounters","mostOptionsAreViable","pokerogueMorse","smiley","beAwareOfPassives","asSeenOnTheWorldWideWeb","vaultinVeluzas","tooManyStarters","checkTheWiki","winWithYourFavorites","alsoTryPokerogueWait","theWayISeeItKyogreIsSurrounded","tryOutHoneyGather","notForTheFaintOfHeart","p","flipYourDeviceToEvolveInkay","inArceusWeTrust","whyDidTheTorchicCrossTheRoad","goodLuck","fuseWisely","compensation","prepareForTroubleAndMakeItDouble","anEggForYourTroubles","regirock","hereForAGoodTime","getGoodOrDont","checkTheSubreddit","betterNerfGreninja","inCaseOfUpdateClearYourCache","insertTextHere","endingEndlessNotFound","iLikeMyEggsVouchered","YOU","noAddedSugar","notSponsored","notRated","justOneMoreWaveMom","saltCured","onlyOnPokerogueNet","pixelPerfection","openSource","probablyGood","itsAMonsterHouse","dontForgetYourPassword","tripleTripleTripleAxel","questionExclamation","clownEncounters","fullOfBerries","limitsAreMeantToBeBrokenSometimes","keepItCasual","serversProbablyWorking","mew","makeItRainAndYourProblemsGoAway","customMusicTracks","youAreValid","number591IsLookingOff","timeForYourDeliDelivery","goodFirstImpression","iPreferRarerCandies","pocketRoguelite","porygonDidNothingWrong","critMattered","pickupNotRequired","stayHydrated","alsoTryCobblemon","alsoTryPokeDoku","mySleepStyleIsDoesnt","makeYourOwnWorldChampDifference","yoChampInTheMaking","notLiableForDecisionAnxiety","theAirIsTastyHere","continue","startANewRunToday","neverGiveUp","theresAlwaysNextTime","oneTwoThreeAndPoof","yourPokemonOnlyGoToLevelOneHundred","theBattlesWillBeLegendary","levelCurveBetterThanJohto","alsoTryShowering","wellStillBeHere","weHopeToSeeYouAgain","aHealthyTeamCanMeanGreaterRewards","aWildPokemonAppeared","isThisThingOn","needsMoreTesting","whoChecksStatChanges","whenTwoTrainersEyesMeet","notOfficiallyOnSteam","fiftyFifty","metaNotIncluded","bornToBeAWinner","onARollout","itsAlwaysNightDeepInTheAbyss","folksThisIsInsane"],zu=[{name:"New Year's",start:"01-01",end:"01-15",messages:["newYears.happyNewYear","newYears.andAHappyNewYear"]},{name:"Valentines",start:"02-07",end:"02-21",messages:["valentines.happyValentines","valentines.fullOfLove","valentines.applinForYou","valentines.thePowerOfLoveIsThreeThirtyBST","valentines.haveAHeartScale","valentines.i<3You"]},{name:"April Fools",start:"04-01",end:"04-03",messages:["aprilFools.battlesOne","aprilFools.aprilFools","aprilFools.removedPokemon","aprilFools.helloKyleAmber","aprilFools.gotcha","aprilFools.alsoTryPokerogueTwo","aprilFools.nowWithSameScumCountermeasures","aprilFools.neverGonnaGiveYouGoodRolls","aprilFools.youBumblingBuffoon","aprilFools.doubleShinyOddsForTrainersOnly","aprilFools.nowWithZMoves","aprilFools.newLightType","aprilFools.removedMegas","aprilFools.nerfedYourFavorites","aprilFools.grrr","aprilFools.enabledEternatusPassiveGoodLuck","aprilFools.theDarkestDaySoundsLikeAFutureProblem","aprilFools.tmShopWhen","aprilFools.whoIsFinn","aprilFools.watchOutForShadowPokemon","aprilFools.nowWithDarkTypeLuxray","aprilFools.onlyOnPokerogueNetAGAIN","aprilFools.noFreeVouchers","aprilFools.altffourAchievementPoints","aprilFools.rokePogue","aprilFools.readMe","aprilFools.winningNotIncluded","aprilFools.timeForYourSoloUnownRun","aprilFools.nowARealTimeStrategyGame","aprilFools.nowWithQuickTimeEncounters","aprilFools.timeYourInputsForHigherCatchrate","aprilFools.certifiedButtonSimulator","aprilFools.iHopeYouGetSuckerPunched"]},{name:"Halloween",start:"10-15",end:"10-31",messages:["halloween.happyHalloween","halloween.boo","halloween.pumpkabooAbout","halloween.mayContainSpiders","halloween.spookyScarySkeledirge","halloween.gourgeistUsedTrickOrTreat","halloween.letsSnuggleForever"]},{name:"Winter Holiday",start:"12-01",end:"12-31",messages:["winterHoliday.happyHolidays","winterHoliday.unaffilicatedWithDelibirdServices","winterHoliday.delibirdSeason","winterHoliday.diamondsFromTheSky","winterHoliday.holidayStylePikachuNotIncluded","winterHoliday.delibirdDirectlyToYourHouse","winterHoliday.haveAnIceDay","winterHoliday.spinTheClaydol","winterHoliday.beGoodForGoodnessSake","winterHoliday.moomooMilkAndLavaCookies","winterHoliday.iNeedAYacheBerry","winterHoliday.getJolly","winterHoliday.tisTheSeasonToBeSpeSpa","winterHoliday.deckTheHalls","winterHoliday.saveScummingGetsYouOnTheNaughtyList","winterHoliday.badTrainersGetRolycoly"]}];function ju(){const P=[...Ku];console.log("use seasonal splash messages",lh);for(const{name:e,start:t,end:s,messages:i}of zu){const r=new Date,a=new Date(`${t}-${r.getFullYear()}`),o=new Date(`${s}-${r.getFullYear()}`);if(r>=a&&r<=o){console.log(`Adding ${i.length} ${e} splash messages (weight: x${cl})`);for(const l of i){const h=Array(cl).fill(l);P.push(...h)}}}return P.map(e=>`splashMessages:${e}`)}p(ju,"getSplashMessages");const _s=class _s extends Fs{constructor(e=L.TITLE){super(e)}setup(){super.setup();const e=this.getUi();this.titleContainer=n.add.container(0,-(n.game.canvas.height/6)),this.titleContainer.setName("title"),this.titleContainer.setAlpha(0),e.add(this.titleContainer);const t=n.add.image(n.game.canvas.width/6/2,8,"logo");t.setOrigin(.5,0),this.titleContainer.add(t),li.isEventActive()&&(this.eventDisplay=new Xh(0,0,li.activeEvent()),this.eventDisplay.setup(),this.titleContainer.add(this.eventDisplay)),this.playerCountLabel=V(n.game.canvas.width/6-2,0,`? ${S.t("menu:playersOnline")}`,x.MESSAGE,{fontSize:"54px"}),this.playerCountLabel.setOrigin(1,0),this.titleContainer.add(this.playerCountLabel),this.splashMessageText=V(t.x+64,t.y+t.displayHeight-8,"",x.MONEY,{fontSize:"54px"}),this.splashMessageText.setOrigin(.5,.5),this.splashMessageText.setAngle(-20),this.titleContainer.add(this.splashMessageText);const s=this.splashMessageText.scale;n.tweens.add({targets:this.splashMessageText,duration:ye(350),scale:s*1.25,loop:-1,yoyo:!0}),this.appVersionText=V(t.x-60,t.y+t.displayHeight+4,"",x.MONEY,{fontSize:"54px"}),this.appVersionText.setOrigin(.5,.5),this.appVersionText.setAngle(0),this.titleContainer.add(this.appVersionText)}updateTitleStats(){Et.getGameTitleStats().then(e=>{e&&(this.playerCountLabel.setText(`${e.playerCount} ${S.t("menu:playersOnline")}`),this.splashMessage==="splashMessages:battlesWon"&&this.splashMessageText.setText(S.t(this.splashMessage,{count:e.battleCount})))}).catch(e=>{console.error(`Failed to fetch title stats:
`,e)})}randomPokemon(){const e=fn(1025,1),t=hs(e);(this.splashMessage==="splashMessages:underratedPokemon"||this.splashMessage==="splashMessages:dontTalkAboutThePokemonIncident"||this.splashMessage==="splashMessages:aWildPokemonAppeared"||this.splashMessage==="splashMessages:aprilFools.removedPokemon")&&this.splashMessageText.setText(S.t(this.splashMessage,{pokemonName:t.name}))}genderSplash(){this.splashMessage==="splashMessages:aprilFools.helloKyleAmber"&&(n.gameData.gender===bt.MALE?this.splashMessageText.setText(S.t(this.splashMessage,{name:S.t("trainerNames:player_m")})):this.splashMessageText.setText(S.t(this.splashMessage,{name:S.t("trainerNames:player_f")})))}show(e){const t=super.show(e);if(t){this.playerCountLabel.setY(n.game.canvas.height/6-13-this.getWindowHeight()),this.splashMessage=hh(ju()),this.splashMessageText.setText(S.t(this.splashMessage,{count:_s.BATTLES_WON_FALLBACK})),this.appVersionText.setText("v"+ch);const s=this.getUi();li.isEventActive()&&(this.eventDisplay.setWidth(n.scaledCanvas.width-this.optionSelectBg.width-this.optionSelectBg.x),this.eventDisplay.show()),this.randomPokemon(),this.genderSplash(),this.updateTitleStats(),this.titleStatsTimer=setInterval(()=>{this.updateTitleStats()},6e4),n.tweens.add({targets:[this.titleContainer,s.getMessageHandler().bg],duration:ye(325),alpha:p(i=>i===this.titleContainer?1:0,"alpha"),ease:"Sine.easeInOut"})}return t}clear(){var t;super.clear();const e=this.getUi();(t=this.eventDisplay)==null||t.clear(),this.titleStatsTimer&&clearInterval(this.titleStatsTimer),this.titleStatsTimer=null,n.tweens.add({targets:[this.titleContainer,e.getMessageHandler().bg],duration:ye(325),alpha:p(s=>s===this.titleContainer?0:1,"alpha"),ease:"Sine.easeInOut"})}};p(_s,"TitleUiHandler"),_s.BATTLES_WON_FALLBACK=-1;let Wn=_s;const xa=class xa extends Phaser.GameObjects.Container{constructor(){super(n,n.game.canvas.width/6-4,n.game.canvas.height/6-4)}setup(){this.icon=n.add.sprite(0,0,"saving_icon"),this.icon.setOrigin(1,1),this.add(this.icon),this.animActive=!1,this.shown=!1,this.setAlpha(0),this.setVisible(!1)}show(){this.shown=!0,!this.animActive&&(this.animActive=!0,n.tweens.add({targets:this,alpha:1,duration:ye(250),ease:"Sine.easeInOut",onComplete:p(()=>{n.time.delayedCall(ye(500),()=>{this.animActive=!1,this.shown||this.hide()})},"onComplete")}),this.setVisible(!0),this.shown=!0)}hide(){this.shown=!1,!this.animActive&&(this.animActive=!0,n.tweens.add({targets:this,alpha:0,duration:ye(250),ease:"Sine.easeInOut",onComplete:p(()=>{this.animActive=!1,this.setVisible(!1),this.shown&&this.show()},"onComplete")}),this.shown=!1)}};p(xa,"SavingIconHandler");let Kn=xa;const _a=class _a extends us{constructor(e=null){super(e),this.minTime=1e3*5,this.maxTime=1e3*60*5,this.randVarianceTime=1e3*10,this.reconnectDuration=this.minTime}getModalTitle(){return""}getWidth(){return 160}getHeight(){return 64}getMargin(){return[0,0,48,0]}getButtonLabels(){return[]}setup(){super.setup();const e=V(this.getWidth()/2,this.getHeight()/2,S.t("menu:errorServerDown"),x.WINDOW,{fontSize:"48px",align:"center"});e.setOrigin(.5,.5),this.modalContainer.add(e)}tryReconnect(){Is().then(e=>{e[0]||[200,400].includes(e[1])?(this.reconnectTimer=null,this.reconnectDuration=this.minTime,n.playSound("se/pb_bounce_1"),this.reconnectCallback()):e[1]===401?(oi(bs),n.reset(!0,!0)):(this.reconnectDuration=Math.min(this.reconnectDuration*2,this.maxTime),this.reconnectTimer=setTimeout(()=>this.tryReconnect(),this.reconnectDuration+Math.random()*this.randVarianceTime))})}show(e){if(e.length>=1&&e[0]instanceof Function){const t={buttonActions:[]};return this.reconnectCallback=e[0],this.reconnectDuration=this.minTime,this.reconnectTimer=setTimeout(()=>this.tryReconnect(),this.reconnectDuration),super.show([t])}return!1}};p(_a,"UnavailableModalUiHandler");let zn=_a;const wa=class wa extends us{constructor(e=null){super(e)}getModalTitle(){return""}getWidth(){return 160}getHeight(){return 32}getMargin(){return[0,0,48,0]}getButtonLabels(){return[]}setup(){super.setup();const e=V(this.getWidth()/2,this.getHeight()/2,`Your session is out of date.
Your data will be reloaded`,x.WINDOW,{fontSize:"48px",align:"center"});e.setOrigin(.5,.5),this.modalContainer.add(e)}show(e){const t={buttonActions:[]};return super.show([t])}};p(wa,"SessionReloadModalUiHandler");let jn=wa;const Oa=class Oa extends Mt{constructor(e=null){super(e),this.listening=!1,this.buttonPressed=null,this.timeLeftAutoClose=5}setup(){const e=this.getUi();this.optionSelectContainer=n.add.container(0,0),this.actionsContainer=n.add.container(0,0),this.optionSelectContainer.setVisible(!1),this.actionsContainer.setVisible(!1),e.add(this.optionSelectContainer),e.add(this.actionsContainer),this.titleBg=me(n.game.canvas.width/6-this.getWindowWidth(),-(n.game.canvas.height/6)+28+21,this.getWindowWidth(),24),this.titleBg.setOrigin(.5),this.optionSelectContainer.add(this.titleBg),this.actionBg=me(n.game.canvas.width/6-this.getWindowWidth(),-(n.game.canvas.height/6)+this.getWindowHeight()+28+21+21,this.getWindowWidth(),24),this.actionBg.setOrigin(.5),this.actionsContainer.add(this.actionBg),this.unlockText=V(0,0,S.t("settings:pressButton"),x.WINDOW),this.unlockText.setOrigin(0,0),this.unlockText.setPositionRelative(this.titleBg,36,4),this.optionSelectContainer.add(this.unlockText),this.timerText=V(0,0,"(5)",x.WINDOW),this.timerText.setOrigin(0,0),this.timerText.setPositionRelative(this.unlockText,this.unlockText.width/6+5,0),this.optionSelectContainer.add(this.timerText),this.optionSelectBg=me(n.game.canvas.width/6-this.getWindowWidth(),-(n.game.canvas.height/6)+this.getWindowHeight()+28,this.getWindowWidth(),this.getWindowHeight()),this.optionSelectBg.setOrigin(.5),this.optionSelectContainer.add(this.optionSelectBg),this.cancelLabel=V(0,0,S.t("settings:back"),x.SETTINGS_LABEL),this.cancelLabel.setOrigin(0,.5),this.cancelLabel.setPositionRelative(this.actionBg,10,this.actionBg.height/2),this.actionsContainer.add(this.cancelLabel)}manageAutoCloseTimer(){clearTimeout(this.countdownTimer),this.countdownTimer=setTimeout(()=>{var e;this.timeLeftAutoClose-=1,this.timerText.setText(`(${this.timeLeftAutoClose})`),this.timeLeftAutoClose>=0?this.manageAutoCloseTimer():(e=this.cancelFn)==null||e.call(this)},1e3)}show(e){return super.show(e),this.buttonPressed=null,this.timeLeftAutoClose=5,this.cancelFn=e[0].cancelHandler,this.target=e[0].target,this.getUi().bringToTop(this.optionSelectContainer),this.getUi().bringToTop(this.actionsContainer),this.optionSelectContainer.setVisible(!0),setTimeout(()=>{this.listening=!0,this.manageAutoCloseTimer()},100),!0}getWindowWidth(){return 160}getWindowHeight(){return 64}processInput(e){var i,r;if(this.buttonPressed===null)return!1;const t=this.getUi();let s=!1;switch(e){case I.LEFT:case I.RIGHT:{s=this.setCursor(this.cursor?0:1);break}case I.ACTION:this.cursor===0?(i=this.cancelFn)==null||i.call(this):(s=this.swapAction(),ot.getInstance().updateIcons(),(r=this.cancelFn)==null||r.call(this,s));break}return s?t.playSelect():t.playError(),s}setCursor(e){return this.cursor=e,e===1?(this.actionLabel.setColor(this.getTextColor(x.SETTINGS_SELECTED)),this.actionLabel.setShadowColor(this.getTextColor(x.SETTINGS_SELECTED,!0)),this.cancelLabel.setColor(this.getTextColor(x.WINDOW)),this.cancelLabel.setShadowColor(this.getTextColor(x.WINDOW,!0)),!0):(this.actionLabel.setColor(this.getTextColor(x.WINDOW)),this.actionLabel.setShadowColor(this.getTextColor(x.WINDOW,!0)),this.cancelLabel.setColor(this.getTextColor(x.SETTINGS_SELECTED)),this.cancelLabel.setShadowColor(this.getTextColor(x.SETTINGS_SELECTED,!0)),!0)}clear(){super.clear(),clearTimeout(this.countdownTimer),this.timerText.setText("(5)"),this.timeLeftAutoClose=5,this.listening=!1,this.target=null,this.cancelFn=null,this.optionSelectContainer.setVisible(!1),this.actionsContainer.setVisible(!1),this.newButtonIcon.setVisible(!1),this.buttonPressed=null}onInputDown(e,t,s){clearTimeout(this.countdownTimer),this.timerText.setText(""),this.newButtonIcon.setTexture(s),this.newButtonIcon.setFrame(e),t&&(this.targetButtonIcon.setTexture(s),this.targetButtonIcon.setFrame(t),this.targetButtonIcon.setVisible(!0),this.swapText.setVisible(!0)),this.newButtonIcon.setVisible(!0),this.setCursor(0),this.actionsContainer.setVisible(!0)}};p(Oa,"AbstractBindingUiHandler");let wi=Oa;const Aa=class Aa extends wi{constructor(e=null){var t;super(e),(t=n.input.gamepad)==null||t.on("down",this.gamepadButtonDown,this)}setup(){super.setup(),this.newButtonIcon=n.add.sprite(0,0,"xbox"),this.newButtonIcon.setPositionRelative(this.optionSelectBg,78,16),this.newButtonIcon.setOrigin(.5),this.newButtonIcon.setVisible(!1),this.swapText=V(0,0,"will swap with",x.WINDOW),this.swapText.setOrigin(.5),this.swapText.setPositionRelative(this.optionSelectBg,this.optionSelectBg.width/2-2,this.optionSelectBg.height/2-2),this.swapText.setVisible(!1),this.targetButtonIcon=n.add.sprite(0,0,"xbox"),this.targetButtonIcon.setPositionRelative(this.optionSelectBg,78,48),this.targetButtonIcon.setOrigin(.5),this.targetButtonIcon.setVisible(!1),this.actionLabel=V(0,0,"Confirm swap",x.SETTINGS_LABEL),this.actionLabel.setOrigin(0,.5),this.actionLabel.setPositionRelative(this.actionBg,this.actionBg.width-75,this.actionBg.height/2),this.actionsContainer.add(this.actionLabel),this.optionSelectContainer.add(this.newButtonIcon),this.optionSelectContainer.add(this.swapText),this.optionSelectContainer.add(this.targetButtonIcon)}getSelectedDevice(){var e;return(e=n.inputController)==null?void 0:e.selectedDevice[Se.GAMEPAD]}gamepadButtonDown(e,t,s){const i=[12,13,14,15];if(!this.listening||e.id.toLowerCase()!==this.getSelectedDevice()||i.includes(t.index)||this.buttonPressed!==null)return;const r=n.inputController.getActiveConfig(Se.GAMEPAD),a=r.padType,o=cs(r,t.index),l=r.icons[o];if(!l)return;this.buttonPressed=t.index;const h=vi(r,this.target);this.onInputDown(l,h,a)}swapAction(){const e=n.inputController.getActiveConfig(Se.GAMEPAD);return n.inputController.assignBinding(e,this.target,this.buttonPressed)?(n.gameData.saveMappingConfigs(this.getSelectedDevice(),e),!0):!1}clear(){super.clear(),this.targetButtonIcon.setVisible(!1),this.swapText.setVisible(!1)}};p(Aa,"GamepadBindingUiHandler");let Xn=Aa;const $n={padID:"default",padType:"keyboard",deviceMapping:{KEY_A:Phaser.Input.Keyboard.KeyCodes.A,KEY_B:Phaser.Input.Keyboard.KeyCodes.B,KEY_C:Phaser.Input.Keyboard.KeyCodes.C,KEY_D:Phaser.Input.Keyboard.KeyCodes.D,KEY_E:Phaser.Input.Keyboard.KeyCodes.E,KEY_F:Phaser.Input.Keyboard.KeyCodes.F,KEY_G:Phaser.Input.Keyboard.KeyCodes.G,KEY_H:Phaser.Input.Keyboard.KeyCodes.H,KEY_I:Phaser.Input.Keyboard.KeyCodes.I,KEY_J:Phaser.Input.Keyboard.KeyCodes.J,KEY_K:Phaser.Input.Keyboard.KeyCodes.K,KEY_L:Phaser.Input.Keyboard.KeyCodes.L,KEY_M:Phaser.Input.Keyboard.KeyCodes.M,KEY_N:Phaser.Input.Keyboard.KeyCodes.N,KEY_O:Phaser.Input.Keyboard.KeyCodes.O,KEY_P:Phaser.Input.Keyboard.KeyCodes.P,KEY_Q:Phaser.Input.Keyboard.KeyCodes.Q,KEY_R:Phaser.Input.Keyboard.KeyCodes.R,KEY_S:Phaser.Input.Keyboard.KeyCodes.S,KEY_T:Phaser.Input.Keyboard.KeyCodes.T,KEY_U:Phaser.Input.Keyboard.KeyCodes.U,KEY_V:Phaser.Input.Keyboard.KeyCodes.V,KEY_W:Phaser.Input.Keyboard.KeyCodes.W,KEY_X:Phaser.Input.Keyboard.KeyCodes.X,KEY_Y:Phaser.Input.Keyboard.KeyCodes.Y,KEY_Z:Phaser.Input.Keyboard.KeyCodes.Z,KEY_0:Phaser.Input.Keyboard.KeyCodes.ZERO,KEY_1:Phaser.Input.Keyboard.KeyCodes.ONE,KEY_2:Phaser.Input.Keyboard.KeyCodes.TWO,KEY_3:Phaser.Input.Keyboard.KeyCodes.THREE,KEY_4:Phaser.Input.Keyboard.KeyCodes.FOUR,KEY_5:Phaser.Input.Keyboard.KeyCodes.FIVE,KEY_6:Phaser.Input.Keyboard.KeyCodes.SIX,KEY_7:Phaser.Input.Keyboard.KeyCodes.SEVEN,KEY_8:Phaser.Input.Keyboard.KeyCodes.EIGHT,KEY_9:Phaser.Input.Keyboard.KeyCodes.NINE,KEY_F1:Phaser.Input.Keyboard.KeyCodes.F1,KEY_F2:Phaser.Input.Keyboard.KeyCodes.F2,KEY_F3:Phaser.Input.Keyboard.KeyCodes.F3,KEY_F4:Phaser.Input.Keyboard.KeyCodes.F4,KEY_F5:Phaser.Input.Keyboard.KeyCodes.F5,KEY_F6:Phaser.Input.Keyboard.KeyCodes.F6,KEY_F7:Phaser.Input.Keyboard.KeyCodes.F7,KEY_F8:Phaser.Input.Keyboard.KeyCodes.F8,KEY_F9:Phaser.Input.Keyboard.KeyCodes.F9,KEY_F10:Phaser.Input.Keyboard.KeyCodes.F10,KEY_F11:Phaser.Input.Keyboard.KeyCodes.F11,KEY_F12:Phaser.Input.Keyboard.KeyCodes.F12,KEY_PAGE_DOWN:Phaser.Input.Keyboard.KeyCodes.PAGE_DOWN,KEY_PAGE_UP:Phaser.Input.Keyboard.KeyCodes.PAGE_UP,KEY_CTRL:Phaser.Input.Keyboard.KeyCodes.CTRL,KEY_DEL:Phaser.Input.Keyboard.KeyCodes.DELETE,KEY_END:Phaser.Input.Keyboard.KeyCodes.END,KEY_ENTER:Phaser.Input.Keyboard.KeyCodes.ENTER,KEY_ESC:Phaser.Input.Keyboard.KeyCodes.ESC,KEY_HOME:Phaser.Input.Keyboard.KeyCodes.HOME,KEY_INSERT:Phaser.Input.Keyboard.KeyCodes.INSERT,KEY_PLUS:Phaser.Input.Keyboard.KeyCodes.NUMPAD_ADD,KEY_MINUS:Phaser.Input.Keyboard.KeyCodes.NUMPAD_SUBTRACT,KEY_QUOTATION:Phaser.Input.Keyboard.KeyCodes.QUOTES,KEY_SHIFT:Phaser.Input.Keyboard.KeyCodes.SHIFT,KEY_SPACE:Phaser.Input.Keyboard.KeyCodes.SPACE,KEY_TAB:Phaser.Input.Keyboard.KeyCodes.TAB,KEY_TILDE:Phaser.Input.Keyboard.KeyCodes.BACKTICK,KEY_ARROW_UP:Phaser.Input.Keyboard.KeyCodes.UP,KEY_ARROW_DOWN:Phaser.Input.Keyboard.KeyCodes.DOWN,KEY_ARROW_LEFT:Phaser.Input.Keyboard.KeyCodes.LEFT,KEY_ARROW_RIGHT:Phaser.Input.Keyboard.KeyCodes.RIGHT,KEY_LEFT_BRACKET:Phaser.Input.Keyboard.KeyCodes.OPEN_BRACKET,KEY_RIGHT_BRACKET:Phaser.Input.Keyboard.KeyCodes.CLOSED_BRACKET,KEY_SEMICOLON:Phaser.Input.Keyboard.KeyCodes.SEMICOLON,KEY_COMMA:Phaser.Input.Keyboard.KeyCodes.COMMA,KEY_PERIOD:Phaser.Input.Keyboard.KeyCodes.PERIOD,KEY_BACK_SLASH:Phaser.Input.Keyboard.KeyCodes.BACK_SLASH,KEY_FORWARD_SLASH:Phaser.Input.Keyboard.KeyCodes.FORWARD_SLASH,KEY_BACKSPACE:Phaser.Input.Keyboard.KeyCodes.BACKSPACE,KEY_ALT:Phaser.Input.Keyboard.KeyCodes.ALT},icons:{KEY_A:"A.png",KEY_B:"B.png",KEY_C:"C.png",KEY_D:"D.png",KEY_E:"E.png",KEY_F:"F.png",KEY_G:"G.png",KEY_H:"H.png",KEY_I:"I.png",KEY_J:"J.png",KEY_K:"K.png",KEY_L:"L.png",KEY_M:"M.png",KEY_N:"N.png",KEY_O:"O.png",KEY_P:"P.png",KEY_Q:"Q.png",KEY_R:"R.png",KEY_S:"S.png",KEY_T:"T.png",KEY_U:"U.png",KEY_V:"V.png",KEY_W:"W.png",KEY_X:"X.png",KEY_Y:"Y.png",KEY_Z:"Z.png",KEY_0:"0.png",KEY_1:"1.png",KEY_2:"2.png",KEY_3:"3.png",KEY_4:"4.png",KEY_5:"5.png",KEY_6:"6.png",KEY_7:"7.png",KEY_8:"8.png",KEY_9:"9.png",KEY_F1:"F1.png",KEY_F2:"F2.png",KEY_F3:"F3.png",KEY_F4:"F4.png",KEY_F5:"F5.png",KEY_F6:"F6.png",KEY_F7:"F7.png",KEY_F8:"F8.png",KEY_F9:"F9.png",KEY_F10:"F10.png",KEY_F11:"F11.png",KEY_F12:"F12.png",KEY_PAGE_DOWN:"PAGE_DOWN.png",KEY_PAGE_UP:"PAGE_UP.png",KEY_CTRL:"CTRL.png",KEY_DEL:"DEL.png",KEY_END:"END.png",KEY_ENTER:"ENTER.png",KEY_ESC:"ESC.png",KEY_HOME:"HOME.png",KEY_INSERT:"INS.png",KEY_PLUS:"PLUS.png",KEY_MINUS:"MINUS.png",KEY_QUOTATION:"QUOTE.png",KEY_SHIFT:"SHIFT.png",KEY_SPACE:"SPACE.png",KEY_TAB:"TAB.png",KEY_TILDE:"TILDE.png",KEY_ARROW_UP:"KEY_ARROW_UP.png",KEY_ARROW_DOWN:"KEY_ARROW_DOWN.png",KEY_ARROW_LEFT:"KEY_ARROW_LEFT.png",KEY_ARROW_RIGHT:"KEY_ARROW_RIGHT.png",KEY_LEFT_BRACKET:"LEFT_BRACKET.png",KEY_RIGHT_BRACKET:"RIGHT_BRACKET.png",KEY_SEMICOLON:"SEMICOLON.png",KEY_COMMA:"COMMA.png",KEY_PERIOD:"PERIOD.png",KEY_BACK_SLASH:"BACK_SLASH.png",KEY_FORWARD_SLASH:"FORWARD_SLASH.png",KEY_BACKSPACE:"BACK.png",KEY_ALT:"ALT.png"},settings:{[oe.Button_Up]:I.UP,[oe.Button_Down]:I.DOWN,[oe.Button_Left]:I.LEFT,[oe.Button_Right]:I.RIGHT,[oe.Button_Submit]:I.SUBMIT,[oe.Button_Action]:I.ACTION,[oe.Button_Cancel]:I.CANCEL,[oe.Button_Menu]:I.MENU,[oe.Button_Stats]:I.STATS,[oe.Button_Cycle_Shiny]:I.CYCLE_SHINY,[oe.Button_Cycle_Form]:I.CYCLE_FORM,[oe.Button_Cycle_Gender]:I.CYCLE_GENDER,[oe.Button_Cycle_Ability]:I.CYCLE_ABILITY,[oe.Button_Cycle_Nature]:I.CYCLE_NATURE,[oe.Button_Speed_Up]:I.SPEED_UP,[oe.Button_Slow_Down]:I.SLOW_DOWN,[oe.Button_Cycle_Tera]:I.CYCLE_TERA,[oe.Alt_Button_Up]:I.UP,[oe.Alt_Button_Down]:I.DOWN,[oe.Alt_Button_Left]:I.LEFT,[oe.Alt_Button_Right]:I.RIGHT,[oe.Alt_Button_Submit]:I.SUBMIT,[oe.Alt_Button_Action]:I.ACTION,[oe.Alt_Button_Cancel]:I.CANCEL,[oe.Alt_Button_Menu]:I.MENU,[oe.Alt_Button_Stats]:I.STATS,[oe.Alt_Button_Cycle_Shiny]:I.CYCLE_SHINY,[oe.Alt_Button_Cycle_Form]:I.CYCLE_FORM,[oe.Alt_Button_Cycle_Gender]:I.CYCLE_GENDER,[oe.Alt_Button_Cycle_Ability]:I.CYCLE_ABILITY,[oe.Alt_Button_Cycle_Nature]:I.CYCLE_NATURE,[oe.Alt_Button_Speed_Up]:I.SPEED_UP,[oe.Alt_Button_Slow_Down]:I.SLOW_DOWN,[oe.Alt_Button_Cycle_Tera]:I.CYCLE_TERA},default:{KEY_ARROW_UP:oe.Button_Up,KEY_ARROW_DOWN:oe.Button_Down,KEY_ARROW_LEFT:oe.Button_Left,KEY_ARROW_RIGHT:oe.Button_Right,KEY_ENTER:oe.Button_Submit,KEY_SPACE:oe.Button_Action,KEY_BACKSPACE:oe.Button_Cancel,KEY_ESC:oe.Button_Menu,KEY_C:oe.Button_Stats,KEY_R:oe.Button_Cycle_Shiny,KEY_F:oe.Button_Cycle_Form,KEY_G:oe.Button_Cycle_Gender,KEY_E:oe.Button_Cycle_Ability,KEY_N:oe.Button_Cycle_Nature,KEY_V:oe.Button_Cycle_Tera,KEY_PLUS:-1,KEY_MINUS:-1,KEY_A:oe.Alt_Button_Left,KEY_B:-1,KEY_D:oe.Alt_Button_Right,KEY_H:-1,KEY_I:-1,KEY_J:-1,KEY_K:-1,KEY_L:-1,KEY_M:oe.Alt_Button_Menu,KEY_O:-1,KEY_P:-1,KEY_Q:-1,KEY_S:oe.Alt_Button_Down,KEY_T:oe.Alt_Button_Cycle_Form,KEY_U:-1,KEY_W:oe.Alt_Button_Up,KEY_X:oe.Alt_Button_Cancel,KEY_Y:oe.Alt_Button_Cycle_Shiny,KEY_Z:oe.Alt_Button_Action,KEY_0:-1,KEY_1:-1,KEY_2:-1,KEY_3:-1,KEY_4:-1,KEY_5:-1,KEY_6:-1,KEY_7:-1,KEY_8:-1,KEY_9:-1,KEY_CTRL:-1,KEY_DEL:-1,KEY_END:-1,KEY_F1:-1,KEY_F2:-1,KEY_F3:-1,KEY_F4:-1,KEY_F5:-1,KEY_F6:-1,KEY_F7:-1,KEY_F8:-1,KEY_F9:-1,KEY_F10:-1,KEY_F11:-1,KEY_F12:-1,KEY_HOME:-1,KEY_INSERT:-1,KEY_PAGE_DOWN:oe.Button_Slow_Down,KEY_PAGE_UP:oe.Button_Speed_Up,KEY_QUOTATION:-1,KEY_SHIFT:oe.Alt_Button_Stats,KEY_TAB:-1,KEY_TILDE:-1,KEY_LEFT_BRACKET:-1,KEY_RIGHT_BRACKET:-1,KEY_SEMICOLON:-1,KEY_ALT:-1},blacklist:["KEY_ENTER","KEY_ESC","KEY_SPACE","KEY_BACKSPACE","KEY_ARROW_UP","KEY_ARROW_DOWN","KEY_ARROW_LEFT","KEY_ARROW_RIGHT","KEY_DEL","KEY_HOME"]},ka=class ka extends Ii{constructor(e=null){var i,r;super(e),this.setSetting=$h,this.titleSelected="Keyboard",this.setting=oe,this.settingDeviceDefaults=Zh,this.settingDeviceOptions=qh,this.configs=[$n],this.commonSettingsCount=0,this.textureOverride="keyboard",this.localStoragePropertyName="settingsKeyboard",this.settingBlacklisted=Qh,this.device=Se.KEYBOARD;const t=(i=n.input.keyboard)==null?void 0:i.addKey(Phaser.Input.Keyboard.KeyCodes.DELETE),s=(r=n.input.keyboard)==null?void 0:r.addKey(Phaser.Input.Keyboard.KeyCodes.HOME);t==null||t.on("up",this.onDeleteDown,this),s==null||s.on("up",this.onHomeDown,this)}setup(){super.setup(),this.layout.noKeyboard=new Map;const e=n.add.container(0,0);e.setVisible(!1);const t=V(8,28,S.t("settings:keyboardPleasePress"),x.SETTINGS_LABEL);t.setOrigin(0,0),e.add(t),this.settingsContainer.add(e);const s=n.add.sprite(0,0,"keyboard");s.setOrigin(0,-.1),s.setPositionRelative(this.actionsBg,this.navigationContainer.width-260,4),this.navigationIcons.BUTTON_DELETE=s;const i=V(0,0,S.t("settings:delete"),x.SETTINGS_LABEL);i.setOrigin(0,.15),i.setPositionRelative(s,-i.width/6-2,0),this.settingsContainer.add(s),this.settingsContainer.add(i),this.layout.noKeyboard.optionsContainer=e,this.layout.noKeyboard.label=t}onHomeDown(){[L.SETTINGS_KEYBOARD,L.SETTINGS_GAMEPAD].includes(n.ui.getMode())&&(n.gameData.resetMappingToFactory(),ot.getInstance().updateIcons())}onDeleteDown(){if(n.ui.getMode()!==L.SETTINGS_KEYBOARD)return;const e=this.cursor+this.scrollCursor,t=this.settingLabels[e].text,s=dh(t),i=oe[s],r=this.getActiveConfig();ku(this.getActiveConfig(),i)&&(this.saveCustomKeyboardMappingToLocalStorage(r),this.updateBindings(),ot.getInstance().updateIcons())}setLayout(e){return e?super.setLayout(e):(this.layout.noKeyboard.optionsContainer.setVisible(!0),!1)}updateChosenKeyboardDisplay(){this.updateBindings();for(const[e,t]of Object.keys(this.setting).entries())if(this.setting[t]===this.setting.Default_Layout)for(const i of Object.keys(this.layout))i!=="noKeyboard"&&this.layout[i].optionValueLabels[e][0].setText(vl(n.inputController.selectedDevice[Se.KEYBOARD],22))}saveCustomKeyboardMappingToLocalStorage(e){var t;n.gameData.saveMappingConfigs((t=n.inputController)==null?void 0:t.selectedDevice[Se.KEYBOARD],e)}saveSettingToLocalStorage(e,t){this.setting[e]!==this.setting.Default_Layout&&n.gameData.saveControlSetting(this.device,this.localStoragePropertyName,e,this.settingDeviceDefaults,t)}};p(ka,"SettingsKeyboardUiHandler");let Oi=ka;const Ma=class Ma extends wi{constructor(e=null){var t;super(e),(t=n.input.keyboard)==null||t.on("keydown",this.onKeyDown,this)}setup(){super.setup(),this.newButtonIcon=n.add.sprite(0,0,"keyboard"),this.newButtonIcon.setPositionRelative(this.optionSelectBg,78,32),this.newButtonIcon.setOrigin(.5),this.newButtonIcon.setVisible(!1),this.actionLabel=V(0,0,"Assign button",x.SETTINGS_LABEL),this.actionLabel.setOrigin(0,.5),this.actionLabel.setPositionRelative(this.actionBg,this.actionBg.width-80,this.actionBg.height/2),this.actionsContainer.add(this.actionLabel),this.optionSelectContainer.add(this.newButtonIcon)}getSelectedDevice(){var e;return(e=n.inputController)==null?void 0:e.selectedDevice[Se.KEYBOARD]}onKeyDown(e){const t=[Phaser.Input.Keyboard.KeyCodes.UP,Phaser.Input.Keyboard.KeyCodes.DOWN,Phaser.Input.Keyboard.KeyCodes.LEFT,Phaser.Input.Keyboard.KeyCodes.RIGHT,Phaser.Input.Keyboard.KeyCodes.HOME,Phaser.Input.Keyboard.KeyCodes.ENTER,Phaser.Input.Keyboard.KeyCodes.ESC,Phaser.Input.Keyboard.KeyCodes.DELETE],s=e.keyCode;if(!this.listening||this.buttonPressed!==null||t.includes(s))return;const i=n.inputController.getActiveConfig(Se.KEYBOARD),r=cs(i,s),a=i.icons[r];a&&(this.buttonPressed=s,this.onInputDown(a,null,"keyboard"))}swapAction(){const e=n.inputController.getActiveConfig(Se.KEYBOARD);return n.inputController.assignBinding(e,this.target,this.buttonPressed)?(n.gameData.saveMappingConfigs(this.getSelectedDevice(),e),!0):!1}};p(Ma,"KeyboardBindingUiHandler");let Zn=Ma;const La=class La extends Ns{constructor(e=null){super(Hr.DISPLAY,e),this.title="Display";const t=this.settings.findIndex(s=>s.key===ts.Language);if(t>=0)switch(localStorage.getItem("prLang")){case"en":this.settings[t].options[0]={value:"English",label:"English"};break;case"es-ES":this.settings[t].options[0]={value:"Espaol (ES)",label:"Espaol (ES)"};break;case"es-MX":this.settings[t].options[0]={value:"Espaol (LATAM)",label:"Espaol (LATAM)"};break;case"it":this.settings[t].options[0]={value:"Italiano",label:"Italiano"};break;case"fr":this.settings[t].options[0]={value:"Franais",label:"Franais"};break;case"de":this.settings[t].options[0]={value:"Deutsch",label:"Deutsch"};break;case"pt-BR":this.settings[t].options[0]={value:"Portugus (BR)",label:"Portugus (BR)"};break;case"zh-CN":this.settings[t].options[0]={value:"",label:""};break;case"zh-TW":this.settings[t].options[0]={value:"",label:""};break;case"ko":case"ko-KR":this.settings[t].options[0]={value:"",label:""};break;case"ja":this.settings[t].options[0]={value:"",label:""};break;case"ca-ES":this.settings[t].options[0]={value:"Catal",label:"Catal"};break;default:this.settings[t].options[0]={value:"English",label:"English"};break}this.localStorageKey="settings"}};p(La,"SettingsDisplayUiHandler");let Ai=La;const Da=class Da extends Ns{constructor(e=null){super(Hr.AUDIO,e),this.title="Audio",this.localStorageKey="settings",this.rowsToDisplay=6}};p(Da,"SettingsAudioUiHandler");let ki=Da;const Pa=class Pa extends Yt{getModalTitle(e){return S.t("menu:renamePokemon")}getWidth(e){return 160}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return[S.t("menu:rename"),S.t("menu:cancel")]}getReadableErrorMessage(e){const t=e==null?void 0:e.indexOf(":");return t>0&&(e=e.slice(0,t)),super.getReadableErrorMessage(e)}getInputFieldConfigs(){return[{label:S.t("menu:nickname")}]}show(e){if(super.show(e)){const t=e[0];return e[1]&&typeof e[1].getNameToRender=="function"?this.inputs[0].text=e[1].getNameToRender(!1):this.inputs[0].text=e[1],this.submitAction=s=>{this.sanitizeInputs();const i=btoa(unescape(encodeURIComponent(this.inputs[0].text)));return t.buttonActions[0](i),!0},!0}return!1}};p(Pa,"RenameFormUiHandler");let qn=Pa;const Ba=class Ba extends Nl{constructor(e,t=115,s=9){super(t,s),this.pokemonListContainer=e}setup(){super.setup(),super.changeToEggSummaryLayout(),this.currentPokemonSprite=n.add.sprite(54,80,"pkmn__sub"),this.currentPokemonSprite.setScale(.8),this.currentPokemonSprite.setPipeline(n.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.pokemonListContainer.add(this.currentPokemonSprite),this.pokemonNumberText=V(80,107.5,"0000",x.SUMMARY,{fontSize:74}),this.pokemonNumberText.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonNumberText),this.pokemonNameText=V(7,107.5,"",x.SUMMARY,{fontSize:74}),this.pokemonNameText.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonNameText),this.pokemonHatchedIcon=n.add.sprite(-5,90,"egg_icons"),this.pokemonHatchedIcon.setOrigin(0,.2),this.pokemonHatchedIcon.setScale(.8),this.pokemonListContainer.add(this.pokemonHatchedIcon),this.pokemonCandyIcon=n.add.sprite(4.5,40,"candy"),this.pokemonCandyIcon.setScale(.5),this.pokemonCandyIcon.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonCandyIcon),this.pokemonCandyOverlayIcon=n.add.sprite(4.5,40,"candy_overlay"),this.pokemonCandyOverlayIcon.setScale(.5),this.pokemonCandyOverlayIcon.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonCandyOverlayIcon),this.pokemonCandyCountText=V(14,40,"x0",x.SUMMARY,{fontSize:"56px"}),this.pokemonCandyCountText.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonCandyCountText),this.pokemonEggMoveContainers=[],this.pokemonEggMoveBgs=[],this.pokemonEggMoveLabels=[],this.pokemonEggMovesContainer=n.add.container(0,200),this.pokemonEggMovesContainer.setVisible(!1),this.pokemonEggMovesContainer.setScale(.5);for(let e=0;e<4;e++){const t=n.add.container(0,0+6*e),s=n.add.nineslice(70,0,"type_bgs","unknown",92,14,2,2,2,2);s.setOrigin(1,0);const i=V(70-s.width/2,0,"???",x.PARTY);i.setOrigin(.5,0),this.pokemonEggMoveBgs.push(s),this.pokemonEggMoveLabels.push(i),t.add(s),t.add(i),t.setScale(.44),this.pokemonEggMoveContainers.push(t),this.pokemonEggMovesContainer.add(t)}super.add(this.pokemonEggMoveContainers)}hideDisplayPokemon(){this.currentPokemonSprite.setVisible(!1)}displayPokemon(e){const t=e.species,s=e.gender===kt.FEMALE,i=e.formIndex,r=e.shiny,a=e.variant;this.currentPokemonSprite.setVisible(!1),t.loadAssets(s,i,r,a,!0).then(()=>{Ct(t.speciesId,e.formIndex).cry(),this.currentPokemonSprite.play(t.getSpriteKey(s,i,r,a)),this.currentPokemonSprite.setPipelineData("shiny",r),this.currentPokemonSprite.setPipelineData("variant",a),this.currentPokemonSprite.setPipelineData("spriteKey",t.getSpriteKey(s,i,r,a)),this.currentPokemonSprite.setVisible(!0)})}showHatchInfo(e){this.pokemonEggMovesContainer.setVisible(!0);const t=e.pokemon,s=t.species;this.displayPokemon(t),super.show(t,!1,1,e.getDex(),e.getStarterEntry(),!0);const i=Ye[s.speciesId];this.pokemonCandyIcon.setTint(pt(it(i[0]))),this.pokemonCandyIcon.setVisible(!0),this.pokemonCandyOverlayIcon.setTint(pt(it(i[1]))),this.pokemonCandyOverlayIcon.setVisible(!0),this.pokemonCandyCountText.setText(`x${n.gameData.starterData[s.speciesId].candyCount}`),this.pokemonCandyCountText.setVisible(!0),this.pokemonNumberText.setText(Ot(s.speciesId,4)),this.pokemonNameText.setText(s.name);const r=s&&dt.hasOwnProperty(s.speciesId);for(let a=0;a<4;a++){const o=r?_e[dt[s.speciesId][a]]:null,l=o&&n.gameData.starterData[s.speciesId].eggMoves&Math.pow(2,a);this.pokemonEggMoveBgs[a].setFrame(Te[o?o.type:Te.UNKNOWN].toString().toLowerCase()),this.pokemonEggMoveLabels[a].setText(o&&l?o.name:"???"),!(o&&e.starterDataEntryBeforeUpdate.eggMoves&Math.pow(2,a))&&l&&this.pokemonEggMoveLabels[a].setText("(+) "+o.name)}this.pokemonEggMovesContainer.setVisible(!0),s.speciesId===ge.MANAPHY||s.speciesId===ge.PHIONE?this.pokemonHatchedIcon.setFrame("manaphy"):this.pokemonHatchedIcon.setFrame(Qt(s))}};p(Ba,"PokemonHatchInfoContainer");let Qn=Ba;const Ra=class Ra extends Phaser.GameObjects.Container{constructor(e,t,s){super(n,e,t);const i=s.pokemon;this.species=i.species;const r=2,a=12,o=i.species,l=i.gender===kt.FEMALE,h=i.formIndex,c=i.variant,d=i.shiny,f=n.add.sprite(-2,r,o.getIconAtlasKey(h,d,c));f.setScale(.5),f.setOrigin(0,0),f.setFrame(o.getIconId(l,h,d,c)),this.icon=f,this.checkIconId(l,h,d,c),this.add(this.icon),this.shinyIcon=n.add.image(a,r,"shiny_star_small"),this.shinyIcon.setOrigin(0,0),this.shinyIcon.setScale(.5),this.add(this.shinyIcon);const u=n.add.image(a,r*4,"ha_capsule");u.setOrigin(0,0),u.setScale(.5),this.hiddenAbilityIcon=u,this.add(this.hiddenAbilityIcon);const C=n.add.image(a,r*7,"icon_owned");C.setOrigin(0,0),C.setScale(.5),this.pokeballIcon=C,this.add(this.pokeballIcon);const g=n.add.image(0,r,"icon_egg_move");g.setOrigin(0,0),g.setScale(.5),this.eggMoveIcon=g,this.add(this.eggMoveIcon)}updateAndAnimate(e,t){const s=e.pokemon;this.species=s.species;const r=e.dexEntryBeforeUpdate.caughtAttr,a=BigInt(1<<(s.shiny?1:0)),o=BigInt(1<<s.variant+4),l=(a&r)===BigInt(0)||(o&r)===BigInt(0),h=(BigInt(1<<s.formIndex)*Z.DEFAULT_FORM&r)===BigInt(0),c=s.gender===kt.FEMALE,d=s.formIndex,f=s.variant,u=s.shiny;this.icon.setTexture(this.species.getIconAtlasKey(d,u,f)),this.icon.setFrame(this.species.getIconId(c,d,u,f)),this.checkIconId(c,d,u,f),this.shinyIcon.setVisible(s.shiny),this.shinyIcon.setTint($e(s.variant)),this.eggMoveIcon.setVisible(e.eggMoveUnlocked),this.hiddenAbilityIcon.setVisible(s.abilityIndex===2),this.pokeballIcon.setVisible(!r||h),!r||l||h?t.addOrUpdate(this.icon,Ze.PASSIVE):t.addOrUpdate(this.icon,Ze.NONE)}checkIconId(e,t,s,i){this.icon.frame.name!==this.species.getIconId(e,t,s,i)&&(console.log(`${this.species.name}'s variant icon does not exist. Replacing with default.`),this.icon.setTexture(this.species.getIconAtlasKey(t,!1,i)),this.icon.setFrame(this.species.getIconId(e,t,!1,i)))}};p(Ra,"HatchedPokemonContainer");let Jn=Ra;const hn=112,cn=9,ni=9,Rt=11,Cs=18,Na=class Na extends at{constructor(){super(L.EGG_HATCH_SUMMARY),this.eventTarget=new EventTarget}setup(){const e=this.getUi();this.summaryContainer=n.add.container(0,-n.game.canvas.height/6),this.summaryContainer.setVisible(!1),e.add(this.summaryContainer),this.eggHatchContainer=n.add.container(0,-n.game.canvas.height/6),this.eggHatchContainer.setVisible(!1),e.add(this.eggHatchContainer),this.iconAnimHandler=new Yi,this.iconAnimHandler.setup(),this.eggHatchBg=n.add.image(0,0,"egg_summary_bg"),this.eggHatchBg.setOrigin(0,0),this.eggHatchContainer.add(this.eggHatchBg),this.cursorObj=n.add.image(0,0,"select_cursor"),this.cursorObj.setOrigin(0,0),this.summaryContainer.add(this.cursorObj),this.pokemonContainers=[],this.pokemonIconsContainer=n.add.container(hn,cn),this.summaryContainer.add(this.pokemonIconsContainer),this.infoContainer=new Qn(this.summaryContainer),this.infoContainer.setup(),this.infoContainer.changeToEggSummaryLayout(),this.infoContainer.setVisible(!0),this.summaryContainer.add(this.infoContainer);const t=new _t(hn+Rt*Cs,cn+3,4,n.game.canvas.height/6-20,ni);this.summaryContainer.add(t),this.scrollGridHandler=new xi(this,ni,Rt).withScrollBar(t).withUpdateGridCallBack(()=>this.updatePokemonIcons()).withUpdateSingleElementCallback(s=>this.infoContainer.showHatchInfo(this.eggHatchData[s])),this.cursor=-1}clear(){super.clear(),this.scrollGridHandler.reset(),this.cursor=-1,this.summaryContainer.setVisible(!1),this.pokemonIconsContainer.removeAll(!0),this.pokemonContainers=[],this.eggHatchBg.setVisible(!1),this.getUi().hideTooltip();const e=n.getActiveKeys();Object.keys(n.anims.anims.entries).forEach(i=>{i.startsWith("pkmn__")&&!e.includes(i)&&n.anims.remove(i)}),Object.keys(n.cache.audio.entries.entries).forEach(i=>{i.startsWith("cry/")&&!e.includes(i)&&delete n.cache.audio.entries.entries[i]}),this.eggHatchData.length=0,this.iconAnimHandler.removeAll()}show(e){super.show(e),e.length>=1&&(this.eggHatchData=e[0].sort(p(function(i,r){const a=i.pokemon.species,o=r.pokemon.species;return Qt(a)<Qt(o)?-1:Qt(a)>Qt(o)?1:a.speciesId<o.speciesId?-1:a.speciesId>o.speciesId?1:0},"sortHatchData"))),this.getUi().bringToTop(this.summaryContainer),this.summaryContainer.setVisible(!0),this.eggHatchContainer.setVisible(!0),this.eggHatchBg.setVisible(!0),this.infoContainer.hideDisplayPokemon(),this.scrollGridHandler.setTotalElements(this.eggHatchData.length),this.updatePokemonIcons(),this.setCursor(0),n.playSoundWithoutBgm("evolution_fanfare");const t=n.eggSkipPreference===2?2e3:1e3;return this.blockExit=!0,n.time.delayedCall(t,()=>this.blockExit=!1),!0}updatePokemonIcons(){const e=this.scrollGridHandler.getItemOffset(),t=Math.min(ni*Rt,this.eggHatchData.length-e);for(let s=0;s<ni*Rt;s++){const i=this.eggHatchData[s+e];let r=this.pokemonContainers[s];if(s<t){if(!r){const a=s%Rt*Cs,o=Math.floor(s/Rt)*Cs;r=new Jn(a,o,i).setVisible(!1),this.pokemonContainers.push(r),this.pokemonIconsContainer.add(r)}r.setVisible(!0),r.updateAndAnimate(i,this.iconAnimHandler)}else r&&(r.setVisible(!1),this.iconAnimHandler.addOrUpdate(r.icon,Ze.NONE))}}processInput(e){const t=this.getUi();let s=!1,i=!1;if(e===I.CANCEL)if(this.blockExit)i=!0;else{const r=n.getCurrentPhase();r instanceof Jh&&r.end(),s=!0}else this.scrollGridHandler.processInput(e);return s?t.playSelect():i&&t.playError(),s||i}setCursor(e){let t=!1;const s=this.cursor;return t=super.setCursor(e),t&&(this.cursorObj.setPosition(hn-1+Cs*(e%Rt),cn+1+Cs*Math.floor(e/Rt)),s>-1&&this.iconAnimHandler.addOrUpdate(this.pokemonContainers[s].icon,Ze.NONE),this.iconAnimHandler.addOrUpdate(this.pokemonContainers[e].icon,Ze.ACTIVE),this.infoContainer.showHatchInfo(this.eggHatchData[e+this.scrollGridHandler.getItemOffset()])),t}};p(Na,"EggSummaryUiHandler");let er=Na;const Fa=class Fa extends Yt{constructor(e){super(e)}setup(){super.setup();const e=p((i,r,a)=>Object.keys(i??{}).map((o,l)=>{const h=Object.values(i)[l];if(typeof h=="object"&&!ve(h))return e(h,r??o,r?a?[...a,o]:[o]:void 0).filter(c=>c.length>0);if(typeof h=="string"||ve(h))return a?`${r}:${a.map(c=>c).join(".")}.${o}`:`${r}:${o}`}).filter(o=>o),"flattenKeys"),s=e(S.getDataByLanguage(String(S.resolvedLanguage))).filter(i=>i.length>0).flat(Number.POSITIVE_INFINITY).map(String);this.keys=s}getModalTitle(e){return"Test Dialogue"}getWidth(e){return 300}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return["Check","Cancel"]}getReadableErrorMessage(e){const t=e==null?void 0:e.indexOf(":");return t>0&&(e=e.slice(0,t)),super.getReadableErrorMessage(e)}getInputFieldConfigs(){return[{label:"Dialogue"}]}show(e){const t=this.getUi(),s=!!this.getModalTitle();this.updateFields(this.getInputFieldConfigs(),s),this.updateContainer(e[0]);const i=this.inputs[0];if(i.setMaxLength(255),i.on("keydown",(r,a)=>{["escape","space"].some(o=>o===a.key.toLowerCase()||o===a.code.toLowerCase())&&t.getMode()===L.AUTO_COMPLETE&&(r.on("blur",()=>r.node.focus(),{once:!0}),t.revertMode())}),i.on("textchange",(r,a)=>{t.getMode()===L.AUTO_COMPLETE&&t.revertMode();let o=[];const l=r.text.split(" "),h=this.keys.filter(c=>c.toLowerCase().includes(l[l.length-1].toLowerCase()));if(r.text!==""&&h.length>0&&(o=h.slice(0).map(c=>({label:c,handler:p(()=>{var d;if(!ve(a.data)||((d=a.inputType)==null?void 0:d.toLowerCase())==="deletecontentbackward"){const f=r.text.split(" ");f[f.length-1]=c,r.setText(f.join(" "))}return t.revertMode(),!0},"handler")}))),o.length>0){const c={options:o,maxOptions:5,modalContainer:this.modalContainer};t.setOverlayMode(L.AUTO_COMPLETE,c)}}),super.show(e)){const r=e[0];return this.inputs[0].resize(1150,116),this.inputContainers[0].list[0].width=200,e[1]&&typeof e[1].getNameToRender=="function"?this.inputs[0].text=e[1].getNameToRender():this.inputs[0].text=e[1],this.submitAction=a=>{if(t.getMode()===L.TEST_DIALOGUE){this.sanitizeInputs();const o=btoa(unescape(encodeURIComponent(this.inputs[0].text)));return r.buttonActions[0](o),!0}return!1},!0}return!1}};p(Fa,"TestDialogueUiHandler");let tr=Fa;const Va=class Va extends Pl{constructor(e=L.OPTION_SELECT){super(e)}getWindowWidth(){return 64}show(e){if(e[0].modalContainer){const{modalContainer:t}=e[0],s=super.show(e);return this.modalContainer=t,this.setupOptions(),s}return!1}setupOptions(){super.setupOptions(),this.modalContainer&&(this.optionSelectContainer.setSize(this.optionSelectContainer.height,Math.max(this.optionSelectText.displayWidth+24,this.getWindowWidth())),this.optionSelectContainer.setPositionRelative(this.modalContainer,this.optionSelectBg.width,this.optionSelectBg.height+50))}processInput(e){return e!==I.CANCEL&&e!==I.ACTION?super.processInput(e):!1}};p(Va,"AutoCompleteUiHandler");let sr=Va;const Ua=class Ua extends Mt{constructor(){super(L.MYSTERY_ENCOUNTER),this.optionScrollTweens=new Array(4).fill(null),this.showDexProgress=!1,this.encounterOptions=[],this.viewPartyIndex=0,this.viewPartyXPosition=0,this.blockInput=!0}setup(){const e=this.getUi();this.cursorContainer=n.add.container(18,-38.7),this.cursorContainer.setVisible(!1),e.add(this.cursorContainer),this.optionsContainer=n.add.container(12,-38.7),this.optionsContainer.setVisible(!1),e.add(this.optionsContainer),this.dexProgressContainer=n.add.container(214,-43),this.dexProgressContainer.setVisible(!1),e.add(this.dexProgressContainer),this.descriptionContainer=n.add.container(0,-152),this.descriptionContainer.setVisible(!1),e.add(this.descriptionContainer),this.tooltipContainer=n.add.container(210,-48),this.tooltipContainer.setVisible(!1),e.add(this.tooltipContainer),this.setCursor(this.getCursor()),this.descriptionWindow=me(0,0,150,105,!1,!1,0,0,gt.THIN),this.descriptionContainer.add(this.descriptionWindow),this.tooltipWindow=me(0,0,110,48,!1,!1,0,0,gt.THIN),this.tooltipContainer.add(this.tooltipWindow),this.dexProgressWindow=me(0,0,24,28,!1,!1,0,0,gt.THIN),this.dexProgressContainer.add(this.dexProgressWindow),this.rarityBall=n.add.sprite(141,9,"pb"),this.rarityBall.setScale(.75),this.descriptionContainer.add(this.rarityBall);const t=n.add.sprite(12,10,"encounter_radar");t.setScale(.8),this.dexProgressContainer.add(t),this.dexProgressContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,24,28),Phaser.Geom.Rectangle.Contains)}show(e){var a,o,l,h;super.show(e),this.overrideSettings=e[0]??{};const t=ve((a=this.overrideSettings)==null?void 0:a.hideDescription)?!0:!this.overrideSettings.hideDescription,s=ve((o=this.overrideSettings)==null?void 0:o.slideInDescription)?!0:this.overrideSettings.slideInDescription,i=((l=this.overrideSettings)==null?void 0:l.startingCursorIndex)??0;this.cursorContainer.setVisible(!0),this.descriptionContainer.setVisible(t),this.optionsContainer.setVisible(!0),this.dexProgressContainer.setVisible(!0),this.displayEncounterOptions(s);const r=this.getCursor();return r===(((h=this.optionsContainer)==null?void 0:h.length)||0)-1?this.setCursor(r):this.setCursor(i),this.blockInput&&setTimeout(()=>{this.unblockInput()},1e3),this.displayOptionTooltip(),!0}processInput(e){var r;const t=this.getUi();let s=!1;const i=this.getCursor();if(e===I.CANCEL||e===I.ACTION){if(e===I.ACTION){const a=this.encounterOptions[i];if(i===this.viewPartyIndex){s=!0;const o={...this.overrideSettings,slideInDescription:!1};n.ui.setMode(L.PARTY,Fl.CHECK,-1,()=>{n.ui.setMode(L.MYSTERY_ENCOUNTER,o),setTimeout(()=>{this.setCursor(this.viewPartyIndex),this.unblockInput()},300)})}else this.blockInput||!this.optionsMeetsReqs[i]&&(a.optionMode===St.DISABLED_OR_DEFAULT||a.optionMode===St.DISABLED_OR_SPECIAL)?s=!1:n.getCurrentPhase().handleOptionSelect(a,i)?s=!0:t.playError()}}else{switch((r=this.optionsContainer.getAll())==null?void 0:r.length){default:case 3:s=this.handleTwoOptionMoveInput(e);break;case 4:s=this.handleThreeOptionMoveInput(e);break;case 5:s=this.handleFourOptionMoveInput(e);break}this.displayOptionTooltip()}return s&&t.playSelect(),s}handleTwoOptionMoveInput(e){let t=!1;const s=this.getCursor();switch(e){case I.UP:s<this.viewPartyIndex&&(t=this.setCursor(this.viewPartyIndex));break;case I.DOWN:s===this.viewPartyIndex&&(t=this.setCursor(1));break;case I.LEFT:s>0&&(t=this.setCursor(s-1));break;case I.RIGHT:s<this.viewPartyIndex&&(t=this.setCursor(s+1));break}return t}handleThreeOptionMoveInput(e){let t=!1;const s=this.getCursor();switch(e){case I.UP:s===2?t=this.setCursor(s-2):t=this.setCursor(this.viewPartyIndex);break;case I.DOWN:s===this.viewPartyIndex?t=this.setCursor(1):t=this.setCursor(2);break;case I.LEFT:s===this.viewPartyIndex?t=this.setCursor(1):s===1&&(t=this.setCursor(s-1));break;case I.RIGHT:s===1?t=this.setCursor(this.viewPartyIndex):s<1&&(t=this.setCursor(s+1));break}return t}handleFourOptionMoveInput(e){let t=!1;const s=this.getCursor();switch(e){case I.UP:s>=2&&s!==this.viewPartyIndex?t=this.setCursor(s-2):t=this.setCursor(this.viewPartyIndex);break;case I.DOWN:s<=1?t=this.setCursor(s+2):s===this.viewPartyIndex&&(t=this.setCursor(1));break;case I.LEFT:s===this.viewPartyIndex?t=this.setCursor(1):s%2===1&&(t=this.setCursor(s-1));break;case I.RIGHT:s===1?t=this.setCursor(this.viewPartyIndex):s%2===0&&s!==this.viewPartyIndex&&(t=this.setCursor(s+1));break}return t}unblockInput(){if(this.blockInput){this.blockInput=!1;for(let e=0;e<this.optionsContainer.length-1;e++){const t=this.encounterOptions[e].optionMode;!this.optionsMeetsReqs[e]&&(t===St.DISABLED_OR_DEFAULT||t===St.DISABLED_OR_SPECIAL)||this.optionsContainer.getAt(e).setAlpha(1)}}}getCursor(){return this.cursor?this.cursor:0}setCursor(e){var i,r,a,o;const s=this.getCursor()!==e;return s&&(this.cursor=e),this.viewPartyIndex=((i=this.optionsContainer.getAll())==null?void 0:i.length)-1,this.cursorObj||(this.cursorObj=n.add.image(0,0,"cursor"),this.cursorContainer.add(this.cursorObj)),e===this.viewPartyIndex?this.cursorObj.setPosition(this.viewPartyXPosition,-17):((r=this.optionsContainer.getAll())==null?void 0:r.length)===3?this.cursorObj.setPosition(-10.5+(e%2===1?100:0),15):((a=this.optionsContainer.getAll())==null?void 0:a.length)===4?this.cursorObj.setPosition(-10.5+(e%2===1?100:0),7+(e>1?16:0)):((o=this.optionsContainer.getAll())==null?void 0:o.length)===5&&this.cursorObj.setPosition(-10.5+(e%2===1?100:0),7+(e>1?16:0)),s}displayEncounterOptions(e=!0){var g,v,m,b;this.getUi().clearText();const t=n.currentBattle.mysteryEncounter;this.encounterOptions=((g=this.overrideSettings)==null?void 0:g.overrideOptions)??t.options,this.optionsMeetsReqs=[];const s=zt((v=t.dialogue.encounterOptionsDialogue)==null?void 0:v.title,x.TOOLTIP_TITLE),i=zt((m=t.dialogue.encounterOptionsDialogue)==null?void 0:m.description,x.TOOLTIP_CONTENT),r=zt((b=t.dialogue.encounterOptionsDialogue)==null?void 0:b.query,x.TOOLTIP_CONTENT);this.optionsContainer.removeAll(!0);for(let E=0;E<this.encounterOptions.length;E++){const w=this.encounterOptions[E];let _;switch(this.encounterOptions.length){default:case 2:_=yt(E%2===0?0:100,8,"-",x.WINDOW,{fontSize:"80px",lineSpacing:-8});break;case 3:_=yt(E%2===0?0:100,E<2?0:16,"-",x.WINDOW,{fontSize:"80px",lineSpacing:-8});break;case 4:_=yt(E%2===0?0:100,E<2?0:16,"-",x.WINDOW,{fontSize:"80px",lineSpacing:-8});break}this.optionsMeetsReqs.push(w.meetsRequirements());const A=w.dialogue,D=!this.optionsMeetsReqs[E]&&A.disabledButtonLabel?A.disabledButtonLabel:A.buttonLabel;let j;w.hasRequirements()&&this.optionsMeetsReqs[E]&&(w.optionMode===St.DEFAULT_OR_SPECIAL||w.optionMode===St.DISABLED_OR_SPECIAL)?j=zt(D,x.ME_OPTION_SPECIAL):j=zt(D,A.style?A.style:x.ME_OPTION_DEFAULT),j&&_.setText(j),!this.optionsMeetsReqs[E]&&(w.optionMode===St.DISABLED_OR_DEFAULT||w.optionMode===St.DISABLED_OR_SPECIAL)&&_.setAlpha(.5),this.blockInput&&_.setAlpha(.5);const B=90,$=n.make.graphics({});$.setScale(6),$.fillStyle(16777215),$.beginPath(),$.fillRect(_.x+11,_.y+140,B,18);const ie=$.createGeometryMask();_.setMask(ie);const k=_.displayWidth,U=this.optionScrollTweens[E];U&&(U.remove(),this.optionScrollTweens[E]=null),k>B&&(this.optionScrollTweens[E]=n.tweens.add({targets:_,delay:ye(2e3),loop:-1,hold:ye(2e3),duration:ye((k-B)/15*2e3),x:`-=${k-B}`})),this.optionsContainer.add(_)}const a=yt(n.game.canvas.width/6,-24,zi(S.t("mysteryEncounterMessages:view_party_button"),x.PARTY),x.PARTY);this.optionsContainer.add(a),a.x-=a.displayWidth+16,this.viewPartyXPosition=a.x-10;const o=yt(0,0,s??"",x.TOOLTIP_TITLE,{wordWrap:{width:750},align:"center",lineSpacing:-8});this.descriptionContainer.add(o),o.setPosition(72-o.displayWidth/2,5.5);const l=t.encounterTier===Ve.COMMON?0:t.encounterTier===Ve.GREAT?1:t.encounterTier===Ve.ULTRA?2:t.encounterTier===Ve.ROGUE?3:4,h=bn(l);this.rarityBall.setTexture("pb",h);const c=yt(6,25,i??"",x.TOOLTIP_CONTENT,{wordWrap:{width:830}}),d=n.make.graphics({});d.setScale(6),d.fillStyle(16777215),d.beginPath(),d.fillRect(6,53,206,57);const f=d.createGeometryMask();c.setMask(f);const u=Math.floor(c.displayHeight/10);this.descriptionScrollTween&&(this.descriptionScrollTween.remove(),this.descriptionScrollTween=void 0),u>6&&(this.descriptionScrollTween=n.tweens.add({targets:c,delay:ye(2e3),loop:-1,hold:ye(2e3),duration:ye((u-6)*2e3),y:`-=${10*(u-6)}`})),this.descriptionContainer.add(c);const C=yt(0,0,r??"",x.TOOLTIP_CONTENT,{wordWrap:{width:830}});this.descriptionContainer.add(C),C.setPosition(75-C.displayWidth/2,90),e&&(this.descriptionContainer.x-=150,n.tweens.add({targets:this.descriptionContainer,x:"+=150",ease:"Sine.easeInOut",duration:1e3}))}displayOptionTooltip(){const e=this.getCursor();if(this.tooltipContainer.length>1&&this.tooltipContainer.removeBetween(1,this.tooltipContainer.length,!0),this.tooltipContainer.setVisible(!0),ve(e)||e>this.optionsContainer.length-2){this.showHideDexProgress(!1);return}let t;const s=this.encounterOptions[e],i=s.dialogue;if(!this.optionsMeetsReqs[e]&&(s.optionMode===St.DISABLED_OR_DEFAULT||s.optionMode===St.DISABLED_OR_SPECIAL)&&i.disabledButtonTooltip?t=zt(i.disabledButtonTooltip,x.TOOLTIP_CONTENT):t=zt(i.buttonTooltip,x.TOOLTIP_CONTENT),t){const r=[...t.match(new RegExp(/\[color=[^\[]*\]\[shadow=[^\[]*\]/i))][0];t=t.replace(/(\(\+\)[^\(\[]*)/gi,a=>"[/color][/shadow]"+zi(a,x.SUMMARY_GREEN)+"[/color][/shadow]"+r),t=t.replace(/(\(\-\)[^\(\[]*)/gi,a=>"[/color][/shadow]"+zi(a,x.SUMMARY_BLUE)+"[/color][/shadow]"+r)}if(t){const r=yt(6,7,t,x.TOOLTIP_CONTENT,{wordWrap:{width:600},fontSize:"72px"});this.tooltipContainer.add(r);const a=n.make.graphics({});a.setScale(6),a.fillStyle(16777215),a.beginPath(),a.fillRect(this.tooltipContainer.x,this.tooltipContainer.y+188.5,150,32);const o=a.createGeometryMask();r.setMask(o);const l=Math.floor(r.displayHeight/11.2);this.tooltipScrollTween&&(this.tooltipScrollTween.remove(),this.tooltipScrollTween=void 0),l>3&&(this.tooltipScrollTween=n.tweens.add({targets:r,delay:ye(1200),loop:-1,hold:ye(1200),duration:ye((l-3)*1200),y:`-=${11.2*(l-3)}`}))}s.hasDexProgress&&!this.showDexProgress?this.showHideDexProgress(!0):s.hasDexProgress||this.showHideDexProgress(!1)}clear(){super.clear(),this.overrideSettings=void 0,this.optionsContainer.setVisible(!1),this.optionsContainer.removeAll(!0),this.dexProgressContainer.setVisible(!1),this.descriptionContainer.setVisible(!1),this.tooltipContainer.setVisible(!1),this.descriptionContainer.removeBetween(2,this.descriptionContainer.length,!0),this.getUi().getMessageHandler().clearText(),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=void 0}showHideDexProgress(e){e&&!this.showDexProgress?(this.showDexProgress=!0,n.tweens.killTweensOf(this.dexProgressContainer),n.tweens.add({targets:this.dexProgressContainer,y:-63,ease:"Sine.easeInOut",duration:750,onComplete:p(()=>{this.dexProgressContainer.on("pointerover",()=>{n.ui.showTooltip("",S.t("mysteryEncounterMessages:affects_pokedex"),!0)}),this.dexProgressContainer.on("pointerout",()=>{n.ui.hideTooltip()})},"onComplete")})):!e&&this.showDexProgress&&(this.showDexProgress=!1,n.tweens.killTweensOf(this.dexProgressContainer),n.tweens.add({targets:this.dexProgressContainer,y:-43,ease:"Sine.easeInOut",duration:750,onComplete:p(()=>{this.dexProgressContainer.off("pointerover"),this.dexProgressContainer.off("pointerout")},"onComplete")}))}};p(Ua,"MysteryEncounterUiHandler");let ir=Ua;const Ya=class Ya extends Yt{setup(){super.setup(),this.nameKeys=Re.map(e=>e.name).filter((e,t,s)=>s.indexOf(e)===t),this.moveKeys=_e.map(e=>e.name),this.abilityKeys=Fe.map(e=>e.name)}getModalTitle(e){return S.t("pokedexUiHandler:scanChooseOption")}getWidth(e){return 300}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return[S.t("pokedexUiHandler:scanSelect"),S.t("pokedexUiHandler:scanCancel")]}getReadableErrorMessage(e){const t=e==null?void 0:e.indexOf(":");return t>0&&(e=e.slice(0,t)),super.getReadableErrorMessage(e)}getInputFieldConfigs(){switch(this.row){case Ne.NAME:return[{label:S.t("pokedexUiHandler:scanLabelName")}];case Ne.MOVE_1:case Ne.MOVE_2:return[{label:S.t("pokedexUiHandler:scanLabelMove")}];case Ne.ABILITY_1:return[{label:S.t("pokedexUiHandler:scanLabelAbility")}];case Ne.ABILITY_2:return[{label:S.t("pokedexUiHandler:scanLabelPassive")}];default:return[{label:""}]}}reduceKeys(){switch(this.row){case Ne.NAME:{this.reducedKeys=this.nameKeys;break}case Ne.MOVE_1:case Ne.MOVE_2:{this.reducedKeys=this.moveKeys;break}case Ne.ABILITY_1:case Ne.ABILITY_2:{this.reducedKeys=this.abilityKeys;break}default:this.reducedKeys=this.keys}}show(e){this.row=e[2];const t=this.getUi(),s=!!this.getModalTitle();this.updateFields(this.getInputFieldConfigs(),s),this.updateContainer(e[0]);const i=this.inputs[0];if(i.setMaxLength(255),this.reduceKeys(),setTimeout(()=>{i.setFocus()},50),i.on("keydown",(r,a)=>{["escape","space"].some(o=>o===a.key.toLowerCase()||o===a.code.toLowerCase())&&t.getMode()===L.AUTO_COMPLETE&&(r.on("blur",()=>r.node.focus(),{once:!0}),t.revertMode())}),i.on("textchange",(r,a)=>{t.getMode()===L.AUTO_COMPLETE&&t.revertMode();let o=[];const l=this.reducedKeys.filter(h=>h.toLowerCase().includes(r.text.toLowerCase()));if(r.text!==""&&l.length>0&&(o=l.slice(0).map(h=>({label:h,handler:p(()=>{var c;return(!ve(a.data)||((c=a.inputType)==null?void 0:c.toLowerCase())==="deletecontentbackward")&&r.setText(h),t.revertMode(),!0},"handler")}))),o.length>0){const h={options:o,maxOptions:5,modalContainer:this.modalContainer};t.setOverlayMode(L.AUTO_COMPLETE,h)}}),super.show(e)){const r=e[0];return this.inputs[0].resize(1150,116),this.inputContainers[0].list[0].width=200,e[1]&&typeof e[1].getNameToRender=="function"?this.inputs[0].text=e[1].getNameToRender():this.inputs[0].text=e[1],this.submitAction=a=>{if(t.getMode()===L.POKEDEX_SCAN){this.sanitizeInputs();const o=this.reducedKeys.includes(this.inputs[0].text)?this.inputs[0].text:"",l=btoa(unescape(encodeURIComponent(o)));return r.buttonActions[0](l),!0}return!1},!0}return!1}clear(){super.clear(),this.formLabels.forEach(e=>{e.destroy()})}};p(Ya,"PokedexScanUiHandler");let nr=Ya;const dn=48,rt=8,ri=6,Ri=class Ri extends Phaser.GameObjects.Container{constructor(e){super(n,e==null?void 0:e.x,e==null?void 0:e.y),this.active=!1,this.descScroll=null,this.scale=(e==null?void 0:e.scale)||1,this.setScale(this.scale),this.options=e||{},this.width=((e==null?void 0:e.width)||Ri.getWidth(this.scale))/this.scale,this.descBg=me(0,0,this.width,dn),this.descBg.setOrigin(0,0),this.add(this.descBg),this.desc=V(rt,rt-2,"",x.BATTLE_INFO,{wordWrap:{width:(this.width-(rt-2)*2)*ri}}),this.desc.setLineSpacing(S.resolvedLanguage==="ja"?25:5),this.maskPointOriginX=(e==null?void 0:e.x)||0,this.maskPointOriginY=(e==null?void 0:e.y)||0,this.maskPointOriginX<0&&(this.maskPointOriginX+=n.game.canvas.width/ri),this.maskPointOriginY<0&&(this.maskPointOriginY+=n.game.canvas.height/ri),this.textMaskRect=n.make.graphics(),this.textMaskRect.fillStyle(16711680),this.textMaskRect.fillRect(this.maskPointOriginX+rt*this.scale,this.maskPointOriginY+(rt-2)*this.scale,this.width-rt*2*this.scale,(dn-(rt-2)*2)*this.scale),this.textMaskRect.setScale(6);const t=this.createGeometryMask(this.textMaskRect);this.add(this.desc),this.desc.setMask(t),e!=null&&e.hideBg&&this.descBg.setVisible(!1),this.setVisible(!1)}show(e){if(!n.enableMoveInfo)return!1;this.desc.setText(e??""),this.descScroll&&(this.descScroll.remove(),this.descScroll=null,this.desc.y=rt-2);const t=Math.floor(this.desc.displayHeight*(96/72)/14.83),s=t>=3?48:t===2?36:24;this.textMaskRect.clear(),this.textMaskRect.fillStyle(16711680),this.textMaskRect.fillRect(this.maskPointOriginX+rt*this.scale,this.maskPointOriginY+(rt-2)*this.scale+(48-s),this.width-rt*2*this.scale,(s-(rt-2)*2)*this.scale);const i=this.createGeometryMask(this.textMaskRect);return this.desc.setMask(i),this.descBg.setSize(this.descBg.width,s),this.descBg.setY(48-s),this.desc.setY(rt-2+(48-s)),t>3&&(this.descScroll=n.tweens.add({targets:this.desc,delay:ye(2e3),loop:-1,hold:ye(2e3),duration:ye((t-3)*2e3),y:`-=${14.83*(72/96)*(t-3)}`})),this.options.delayVisibility||this.setVisible(!0),this.active=!0,!0}clear(){this.setVisible(!1),this.active=!1}toggleInfo(e){e&&this.setVisible(!0),n.tweens.add({targets:this.desc,duration:ye(125),ease:"Sine.easeInOut",alpha:e?1:0}),e||this.setVisible(!1)}isActive(){return this.active}static getWidth(e){return n.game.canvas.width/ri/2}static getHeight(e,t){return dn*e}};p(Ri,"PokedexInfoOverlay");let Mi=Ri;const dl=120,Nt=8,Xu=6,$u=["HP","ATK","DEF","SPATK","SPDEF","SPD"],Ni=class Ni extends Phaser.GameObjects.Container{constructor(e){super(n,e==null?void 0:e.x,e==null?void 0:e.y),this.active=!1,this.statsLabels=[],this.statsRectangles=[],this.statsShadows=[],this.scale=(e==null?void 0:e.scale)||1,this.setScale(this.scale),this.width=((e==null?void 0:e.width)||Ni.getWidth(this.scale))/this.scale,this.statsBg=me(0,0,this.width,dl),this.statsBg.setOrigin(0,0),this.add(this.statsBg);for(let t=0;t<6;t++){const s=n.add.rectangle(this.width-Nt+1,Nt+3+t*15,100,5,26720);s.setOrigin(1,0),this.statsShadows.push(s),this.add(s);const i=n.add.rectangle(this.width-Nt,Nt+2+t*15,100,5,6728345);i.setOrigin(1,0),this.statsRectangles.push(i),this.add(i);const r=V(Nt,Nt-2+t*15,"A",x.BATTLE_INFO);this.statsLabels.push(r),this.add(r)}this.statsTotalLabel=V(Nt,Nt+6*15,"A",x.MONEY_WINDOW),this.add(this.statsTotalLabel),this.setVisible(!1)}show(e,t){for(let s=0;s<6;s++)this.statsLabels[s].setText(S.t(`pokemonInfo:Stat.${$u[s]}shortened`)+`: ${e[s]}`),this.statsShadows[s].setSize(e[s]/2,5),this.statsRectangles[s].setSize(e[s]/2,5);return this.statsTotalLabel.setText(S.t("pokedexUiHandler:baseTotal")+`: ${t}`),this.setVisible(!0),this.active=!0,!0}clear(){this.setVisible(!1),this.active=!1}toggleInfo(e){e&&this.setVisible(!0),n.tweens.add({targets:this.statsLabels,duration:ye(125),ease:"Sine.easeInOut",alpha:e?1:0}),e||this.setVisible(!1)}isActive(){return this.active}static getWidth(e){return n.game.canvas.width/Xu/2}static getHeight(e,t){return dl*e}};p(Ni,"BaseStatsOverlay");let rr=Ni;const ul={en:{starterInfoTextSize:"56px",instructionTextSize:"38px"},de:{starterInfoTextSize:"48px",instructionTextSize:"35px",starterInfoXPos:33},"es-ES":{starterInfoTextSize:"56px",instructionTextSize:"35px"},fr:{starterInfoTextSize:"54px",instructionTextSize:"38px"},it:{starterInfoTextSize:"56px",instructionTextSize:"38px"},pt_BR:{starterInfoTextSize:"47px",instructionTextSize:"38px",starterInfoXPos:33},zh:{starterInfoTextSize:"47px",instructionTextSize:"38px",starterInfoYOffset:1,starterInfoXPos:24},pt:{starterInfoTextSize:"48px",instructionTextSize:"42px",starterInfoXPos:33},ko:{starterInfoTextSize:"52px",instructionTextSize:"38px"},ja:{starterInfoTextSize:"51px",instructionTextSize:"38px"},"ca-ES":{starterInfoTextSize:"56px",instructionTextSize:"38px"}},pl=2,Zu=109;var Zt=(P=>(P[P.BASE_STATS=0]="BASE_STATS",P[P.ABILITIES=1]="ABILITIES",P[P.LEVEL_MOVES=2]="LEVEL_MOVES",P[P.EGG_MOVES=3]="EGG_MOVES",P[P.TM_MOVES=4]="TM_MOVES",P[P.BIOMES=5]="BIOMES",P[P.NATURES=6]="NATURES",P[P.TOGGLE_IVS=7]="TOGGLE_IVS",P[P.EVOLUTIONS=8]="EVOLUTIONS",P))(Zt||{});const Ga=class Ga extends at{constructor(){super(L.POKEDEX_PAGE),this.allSpecies=[],this.speciesLoaded=new Map,this.eggMoves=[],this.hasEggMoves=[],this.tmMoves=[],this.instructionRowX=0,this.instructionRowY=0,this.instructionRowTextOffset=9,this.filterInstructionRowX=0,this.filterInstructionRowY=0,this.blockInput=!1,this.blockInputOverlay=!1,this.showBackSprite=!1,this.scale=.1666666667,this.filteredIndices=null}setup(){const e=this.getUi(),t=S.resolvedLanguage??"en",s=Object.keys(ul).find(d=>t.includes(d))??"en",i=ul[s];this.starterSelectContainer=n.add.container(0,-n.game.canvas.height/6),this.starterSelectContainer.setVisible(!1),e.add(this.starterSelectContainer);const r=n.add.rectangle(0,0,n.game.canvas.width/6,n.game.canvas.height/6,26720);r.setOrigin(0,0),this.starterSelectContainer.add(r);const a=n.add.image(0,0,"pokedex_summary_bg");a.setOrigin(0,0),this.starterSelectContainer.add(a),this.pokemonSprite=n.add.sprite(53,63,"pkmn__sub"),this.pokemonSprite.setPipeline(n.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.starterSelectContainer.add(this.pokemonSprite),this.shinyOverlay=n.add.image(6,6,"summary_overlay_shiny"),this.shinyOverlay.setOrigin(0,0),this.shinyOverlay.setVisible(!1),this.starterSelectContainer.add(this.shinyOverlay),this.pokemonNumberText=V(17,1,"0000",x.SUMMARY),this.pokemonNumberText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNumberText),this.pokemonNameText=V(6,112,"",x.SUMMARY),this.pokemonNameText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNameText),this.pokemonGrowthRateLabelText=V(8,106,S.t("pokedexUiHandler:growthRate"),x.SUMMARY_ALT,{fontSize:"36px"}),this.pokemonGrowthRateLabelText.setOrigin(0,0),this.pokemonGrowthRateLabelText.setVisible(!1),this.starterSelectContainer.add(this.pokemonGrowthRateLabelText),this.pokemonGrowthRateText=V(34,106,"",x.SUMMARY_PINK,{fontSize:"36px"}),this.pokemonGrowthRateText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonGrowthRateText),this.pokemonGenderText=V(96,112,"",x.SUMMARY_ALT),this.pokemonGenderText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonGenderText),this.pokemonUncaughtText=V(6,127,S.t("pokedexUiHandler:uncaught"),x.WINDOW,{fontSize:"56px"}),this.pokemonUncaughtText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonUncaughtText);const o=n.add.container(Zu+6,9);for(const d of Re)!Le.hasOwnProperty(d.speciesId)||!d.isObtainable()||(this.speciesLoaded.set(d.speciesId,!1),this.allSpecies.push(d));this.starterSelectContainer.add(o),this.type1Icon=n.add.sprite(8,98,Tt("types")),this.type1Icon.setScale(.5),this.type1Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type1Icon),this.type2Icon=n.add.sprite(26,98,Tt("types")),this.type2Icon.setScale(.5),this.type2Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type2Icon),this.pokemonLuckLabelText=V(8,89,S.t("common:luckIndicator"),x.WINDOW_ALT,{fontSize:"56px"}),this.pokemonLuckLabelText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonLuckLabelText),this.pokemonLuckText=V(8+this.pokemonLuckLabelText.displayWidth+2,89,"0",x.WINDOW,{fontSize:"56px"}),this.pokemonLuckText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonLuckText),this.pokemonCandyContainer=n.add.container(4.5,18),this.pokemonCandyIcon=n.add.sprite(0,0,"candy"),this.pokemonCandyIcon.setScale(.5),this.pokemonCandyIcon.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyIcon),this.pokemonCandyOverlayIcon=n.add.sprite(0,0,"candy_overlay"),this.pokemonCandyOverlayIcon.setScale(.5),this.pokemonCandyOverlayIcon.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyOverlayIcon),this.pokemonCandyDarknessOverlay=n.add.sprite(0,0,"candy"),this.pokemonCandyDarknessOverlay.setScale(.5),this.pokemonCandyDarknessOverlay.setOrigin(0,0),this.pokemonCandyDarknessOverlay.setTint(0),this.pokemonCandyDarknessOverlay.setAlpha(.5),this.pokemonCandyContainer.add(this.pokemonCandyDarknessOverlay),this.pokemonCandyCountText=V(9.5,0,"x0",x.WINDOW_ALT,{fontSize:"56px"}),this.pokemonCandyCountText.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyCountText),this.pokemonCandyContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,30,20),Phaser.Geom.Rectangle.Contains),this.starterSelectContainer.add(this.pokemonCandyContainer),this.pokemonFormText=V(6,42,"Form",x.WINDOW_ALT,{fontSize:"42px"}),this.pokemonFormText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonFormText),this.pokemonCaughtHatchedContainer=n.add.container(2,25),this.pokemonCaughtHatchedContainer.setScale(.5),this.starterSelectContainer.add(this.pokemonCaughtHatchedContainer);const l=n.add.sprite(1,0,"items","pb");l.setOrigin(0,0),l.setScale(.75),this.pokemonCaughtHatchedContainer.add(l),this.pokemonCaughtCountText=V(24,4,"0",x.SUMMARY_ALT),this.pokemonCaughtCountText.setOrigin(0,0),this.pokemonCaughtHatchedContainer.add(this.pokemonCaughtCountText),this.pokemonHatchedIcon=n.add.sprite(1,14,"egg_icons"),this.pokemonHatchedIcon.setOrigin(.15,.2),this.pokemonHatchedIcon.setScale(.8),this.pokemonCaughtHatchedContainer.add(this.pokemonHatchedIcon),this.pokemonShinyIcons=[];for(let d=0;d<3;d++){const f=n.add.sprite(153+d*13,160,"shiny_icons");f.setOrigin(.15,.2),f.setScale(1),f.setFrame(ct(d)),f.setVisible(!1),this.pokemonCaughtHatchedContainer.add(f),this.pokemonShinyIcons.push(f)}this.pokemonHatchedCountText=V(24,19,"0",x.SUMMARY_ALT),this.pokemonHatchedCountText.setOrigin(0,0),this.pokemonCaughtHatchedContainer.add(this.pokemonHatchedCountText);const h=i.instructionTextSize;this.instructionsContainer=n.add.container(4,128),this.instructionsContainer.setVisible(!0),this.starterSelectContainer.add(this.instructionsContainer),this.candyUpgradeIconElement=new Phaser.GameObjects.Sprite(n,this.instructionRowX,this.instructionRowY,"keyboard","C.png"),this.candyUpgradeIconElement.setName("sprite-candyUpgrade-icon-element"),this.candyUpgradeIconElement.setScale(.675),this.candyUpgradeIconElement.setOrigin(0,0),this.candyUpgradeLabel=V(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,S.t("pokedexUiHandler:candyUpgrade"),x.PARTY,{fontSize:h}),this.candyUpgradeLabel.setName("text-candyUpgrade-label"),this.shinyIconElement=new Phaser.GameObjects.Sprite(n,this.instructionRowX,this.instructionRowY,"keyboard","R.png"),this.shinyIconElement.setName("sprite-shiny-icon-element"),this.shinyIconElement.setScale(.675),this.shinyIconElement.setOrigin(0,0),this.shinyLabel=V(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,S.t("pokedexUiHandler:cycleShiny"),x.PARTY,{fontSize:h}),this.shinyLabel.setName("text-shiny-label"),this.formIconElement=new Phaser.GameObjects.Sprite(n,this.instructionRowX,this.instructionRowY,"keyboard","F.png"),this.formIconElement.setName("sprite-form-icon-element"),this.formIconElement.setScale(.675),this.formIconElement.setOrigin(0,0),this.formLabel=V(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,S.t("pokedexUiHandler:cycleForm"),x.PARTY,{fontSize:h}),this.formLabel.setName("text-form-label"),this.genderIconElement=new Phaser.GameObjects.Sprite(n,this.instructionRowX,this.instructionRowY,"keyboard","G.png"),this.genderIconElement.setName("sprite-gender-icon-element"),this.genderIconElement.setScale(.675),this.genderIconElement.setOrigin(0,0),this.genderLabel=V(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,S.t("pokedexUiHandler:cycleGender"),x.PARTY,{fontSize:h}),this.genderLabel.setName("text-gender-label"),this.variantIconElement=new Phaser.GameObjects.Sprite(n,this.instructionRowX,this.instructionRowY,"keyboard","V.png"),this.variantIconElement.setName("sprite-variant-icon-element"),this.variantIconElement.setScale(.675),this.variantIconElement.setOrigin(0,0),this.variantLabel=V(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,S.t("pokedexUiHandler:cycleVariant"),x.PARTY,{fontSize:h}),this.variantLabel.setName("text-variant-label"),this.showBackSpriteIconElement=new Phaser.GameObjects.Sprite(n,50,7,"keyboard","E.png"),this.showBackSpriteIconElement.setName("show-backSprite-icon-element"),this.showBackSpriteIconElement.setScale(.675),this.showBackSpriteIconElement.setOrigin(0,0),this.showBackSpriteLabel=V(60,7,S.t("pokedexUiHandler:showBackSprite"),x.PARTY,{fontSize:h}),this.showBackSpriteLabel.setName("show-backSprite-label"),this.starterSelectContainer.add(this.showBackSpriteIconElement),this.starterSelectContainer.add(this.showBackSpriteLabel),this.hideInstructions(),this.filterInstructionsContainer=n.add.container(50,5),this.filterInstructionsContainer.setVisible(!0),this.starterSelectContainer.add(this.filterInstructionsContainer),this.starterSelectMessageBoxContainer=n.add.container(0,n.game.canvas.height/6),this.starterSelectMessageBoxContainer.setVisible(!1),this.starterSelectContainer.add(this.starterSelectMessageBoxContainer),this.starterSelectMessageBox=me(1,-1,318,28),this.starterSelectMessageBox.setOrigin(0,1),this.starterSelectMessageBoxContainer.add(this.starterSelectMessageBox),this.message=V(8,8,"",x.WINDOW,{maxLines:2}),this.message.setOrigin(0,0),this.starterSelectMessageBoxContainer.add(this.message),this.initPromptSprite(this.starterSelectMessageBoxContainer),this.statsContainer=new _l(6,16),n.add.existing(this.statsContainer),this.statsContainer.setVisible(!1),this.starterSelectContainer.add(this.statsContainer),this.menuContainer=n.add.container(-130,0),this.menuContainer.setName("menu"),this.menuContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,n.game.canvas.width/6,n.game.canvas.height/6),Phaser.Geom.Rectangle.Contains),this.menuContainer.setVisible(!1),this.menuOptions=es(Zt).map(d=>Number.parseInt(Zt[d])),this.optionSelectText=yt(0,0,this.menuOptions.map(d=>`${S.t(`pokedexUiHandler:${Zt[d]}`)}`).join(`
`),x.WINDOW,{maxLines:this.menuOptions.length,lineSpacing:12}),this.menuDescriptions=[S.t("pokedexUiHandler:showBaseStats"),S.t("pokedexUiHandler:showAbilities"),S.t("pokedexUiHandler:showLevelMoves"),S.t("pokedexUiHandler:showEggMoves"),S.t("pokedexUiHandler:showTmMoves"),S.t("pokedexUiHandler:showBiomes"),S.t("pokedexUiHandler:showNatures"),S.t("pokedexUiHandler:toggleIVs"),S.t("pokedexUiHandler:showEvolutions")],this.scale=Vi(x.WINDOW,n.uiTheme).scale,this.menuBg=me(n.game.canvas.width/6-83,0,this.optionSelectText.displayWidth+19+24*this.scale,n.game.canvas.height/6-2),this.menuBg.setOrigin(0,0),this.optionSelectText.setPosition(this.menuBg.x+10+24*this.scale,this.menuBg.y+6),this.menuContainer.add(this.menuBg),this.menuContainer.add(this.optionSelectText),e.add(this.menuContainer),this.starterSelectContainer.add(this.menuContainer),this.baseStatsOverlay=new rr({x:317,y:0,width:133}),this.menuContainer.add(this.baseStatsOverlay),this.menuContainer.bringToTop(this.baseStatsOverlay);const c=1;this.moveInfoOverlay=new ls({scale:c,top:!0,x:1,y:n.game.canvas.height/6-ls.getHeight(c)-29}),this.starterSelectContainer.add(this.moveInfoOverlay),this.infoOverlay=new Mi({scale:c,x:1,y:n.game.canvas.height/6-Mi.getHeight(c)-29}),this.starterSelectContainer.add(this.infoOverlay),this.starterSelectContainer.bringToTop(this.starterSelectMessageBoxContainer),this.previousSpecies=[],this.previousStarterAttributes=[]}show(e){var t;return this.canUseCandies=["TitlePhase","SelectStarterPhase","CommandPhase"].includes(((t=n.getCurrentPhase())==null?void 0:t.constructor.name)??""),e.length>=1&&e[0]==="refresh"?!1:(this.species=e[0],this.savedStarterAttributes=e[1]??{shiny:!1,female:!0,variant:0,form:0},this.formIndex=this.savedStarterAttributes.form??0,this.filteredIndices=e[2]??null,this.starterSetup(),e[4]instanceof Function&&(this.exitCallback=e[4]),this.moveInfoOverlay.clear(),this.infoOverlay.clear(),super.show(e),this.starterSelectContainer.setVisible(!0),this.getUi().bringToTop(this.starterSelectContainer),this.starterAttributes=this.initStarterPrefs(),this.menuOptions=es(Zt).map(s=>Number.parseInt(Zt[s])),this.menuContainer.setVisible(!0),this.speciesStarterDexEntry=this.species?n.gameData.dexData[this.species.speciesId]:null,this.setSpecies(),this.updateInstructions(),this.optionSelectText.setText(this.getMenuText()),this.setCursor(0),!0)}getMenuText(){const e=this.isSeen(),t=!!this.isCaught(this.getStarterSpecies(this.species));return this.menuOptions.map(s=>{const i=`${S.t(`pokedexUiHandler:${Zt[s]}`)}`,r=!e||!t&&(s===7||s===6)||this.tmMoves.length<1&&s===4,a=At(r?x.SHADOW_TEXT:x.SETTINGS_VALUE,!1,n.uiTheme);return`[shadow=${At(r?x.SHADOW_TEXT:x.SETTINGS_VALUE,!0,n.uiTheme)}][color=${a}]${i}[/color][/shadow]`}).join(`
`)}starterSetup(){var g,v;this.evolutions=[],this.prevolutions=[],this.battleForms=[];const e=this.species;let t=((g=this.species)==null?void 0:g.forms.length)>0?this.species.forms[this.formIndex].formKey:"";this.isFormGender=t==="male"||t==="female",this.isFormGender&&(this.savedStarterAttributes.female===!0&&t==="male"||this.savedStarterAttributes.female===!1&&t==="female")&&(this.formIndex=(this.formIndex+1)%2,t=this.species.forms[this.formIndex].formKey);const s=this.formIndex??0;this.starterId=this.getStarterSpeciesId(this.species.speciesId);const i=js.hasOwnProperty(e.speciesId)?js[e.speciesId]:[];if(e.forms.length>0){const m=e.forms[s];this.levelMoves=s>0&&xt.hasOwnProperty(e.speciesId)&&xt[e.speciesId].hasOwnProperty(s)?xt[e.speciesId][s]:fi[e.speciesId],this.ability1=m.ability1,this.ability2=m.ability2===m.ability1?void 0:m.ability2,this.abilityHidden=m.abilityHidden===m.ability1?void 0:m.abilityHidden,this.evolutions=i.filter(b=>b.preFormKey===m.formKey||b.preFormKey===null),this.baseStats=m.baseStats,this.baseTotal=m.baseTotal}else this.levelMoves=fi[e.speciesId],this.ability1=e.ability1,this.ability2=e.ability2===e.ability1?void 0:e.ability2,this.abilityHidden=e.abilityHidden===e.ability1?void 0:e.abilityHidden,this.evolutions=i,this.baseStats=e.baseStats,this.baseTotal=e.baseTotal;this.eggMoves=dt[this.starterId]??[],this.hasEggMoves=Array.from({length:4},(m,b)=>(n.gameData.starterData[this.starterId].eggMoves&1<<b)!==0),this.tmMoves=((v=Bl[e.speciesId])==null?void 0:v.filter(m=>Array.isArray(m)?m[0]===t:!0).map(m=>Array.isArray(m)?m[1]:m).sort((m,b)=>_e[m].name>_e[b].name?1:-1))??[];const r=ji.hasOwnProperty(e.speciesId)?e.speciesId:ji.hasOwnProperty(this.starterId)?this.starterId:It[this.starterId],a=ji[r];this.passive=this.formIndex in a?a[s]:a[0];const o=n.gameData.starterData[this.starterId],l=o.abilityAttr;this.hasPassive=o.passiveAttr>0;const h=l&Xe.ABILITY_1,c=l&Xe.ABILITY_2,d=l&Xe.ABILITY_HIDDEN;this.hasAbilities=[h,c,d];const f=gi[e.speciesId]??[];this.preBiomes=this.sanitizeBiomes((gi[this.starterId]??[]).filter(m=>!f.some(b=>m.biome===b.biome&&m.tier===b.tier)&&m.biome!==Ue.TOWN),this.starterId),this.biomes=this.sanitizeBiomes(f,e.speciesId);const u=Ms.hasOwnProperty(e.speciesId)?Ms[e.speciesId]:[];this.battleForms=u.filter(m=>m.preFormKey===this.species.forms[this.formIndex].formKey);const C=It.hasOwnProperty(this.species.speciesId)?Re.find(m=>m.speciesId===It[this.species.speciesId]):null;if(C){const m=js.hasOwnProperty(C.speciesId)?js[C.speciesId]:[];this.prevolutions=m.filter(b=>{var E,w;return b.speciesId===e.speciesId&&((b.evoFormKey===""||b.evoFormKey===null)&&(C.forms.some(_=>{var A;return _.formKey===((A=e.forms[s])==null?void 0:A.formKey)})||C.forms.length>0&&e.forms.length===0||C.forms.length===0&&(e.forms.length===0||((E=e.forms[s])==null?void 0:E.formKey)===""))||b.evoFormKey===((w=e.forms[s])==null?void 0:w.formKey))})}this.availableVariants=e.getFullUnlocksData()&Z.VARIANT_3?3:1}sanitizeBiomes(e,t){return t===ge.BURMY||t===ge.WORMADAM?e.filter(s=>{const i=(()=>{switch(s.biome){case Ue.BEACH:return 1;case Ue.SLUM:return 2;default:return 0}})();return this.formIndex===i}):t===ge.ROTOM?e.filter(s=>{const i=(()=>{switch(s.biome){case Ue.VOLCANO:return 1;case Ue.SEA:return 2;case Ue.ICE_CAVE:return 3;case Ue.MOUNTAIN:return 4;case Ue.TALL_GRASS:return 5;default:return 0}})();return this.formIndex===i}):t===ge.LYCANROC?e.filter(s=>{const i=(()=>{switch(s.tod[0]){case ut.DAY:case ut.DAWN:return 0;case ut.DUSK:return 2;case ut.NIGHT:return 1;default:return 0}})();return this.formIndex===i}):e}isCaught(e){const t=e||this.species;n.dexForDevs&&t.getFullUnlocksData();const s=n.gameData.dexData[t.speciesId];return((s==null?void 0:s.caughtAttr)??0n)&t.getFullUnlocksData()}isFormCaught(e,t){if(n.dexForDevs)return!0;const s=e||this.species,i=t!==void 0?t:this.formIndex,r=this.isCaught(s);return r&&(!s.forms.length||s.forms.length===1)?!0:(r&n.gameData.getFormAttr(i??0))>0n}isSeen(){var t;return(t=this.speciesStarterDexEntry)!=null&&t.seenAttr?!0:!!this.isCaught(this.getStarterSpecies(this.species))}initStarterPrefs(){const e=this.species?{...this.savedStarterAttributes}:null,t=this.isCaught();if(!e||!this.isSeen())return{};const s=t&Z.SHINY,i=t&Z.NON_SHINY;if(!s||e.shiny===void 0&&i?(e.shiny=!1,e.variant=0):(!i||e.shiny===void 0&&s)&&(e.shiny=!0,e.variant=0),this.unlockedVariants=[!!(s&&t&Z.DEFAULT_VARIANT),!!(s&&t&Z.VARIANT_2),!!(s&&t&Z.VARIANT_3)],e.variant===void 0||Number.isNaN(e.variant)||e.variant<0)e.variant=0;else if(!this.unlockedVariants[e.variant]){let r=-1;for(let a=0;a<=e.variant&&a<this.unlockedVariants.length;a++)this.unlockedVariants[a]&&(r=a);e.variant=r!==-1?r:0}return e.female!==void 0?(e.female&&!(t&Z.FEMALE)||!e.female&&!(t&Z.MALE))&&(e.female=!e.female):t&Z.FEMALE?e.female=!0:t&Z.MALE&&(e.female=!1),e}showText(e,t,s,i,r,a,o){super.showText(e,t,s,i,r,a);const l=(e==null?void 0:e.indexOf(`
`))===-1;this.starterSelectMessageBox.setSize(318,l?28:42),o?(this.starterSelectMessageBox.setOrigin(0,0),this.starterSelectMessageBoxContainer.setY(0),this.message.setY(4)):(this.starterSelectMessageBoxContainer.setY(n.game.canvas.height/6),this.starterSelectMessageBox.setOrigin(0,1),this.message.setY(l?-22:-37)),this.starterSelectMessageBoxContainer.setVisible(!!(e!=null&&e.length))}isUpgradeIconEnabled(){return n.candyUpgradeNotification!==0&&n.candyUpgradeDisplay===0}isUpgradeAnimationEnabled(){return n.candyUpgradeNotification!==0&&n.candyUpgradeDisplay===1}getStarterSpeciesId(e){return e===ge.PIKACHU?[0,1,8].includes(this.formIndex)?ge.PICHU:ge.PIKACHU:Le.hasOwnProperty(e)?e:Cn[e]}getStarterSpecies(e){return Le.hasOwnProperty(e.speciesId)?e:Re.find(t=>t.speciesId===Cn[e.speciesId])??e}processInput(e){if(this.blockInput)return!1;const t=this.getUi();let s=!1,i=!1;const r=this.isCaught(),a=this.isFormCaught(),o=this.isSeen(),l=!!this.isCaught(this.getStarterSpecies(this.species));if(this.blockInputOverlay){if(e===I.CANCEL||e===I.ACTION)return this.blockInputOverlay=!1,this.baseStatsOverlay.clear(),t.showText(""),!0;if(e===I.UP||e===I.DOWN)this.blockInputOverlay=!1,this.baseStatsOverlay.clear(),t.showText("");else return!1}if(e===I.SUBMIT)s=!0;else if(e===I.CANCEL)this.statsMode?(this.toggleStatsMode(!1),s=!0):this.previousSpecies.length>0?(this.blockInput=!0,t.setModeWithoutClear(L.OPTION_SELECT).then(()=>{const h=this.previousSpecies.pop(),c=this.previousStarterAttributes.pop();this.moveInfoOverlay.clear(),this.clearText(),t.setModeForceTransition(L.POKEDEX_PAGE,h,c),s=!0}),this.blockInput=!1):(t.revertMode().then(()=>{if(this.exitCallback instanceof Function){const h=this.exitCallback;this.exitCallback=null,h()}}),s=!0);else{const h=n.gameData.starterData[this.starterId],c=this.starterAttributes;if(e===I.ACTION)switch(this.cursor){case 0:o?(this.blockInput=!0,t.setMode(L.POKEDEX_PAGE,"refresh").then(()=>{t.showText(S.t("pokedexUiHandler:showBaseStats"),null,()=>(this.baseStatsOverlay.show(this.baseStats,this.baseTotal),this.blockInput=!1,this.blockInputOverlay=!0,!0)),s=!0})):i=!0;break;case 2:o?(this.blockInput=!0,t.setMode(L.POKEDEX_PAGE,"refresh").then(()=>{t.showText(S.t("pokedexUiHandler:showLevelMoves"),null,()=>{this.moveInfoOverlay.show(_e[this.levelMoves[0][1]]),t.setModeWithoutClear(L.OPTION_SELECT,{options:this.levelMoves.map(d=>({label:(d[0]>0?String(d[0]):"").padEnd(4," ")+_e[d[1]].name,handler:p(()=>!1,"handler"),onHover:p(()=>{this.moveInfoOverlay.show(_e[d[1]]),d[0]===0?this.showText(S.t("pokedexUiHandler:onlyEvolutionMove")):d[0]===-1?this.showText(S.t("pokedexUiHandler:onlyRecallMove")):d[0]<=5?this.showText(S.t("pokedexUiHandler:onStarterSelectMove")):this.showText(S.t("pokedexUiHandler:byLevelUpMove"))},"onHover")})).concat({label:S.t("menu:cancel"),handler:p(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(L.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:p(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),s=!0):i=!0;break;case 3:o?(this.blockInput=!0,t.setMode(L.POKEDEX_PAGE,"refresh").then(()=>{if(this.eggMoves.length===0)return t.showText(S.t("pokedexUiHandler:noEggMoves")),this.blockInput=!1,!0;t.showText(S.t("pokedexUiHandler:showEggMoves"),null,()=>{this.moveInfoOverlay.show(_e[this.eggMoves[0]]),t.setModeWithoutClear(L.OPTION_SELECT,{options:[{label:S.t("pokedexUiHandler:common"),skip:!0,style:x.MONEY_WINDOW,handler:p(()=>!1,"handler"),onHover:p(()=>this.moveInfoOverlay.clear(),"onHover")},...this.eggMoves.slice(0,3).map((d,f)=>({label:_e[d].name,style:this.hasEggMoves[f]?x.SETTINGS_VALUE:x.SHADOW_TEXT,handler:p(()=>!1,"handler"),onHover:p(()=>this.moveInfoOverlay.show(_e[d]),"onHover")})),{label:S.t("pokedexUiHandler:rare"),skip:!0,style:x.MONEY_WINDOW,handler:p(()=>!1,"handler"),onHover:p(()=>this.moveInfoOverlay.clear(),"onHover")},{label:_e[this.eggMoves[3]].name,style:this.hasEggMoves[3]?x.SETTINGS_VALUE:x.SHADOW_TEXT,handler:p(()=>!1,"handler"),onHover:p(()=>this.moveInfoOverlay.show(_e[this.eggMoves[3]]),"onHover")},{label:S.t("menu:cancel"),handler:p(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(L.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:p(()=>this.moveInfoOverlay.clear(),"onHover")}],supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),s=!0):i=!0;break;case 4:o?this.tmMoves.length<1?(t.showText(S.t("pokedexUiHandler:noTmMoves")),i=!0):(this.blockInput=!0,t.setMode(L.POKEDEX_PAGE,"refresh").then(()=>{t.showText(S.t("pokedexUiHandler:showTmMoves"),null,()=>{this.moveInfoOverlay.show(_e[this.tmMoves[0]]),t.setModeWithoutClear(L.OPTION_SELECT,{options:this.tmMoves.map(d=>({label:_e[d].name,handler:p(()=>!1,"handler"),onHover:p(()=>{this.moveInfoOverlay.show(_e[d])},"onHover")})).concat({label:S.t("menu:cancel"),handler:p(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(L.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:p(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),s=!0):i=!0;break;case 1:o?(this.blockInput=!0,t.setMode(L.POKEDEX_PAGE,"refresh").then(()=>{t.showText(S.t("pokedexUiHandler:showAbilities"),null,()=>{this.infoOverlay.show(Fe[this.ability1].description);const d=[];if(this.ability1&&d.push({label:Fe[this.ability1].name,style:this.hasAbilities[0]>0?x.SETTINGS_VALUE:x.SHADOW_TEXT,handler:p(()=>!1,"handler"),onHover:p(()=>this.infoOverlay.show(Fe[this.ability1].description),"onHover")}),this.ability2){const f=Fe[this.ability2];d.push({label:f==null?void 0:f.name,style:this.hasAbilities[1]>0?x.SETTINGS_VALUE:x.SHADOW_TEXT,handler:p(()=>!1,"handler"),onHover:p(()=>this.infoOverlay.show(f==null?void 0:f.description),"onHover")})}if(this.abilityHidden){d.push({label:S.t("pokedexUiHandler:hidden"),skip:!0,style:x.MONEY_WINDOW,handler:p(()=>!1,"handler"),onHover:p(()=>this.infoOverlay.clear(),"onHover")});const f=Fe[this.abilityHidden];d.push({label:Fe[this.abilityHidden].name,style:this.hasAbilities[2]>0?x.SETTINGS_VALUE:x.SHADOW_TEXT,handler:p(()=>!1,"handler"),onHover:p(()=>this.infoOverlay.show(f==null?void 0:f.description),"onHover")})}this.passive&&(d.push({label:S.t("pokedexUiHandler:passive"),skip:!0,style:x.MONEY_WINDOW,handler:p(()=>!1,"handler"),onHover:p(()=>this.infoOverlay.clear(),"onHover")}),d.push({label:Fe[this.passive].name,style:this.hasPassive?x.SETTINGS_VALUE:x.SHADOW_TEXT,handler:p(()=>!1,"handler"),onHover:p(()=>this.infoOverlay.show(Fe[this.passive].description),"onHover")})),d.push({label:S.t("menu:cancel"),handler:p(()=>(this.infoOverlay.clear(),this.clearText(),t.setMode(L.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:p(()=>this.infoOverlay.clear(),"onHover")}),t.setModeWithoutClear(L.OPTION_SELECT,{options:d,supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),s=!0):i=!0;break;case 5:o?(this.blockInput=!0,t.setMode(L.POKEDEX_PAGE,"refresh").then(()=>{var f,u;if((!this.biomes||((f=this.biomes)==null?void 0:f.length)===0)&&(!this.preBiomes||((u=this.preBiomes)==null?void 0:u.length)===0))return t.showText(S.t("pokedexUiHandler:noBiomes")),t.playError(),this.blockInput=!1,!0;const d=[];t.showText(S.t("pokedexUiHandler:showBiomes"),null,()=>{this.biomes.map(C=>{d.push({label:S.t(`biome:${Ue[C.biome].toUpperCase()}`)+" - "+S.t(`biome:${Lo[C.tier].toUpperCase()}`)+(C.tod.length===1&&C.tod[0]===-1?"":" ("+C.tod.map(g=>S.t(`biome:${ut[g].toUpperCase()}`)).join(", ")+")"),handler:p(()=>!1,"handler")})}),this.preBiomes.length>0&&(d.push({label:S.t("pokedexUiHandler:preBiomes"),skip:!0,handler:p(()=>!1,"handler")}),this.preBiomes.map(C=>{d.push({label:S.t(`biome:${Ue[C.biome].toUpperCase()}`)+" - "+S.t(`biome:${Lo[C.tier].toUpperCase()}`)+(C.tod.length===1&&C.tod[0]===-1?"":" ("+C.tod.map(g=>S.t(`biome:${ut[g].toUpperCase()}`)).join(", ")+")"),handler:p(()=>!1,"handler")})})),d.push({label:S.t("menu:cancel"),handler:p(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(L.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:p(()=>this.moveInfoOverlay.clear(),"onHover")}),t.setModeWithoutClear(L.OPTION_SELECT,{options:d,supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),s=!0):i=!0;break;case 8:o?(this.blockInput=!0,t.setMode(L.POKEDEX_PAGE,"refresh").then(()=>{var f,u,C;const d=[];if((!this.prevolutions||((f=this.prevolutions)==null?void 0:f.length)===0)&&(!this.evolutions||((u=this.evolutions)==null?void 0:u.length)===0)&&(!this.battleForms||((C=this.battleForms)==null?void 0:C.length)===0))return t.showText(S.t("pokedexUiHandler:noEvolutions")),t.playError(),this.blockInput=!1,!0;t.showText(S.t("pokedexUiHandler:showEvolutions"),null,()=>{var g;((g=this.prevolutions)==null?void 0:g.length)>0&&(d.push({label:S.t("pokedexUiHandler:prevolutions"),style:x.MONEY_WINDOW,skip:!0,handler:p(()=>!1,"handler")}),this.prevolutions.map(v=>{var w;const m=Re.find(_=>_.speciesId===It[this.species.speciesId]),b=((w=m==null?void 0:m.forms.find(_=>_.formKey===v.preFormKey))==null?void 0:w.formIndex)??0,E=v.description;d.push({label:v.preFormKey?(m??this.species).getFormNameToDisplay(b,!0):(m??this.species).getExpandedSpeciesName(),handler:p(()=>{this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes});const _=Re.find(B=>B.speciesId===It[v.speciesId]),A=v.preFormKey?v.preFormKey:this.species.forms.length>0?this.species.forms[this.formIndex].formKey:"",D=_==null?void 0:_.forms.find(B=>B.formKey===A),j=D?D.formIndex:0;return this.starterAttributes.form=j,this.savedStarterAttributes.form=j,this.moveInfoOverlay.clear(),this.clearText(),t.setMode(L.POKEDEX_PAGE,_,this.savedStarterAttributes),!0},"handler"),onHover:p(()=>this.showText(E),"onHover")})})),this.evolutions.length>0&&(d.push({label:S.t("pokedexUiHandler:evolutions"),style:x.MONEY_WINDOW,skip:!0,handler:p(()=>!1,"handler")}),this.evolutions.map(v=>{const m=Re.find(j=>j.speciesId===v.speciesId),b=!!this.isCaught(m),E=v.evoFormKey?v.evoFormKey:this.species.forms.length>0?this.species.forms[this.formIndex].formKey:"",w=m==null?void 0:m.forms.find(j=>j.formKey===E),_=w?w.formIndex:0,A=this.isFormCaught(m,_),D=v.description;d.push({label:v.evoFormKey?(m??this.species).getFormNameToDisplay(_,!0):(m??this.species).getExpandedSpeciesName(),style:b&&A?x.WINDOW:x.SHADOW_TEXT,handler:p(()=>(this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes}),this.starterAttributes.form=_,this.savedStarterAttributes.form=_,this.moveInfoOverlay.clear(),this.clearText(),t.setMode(L.POKEDEX_PAGE,m,this.savedStarterAttributes),!0),"handler"),onHover:p(()=>this.showText(D),"onHover")})})),this.battleForms.length>0&&(d.push({label:S.t("pokedexUiHandler:forms"),style:x.MONEY_WINDOW,skip:!0,handler:p(()=>!1,"handler")}),this.battleForms.map(v=>{var A;const m=(A=this.species)==null?void 0:A.forms.find(D=>D.formKey===v.formKey),b=m?m.formIndex:0;let E="";v.trigger?E=v.trigger.description:E="";let w=this.species.getFormNameToDisplay(b);w===""&&(w=this.species.name);const _=this.isFormCaught(this.species,b);E&&d.push({label:w,style:_?x.WINDOW:x.SHADOW_TEXT,handler:p(()=>{var B;this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes});const D=this.species,j=(B=this.species.forms.find($=>$.formKey===v.formKey))==null?void 0:B.formIndex;return this.starterAttributes.form=j,this.savedStarterAttributes.form=j,this.moveInfoOverlay.clear(),this.clearText(),t.setMode(L.POKEDEX_PAGE,D,this.savedStarterAttributes,this.filteredIndices),!0},"handler"),onHover:p(()=>this.showText(E),"onHover")})})),d.push({label:S.t("menu:cancel"),handler:p(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(L.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:p(()=>this.moveInfoOverlay.clear(),"onHover")}),t.setModeWithoutClear(L.OPTION_SELECT,{options:d,supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),s=!0):i=!0;break;case 7:l?(this.toggleStatsMode(),t.setMode(L.POKEDEX_PAGE,"refresh"),s=!0):i=!0;break;case 6:l?(this.blockInput=!0,t.setMode(L.POKEDEX_PAGE,"refresh").then(()=>{t.showText(S.t("pokedexUiHandler:showNature"),null,()=>{var f;const d=n.gameData.getNaturesForAttr((f=this.speciesStarterDexEntry)==null?void 0:f.natureAttr);t.setModeWithoutClear(L.OPTION_SELECT,{options:d.map((u,C)=>({label:gn(u,!0,!0,!0,n.uiTheme),handler:p(()=>!1,"handler")})).concat({label:S.t("menu:cancel"),handler:p(()=>(this.clearText(),t.setMode(L.POKEDEX_PAGE,"refresh"),this.blockInput=!1,!0),"handler")}),maxOptions:8,yOffset:19})})}),s=!0):i=!0;break}else{const d=n.gameData.getSpeciesDexAttrProps(this.species,this.getCurrentDexProps(this.species.speciesId));switch(e){case I.CYCLE_SHINY:if(this.canCycleShiny)if(c.shiny){let f=d.variant;do if(f=(f+1)%3,f===0){if(this.isCaught()&Z.DEFAULT_VARIANT)break}else if(f===1){if(this.isCaught()&Z.VARIANT_2)break}else if(this.isCaught()&Z.VARIANT_3)break;while(f!==d.variant);c.variant=f,this.savedStarterAttributes.variant=c.variant,this.isCaught()&Z.NON_SHINY&&f<=d.variant?(this.setSpeciesDetails(this.species,{shiny:!1,variant:0}),s=!0,c.shiny=!1,this.savedStarterAttributes.shiny=c.shiny):(this.setSpeciesDetails(this.species,{variant:f}),s=!0)}else{const f=c.variant?c.variant:0;this.setSpeciesDetails(this.species,{shiny:!0,variant:f}),n.playSound("se/sparkle"),c.shiny=!0,this.savedStarterAttributes.shiny=c.shiny}break;case I.CYCLE_FORM:if(this.canCycleForm){const f=this.species.forms.length;let u=this.formIndex;do if(u=(u+1)%f,this.species.forms[u].isStarterSelectable||n.dexForDevs)break;while(u!==d.formIndex||this.species.forms[u].isUnobtainable);c.form=u,this.savedStarterAttributes.form=c.form,this.formIndex=u;let C=d.female;this.isFormGender&&(C=!d.female),c.female=C,this.savedStarterAttributes.female=c.female,this.starterSetup(),this.setSpeciesDetails(this.species,{formIndex:u,female:C}),s=this.setCursor(this.cursor)}break;case I.CYCLE_GENDER:if(this.canCycleGender){c.female=!d.female,this.savedStarterAttributes.female=c.female;let f=this.formIndex;this.isFormGender&&(f=this.formIndex===0?1:0),c.form=f,this.savedStarterAttributes.form=c.form,this.formIndex=f,this.starterSetup(),this.setSpeciesDetails(this.species,{female:!d.female,formIndex:f}),s=!0}break;case I.STATS:if(!r||!a||!this.canUseCandies)i=!0;else{const f=this.getUi();f.showText("");const u=[],C=h.passiveAttr,g=h.candyCount;if(!(C&Ke.UNLOCKED)){const b=Os(Le[this.starterId]);u.push({label:`x${b} ${S.t("pokedexUiHandler:unlockPassive")} (${Fe[this.passive].name})`,handler:p(()=>pe.FREE_CANDY_UPGRADE_OVERRIDE||g>=b?(h.passiveAttr|=Ke.UNLOCKED|Ke.ENABLED,pe.FREE_CANDY_UPGRADE_OVERRIDE||(h.candyCount-=b),this.pokemonCandyCountText.setText(`x${h.candyCount}`),n.gameData.saveSystem().then(E=>{if(!E)return n.reset(!0)}),this.setSpeciesDetails(this.species),n.playSound("se/buy"),f.setMode(L.POKEDEX_PAGE,"refresh"),!0):!1,"handler"),style:this.isPassiveAvailable()?x.WINDOW:x.SHADOW_TEXT,item:"candy",itemArgs:this.isPassiveAvailable()?Ye[this.starterId]:["808080","808080"]})}const v=h.valueReduction;if(v<pl){const b=As(Le[this.starterId])[v];u.push({label:`x${b} ${S.t("pokedexUiHandler:reduceCost")}`,handler:p(()=>pe.FREE_CANDY_UPGRADE_OVERRIDE||g>=b?(h.valueReduction++,pe.FREE_CANDY_UPGRADE_OVERRIDE||(h.candyCount-=b),this.pokemonCandyCountText.setText(`x${h.candyCount}`),n.gameData.saveSystem().then(E=>{if(!E)return n.reset(!0)}),f.setMode(L.POKEDEX_PAGE,"refresh"),n.playSound("se/buy"),!0):!1,"handler"),style:this.isValueReductionAvailable()?x.WINDOW:x.SHADOW_TEXT,item:"candy",itemArgs:this.isValueReductionAvailable()?Ye[this.starterId]:["808080","808080"]})}const m=ks(Le[this.starterId]);u.push({label:`x${m} ${S.t("pokedexUiHandler:sameSpeciesEgg")}`,handler:p(()=>pe.FREE_CANDY_UPGRADE_OVERRIDE||g>=m?n.gameData.eggs.length>=99&&!pe.UNLIMITED_EGG_COUNT_OVERRIDE?(this.showText(S.t("egg:tooManyEggs"),void 0,()=>this.showText("",0,()=>this.tutorialActive=!1),2e3,!1,void 0,!0),!1):(pe.FREE_CANDY_UPGRADE_OVERRIDE||(h.candyCount-=m),this.pokemonCandyCountText.setText(`x${h.candyCount}`),new Gr({scene:n,species:this.starterId,sourceType:Ll.SAME_SPECIES_EGG}).addEggToGameData(),n.gameData.saveSystem().then(E=>{if(!E)return n.reset(!0)}),f.setMode(L.POKEDEX_PAGE,"refresh"),n.playSound("se/buy"),!0):!1,"handler"),style:this.isSameSpeciesEggAvailable()?x.WINDOW:x.SHADOW_TEXT,item:"candy",itemArgs:this.isSameSpeciesEggAvailable()?Ye[this.starterId]:["808080","808080"]}),u.push({label:S.t("menu:cancel"),handler:p(()=>(f.setMode(L.POKEDEX_PAGE,"refresh"),!0),"handler")}),f.setModeWithoutClear(L.OPTION_SELECT,{options:u,yOffset:47}),s=!0}break;case I.CYCLE_ABILITY:this.showBackSprite=!this.showBackSprite,this.showBackSprite?this.showBackSpriteLabel.setText(S.t("pokedexUiHandler:showFrontSprite")):this.showBackSpriteLabel.setText(S.t("pokedexUiHandler:showBackSprite")),this.setSpeciesDetails(this.species,{},!0),s=!0;break;case I.UP:this.cursor?s=this.setCursor(this.cursor-1):s=this.setCursor(this.menuOptions.length-1);break;case I.DOWN:this.cursor+1<this.menuOptions.length?s=this.setCursor(this.cursor+1):s=this.setCursor(0);break;case I.LEFT:if(this.filteredIndices&&this.filteredIndices.length<=1)return t.playError(),this.blockInput=!1,!0;this.blockInput=!0,t.setModeWithoutClear(L.OPTION_SELECT).then(()=>{this.previousSpecies.length===0&&(this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes}));let f;if(this.filteredIndices){const g=this.filteredIndices.findIndex(m=>m===this.species.speciesId),v=g<=0?this.filteredIndices.length-1:g-1;f=hs(this.filteredIndices[v])}else{const g=Re.findIndex(m=>m.speciesId===this.species.speciesId),v=g<=0?Re.length-1:g-1;f=Re[v]}const u=f==null?void 0:f.forms.find(g=>{var v,m;return g.formKey===((m=(v=this.species)==null?void 0:v.forms[this.formIndex])==null?void 0:m.formKey)}),C=u?u.formIndex:0;this.starterAttributes.form=C,this.savedStarterAttributes.form=C,this.moveInfoOverlay.clear(),this.clearText(),t.setModeForceTransition(L.POKEDEX_PAGE,f,this.savedStarterAttributes,this.filteredIndices)}),this.blockInput=!1;break;case I.RIGHT:if(this.filteredIndices&&this.filteredIndices.length<=1)return t.playError(),this.blockInput=!1,!0;t.setModeWithoutClear(L.OPTION_SELECT).then(()=>{this.previousSpecies.length===0&&(this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes}));let f;if(this.filteredIndices){const g=this.filteredIndices.findIndex(m=>m===this.species.speciesId),v=g>=this.filteredIndices.length-1?0:g+1;f=hs(this.filteredIndices[v])}else{const g=Re.findIndex(m=>m.speciesId===this.species.speciesId),v=g>=Re.length-1?0:g+1;f=Re[v]}const u=f==null?void 0:f.forms.find(g=>{var v,m;return g.formKey===((m=(v=this.species)==null?void 0:v.forms[this.formIndex])==null?void 0:m.formKey)}),C=u?u.formIndex:0;this.starterAttributes.form=C,this.savedStarterAttributes.form=C,this.moveInfoOverlay.clear(),this.clearText(),t.setModeForceTransition(L.POKEDEX_PAGE,f,this.savedStarterAttributes,this.filteredIndices)});break}}}return s?t.playSelect():i&&t.playError(),s||i}updateButtonIcon(e,t,s,i){var a;let r;if(t==="touch")switch(t="keyboard",e){case oe.Button_Cycle_Shiny:r="R.png";break;case oe.Button_Cycle_Form:r="F.png";break;case oe.Button_Cycle_Gender:r="G.png";break;case oe.Button_Cycle_Ability:r="E.png";break}else r=(a=n.inputController)==null?void 0:a.getIconForLatestInputRecorded(e);s.setTexture(t,r),s.setPosition(this.instructionRowX,this.instructionRowY),i.setPosition(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY),s.setVisible(!0),i.setVisible(!0),this.instructionsContainer.add([s,i]),this.instructionRowY+=8,this.instructionRowY>=24&&(this.instructionRowY=8,this.instructionRowX+=50)}updateInstructions(){this.instructionRowX=0,this.instructionRowY=0,this.filterInstructionRowX=0,this.filterInstructionRowY=0,this.hideInstructions(),this.instructionsContainer.removeAll(),this.filterInstructionsContainer.removeAll();let e;if(n.inputMethod==="gamepad"?e=n.inputController.getConfig(n.inputController.selectedDevice[Se.GAMEPAD]).padType:e=n.inputMethod,!e)return;const t=this.isFormCaught();this.isCaught()&&(t?(this.canUseCandies&&this.updateButtonIcon(oe.Button_Stats,e,this.candyUpgradeIconElement,this.candyUpgradeLabel),this.canCycleShiny&&this.updateButtonIcon(oe.Button_Cycle_Shiny,e,this.shinyIconElement,this.shinyLabel),this.canCycleGender&&this.updateButtonIcon(oe.Button_Cycle_Gender,e,this.genderIconElement,this.genderLabel)):this.instructionRowY+=8,this.canCycleForm&&this.updateButtonIcon(oe.Button_Cycle_Form,e,this.formIconElement,this.formLabel))}setCursor(e){const t=super.setCursor(e);this.cursorObj||(this.cursorObj=n.add.image(0,0,"cursor"),this.cursorObj.setOrigin(0,0),this.menuContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.menuBg,7,6+(18+this.cursor*96)*this.scale);const s=this.getUi();return this.isCaught()&&this.isFormCaught()||this.isSeen()?s.showText(this.menuDescriptions[e]):s.showText(""),t}getFriendship(e){let t=n.gameData.starterData[this.starterId].friendship;(!t||t===void 0)&&(t=0);const s=Ur(Le[this.starterId]);return{currentFriendship:t,friendshipCap:s}}isPassiveAvailable(){const e=n.gameData.starterData[this.starterId];return e.candyCount>=Os(Le[this.starterId])&&!(e.passiveAttr&Ke.UNLOCKED)}isValueReductionAvailable(){const e=n.gameData.starterData[this.starterId];return e.candyCount>=As(Le[this.starterId])[e.valueReduction]&&e.valueReduction<pl}isSameSpeciesEggAvailable(){return n.gameData.starterData[this.starterId].candyCount>=ks(Le[this.starterId])}setSpecies(){const e=this.species,t=e?{...this.starterAttributes}:null;if(!e&&n.ui.getTooltip().visible&&n.ui.hideTooltip(),this.statsMode&&(this.isCaught()?(this.statsContainer.setVisible(!0),this.showStats()):(this.statsContainer.setVisible(!1),this.statsContainer.updateIvs(null))),e&&(this.isSeen()||this.isCaught()))if(this.pokemonNumberText.setText(Ot(e.speciesId,4)),this.isCaught()){const s=this.getCurrentDexProps(e.speciesId),i=n.gameData.getSpeciesDexAttrProps(e,s);t!=null&&t.variant&&!Number.isNaN(t.variant)&&i.shiny&&(i.variant=t.variant),i.form=(t==null?void 0:t.form)??i.form,i.female=(t==null?void 0:t.female)??i.female,this.setSpeciesDetails(e,{shiny:i.shiny,formIndex:i.form,female:i.female,variant:i.variant??0})}else{this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!0),this.type2Icon.setVisible(!0),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1);for(const r of this.pokemonShinyIcons)r.setVisible(!1);this.pokemonUncaughtText.setVisible(!0),this.pokemonCaughtHatchedContainer.setVisible(!0),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1);const s=n.gameData.getSpeciesDefaultDexAttr(e,!0,!0),i=n.gameData.getSpeciesDexAttrProps(e,s);this.setSpeciesDetails(e,{shiny:i.shiny,formIndex:i.formIndex,female:i.female,variant:i.variant}),this.pokemonSprite.setTint(8421504)}else{this.pokemonNumberText.setText(e?Ot(e.speciesId,4):""),this.pokemonNameText.setText(e?"???":""),this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1);for(const s of this.pokemonShinyIcons)s.setVisible(!1);this.pokemonUncaughtText.setVisible(!!e),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1),this.setSpeciesDetails(e,{shiny:!1,formIndex:0,female:!1,variant:0}),this.pokemonSprite.setTint(0)}}setSpeciesDetails(e,t={},s){var c,d,f;let{shiny:i,formIndex:r,female:a,variant:o}=t;const l=e?this.starterAttributes:null,h=(e==null?void 0:e.genderDiffs)&&!ve(a)||!ve(r)||!ve(i)||!ve(o)||s;if(this.activeTooltip==="CANDY")if(this.species&&this.pokemonCandyContainer.visible){const{currentFriendship:u,friendshipCap:C}=this.getFriendship(this.species.speciesId);n.ui.editTooltip("",`${u}/${C}`)}else n.ui.hideTooltip();if((c=e==null?void 0:e.forms)!=null&&c.find(u=>u.formKey==="female")&&(a!==void 0?r=a?1:0:r!==void 0&&(a=r===1)),e&&(i===void 0&&(i=(l==null?void 0:l.shiny)??!1),a===void 0&&(a=(l==null?void 0:l.female)??!1),o===void 0&&(o=(l==null?void 0:l.variant)??0),r===void 0&&(r=(l==null?void 0:l.form)??0)),this.pokemonSprite.setVisible(!1),this.assetLoadCancelled&&(this.assetLoadCancelled.value=!0,this.assetLoadCancelled=null),e){const u=this.isCaught(e);if(!u){const A=this.starterAttributes;(i===void 0||i!==A.shiny)&&(i=A.shiny),(r===void 0||r!==A.form)&&(r=A.form),(a===void 0||a!==A.female)&&(a=A.female),(o===void 0||o!==A.variant)&&(o=A.variant)}const C=this.isFormCaught(),g=this.isSeen();this.shinyOverlay.setVisible(i??!1),this.pokemonNumberText.setColor(this.getTextColor(i?x.SUMMARY_GOLD:x.SUMMARY,!1)),this.pokemonNumberText.setShadowColor(this.getTextColor(i?x.SUMMARY_GOLD:x.SUMMARY,!0));const v=new ft(!1);if(this.assetLoadCancelled=v,h){const A=!!this.showBackSprite;e.loadAssets(a,r,i,o,!0,A).then(()=>{v.value||(this.assetLoadCancelled=null,this.speciesLoaded.set(e.speciesId,!0),this.pokemonSprite.play(e.getSpriteKey(a,r,i,o,A)),this.pokemonSprite.setPipelineData("shiny",i),this.pokemonSprite.setPipelineData("variant",o),this.pokemonSprite.setPipelineData("spriteKey",e.getSpriteKey(a,r,i,o,A)),this.pokemonSprite.setVisible(!this.statsMode))})}else this.pokemonSprite.setVisible(!this.statsMode);const m=!!(u&Z.NON_SHINY),b=!!(u&Z.SHINY),E=[Z.DEFAULT_VARIANT,Z.VARIANT_2,Z.VARIANT_3].filter(A=>u&A);this.canCycleShiny=m&&b||b&&E.length>1;const w=!!(u&Z.MALE),_=!!(u&Z.FEMALE);if(this.canCycleGender=w&&_,this.canCycleForm=n.dexForDevs?e.forms.length>1:e.forms.filter(A=>A.isStarterSelectable).filter(A=>A).length>1,u&&e.malePercent!==null){const A=a?kt.FEMALE:kt.MALE;this.pokemonGenderText.setText(kl(A)),this.pokemonGenderText.setColor(pi(A)),this.pokemonGenderText.setShadowColor(pi(A,!0))}else this.pokemonGenderText.setText("");if(C||g?this.pokemonNameText.setText(e.name):this.pokemonNameText.setText(e?"???":""),C?(this.species.loadAssets(a,r,i,o,!0).then(()=>{(this.species.forms&&this.species.forms.length>0?this.species.forms[r??this.formIndex]:this.species).cry()}),this.pokemonSprite.clearTint()):g?this.pokemonSprite.setTint(8421504):this.pokemonSprite.setTint(0),C){const A=n.gameData.getDexAttrLuck(this.isCaught());this.pokemonLuckText.setVisible(!!A),this.pokemonLuckText.setText(A.toString()),this.pokemonLuckText.setTint($e(Math.min(A-1,2))),this.pokemonLuckLabelText.setVisible(this.pokemonLuckText.visible)}else this.pokemonLuckText.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1);if(C){let A=Tl(Al[e.growthRate]);const D=A.replace(" ","_");S.exists("growth:"+D)&&(A=S.t("growth:"+D)),this.pokemonGrowthRateText.setText(A),this.pokemonGrowthRateText.setColor(ui(e.growthRate)),this.pokemonGrowthRateText.setShadowColor(ui(e.growthRate,!0)),this.pokemonGrowthRateLabelText.setVisible(!0)}else this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1);if(C){const A=Ye[this.starterId];this.pokemonUncaughtText.setVisible(!1),this.pokemonCaughtCountText.setText(`${(d=this.speciesStarterDexEntry)==null?void 0:d.caughtCount}`),e.speciesId===ge.MANAPHY||e.speciesId===ge.PHIONE?this.pokemonHatchedIcon.setFrame("manaphy"):this.pokemonHatchedIcon.setFrame(Qt(e)),this.pokemonHatchedCountText.setText(`${(f=this.speciesStarterDexEntry)==null?void 0:f.hatchedCount}`);const D=this.getCurrentDexProps(e.speciesId),B=n.gameData.getSpeciesDexAttrProps(e,D).variant;for(let $=0;$<3;$++){const ie=this.pokemonShinyIcons[$];if($<this.availableVariants){if(!this.unlockedVariants[$])ie.setTint(0);else if(i&&$===B){const k=$e($);ie.setTint(k)}else ie.setTint(8421504);ie.setVisible(!0)}else ie.setVisible(!1)}if(this.pokemonCaughtHatchedContainer.setVisible(!0),this.pokemonCaughtHatchedContainer.setY(25),this.pokemonCandyIcon.setTint(pt(it(A[0]))),this.pokemonCandyOverlayIcon.setTint(pt(it(A[1]))),this.pokemonCandyCountText.setText(`x${e.speciesId===ge.PIKACHU?0:n.gameData.starterData[this.starterId].candyCount}`),this.pokemonCandyContainer.setVisible(!0),It.hasOwnProperty(e.speciesId))this.pokemonHatchedIcon.setVisible(!1),this.pokemonHatchedCountText.setVisible(!1),this.pokemonFormText.setY(36);else{this.pokemonHatchedIcon.setVisible(!0),this.pokemonHatchedCountText.setVisible(!0),this.pokemonFormText.setY(42);const{currentFriendship:$,friendshipCap:ie}=this.getFriendship(this.species.speciesId),k=16-16*($/ie);this.pokemonCandyDarknessOverlay.setCrop(0,0,16,k),this.pokemonCandyContainer.on("pointerover",()=>{n.ui.showTooltip("",`${$}/${ie}`,!0),this.activeTooltip="CANDY"}),this.pokemonCandyContainer.on("pointerout",()=>{n.ui.hideTooltip(),this.activeTooltip=void 0})}}else{this.pokemonUncaughtText.setVisible(!0),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1);for(const A of this.pokemonShinyIcons)A.setVisible(!1)}if(C||g){const A=Ct(e.speciesId,r);this.setTypeIcons(A.type1,A.type2),Rl.includes(e.speciesId)&&!r?this.pokemonFormText.setText(""):this.pokemonFormText.setText(e.getFormNameToDisplay(r)),this.pokemonFormText.setVisible(!0),C||this.pokemonFormText.setY(18)}else this.setTypeIcons(null,null),this.pokemonFormText.setText(""),this.pokemonFormText.setVisible(!1)}else this.shinyOverlay.setVisible(!1),this.pokemonNumberText.setColor(this.getTextColor(x.SUMMARY)),this.pokemonNumberText.setShadowColor(this.getTextColor(x.SUMMARY,!0)),this.pokemonGenderText.setText(""),this.setTypeIcons(null,null);this.updateInstructions()}setTypeIcons(e,t){e!==null?(this.type1Icon.setVisible(!0),this.type1Icon.setFrame(Te[e].toLowerCase())):this.type1Icon.setVisible(!1),t!==null?(this.type2Icon.setVisible(!0),this.type2Icon.setFrame(Te[t].toLowerCase())):this.type2Icon.setVisible(!1)}getCurrentDexProps(e){var r,a,o,l,h,c,d;let t=0n;const s=Re.find(f=>f.speciesId===e),i=n.gameData.dexData[e].caughtAttr&n.gameData.dexData[this.getStarterSpeciesId(e)].caughtAttr&((s==null?void 0:s.getFullUnlocksData())??0n);return(r=this.starterAttributes)!=null&&r.female||(i&Z.FEMALE)>0n&&(i&Z.MALE)===0n?t+=Z.FEMALE:t+=Z.MALE,(a=this.starterAttributes)!=null&&a.shiny||(i&Z.SHINY)>0n&&((o=this.starterAttributes)==null?void 0:o.shiny)!==!1?(t+=Z.SHINY,((l=this.starterAttributes)==null?void 0:l.variant)!==void 0?t+=BigInt(Math.pow(2,(h=this.starterAttributes)==null?void 0:h.variant))*Z.DEFAULT_VARIANT:(i&Z.VARIANT_3)>0?t+=Z.VARIANT_3:(i&Z.VARIANT_2)>0?t+=Z.VARIANT_2:t+=Z.DEFAULT_VARIANT):(t+=Z.NON_SHINY,t+=Z.DEFAULT_VARIANT),(c=this.starterAttributes)!=null&&c.form?t+=BigInt(Math.pow(2,(d=this.starterAttributes)==null?void 0:d.form))*Z.DEFAULT_FORM:t+=n.gameData.getFormAttr(n.gameData.getFormIndex(i)),t}toggleStatsMode(e){e===void 0&&(e=!this.statsMode),e?(this.showStats(),this.statsMode=!0,this.pokemonSprite.setVisible(!1)):(this.statsMode=!1,this.statsContainer.setVisible(!1),this.pokemonSprite.setVisible(!0),this.statsContainer.updateIvs(null))}showStats(){this.speciesStarterDexEntry&&(this.statsContainer.setVisible(!0),this.statsContainer.updateIvs(this.speciesStarterDexEntry.ivs))}clearText(){this.starterSelectMessageBoxContainer.setVisible(!1),super.clearText()}hideInstructions(){this.candyUpgradeIconElement.setVisible(!1),this.candyUpgradeLabel.setVisible(!1),this.shinyIconElement.setVisible(!1),this.shinyLabel.setVisible(!1),this.formIconElement.setVisible(!1),this.formLabel.setVisible(!1),this.genderIconElement.setVisible(!1),this.genderLabel.setVisible(!1),this.variantIconElement.setVisible(!1),this.variantLabel.setVisible(!1)}clear(){super.clear(),this.cursor=-1,this.hideInstructions(),this.activeTooltip=void 0,n.ui.hideTooltip(),this.starterSelectContainer.setVisible(!1),this.blockInput=!1,this.showBackSprite=!1,this.showBackSpriteLabel.setText(S.t("pokedexUiHandler:showBackSprite")),this.statsMode&&this.toggleStatsMode(!1)}checkIconId(e,t,s,i,r,a){e.frame.name!==t.getIconId(s,i,r,a)&&(console.log(`${t.name}'s icon ${e.frame.name} does not match getIconId with female: ${s}, formIndex: ${i}, shiny: ${r}, variant: ${a}`),e.setTexture(t.getIconAtlasKey(i,!1,a)),e.setFrame(t.getIconId(s,i,!1,a)))}};p(Ga,"PokedexPageUiHandler");let Us=Ga;const fl=[L.SAVE_SLOT,L.PARTY,L.SUMMARY,L.STARTER_SELECT,L.EVOLUTION_SCENE,L.EGG_HATCH_SCENE,L.EGG_LIST,L.EGG_GACHA,L.POKEDEX,L.POKEDEX_PAGE,L.CHALLENGE_SELECT,L.RUN_HISTORY],ai=[L.TITLE,L.CONFIRM,L.OPTION_SELECT,L.MENU,L.MENU_OPTION_SELECT,L.GAMEPAD_BINDING,L.KEYBOARD_BINDING,L.SETTINGS,L.SETTINGS_AUDIO,L.SETTINGS_DISPLAY,L.SETTINGS_GAMEPAD,L.SETTINGS_KEYBOARD,L.ACHIEVEMENTS,L.GAME_STATS,L.POKEDEX_SCAN,L.LOGIN_FORM,L.REGISTRATION_FORM,L.LOADING,L.SESSION_RELOAD,L.UNAVAILABLE,L.RENAME_POKEMON,L.TEST_DIALOGUE,L.AUTO_COMPLETE,L.ADMIN,L.MYSTERY_ENCOUNTER,L.RUN_INFO],Ha=class Ha extends Phaser.GameObjects.Container{constructor(){super(n,0,n.game.canvas.height/6),this.mode=L.MESSAGE,this.modeChain=[],this.handlers=[new In,new Wn,new ec,new En,new xn,new On,new tc,new sc,new ic,new nc,new Rs,new rc,new Nn,new er,new ac,new Fs,new Bn,new Fs(L.MENU_OPTION_SELECT),new Si,new Ai,new ki,new Ei,new Xn,new Oi,new Zn,new Rn,new oc,new Fn,new Vn,new Vs,new nr(L.TEST_DIALOGUE),new Us,new Yn,new Gn,new Hn,new jn,new zn,new Mn,new qn,new lc,new Vl,new tr(L.TEST_DIALOGUE),new sr,new Pn,new ir]}setup(){this.setName(`ui-${L[this.mode]}`);for(const e of this.handlers)e.setup();this.overlay=n.add.rectangle(0,0,n.game.canvas.width/6,n.game.canvas.height/6,0),this.overlay.setName("rect-ui-overlay"),this.overlay.setOrigin(0,0),n.uiContainer.add(this.overlay),this.overlay.setVisible(!1),this.setupTooltip(),this.achvBar=new Ln,this.achvBar.setup(),n.uiContainer.add(this.achvBar),this.savingIcon=new Kn,this.savingIcon.setup(),n.uiContainer.add(this.savingIcon)}setupTooltip(){this.tooltipContainer=n.add.container(0,0),this.tooltipContainer.setName("tooltip"),this.tooltipContainer.setVisible(!1),this.tooltipBg=me(0,0,128,31),this.tooltipBg.setName("window-tooltip-bg"),this.tooltipBg.setOrigin(0,0),this.tooltipTitle=V(64,4,"",x.TOOLTIP_TITLE),this.tooltipTitle.setName("text-tooltip-title"),this.tooltipTitle.setOrigin(.5,0),this.tooltipContent=V(6,16,"",x.TOOLTIP_CONTENT),this.tooltipContent.setName("text-tooltip-content"),this.tooltipContent.setWordWrapWidth(850),this.tooltipContainer.add(this.tooltipBg),this.tooltipContainer.add(this.tooltipTitle),this.tooltipContainer.add(this.tooltipContent),n.uiContainer.add(this.tooltipContainer)}getHandler(){return this.handlers[this.mode]}getMessageHandler(){return this.handlers[L.MESSAGE]}processInfoButton(e){var t,s;return this.overlayActive?!1:[L.CONFIRM,L.COMMAND,L.FIGHT,L.MESSAGE,L.TARGET_SELECT].includes(this.mode)?((t=n)==null||t.processInfoButton(e),!0):((s=n)==null||s.processInfoButton(!1),!0)}processInput(e){if(this.overlayActive)return!1;const t=this.getHandler();return t instanceof hc&&t.tutorialActive?t.processTutorialInput(e):t.processInput(e)}showTextPromise(e,t=0,s=!0,i){return new Promise(r=>{this.showText(e??"",null,()=>r(),t,s,i)})}showText(e,t,s,i,r,a){const o=[],l=["#POKEMON1","#POKEMON2"];for(let h=0;h<n.getPlayerField().length;h++)o.push(n.getPlayerField()[h].getNameToRender()),e=e.split(o[h]).join(l[h]);if(r&&e.indexOf("$")>-1){const h=e.split(/\$/g).map(d=>d.trim());let c=p(()=>s&&s(),"showMessageAndCallback");for(let d=h.length-1;d>=0;d--){const f=c;h[d]=h[d].split(l[0]).join(o[0]),h[d]=h[d].split(l[1]).join(o[1]),c=p(()=>this.showText(h[d],null,f,null,!0),"showMessageAndCallback")}c()}else{const h=this.getHandler();for(let c=0;c<n.getPlayerField().length;c++)e=e.split(l[c]).join(o[c]);h instanceof at?h.showText(e,t,s,i,r,a):this.getMessageHandler().showText(e,t,s,i,r,a)}}showDialogue(e,t,s=0,i,r,a){let o=!1,l=e;const h=n.gameData.gender??bt.UNSET,c=bt[h].toLowerCase();if(S.exists(e)){const f=e;if(o=!0,l=S.t(f,{context:c}),this.shouldSkipDialogue(f)){console.log(`Dialogue ${f} skipped`),i();return}}let d=p(()=>{o&&n.gameData.saveSeenDialogue(e),i()},"showMessageAndCallback");if(l.indexOf("$")>-1){const f=l.split(/\$/g).map(u=>u.trim());for(let u=f.length-1;u>=0;u--){const C=d;d=p(()=>this.showDialogue(f[u],t,null,C),"showMessageAndCallback")}d()}else{const f=this.getHandler();f instanceof at?f.showDialogue(l,t,s,d,r,!0,a):this.getMessageHandler().showDialogue(l,t,s,d,r,!0,a)}}shouldSkipDialogue(e){return!!(S.exists(e)&&n.skipSeenDialogues&&n.gameData.getSeenDialogues()[e]===!0)}getTooltip(){return{visible:this.tooltipContainer.visible,title:this.tooltipTitle.text,content:this.tooltipContent.text}}showTooltip(e,t,s){this.tooltipContainer.setVisible(!0),this.editTooltip(e,t),s?n.uiContainer.moveAbove(this.tooltipContainer,this):n.uiContainer.moveBelow(this.tooltipContainer,this)}editTooltip(e,t){this.tooltipTitle.setText(e||"");const s=this.tooltipContent.runWordWrap(t);this.tooltipContent.setText(s),this.tooltipContent.y=e?16:4,this.tooltipBg.width=Math.min(Math.max(this.tooltipTitle.displayWidth,this.tooltipContent.displayWidth)+12,838),this.tooltipBg.height=(e?31:19)+10.5*(s.split(`
`).length-1),this.tooltipTitle.x=this.tooltipBg.width/2}hideTooltip(){this.tooltipContainer.setVisible(!1),this.tooltipTitle.clearTint()}update(){if(this.tooltipContainer.visible){const e=n.inputMethod==="touch",t=n.game.input.activePointer.x,s=n.game.input.activePointer.y,i=this.tooltipBg.width,r=this.tooltipBg.height,a=2;let o=e?a:t/6+a,l=e?a:s/6+a;e?t<=n.game.canvas.width/2&&s<=n.game.canvas.height/2&&(o=n.game.canvas.width/6-i-a):(o+i+a>n.game.canvas.width/6&&(o=Math.max(a,t/6-i-a)),l+r+a>n.game.canvas.height/6&&(l=Math.max(a,s/6-r-a))),this.tooltipContainer.setPosition(o,l)}}clearText(){const e=this.getHandler();e instanceof at?e.clearText():this.getMessageHandler().clearText()}setCursor(e){const t=this.getHandler().setCursor(e);return t&&this.playSelect(),t}playSelect(){n.playSound("ui/select")}playError(){n.playSound("ui/error")}fadeOut(e){return new Promise(t=>{if(this.overlayActive)return t();this.overlayActive=!0,this.overlay.setAlpha(0),this.overlay.setVisible(!0),n.tweens.add({targets:this.overlay,alpha:1,duration:e,ease:"Sine.easeOut",onComplete:p(()=>t(),"onComplete")})})}fadeIn(e){return new Promise(t=>{if(!this.overlayActive)return t();n.tweens.add({targets:this.overlay,alpha:0,duration:e,ease:"Sine.easeIn",onComplete:p(()=>{this.overlay.setVisible(!1),t()},"onComplete")}),this.overlayActive=!1})}setModeInternal(e,t,s,i,r){return new Promise(a=>{if(this.mode===e&&!s){a();return}const o=p(()=>{if(this.mode!==e){t&&this.getHandler().clear(),i&&this.mode&&!t&&(this.modeChain.push(this.mode),n.updateGameInfo()),this.mode=e;const l=document==null?void 0:document.getElementById("touchControls");l&&(l.dataset.uiMode=L[e]),this.getHandler().show(r)}a()},"doSetMode");!i&&(fl.indexOf(this.mode)>-1||fl.indexOf(e)>-1)&&ai.indexOf(this.mode)===-1&&ai.indexOf(e)===-1||i&&ai.indexOf(e)===-1?this.fadeOut(250).then(()=>{n.time.delayedCall(100,()=>{o(),this.fadeIn(250)})}):o()})}getMode(){return this.mode}setMode(e,...t){return this.setModeInternal(e,!0,!1,!1,t)}setModeForceTransition(e,...t){return this.setModeInternal(e,!0,!0,!1,t)}setModeWithoutClear(e,...t){return this.setModeInternal(e,!1,!1,!1,t)}setOverlayMode(e,...t){return this.setModeInternal(e,!1,!1,!0,t)}resetModeChain(){this.modeChain=[],n.updateGameInfo()}revertMode(){return new Promise(e=>{var i;if(!((i=this==null?void 0:this.modeChain)!=null&&i.length))return e(!1);const t=this.mode,s=p(()=>{this.getHandler().clear(),this.mode=this.modeChain.pop(),n.updateGameInfo();const r=document.getElementById("touchControls");r&&(r.dataset.uiMode=L[this.mode]),e(!0)},"doRevertMode");ai.indexOf(t)===-1?this.fadeOut(250).then(()=>{n.time.delayedCall(100,()=>{s(),this.fadeIn(250)})}):s()})}revertModes(){return new Promise(e=>{var t;if(!((t=this==null?void 0:this.modeChain)!=null&&t.length))return e();this.revertMode().then(s=>El(s,this.revertModes).then(()=>e()))})}getModeChain(){return this.modeChain}getGamepadType(){return n.inputMethod==="gamepad"?n.inputController.getConfig(n.inputController.selectedDevice[Se.GAMEPAD]).padType:n.inputMethod}freeUIData(){this.handlers.forEach(e=>e.destroy()),this.handlers=[],ot.getInstance().clearNavigationMenus()}};p(Ha,"UI");let ar=Ha;function qu(){const P=this,e=p(l=>l instanceof uh?l.value:P.gameSpeed===1?l:Math.ceil(l/=P.gameSpeed),"transformValue"),t=this.time.addEvent;this.time.addEvent=function(l){return!(l instanceof Phaser.Time.TimerEvent)&&l.delay&&(l.delay=e(l.delay)),t.apply(this,[l])};const s=this.tweens.add;this.tweens.add=function(l){return l.loopDelay&&(l.loopDelay=e(l.loopDelay)),l instanceof Phaser.Tweens.TweenChain||(l.duration&&(l.duration=e(l.duration)),l instanceof Phaser.Tweens.Tween||(l.delay&&(l.delay=e(l.delay)),l.repeatDelay&&(l.repeatDelay=e(l.repeatDelay)),l.hold&&(l.hold=e(l.hold)))),s.apply(this,[l])};const i=this.tweens.chain;this.tweens.chain=function(l){if(l.tweens)for(const h of l.tweens)h.duration&&(h.duration=e(h.duration)),h.delay&&(h.delay=e(h.delay)),h.repeatDelay&&(h.repeatDelay=e(h.repeatDelay)),h.loopDelay&&(h.loopDelay=e(h.loopDelay)),h.hold&&(h.hold=e(h.hold));return i.apply(this,[l])};const r=this.tweens.addCounter;this.tweens.addCounter=function(l){return l.duration&&(l.duration=e(l.duration)),l.delay&&(l.delay=e(l.delay)),l.repeatDelay&&(l.repeatDelay=e(l.repeatDelay)),l.loopDelay&&(l.loopDelay=e(l.loopDelay)),l.hold&&(l.hold=e(l.hold)),r.apply(this,[l])};const a=Ts.fadeOut;Ts.fadeOut=(l,h,c,d)=>a(n,h,e(c),d);const o=Ts.fadeIn;Ts.fadeIn=(l,h,c,d,f)=>o(n,h,e(c),d,f)}p(qu,"initGameSpeed");const gl=118,Qu=0,ml=-116,Wa=class Wa extends Phaser.GameObjects.Container{constructor(){super(n,gl,ml),this.abilityBars=[],this.player=!0,this.shown=!1}setup(){for(const e of["ability_bar_right","ability_bar_left"]){const t=n.add.image(0,0,e);t.setOrigin(0,0),t.setVisible(!1),this.add(t),this.abilityBars.push(t)}this.abilityBarText=V(15,3,"",x.MESSAGE,{fontSize:"72px"}),this.abilityBarText.setOrigin(0,0),this.abilityBarText.setWordWrapWidth(600,!0),this.add(this.abilityBarText),this.bringToTop(this.abilityBarText),this.setVisible(!1),this.setX(-118)}setVisible(e){return this.abilityBars[+this.player].setVisible(e),this.shown=e,this}async startTween(e,t){return this.setVisible(!0),t&&this.abilityBarText.setText(t),new Promise(s=>{n.tweens.add({...e,onComplete:p(()=>{e.onComplete&&e.onComplete(),s()},"onComplete")})})}async showAbility(e,t,s=!1,i=!0){const r=`${S.t("fightUiHandler:abilityFlyInText",{pokemonName:e,passive:s?S.t("fightUiHandler:passive"):"",abilityName:t})}`;this.screenRight=n.scaledCanvas.width,i!==this.player&&(this.setX(i?-118:this.screenRight),this.player=i),n.fieldUI.bringToTop(this);let a=ml;return this.player?a+=n.currentBattle.double?14:0:a-=n.currentBattle.double?28:14,this.setY(a),this.startTween({targets:this,x:this.player?Qu:this.screenRight-gl,duration:500,ease:"Sine.easeOut",hold:1e3},r)}async hide(){return this.startTween({targets:this,x:this.player?-118:this.screenRight,duration:200,ease:"Sine.easeIn",onComplete:p(()=>{this.setVisible(!1)},"onComplete")})}isVisible(){return this.shown}};p(Wa,"AbilityBar");let or=Wa;const Ju=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D uMainSampler[%count%];

varying vec2 outTexCoord;
varying float outTexId;
varying float outTintEffect;
varying vec4 outTint;

uniform float time;
uniform int ignoreTimeTint;
uniform int isOutside;
uniform vec3 dayTint;
uniform vec3 duskTint;
uniform vec3 nightTint;
uniform vec3 terrainColor;
uniform float terrainColorRatio;

float blendOverlay(float base, float blend) {
	return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));
}

vec3 blendOverlay(vec3 base, vec3 blend) {
	return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));
}

vec3 blendHardLight(vec3 base, vec3 blend) {
	return blendOverlay(blend, base);
}

float hue2rgb(float f1, float f2, float hue) {
	if (hue < 0.0)
		hue += 1.0;
	else if (hue > 1.0)
		hue -= 1.0;
	float res;
	if ((6.0 * hue) < 1.0)
		res = f1 + (f2 - f1) * 6.0 * hue;
	else if ((2.0 * hue) < 1.0)
		res = f2;
	else if ((3.0 * hue) < 2.0)
		res = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;
	else
		res = f1;
	return res;
}

vec3 rgb2hsl(vec3 color) {
	vec3 hsl;
	
	float fmin = min(min(color.r, color.g), color.b);
	float fmax = max(max(color.r, color.g), color.b);
	float delta = fmax - fmin;

	hsl.z = (fmax + fmin) / 2.0;

	if (delta == 0.0) {
		hsl.x = 0.0;
		hsl.y = 0.0;
	} else {
		if (hsl.z < 0.5)
			hsl.y = delta / (fmax + fmin);
		else
			hsl.y = delta / (2.0 - fmax - fmin);
		
		float deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;
		float deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;
		float deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;

		if (color.r == fmax )
			hsl.x = deltaB - deltaG;
		else if (color.g == fmax)
			hsl.x = (1.0 / 3.0) + deltaR - deltaB;
		else if (color.b == fmax)
			hsl.x = (2.0 / 3.0) + deltaG - deltaR;

		if (hsl.x < 0.0)
			hsl.x += 1.0;
		else if (hsl.x > 1.0)
			hsl.x -= 1.0;
	}

	return hsl;
}

vec3 hsl2rgb(vec3 hsl) {
	vec3 rgb;
	
	if (hsl.y == 0.0)
		rgb = vec3(hsl.z);
	else {
		float f2;
		
		if (hsl.z < 0.5)
			f2 = hsl.z * (1.0 + hsl.y);
		else
			f2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);
			
		float f1 = 2.0 * hsl.z - f2;
		
		rgb.r = hue2rgb(f1, f2, hsl.x + (1.0/3.0));
		rgb.g = hue2rgb(f1, f2, hsl.x);
		rgb.b = hue2rgb(f1, f2, hsl.x - (1.0/3.0));
	}
	
	return rgb;
}

vec3 blendHue(vec3 base, vec3 blend) {
	vec3 baseHSL = rgb2hsl(base);
	return hsl2rgb(vec3(rgb2hsl(blend).r, baseHSL.g, baseHSL.b));
}

void main() {
	vec4 texture;

	%forloop%

	vec4 texel = vec4(outTint.bgr * outTint.a, outTint.a);

	//  Multiply texture tint
	vec4 color = texture * texel;

	if (outTintEffect == 1.0) {
		//  Solid color + texture alpha
		color.rgb = mix(texture.rgb, outTint.bgr * outTint.a, texture.a);
	} else if (outTintEffect == 2.0) {
		//  Solid color, no texture
		color = texel;
	}

	/* Apply day/night tint */
	if (color.a > 0.0 && ignoreTimeTint == 0) {
		vec3 dayNightTint;

		if (time < 0.25) {
			dayNightTint = dayTint;
		} else if (isOutside == 0 && time < 0.5) {
			dayNightTint = mix(dayTint, nightTint, (time - 0.25) / 0.25);
		} else if (time < 0.375) {
			dayNightTint = mix(dayTint, duskTint, (time - 0.25) / 0.125);
		} else if (time < 0.5) {
			dayNightTint = mix(duskTint, nightTint, (time - 0.375) / 0.125);
		} else if (time < 0.75) {
			dayNightTint = nightTint;
		} else if (isOutside == 0) {
			dayNightTint = mix(nightTint, dayTint, (time - 0.75) / 0.25);
		} else if (time < 0.875) {
			dayNightTint = mix(nightTint, duskTint, (time - 0.75) / 0.125);
		} else {
			dayNightTint = mix(duskTint, dayTint, (time - 0.875) / 0.125);
		}

		color = vec4(blendHardLight(color.rgb, dayNightTint), color.a);
	}

	if (terrainColorRatio > 0.0 && (1.0 - terrainColorRatio) < outTexCoord.y) {
		if (color.a > 0.0 && (terrainColor.r > 0.0 || terrainColor.g > 0.0 || terrainColor.b > 0.0)) {
			color.rgb = mix(color.rgb, blendHue(color.rgb, terrainColor), 1.0);
		}
	}

	gl_FragColor = color;
}`,nh=`precision mediump float;

uniform mat4 uProjectionMatrix;
uniform int uRoundPixels;
uniform vec2 uResolution;

attribute vec2 inPosition;
attribute vec2 inTexCoord;
attribute float inTexId;
attribute float inTintEffect;
attribute vec4 inTint;

varying vec2 outTexCoord;
varying float outTexId;
varying vec2 outPosition;
varying float outTintEffect;
varying vec4 outTint;

void main()
{
	gl_Position = uProjectionMatrix * vec4(inPosition, 1.0, 1.0);
	if (uRoundPixels == 1)
	{
		gl_Position.xy = floor(((gl_Position.xy + 1.0) * 0.5 * uResolution) + 0.5) / uResolution * 2.0 - 1.0;
	}
	outTexCoord = inTexCoord;
	outTexId = inTexId;
	outPosition = inPosition;
	outTint = inTint;
	outTintEffect = inTintEffect;
}`,Ka=class Ka extends Phaser.Renderer.WebGL.Pipelines.MultiPipeline{constructor(e,t){super(t||{game:e,name:"field-sprite",fragShader:Ju,vertShader:nh})}onPreRender(){this.set1f("time",0),this.set1i("ignoreTimeTint",0),this.set1f("terrainColorRatio",0),this.set3fv("terrainColor",[0,0,0])}onBind(e){var o,l;super.onBind();const s=e.pipelineData,i=s.ignoreTimeTint,r=s.terrainColorRatio||0,a=(o=n.currentBattle)!=null&&o.waveIndex?(n.currentBattle.waveIndex+n.waveCycleOffset)%40/40:ph();this.set1f("time",a),this.set1i("ignoreTimeTint",i?1:0),this.set1i("isOutside",n.arena.isOutside()?1:0),this.set3fv("dayTint",n.arena.getDayTint().map(h=>h/255)),this.set3fv("duskTint",n.arena.getDuskTint().map(h=>h/255)),this.set3fv("nightTint",n.arena.getNightTint().map(h=>h/255)),this.set3fv("terrainColor",cc(((l=n.arena.terrain)==null?void 0:l.terrainType)||Ps.NONE).map(h=>h/255)),this.set1f("terrainColorRatio",r)}onBatch(e){e&&this.flush()}};p(Ka,"FieldSpritePipeline");let Li=Ka;const ep=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D uMainSampler[%count%];

varying vec2 outTexCoord;
varying float outTexId;
varying vec2 outPosition;
varying float outTintEffect;
varying vec4 outTint;

uniform float time;
uniform int ignoreTimeTint;
uniform int isOutside;
uniform vec3 dayTint;
uniform vec3 duskTint;
uniform vec3 nightTint;
uniform float teraTime;
uniform vec3 teraColor;
uniform int hasShadow;
uniform int yCenter;
uniform float fieldScale;
uniform float vCutoff;
uniform vec2 relPosition;
uniform vec2 texFrameUv;
uniform vec2 size;
uniform vec2 texSize;
uniform float yOffset;
uniform float yShadowOffset;
uniform vec4 tone;
uniform vec4 baseVariantColors[32];
uniform vec4 variantColors[32];
uniform vec4 spriteColors[32];
uniform ivec4 fusionSpriteColors[32];

const vec3 lumaF = vec3(.299, .587, .114);

float blendOverlay(float base, float blend) {
	return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));
}

vec3 blendOverlay(vec3 base, vec3 blend) {
	return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));
}

vec3 blendHardLight(vec3 base, vec3 blend) {
	return blendOverlay(blend, base);
}

float hue2rgb(float f1, float f2, float hue) {
	if (hue < 0.0)
		hue += 1.0;
	else if (hue > 1.0)
		hue -= 1.0;
	float res;
	if ((6.0 * hue) < 1.0)
		res = f1 + (f2 - f1) * 6.0 * hue;
	else if ((2.0 * hue) < 1.0)
		res = f2;
	else if ((3.0 * hue) < 2.0)
		res = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;
	else
		res = f1;
	return res;
}

vec3 rgb2hsl(vec3 color) {
	vec3 hsl;
	float fmin = min(min(color.r, color.g), color.b);
	float fmax = max(max(color.r, color.g), color.b);
	float delta = fmax - fmin;

	hsl.z = (fmax + fmin) / 2.0;

	if (delta == 0.0) {
		hsl.x = 0.0;
		hsl.y = 0.0;
	} else {
		if (hsl.z < 0.5)
			hsl.y = delta / (fmax + fmin);
		else
			hsl.y = delta / (2.0 - fmax - fmin);
		
		float deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;
		float deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;
		float deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;

		if (color.r == fmax )
			hsl.x = deltaB - deltaG;
		else if (color.g == fmax)
			hsl.x = (1.0 / 3.0) + deltaR - deltaB;
		else if (color.b == fmax)
			hsl.x = (2.0 / 3.0) + deltaG - deltaR;

		if (hsl.x < 0.0)
			hsl.x += 1.0;
		else if (hsl.x > 1.0)
			hsl.x -= 1.0;
	}

	return hsl;
}

vec3 hsl2rgb(vec3 hsl) {
	vec3 rgb;
	
	if (hsl.y == 0.0)
		rgb = vec3(hsl.z);
	else {
		float f2;
		
		if (hsl.z < 0.5)
			f2 = hsl.z * (1.0 + hsl.y);
		else
			f2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);
			
		float f1 = 2.0 * hsl.z - f2;
		
		rgb.r = hue2rgb(f1, f2, hsl.x + (1.0/3.0));
		rgb.g = hue2rgb(f1, f2, hsl.x);
		rgb.b= hue2rgb(f1, f2, hsl.x - (1.0/3.0));
	}
	
	return rgb;
}

vec3 blendHue(vec3 base, vec3 blend) {
	vec3 baseHSL = rgb2hsl(base);
	return hsl2rgb(vec3(rgb2hsl(blend).r, baseHSL.g, baseHSL.b));
}

vec3 rgb2hsv(vec3 c) {
	vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
	vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
	vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

	float d = q.x - min(q.w, q.y);
	float e = 1.0e-10;
	return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
}

vec3 hsv2rgb(vec3 c) {
	vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
	vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
	return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

void main() {
	vec4 texture = texture2D(uMainSampler[0], outTexCoord);

	for (int i = 0; i < 32; i++) {
		if (baseVariantColors[i].a == 0.0)
			break;
		if (texture.a > 0.0 && all(lessThan(abs(texture.rgb - baseVariantColors[i].rgb), vec3(1.0/255.0)))) {
			texture.rgb = variantColors[i].rgb;
			break;
		}
	}

	for (int i = 0; i < 32; i++) {
		if (spriteColors[i][3] == 0.0)
			break;
		if (texture.a > 0.0 && all(lessThan(abs(texture.rgb - spriteColors[i].rgb), vec3(1.0/255.0)))) {
			vec3 fusionColor = vec3(fusionSpriteColors[i].rgb) / 255.0;
			vec3 bg = spriteColors[i].rgb;
			float gray = (bg.r + bg.g + bg.b) / 3.0;
			bg = vec3(gray);
			vec3 fg = fusionColor;
			texture.rgb = mix(1.0 - 2.0 * (1.0 - bg) * (1.0 - fg), 2.0 * bg * fg, step(bg, vec3(0.5)));
			break;
		}
	}

	vec4 texel = vec4(outTint.bgr * outTint.a, outTint.a);

	//  Multiply texture tint
	vec4 color = texture * texel;

	if (color.a > 0.0 && teraColor.r > 0.0 && teraColor.g > 0.0 && teraColor.b > 0.0) {
		vec2 relUv = (outTexCoord.xy - texFrameUv.xy) / (size.xy / texSize.xy);
		vec2 teraTexCoord = vec2(relUv.x * (size.x / 200.0), relUv.y * (size.y / 120.0));
		vec4 teraCol = texture2D(uMainSampler[1], teraTexCoord);
		float floorValue = 86.0 / 255.0;
		vec3 teraPatternHsv = rgb2hsv(teraCol.rgb);
		teraCol.rgb = hsv2rgb(vec3((teraPatternHsv.b - floorValue) * 4.0 + teraTexCoord.x * fieldScale / 2.0 + teraTexCoord.y * fieldScale / 2.0 + teraTime * 255.0, teraPatternHsv.b, teraPatternHsv.b));

		color.rgb = mix(color.rgb, blendHue(color.rgb, teraColor), 0.625);
		teraCol.rgb = mix(teraCol.rgb, teraColor, 0.5);
		color.rgb = blendOverlay(color.rgb, teraCol.rgb);

		if (any(lessThan(teraCol.rgb, vec3(1.0)))) {
			vec3 teraColHsv = rgb2hsv(teraColor);
			color.rgb = mix(color.rgb, teraColor, (1.0 - teraColHsv.g) / 2.0);
		}
	}

	if (outTintEffect == 1.0) {
		//  Solid color + texture alpha
		color.rgb = mix(texture.rgb, outTint.bgr * outTint.a, texture.a);
	} else if (outTintEffect == 2.0) {
		//  Solid color, no texture
		color = texel;
	}

	/* Apply gray */
	float luma = dot(color.rgb, lumaF);
	color.rgb = mix(color.rgb, vec3(luma), tone.w);

	/* Apply tone */
	color.rgb += tone.rgb * (color.a / 255.0);

	/* Apply day/night tint */
	if (color.a > 0.0 && ignoreTimeTint == 0) {
		vec3 dayNightTint;

		if (time < 0.25) {
			dayNightTint = dayTint;
		} else if (isOutside == 0 && time < 0.5) {
			dayNightTint = mix(dayTint, nightTint, (time - 0.25) / 0.25);
		} else if (time < 0.375) {
			dayNightTint = mix(dayTint, duskTint, (time - 0.25) / 0.125);
		} else if (time < 0.5) {
			dayNightTint = mix(duskTint, nightTint, (time - 0.375) / 0.125);
		} else if (time < 0.75) {
			dayNightTint = nightTint;
		} else if (isOutside == 0) {
			dayNightTint = mix(nightTint, dayTint, (time - 0.75) / 0.25);
		} else if (time < 0.875) {
			dayNightTint = mix(nightTint, duskTint, (time - 0.75) / 0.125);
		} else {
			dayNightTint = mix(duskTint, dayTint, (time - 0.875) / 0.125);
		}

		color.rgb = blendHardLight(color.rgb, dayNightTint);
	}

	if (hasShadow == 1) {
		float width = size.x - (yOffset / 2.0);

		float spriteX = ((floor(outPosition.x / fieldScale) - relPosition.x) / width) + 0.5;
		float spriteY = ((floor(outPosition.y / fieldScale) - relPosition.y - yShadowOffset) / size.y);

		if (yCenter == 1) {
			spriteY += 0.5;
		} else {
			spriteY += 1.0;
		}

		bool yOverflow = outTexCoord.y >= vCutoff;

		if ((spriteY >= 0.9 && (color.a == 0.0 || yOverflow))) {
			float shadowSpriteY = (spriteY - 0.9) * (1.0 / 0.15);
			if (distance(vec2(spriteX, shadowSpriteY), vec2(0.5)) < 0.5) {
				color = vec4(vec3(0.0), 0.5);
			} else if (yOverflow) {
				discard;
			}
		} else if (yOverflow) {
			discard;
		}
	}

	gl_FragColor = color;
}`,za=class za extends Li{constructor(e){super(e,{game:e,name:"sprite",fragShader:ep,vertShader:nh}),this._tone=[0,0,0,0]}onPreRender(){super.onPreRender(),this.set1f("teraTime",0),this.set3fv("teraColor",[0,0,0]),this.set1i("hasShadow",0),this.set1i("yCenter",0),this.set2f("relPosition",0,0),this.set2f("texFrameUv",0,0),this.set2f("size",0,0),this.set2f("texSize",0,0),this.set1f("yOffset",0),this.set1f("yShadowOffset",0),this.set4fv("tone",this._tone)}onBind(e){super.onBind(e);const t=e,s=t.pipelineData,i=s.tone,r=s.isTerastallized?s.teraColor??[0,0,0]:[0,0,0],a=s.hasShadow,o=s.yShadowOffset,l=s.ignoreFieldPos,h=s.ignoreOverride,c=t.parentContainer instanceof Ut||t.parentContainer instanceof Tn||t.parentContainer instanceof Do,d=c?t.parentContainer.parentContainer:t.parentContainer,f=c?[t.parentContainer.x,t.parentContainer.y]:[t.x,t.y];if(d&&(f[0]+=d.x/d.scale,f[1]+=d.y/d.scale),f[0]+=-(t.width-t.frame.width)/2+t.frame.x+(l?0:t.x-d.x),t.originY===.5&&(f[1]+=t.height/2*((c?t.parentContainer:t).scale-1)+(l?0:t.y-d.y)),this.set1f("teraTime",this.game.getTime()%5e5/5e5),this.set3fv("teraColor",r.map(u=>u/255)),this.set1i("hasShadow",a?1:0),this.set1i("yCenter",t.originY===.5?1:0),this.set1f("fieldScale",(d==null?void 0:d.scale)||1),this.set2f("relPosition",f[0],f[1]),this.set2f("texFrameUv",t.frame.u0,t.frame.v0),this.set2f("size",t.frame.width,t.height),this.set2f("texSize",t.texture.source[0].width,t.texture.source[0].height),this.set1f("yOffset",t.height-t.frame.height*(c?t.parentContainer.scale:t.scale)),this.set1f("yShadowOffset",o??0),this.set4fv("tone",i),this.bindTexture(this.game.textures.get("tera").source[0].glTexture,1),n.fusionPaletteSwaps){const u=h&&s.spriteColorsBase||s.spriteColors||[],C=h&&s.fusionSpriteColorsBase||s.fusionSpriteColors||[],g=[0,0,0,0],v=[],m=[];for(let b=0;b<32;b++)v.splice(v.length,0,...b<u.length?u[b].map(E=>E/255):g),m.splice(m.length,0,...b<C.length?C[b]:g);this.set4fv("spriteColors",v.flat()),this.set4iv("fusionSpriteColors",m.flat())}}onBatch(e){if(e){const t=e,s=t.pipelineData,i=s.hasOwnProperty("variant")?s.variant:t.parentContainer instanceof Ut?t.parentContainer.variant:0;let r;const a=[0,0,0,0],o=[],l=[];if((t.parentContainer instanceof Ut?t.parentContainer.shiny:s.shiny)&&(r=dc[t.parentContainer instanceof Ut?t.parentContainer.getSprite().texture.key:s.spriteKey])&&r.hasOwnProperty(i)){const h=Object.keys(r[i]);for(let c=0;c<32;c++)if(c<h.length){const d=Array.from(Object.values(it(h[c]))),f=Array.from(Object.values(it(r[i][h[c]])));o.splice(o.length,0,...d.map(u=>u/255)),l.splice(l.length,0,...f.map(u=>u/255))}else o.splice(o.length,0,...a),l.splice(l.length,0,...a)}else for(let h=0;h<32;h++)o.splice(o.length,0,...a),l.splice(l.length,0,...a);this.set4fv("baseVariantColors",o.flat()),this.set4fv("variantColors",l.flat())}super.onBatch(e)}batchQuad(e,t,s,i,r,a,o,l,h,c,d,f,u,C,g,v,m,b,E,w){const _=e;this.set1f("vCutoff",u);const A=_.pipelineData.hasShadow,D=_.pipelineData.yShadowOffset??0;if(A){const j=_.parentContainer instanceof Ut||_.parentContainer instanceof Tn||_.parentContainer instanceof Do,B=j?_.parentContainer.parentContainer:_.parentContainer,$=B.scale/6,ie=(j?_.parentContainer.y:_.y+_.height)*6/$,k=Math.ceil(_.height*.05+Math.max(D,0))*6/$,U=(ie-r)/B.scale;o=r=ie+k;const T=(u-d)/(_.frame.height*(j?_.parentContainer.scale:_.scale));u+=(U+k/B.scale)*T}return super.batchQuad(e,t,s,i,r,a,o,l,h,c,d,f,u,C,g,v,m,b,E,w)}get tone(){return this._tone}set tone(e){this._tone=e}};p(za,"SpritePipeline");let lr=za;const ja=class ja extends Phaser.GameObjects.Container{constructor(){super(n,n.game.canvas.width/6,-(n.game.canvas.height/6)+15)}setup(){this.bg=n.add.nineslice(0,0,"party_exp_bar",void 0,8,18,21,5,6,4),this.bg.setOrigin(0,0),this.add(this.bg),this.expText=V(22,4,"",x.BATTLE_INFO),this.expText.setOrigin(0,0),this.add(this.expText),this.setVisible(!1),this.shown=!1}showPokemonExp(e,t,s,i){return new Promise(r=>{if(this.shown)return r();this.pokemonIcon=n.addPokemonIcon(e,-8,15,0,.5),this.pokemonIcon.setScale(.5),this.add(this.pokemonIcon),s?i>200?this.expText.setText(S.t("battleScene:levelUp")):this.expText.setText(S.t("battleScene:levelUpWithLevel",{level:i})):this.expText.setText(`+${t.toString()}`),this.bg.width=this.expText.displayWidth+28,n.fieldUI.bringToTop(this),this.tween&&this.tween.stop(),this.tween=n.tweens.add({targets:this,x:n.game.canvas.width/6-(this.bg.width-5),duration:500/Math.pow(2,n.expGainsSpeed),ease:"Sine.easeOut",onComplete:p(()=>{this.tween=null,r()},"onComplete")}),this.setVisible(!0),this.shown=!0})}hide(){return new Promise(e=>{if(!this.shown)return e();this.tween&&this.tween.stop(),this.tween=n.tweens.add({targets:this,x:n.game.canvas.width/6,duration:500,ease:"Sine.easeIn",onComplete:p(()=>{var t;this.tween=null,this.shown=!1,this.setVisible(!1),(t=this.pokemonIcon)==null||t.destroy(),e()},"onComplete")})})}};p(ja,"PartyExpBar");let hr=ja;const Xa=class Xa extends Phaser.GameObjects.Container{constructor(e){super(n,e?n.game.canvas.width/6:0,e?-72:-144),this.player=e}setup(){this.bg=n.add.nineslice(0,0,`pb_tray_overlay_${this.player?"player":"enemy"}`,void 0,104,4,48,8,0,0),this.bg.setOrigin(this.player?1:0,0),this.add(this.bg),this.balls=new Array(6).fill(null).map((e,t)=>n.add.sprite((this.player?-83:76)+n.game.canvas.width/6*(this.player?-1:1)+10*t*(this.player?1:-1),-8,"pb_tray_ball","empty"));for(const e of this.balls)e.setOrigin(0,0),this.add(e);this.setVisible(!1),this.shown=!1}showPbTray(e){return new Promise(t=>{if(this.shown)return t();n.fieldUI.bringToTop(this),this.x+=104*(this.player?1:-1),this.bg.width=104,this.bg.alpha=1,this.balls.forEach((s,i)=>{s.x+=(n.game.canvas.width/6+104)*(this.player?1:-1);let r="ball";i>=e.length?r="empty":e[i].hp?e[i].status&&(r="status"):r="faint",s.setFrame(r)}),n.playSound("se/pb_tray_enter"),n.tweens.add({targets:this,x:`${this.player?"-":"+"}=104`,duration:500,ease:"Sine.easeIn",onComplete:p(()=>{this.balls.forEach((s,i)=>{n.tweens.add({targets:s,x:`${this.player?"-":"+"}=104`,duration:i*100,ease:"Sine.easeIn",onComplete:p(()=>n.playSound(`se/${i<e.length?"pb_tray_ball":"pb_tray_empty"}`),"onComplete")})})},"onComplete")}),this.setVisible(!0),this.shown=!0,n.time.delayedCall(1100,()=>t())})}hide(){return new Promise(e=>{if(!this.shown)return e();this.balls.forEach((t,s)=>{n.tweens.add({targets:t,x:`${this.player?"-":"+"}=${n.game.canvas.width/6}`,duration:250,delay:s*100,ease:"Sine.easeIn"})}),n.tweens.add({targets:this.bg,width:144,alpha:0,duration:500,ease:"Sine.easeIn"}),n.time.delayedCall(850,()=>{this.setVisible(!1),e()}),this.shown=!1})}};p(Xa,"PokeballTray");let Di=Xa;const $a=class $a extends uc{constructor(e,t,s){super(e,null,0),this.formChange=t,this.modal=s}validate(){return!!this.formChange}setMode(){return this.modal?n.ui.setOverlayMode(L.EVOLUTION_SCENE):super.setMode()}doEvolution(){const e=is(this.pokemon);this.pokemon.getPossibleForm(this.formChange).then(t=>{[this.pokemonEvoSprite,this.pokemonEvoTintSprite].map(s=>{const i=t.getSpriteKey(!0);try{s.play(i)}catch(r){console.error(`Failed to play animation for ${i}`,r)}s.setPipelineData("ignoreTimeTint",!0),s.setPipelineData("spriteKey",t.getSpriteKey()),s.setPipelineData("shiny",t.shiny),s.setPipelineData("variant",t.variant),["spriteColors","fusionSpriteColors"].map(r=>{t.summonData.speciesForm&&(r+="Base"),s.pipelineData[r]=t.getSprite().pipelineData[r]})}),n.time.delayedCall(250,()=>{n.tweens.add({targets:this.evolutionBgOverlay,alpha:1,delay:500,duration:1500,ease:"Sine.easeOut",onComplete:p(()=>{n.time.delayedCall(1e3,()=>{n.tweens.add({targets:this.evolutionBgOverlay,alpha:0,duration:250}),this.evolutionBg.setVisible(!0),this.evolutionBg.play()}),n.playSound("se/charge"),this.doSpiralUpward(),n.tweens.addCounter({from:0,to:1,duration:2e3,onUpdate:p(s=>{this.pokemonTintSprite.setAlpha(s.getValue())},"onUpdate"),onComplete:p(()=>{this.pokemonSprite.setVisible(!1),n.time.delayedCall(1100,()=>{n.playSound("se/beam"),this.doArcDownward(),n.time.delayedCall(1e3,()=>{this.pokemonEvoTintSprite.setScale(.25),this.pokemonEvoTintSprite.setVisible(!0),this.doCycle(1,1).then(s=>{n.playSound("se/sparkle"),this.pokemonEvoSprite.setVisible(!0),this.doCircleInward(),n.time.delayedCall(900,()=>{this.pokemon.changeForm(this.formChange).then(()=>{this.modal||n.unshiftPhase(new pc),n.playSound("se/shine"),this.doSpray(),n.tweens.add({targets:this.evolutionOverlay,alpha:1,duration:250,easing:"Sine.easeIn",onComplete:p(()=>{this.evolutionBgOverlay.setAlpha(1),this.evolutionBg.setVisible(!1),n.tweens.add({targets:[this.evolutionOverlay,this.pokemonEvoTintSprite],alpha:0,duration:2e3,delay:150,easing:"Sine.easeIn",onComplete:p(()=>{n.tweens.add({targets:this.evolutionBgOverlay,alpha:0,duration:250,onComplete:p(()=>{n.time.delayedCall(250,()=>{this.pokemon.cry(),n.time.delayedCall(1250,()=>{let i=!1;this.formChange.formKey.indexOf(Xi.MEGA)>-1?(n.validateAchv(Ge.MEGA_EVOLVE),i=!0):(this.formChange.formKey.indexOf(Xi.GIGANTAMAX)>-1||this.formChange.formKey.indexOf(Xi.ETERNAMAX)>-1)&&(n.validateAchv(Ge.GIGANTAMAX),i=!0);const r=i?4e3:1750;n.playSoundWithoutBgm(i?"evolution_fanfare":"minor_fanfare"),t.destroy(),n.ui.showText(Sn(this.pokemon,this.formChange,e),null,()=>this.end(),null,!0,ye(r)),n.time.delayedCall(ye(r+250),()=>n.playBgm())})})},"onComplete")})},"onComplete")})},"onComplete")})})})})})})},"onComplete")})},"onComplete")})})})}end(){this.pokemon.findAndRemoveTags(e=>e.tagType===ss.AUTOTOMIZED),this.modal?n.ui.revertMode().then(()=>{if(n.ui.getMode()===L.PARTY){const e=n.ui.getHandler();e.clearPartySlots(),e.populatePartySlots()}super.end()}):super.end()}};p($a,"FormChangePhase");let cr=$a;const Za=class Za{setup(){this.sprites=new Set,n.tweens.addCounter({duration:ye(200),from:0,to:1,yoyo:!0,repeat:-1,onRepeat:p(()=>this.onLapse(),"onRepeat")})}onLapse(){Array.from(this.sprites.values()).filter(e=>!e.scene).map(e=>this.sprites.delete(e));for(const e of this.sprites.values()){if(!e.pipelineData.teraColor||!e.pipelineData.teraColor.find(f=>f)||!e.visible||e.parentContainer instanceof Ut&&!e.parentContainer.parentContainer||!(e.parentContainer instanceof Ut)||!e.parentContainer.isTerastallized)continue;const t=e.parentContainer instanceof Ut?e.parentContainer:null,s=(t||e).parentContainer,i=e.texture,[r,a]=[i.source[0].width,i.source[0].height],[o,l]=[fn(r),fn(a)],h=e.width/r,c=e.height/a,d=i.manager.getPixel(o,l,i.key,"__BASE");if(d!=null&&d.alpha){const[f,u]=[-e.originX*e.width,-e.originY*e.height],C=n.addFieldSprite(((t==null?void 0:t.x)||0)+e.x+o*h+f,((t==null?void 0:t.y)||0)+e.y+l*c+u,"tera_sparkle");C.pipelineData.ignoreTimeTint=e.pipelineData.ignoreTimeTint,C.setName("sprite-tera-sparkle"),C.play("tera_sparkle"),s.add(C),e.scene.time.delayedCall(ye(Math.floor(1e3/12*13)),()=>C.destroy())}}}add(e){Array.isArray(e)||(e=[e]);for(const t of e)this.sprites.has(t)||this.sprites.add(t)}remove(e){Array.isArray(e)||(e=[e]);for(const t of e)this.sprites.delete(t)}removeAll(){for(const e of this.sprites.values())this.sprites.delete(e)}};p(Za,"PokemonSpriteSparkleHandler");let dr=Za;const qa=class qa extends Phaser.GameObjects.Container{constructor(){super(n,n.game.canvas.width/6+32,-42)}setup(){[this.sprite,this.transitionSprite]=new Array(2).fill(null).map(()=>{const e=n.add.sprite(0,0,"","");return e.setOrigin(.5,1),this.add(e),e}),this.transitionSprite.setVisible(!1),this.setVisible(!1),this.shown=!1}showCharacter(e,t){return new Promise(s=>{if(e.startsWith("c_")||(e=`c_${e}`),this.shown){if(e===this.key&&t===this.variant)return s();if(e!==this.key)return this.hide().then(()=>this.showCharacter(e,t));this.setVariant(t).then(()=>s());return}this.sprite.setTexture(e,t),n.fieldUI.bringToTop(this),n.tweens.add({targets:this,x:n.game.canvas.width/6-102,duration:750,ease:"Cubic.easeOut",onComplete:p(()=>{s()},"onComplete")}),this.setVisible(n.textures.get(e).key!==fh),this.shown=!0,this.key=e,this.variant=t})}setVariant(e){return new Promise(t=>{n.fieldUI.bringToTop(this),this.transitionSprite.setTexture(this.key,e),this.transitionSprite.setAlpha(0),this.transitionSprite.setVisible(!0),n.tweens.add({targets:this.transitionSprite,alpha:1,duration:250,ease:"Sine.easeIn",onComplete:p(()=>{this.sprite.setTexture(this.key,e),this.transitionSprite.setVisible(!1),t()},"onComplete")}),this.variant=e})}hide(){return new Promise(e=>{if(!this.shown)return e();n.tweens.add({targets:this,x:n.game.canvas.width/6+32,duration:750,ease:"Cubic.easeIn",onComplete:p(()=>{this.shown||this.setVisible(!1),e()},"onComplete")}),this.shown=!1})}};p(qa,"CharSprite");let ur=qa;const Qa=class Qa{constructor(){this.damageNumbers=new Map}add(e,t,s=Xt.EFFECTIVE,i=!1){var d;if(!((d=n)!=null&&d.damageNumbersMode))return;const r=e.getBattlerIndex(),a=e.getSpriteScale()/6,o=V(e.x,-(n.game.canvas.height/6)+e.y-e.getSprite().height/2,gh(t,!0),x.SUMMARY);o.setName("text-damage-number"),o.setOrigin(.5,1),o.setScale(a);let[l,h]=[null,null];switch(s){case Xt.SUPER_EFFECTIVE:[l,h]=["#f8d030","#b8a038"];break;case Xt.NOT_VERY_EFFECTIVE:[l,h]=["#f08030","#c03028"];break;case Xt.INDIRECT_KO:case Xt.ONE_HIT_KO:[l,h]=["#a040a0","#483850"];break;case Xt.HEAL:[l,h]=["#78c850","#588040"];break;default:[l,h]=["#ffffff","#636363"];break}l&&o.setColor(l),h&&(i?(o.setShadowOffset(0,0),o.setStroke(h,12)):o.setShadowColor(h)),n.fieldUI.add(o),this.damageNumbers.has(r)||this.damageNumbers.set(r,[]);const c=this.damageNumbers.get(r).length*-10;if(c&&(o.y+=c),this.damageNumbers.get(r).push(o),n.damageNumbersMode===1){n.tweens.add({targets:o,duration:ye(750),alpha:1,y:"-=32"}),n.tweens.add({delay:375,targets:o,duration:ye(625),alpha:0,ease:"Sine.easeIn",onComplete:p(()=>{this.damageNumbers.get(r).splice(this.damageNumbers.get(r).indexOf(o),1),o.destroy(!0)},"onComplete")});return}o.setAlpha(0),n.tweens.chain({targets:o,tweens:[{duration:ye(250),alpha:1,scaleX:.75*a,scaleY:1.25*a,y:"-=16",ease:"Cubic.easeOut"},{duration:ye(175),alpha:1,scaleX:.875*a,scaleY:1.125*a,y:"+=16",ease:"Cubic.easeIn"},{duration:ye(100),scaleX:1.25*a,scaleY:.75*a,ease:"Cubic.easeOut"},{duration:ye(175),scaleX:.875*a,scaleY:1.125*a,y:"-=8",ease:"Cubic.easeOut"},{duration:ye(50),scaleX:.925*a,scaleY:1.075*a,y:"+=8",ease:"Cubic.easeIn"},{duration:ye(100),scaleX:1.125*a,scaleY:.875*a,ease:"Cubic.easeOut"},{duration:ye(175),scaleX:.925*a,scaleY:1.075*a,y:"-=4",ease:"Cubic.easeOut"},{duration:ye(50),scaleX:.975*a,scaleY:1.025*a,y:"+=4",ease:"Cubic.easeIn"},{duration:ye(100),scaleX:1.075*a,scaleY:.925*a,ease:"Cubic.easeOut"},{duration:ye(25),scaleX:a,scaleY:a,ease:"Cubic.easeOut"},{delay:ye(500),alpha:0,onComplete:p(()=>{this.damageNumbers.get(r).splice(this.damageNumbers.get(r).indexOf(o),1),o.destroy(!0)},"onComplete")}]})}};p(Qa,"DamageNumberHandler");let pr=Qa;const Ja=class Ja extends Phaser.GameObjects.Container{constructor(){super(n,n.game.canvas.width/6,-(n.game.canvas.height/6)+15)}setup(){this.bg=n.add.nineslice(0,0,"party_exp_bar",void 0,8,18,21,5,6,4),this.bg.setOrigin(0,0),this.add(this.bg),this.candyIcon=n.add.sprite(14,0,"items","candy"),this.candyIcon.setOrigin(.5,0),this.candyIcon.setScale(.5),this.add(this.candyIcon),this.candyOverlayIcon=n.add.sprite(14,0,"items","candy_overlay"),this.candyOverlayIcon.setOrigin(.5,0),this.candyOverlayIcon.setScale(.5),this.add(this.candyOverlayIcon),this.countText=V(22,4,"",x.BATTLE_INFO),this.countText.setOrigin(0,0),this.add(this.countText),this.setVisible(!1),this.shown=!1}showStarterSpeciesCandy(e,t){return new Promise(s=>{if(this.shown)return this.speciesId===e?s():this.hide().then(()=>this.showStarterSpeciesCandy(e,t)).then(()=>s());const i=Ye[e];this.candyIcon.setTint(pt(it(i[0]))),this.candyOverlayIcon.setTint(pt(it(i[1]))),this.countText.setText(`${n.gameData.starterData[e].candyCount+t} (+${t.toString()})`),this.bg.width=this.countText.displayWidth+28,n.fieldUI.bringToTop(this),this.tween&&this.tween.stop(),n.playSound("se/shing"),this.tween=n.tweens.add({targets:this,x:n.game.canvas.width/6-(this.bg.width-5),duration:500,ease:"Sine.easeOut",onComplete:p(()=>{this.tween=null,this.resetAutoHideTimer(),s()},"onComplete")}),this.setVisible(!0),this.shown=!0})}hide(){return new Promise(e=>{if(!this.shown)return e();this.autoHideTimer&&clearInterval(this.autoHideTimer),this.tween&&this.tween.stop(),this.tween=n.tweens.add({targets:this,x:n.game.canvas.width/6,duration:500,ease:"Sine.easeIn",onComplete:p(()=>{this.tween=null,this.shown=!1,this.setVisible(!1),e()},"onComplete")})})}resetAutoHideTimer(){this.autoHideTimer&&clearInterval(this.autoHideTimer),this.autoHideTimer=setTimeout(()=>{this.hide(),this.autoHideTimer=null},2500)}};p(Ja,"CandyBar");let fr=Ja;const tp={padID:"Generic",padType:"xbox",deviceMapping:{RC_S:0,RC_E:1,RC_W:2,RC_N:3,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15},icons:{RC_S:"XB_Letter_A_OL.png",RC_E:"XB_Letter_B_OL.png",RC_W:"XB_Letter_X_OL.png",RC_N:"XB_Letter_Y_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LT:"Trigger_L.png",RT:"Trigger_R.png",LS:"LS.png",RS:"RS.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[H.Button_Up]:I.UP,[H.Button_Down]:I.DOWN,[H.Button_Left]:I.LEFT,[H.Button_Right]:I.RIGHT,[H.Button_Action]:I.ACTION,[H.Button_Cancel]:I.CANCEL,[H.Button_Cycle_Nature]:I.CYCLE_NATURE,[H.Button_Cycle_Tera]:I.CYCLE_TERA,[H.Button_Menu]:I.MENU,[H.Button_Stats]:I.STATS,[H.Button_Cycle_Form]:I.CYCLE_FORM,[H.Button_Cycle_Shiny]:I.CYCLE_SHINY,[H.Button_Cycle_Gender]:I.CYCLE_GENDER,[H.Button_Cycle_Ability]:I.CYCLE_ABILITY,[H.Button_Speed_Up]:I.SPEED_UP,[H.Button_Slow_Down]:I.SLOW_DOWN},default:{LC_N:H.Button_Up,LC_S:H.Button_Down,LC_W:H.Button_Left,LC_E:H.Button_Right,RC_S:H.Button_Action,RC_E:H.Button_Cancel,RC_W:H.Button_Cycle_Nature,RC_N:H.Button_Cycle_Tera,START:H.Button_Menu,SELECT:H.Button_Stats,LB:H.Button_Cycle_Form,RB:H.Button_Cycle_Shiny,LT:H.Button_Cycle_Gender,RT:H.Button_Cycle_Ability,LS:H.Button_Speed_Up,RS:H.Button_Slow_Down},blacklist:["LC_N","LC_S","LC_W","LC_E"]},sp={padID:"Pro Controller",padType:"xbox",deviceMapping:{RC_S:1,RC_E:0,RC_W:3,RC_N:2,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15,MENU:16},icons:{RC_S:"XB_Letter_B_OL.png",RC_E:"XB_Letter_A_OL.png",RC_W:"XB_Letter_Y_OL.png",RC_N:"XB_Letter_X_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LT:"Trigger_L.png",RT:"Trigger_R.png",LS:"LS.png",RS:"RS.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[H.Button_Up]:I.UP,[H.Button_Down]:I.DOWN,[H.Button_Left]:I.LEFT,[H.Button_Right]:I.RIGHT,[H.Button_Action]:I.ACTION,[H.Button_Cancel]:I.CANCEL,[H.Button_Cycle_Nature]:I.CYCLE_NATURE,[H.Button_Cycle_Tera]:I.CYCLE_TERA,[H.Button_Menu]:I.MENU,[H.Button_Stats]:I.STATS,[H.Button_Cycle_Form]:I.CYCLE_FORM,[H.Button_Cycle_Shiny]:I.CYCLE_SHINY,[H.Button_Cycle_Gender]:I.CYCLE_GENDER,[H.Button_Cycle_Ability]:I.CYCLE_ABILITY,[H.Button_Speed_Up]:I.SPEED_UP,[H.Button_Slow_Down]:I.SLOW_DOWN},default:{LC_N:H.Button_Up,LC_S:H.Button_Down,LC_W:H.Button_Left,LC_E:H.Button_Right,RC_S:H.Button_Action,RC_E:H.Button_Cancel,RC_W:H.Button_Cycle_Nature,RC_N:H.Button_Cycle_Tera,START:H.Button_Menu,SELECT:H.Button_Stats,LB:H.Button_Cycle_Form,RB:H.Button_Cycle_Shiny,LT:H.Button_Cycle_Gender,RT:H.Button_Cycle_Ability,LS:H.Button_Speed_Up,RS:H.Button_Slow_Down}},ip="touchControlPositionsLandscape",np="touchControlPositionsPortrait",eo=class eo{constructor(e){this.draggingElement=null,this.configurationEventListeners={touchstart:[],touchmove:[],touchend:[]},this.isLandscapeMode=this.getScreenSize().width>this.getScreenSize().height,this.isLeft=t=>{var s;return(s=document.querySelector("#touchControls .left"))==null?void 0:s.contains(t)},this.startDrag=t=>{this.draggingElement=t},this.drag=t=>{if(!this.draggingElement)return;const s=this.draggingElement.getBoundingClientRect(),i=this.isLeft(this.draggingElement)?t.clientX-s.width/2:window.innerWidth-t.clientX-s.width/2,r=window.innerHeight-t.clientY-s.height/2;this.setPosition(this.draggingElement,i,r)},this.stopDrag=()=>{this.draggingElement=null},this.touchControls=e,this.inConfigurationMode=!1,this.setPositions(this.getSavedPositionsOfCurrentOrientation()??[]),window.addEventListener("resize",t=>{const s=this.getScreenSize();s.width>s.height!==this.isLandscapeMode&&this.changeOrientation(s.width>s.height)})}async changeOrientation(e){if(this.isLandscapeMode=e,this.inConfigurationMode){const s=document.querySelector("#touchControls #orientation");s&&(s.textContent=this.isLandscapeMode?S.t("settings:landscape"):S.t("settings:portrait"))}const t=this.getSavedPositionsOfCurrentOrientation()??[];this.setPositions(t)}getScreenSize(){return{width:window.screen.width,height:window.screen.height}}createToolbarElement(){const e=document.createElement("div");return e.id="configToolbar",e.innerHTML=`
    <div class="column">
      <div class="button-row">
        <div id="resetButton" class="button">${S.t("settings:touchReset")}</div>
        <div id="saveButton" class="button">${S.t("settings:touchSaveClose")}</div>
        <div id="cancelButton" class="button">${S.t("settings:touchCancel")}</div>
      </div>
      <div class="info-row">
        <div class="orientation-label"> 
          ${S.t("settings:orientation")}
          <span id="orientation">
            ${this.isLandscapeMode?S.t("settings:landscape"):S.t("settings:portrait")}
          </span>
        </div>
      </div>
    </div>
  `,e}createToolbar(){var r;(r=document.querySelector("#touchControls"))==null||r.prepend(this.createToolbarElement());const e=this.getConfigToolbarRefs();if(!e)return;const{saveButton:t,resetButton:s,cancelButton:i}=e;t.addEventListener("click",()=>{this.saveCurrentPositions(),this.disableConfigurationMode()}),s.addEventListener("click",()=>{this.resetPositions()}),i.addEventListener("click",()=>{const a=this.getSavedPositionsOfCurrentOrientation();this.setPositions(a),this.disableConfigurationMode()})}getConfigToolbarRefs(){const e=document.querySelector("#touchControls #configToolbar");if(e)return{toolbar:e,saveButton:e.querySelector("#saveButton"),resetButton:e.querySelector("#resetButton"),cancelButton:e.querySelector("#cancelButton")}}getModifiedCurrentPositions(){return this.getControlGroupElements().filter(e=>e.style.right||e.style.left).map(e=>({id:e.id,x:Number.parseFloat(this.isLeft(e)?e.style.left:e.style.right),y:Number.parseFloat(e.style.bottom)}))}getLocalStorageKey(){return this.isLandscapeMode?ip:np}getSavedPositionsOfCurrentOrientation(){const e=localStorage.getItem(this.getLocalStorageKey());return e?JSON.parse(e):[]}saveCurrentPositions(){const e=this.getModifiedCurrentPositions();localStorage.setItem(this.getLocalStorageKey(),JSON.stringify(e))}setPositions(e){return this.resetPositions(),e.forEach(t=>{const s=document.querySelector(`#${t.id}`);this.setPosition(s,t.x,t.y)})}setPosition(e,t,s){const i=e.getBoundingClientRect(),r=p((l,h,c)=>Math.min(Math.max(l,h),c),"checkBound"),{height:a,width:o}=this.getScreenSize();t=r(t,0,o-i.width),s=r(s,0,a-i.height),this.isLeft(e)?e.style.left=`${t}px`:e.style.right=`${t}px`,e.style.bottom=`${s}px`}resetPositions(){this.getControlGroupElements().forEach(e=>{e.style.removeProperty("left"),e.style.removeProperty("right"),e.style.removeProperty("bottom")})}getControlGroupElements(){return[...document.querySelectorAll("#touchControls .control-group")]}createConfigurationEventListeners(e){return{touchstart:e.map(t=>{const s=p(()=>this.startDrag(t),"startDrag");return t.addEventListener("touchstart",s,{passive:!0}),s}),touchmove:e.map(()=>{const t=p(s=>this.drag(s.touches[0]),"drag");return window.addEventListener("touchmove",t,{passive:!0}),t}),touchend:e.map(()=>{const t=p(()=>this.stopDrag(),"stopDrag");return window.addEventListener("touchend",t,{passive:!0}),t})}}createOverlay(e){var i;const t=new Phaser.GameObjects.Container(n,0,0),s=new Phaser.GameObjects.Rectangle(n,0,0,n.game.canvas.width,n.game.canvas.height,0,.5);s.setInteractive(),t.add(s),e.add(t),this.overlay=t,(i=document.querySelector("#touchControls"))==null||i.classList.add("config-mode")}enableConfigurationMode(e){this.inConfigurationMode||(this.inConfigurationMode=!0,this.touchControls.disable(),this.createOverlay(e),this.createToolbar(),setTimeout(()=>{this.configurationEventListeners=this.createConfigurationEventListeners(this.getControlGroupElements())},500))}disableConfigurationMode(){var r,a;this.inConfigurationMode=!1,this.draggingElement=null;const{touchstart:e,touchmove:t,touchend:s}=this.configurationEventListeners;this.getControlGroupElements().forEach((o,l)=>o.removeEventListener("touchstart",e[l])),t.forEach(o=>window.removeEventListener("touchmove",o)),s.forEach(o=>window.removeEventListener("touchend",o));const i=document.querySelector("#touchControls #configToolbar");i==null||i.remove(),(r=this.overlay)==null||r.destroy(),(a=document.querySelector("#touchControls"))==null||a.classList.remove("config-mode"),this.touchControls.enable()}};p(eo,"MoveTouchControlsHandler");let gr=eo;const yl=250,to=class to{constructor(){this.gamepads=new Array,this.buttonLock=new Array,this.interactions=new Map,this.configs=new Map,this.gamepadSupport=!0,this.disconnectedGamepads=new Array,this.lastSource="keyboard",this.inputInterval=new Array,this.selectedDevice={[Se.GAMEPAD]:null,[Se.KEYBOARD]:"default"};for(const e of Ss(I))this.interactions[e]={pressTime:!1,isPressed:!1,source:null};delete this.interactions[I.MENU],delete this.interactions[I.STATS],this.init()}init(){var e,t,s,i,r,a,o,l;if(this.events=n.game.events,n.game.events.on(wt.Core.Events.BLUR,()=>{this.loseFocus()}),typeof n.input.gamepad<"u"){if((e=n.input.gamepad)==null||e.on("connected",function(h){h&&(this.refreshGamepads(),this.setupGamepad(h),this.onReconnect(h))},this),(t=n.input.gamepad)==null||t.on("disconnected",function(h){this.onDisconnect(h)},this),(s=n.input.gamepad)==null||s.refreshPads(),(i=n.input.gamepad)!=null&&i.total){this.refreshGamepads();for(const h of this.gamepads)n.input.gamepad.emit("connected",h)}(r=n.input.gamepad)==null||r.on("down",this.gamepadButtonDown,this),(a=n.input.gamepad)==null||a.on("up",this.gamepadButtonUp,this),(o=n.input.keyboard)==null||o.on("keydown",this.keyboardKeyDown,this),(l=n.input.keyboard)==null||l.on("keyup",this.keyboardKeyUp,this)}this.touchControls=new mh,this.moveTouchControlsHandler=new gr(this.touchControls)}loseFocus(){this.deactivatePressedKey(),this.touchControls.deactivatePressedKey()}setGamepadSupport(e){e?this.gamepadSupport=!0:(this.gamepadSupport=!1,this.deactivatePressedKey())}setChosenGamepad(e){this.deactivatePressedKey(),this.initChosenGamepad(e)}setChosenKeyboardLayout(e){this.deactivatePressedKey(),this.initChosenLayoutKeyboard(e)}getGamepadsName(){return this.gamepads.filter(e=>!this.disconnectedGamepads.includes(e.id)).map(e=>e.id)}initChosenGamepad(e){var s;e&&(this.selectedDevice[Se.GAMEPAD]=e.toLowerCase());const t=(s=n.ui)==null?void 0:s.handlers[L.SETTINGS_GAMEPAD];t==null||t.updateChosenGamepadDisplay()}initChosenLayoutKeyboard(e){var s;e&&(this.selectedDevice[Se.KEYBOARD]=e.toLowerCase());const t=(s=n.ui)==null?void 0:s.handlers[L.SETTINGS_KEYBOARD];t==null||t.updateChosenKeyboardDisplay()}onDisconnect(e){this.disconnectedGamepads.push(e.id)}onReconnect(e){this.disconnectedGamepads=this.disconnectedGamepads.filter(t=>t!==e.id)}setupGamepad(e){var i,r,a;const t=this.getGamepadsName();for(const o of t){const l=o.toLowerCase();this.selectedDevice[Se.GAMEPAD]||this.setChosenGamepad(l);const h=Po(this.getConfig(l));h.custom=((i=this.configs[l])==null?void 0:i.custom)||{...h.default},this.configs[l]=h,(r=n.gameData)==null||r.saveMappingConfigs(l,this.configs[l])}this.lastSource="gamepad";const s=(a=n.ui)==null?void 0:a.handlers[L.SETTINGS_GAMEPAD];s==null||s.updateChosenGamepadDisplay()}setupKeyboard(){var e,t;for(const s of["default"]){const i=Po(this.getConfigKeyboard(s));i.custom=((e=this.configs[s])==null?void 0:e.custom)||{...i.default},this.configs[s]=i,(t=n.gameData)==null||t.saveMappingConfigs(this.selectedDevice[Se.KEYBOARD],this.configs[s])}this.initChosenLayoutKeyboard(this.selectedDevice[Se.KEYBOARD])}refreshGamepads(){var e;this.gamepads=((e=n.input.gamepad)==null?void 0:e.gamepads.filter(t=>t!==null))??[];for(const[t,s]of this.gamepads.entries())s.index=t}ensureKeyboardIsInit(){var e;(e=this.getActiveConfig(Se.KEYBOARD))!=null&&e.padID||this.setupKeyboard()}keyboardKeyDown(e){this.lastSource="keyboard",this.ensureKeyboardIsInit();const t=ti(this.getActiveConfig(Se.KEYBOARD),e.keyCode);if(t!==void 0){if(this.buttonLock.includes(t))return;this.events.emit("input_down",{controller_type:"keyboard",button:t}),clearInterval(this.inputInterval[t]),this.inputInterval[t]=setInterval(()=>{this.events.emit("input_down",{controller_type:"keyboard",button:t})},yl),this.buttonLock.push(t)}}keyboardKeyUp(e){this.lastSource="keyboard";const t=ti(this.getActiveConfig(Se.KEYBOARD),e.keyCode);if(t!==void 0){this.events.emit("input_up",{controller_type:"keyboard",button:t});const s=this.buttonLock.indexOf(t);this.buttonLock.splice(s,1),clearInterval(this.inputInterval[t])}}gamepadButtonDown(e,t,s){var a;if((a=this.configs[this.selectedDevice[Se.KEYBOARD]])!=null&&a.padID||this.setupKeyboard(),!e||(this.lastSource="gamepad",(!this.selectedDevice[Se.GAMEPAD]||n.ui.getMode()!==L.GAMEPAD_BINDING&&this.selectedDevice[Se.GAMEPAD]!==e.id.toLowerCase())&&this.setChosenGamepad(e.id),!this.gamepadSupport||e.id.toLowerCase()!==this.selectedDevice[Se.GAMEPAD].toLowerCase()))return;const i=this.getActiveConfig(Se.GAMEPAD),r=i&&ti(i,t.index);if(r!==void 0){if(this.buttonLock.includes(r))return;this.events.emit("input_down",{controller_type:"gamepad",button:r}),clearInterval(this.inputInterval[r]),this.inputInterval[r]=setInterval(()=>{if(!this.buttonLock.includes(r)){clearInterval(this.inputInterval[r]);return}this.events.emit("input_down",{controller_type:"gamepad",button:r})},yl),this.buttonLock.push(r)}}gamepadButtonUp(e,t,s){if(!e||(this.lastSource="gamepad",!this.gamepadSupport||e.id.toLowerCase()!==this.selectedDevice[Se.GAMEPAD]))return;const i=ti(this.getActiveConfig(Se.GAMEPAD),t.index);if(i!==void 0){this.events.emit("input_up",{controller_type:"gamepad",button:i});const r=this.buttonLock.indexOf(i);this.buttonLock.splice(r,1),clearInterval(this.inputInterval[i])}}getConfig(e){return e=e.toLowerCase(),e.includes("081f")&&e.includes("e401")?sh:e.includes("xbox")&&e.includes("360")?eh:e.includes("054c")?th:e.includes("057e")&&e.includes("2009")?sp:tp}getConfigKeyboard(e){return $n}deactivatePressedKey(){for(const e of Object.keys(this.inputInterval))clearInterval(this.inputInterval[e]);this.buttonLock=[]}getActiveConfig(e){var t;return(t=this.configs[this.selectedDevice[e]])!=null&&t.padID?this.configs[this.selectedDevice[e]]:null}getIconForLatestInputRecorded(e){return this.lastSource==="keyboard"&&this.ensureKeyboardIsInit(),wu(this.configs,this.lastSource,this.selectedDevice,e)}getLastSourceDevice(){return this.lastSource==="gamepad"?Se.GAMEPAD:Se.KEYBOARD}getLastSourceConfig(){const e=this.getLastSourceDevice();return e===Se.KEYBOARD&&this.ensureKeyboardIsInit(),this.getActiveConfig(e)}getLastSourceType(){const e=this.getLastSourceConfig();return e==null?void 0:e.padType}injectConfig(e,t){this.configs[e]||(this.configs[e]={});const s={BUTTON_CYCLE_VARIANT:"BUTTON_CYCLE_TERA"};for(const i in t.custom)t.custom[i]in s&&(t.custom[i]=s[t.custom[i]]);this.configs[e].custom=t.custom}resetConfigs(){var e;this.configs=new Map,(e=this.getGamepadsName())!=null&&e.length&&this.setupGamepad(this.selectedDevice[Se.GAMEPAD]),this.setupKeyboard()}assignBinding(e,t,s){return this.deactivatePressedKey(),e.padType==="keyboard"?Ou(e,t,s):Au(e,t,s)}};p(to,"InputsController");let mr=to;const so=class so{constructor(e){this.inputsController=e,this.init()}init(){this.events=this.inputsController.events,this.listenInputs()}detectInputMethod(e){e.controller_type==="keyboard"?e.hasOwnProperty("isTouch")&&e.isTouch?n.inputMethod="touch":n.inputMethod="keyboard":e.controller_type==="gamepad"&&(n.inputMethod="gamepad")}listenInputs(){this.events.on("input_down",e=>{this.detectInputMethod(e);const t=this.getActionsKeyDown();t.hasOwnProperty(e.button)&&t[e.button]()},this),this.events.on("input_up",e=>{const t=this.getActionsKeyUp();t.hasOwnProperty(e.button)&&t[e.button]()},this)}doVibration(e,t){e&&n.enableVibration&&typeof navigator.vibrate<"u"&&navigator.vibrate(t)}getActionsKeyDown(){return{[I.UP]:()=>this.buttonDirection(I.UP),[I.DOWN]:()=>this.buttonDirection(I.DOWN),[I.LEFT]:()=>this.buttonDirection(I.LEFT),[I.RIGHT]:()=>this.buttonDirection(I.RIGHT),[I.SUBMIT]:()=>this.buttonTouch(),[I.ACTION]:()=>this.buttonAb(I.ACTION),[I.CANCEL]:()=>this.buttonAb(I.CANCEL),[I.MENU]:()=>this.buttonMenu(),[I.STATS]:()=>this.buttonGoToFilter(I.STATS),[I.CYCLE_SHINY]:()=>this.buttonCycleOption(I.CYCLE_SHINY),[I.CYCLE_FORM]:()=>this.buttonCycleOption(I.CYCLE_FORM),[I.CYCLE_GENDER]:()=>this.buttonCycleOption(I.CYCLE_GENDER),[I.CYCLE_ABILITY]:()=>this.buttonCycleOption(I.CYCLE_ABILITY),[I.CYCLE_NATURE]:()=>this.buttonCycleOption(I.CYCLE_NATURE),[I.CYCLE_TERA]:()=>this.buttonCycleOption(I.CYCLE_TERA),[I.SPEED_UP]:()=>this.buttonSpeedChange(),[I.SLOW_DOWN]:()=>this.buttonSpeedChange(!1)}}getActionsKeyUp(){return{[I.UP]:()=>{},[I.DOWN]:()=>{},[I.LEFT]:()=>{},[I.RIGHT]:()=>{},[I.SUBMIT]:()=>{},[I.ACTION]:()=>{},[I.CANCEL]:()=>{},[I.MENU]:()=>{},[I.STATS]:()=>this.buttonStats(!1),[I.CYCLE_SHINY]:()=>{},[I.CYCLE_FORM]:()=>{},[I.CYCLE_GENDER]:()=>{},[I.CYCLE_ABILITY]:()=>{},[I.CYCLE_NATURE]:()=>{},[I.CYCLE_TERA]:()=>this.buttonInfo(!1),[I.SPEED_UP]:()=>{},[I.SLOW_DOWN]:()=>{}}}buttonDirection(e){const t=n.ui.processInput(e);this.doVibration(t,5)}buttonAb(e){n.ui.processInput(e)}buttonTouch(){n.ui.processInput(I.SUBMIT)||n.ui.processInput(I.ACTION)}buttonStats(e=!0){for(const t of n.getInfoToggles(!0))t.toggleInfo(e);for(const t of n.getField().filter(s=>s==null?void 0:s.isActive(!0)))t.toggleStats(e)}buttonGoToFilter(e){var i;const t=[Rs,Vs,Us],s=(i=n.ui)==null?void 0:i.getHandler();t.some(r=>s instanceof r)?n.ui.processInput(e):this.buttonStats(!0)}buttonInfo(e=!0){if(n.showMovesetFlyout)for(const t of n.getField().filter(s=>s==null?void 0:s.isActive(!0)))t.toggleFlyout(e);n.showArenaFlyout&&n.ui.processInfoButton(e)}buttonMenu(){var e;if(!n.disableMenu)switch((e=n.ui)==null?void 0:e.getMode()){case L.MESSAGE:{const t=n.ui.getHandler();if(!t.pendingPrompt||t.isTextAnimationInProgress())return}case L.TITLE:case L.COMMAND:case L.MODIFIER_SELECT:case L.MYSTERY_ENCOUNTER:n.ui.setOverlayMode(L.MENU);break;case L.STARTER_SELECT:case L.POKEDEX_PAGE:this.buttonTouch();break;case L.MENU:n.ui.revertMode(),n.playSound("ui/select");break;default:return}}buttonCycleOption(e){var i;const t=[Rs,Vs,Us,Si,Vl,Ai,ki,Ei,Oi],s=(i=n.ui)==null?void 0:i.getHandler();t.some(r=>s instanceof r)?n.ui.processInput(e):e===I.CYCLE_TERA&&this.buttonInfo(!0)}buttonSpeedChange(e=!0){var s,i;const t=fc(ts.Game_Speed);e&&n.gameSpeed<5?(n.gameData.saveSetting(ts.Game_Speed,mn[t].options.findIndex(r=>r.label===`${n.gameSpeed}x`)+1),((s=n.ui)==null?void 0:s.getMode())===L.SETTINGS&&n.ui.getHandler().show([])):!e&&n.gameSpeed>1&&(n.gameData.saveSetting(ts.Game_Speed,Math.max(mn[t].options.findIndex(r=>r.label===`${n.gameSpeed}x`)-1,0)),((i=n.ui)==null?void 0:i.getMode())===L.SETTINGS&&n.ui.getHandler().show([]))}};p(so,"UiInputs");let yr=so;const io=class io extends Phaser.GameObjects.Container{constructor(e=0,t=0){super(n,e,t),this.timeOfDayIconFgs=new Array(2),this.timeOfDayIconMgs=new Array(2),this.timeOfDayIconBgs=new Array(2),this.timeOfDayIconPairs=new Map([["bg",this.timeOfDayIconBgs],["mg",this.timeOfDayIconMgs],["fg",this.timeOfDayIconFgs]]),this.currentTime=ut.ALL,this.previousTime=ut.ALL,this.onEncounterPhaseEvent=s=>this.onEncounterPhase(s),this.setVisible(n.showTimeOfDayWidget),n.showTimeOfDayWidget&&(this.timeOfDayIconPairs.forEach((s,i)=>{for(let r=0;r<s.length;r++)s[r]=n.add.sprite(0,0,"dawn_icon_"+i).setOrigin()}),this.timeOfDayIcons=[this.timeOfDayIconBgs,this.timeOfDayIconMgs,this.timeOfDayIconFgs].flat(),this.add(this.timeOfDayIcons),n.eventTarget.addEventListener(as.ENCOUNTER_PHASE,this.onEncounterPhaseEvent))}get parentVisible(){return this._parentVisible}set parentVisible(e){var t;e&&!this._parentVisible&&((t=this.timeOfDayIcons)==null||t.forEach(s=>n.tweens.getTweensOf(s).forEach(i=>i.resume()))),this._parentVisible=e}getBackTween(){const e={targets:[this.timeOfDayIconMgs[0],this.timeOfDayIconMgs[1]],angle:"+=90",duration:ye(1500),ease:"Back.easeOut",paused:!this.parentVisible},t={targets:[this.timeOfDayIconBgs[1],this.timeOfDayIconMgs[1],this.timeOfDayIconFgs[1]],alpha:0,duration:ye(500),ease:"Linear",paused:!this.parentVisible};return[e,t]}getBounceTween(){const e={targets:[this.timeOfDayIconMgs[0],this.timeOfDayIconMgs[1]],angle:"+=90",duration:ye(2e3),ease:"Bounce.easeOut",paused:!this.parentVisible},t={targets:[this.timeOfDayIconBgs[1],this.timeOfDayIconMgs[1],this.timeOfDayIconFgs[1]],alpha:0,duration:ye(800),ease:"Linear",paused:!this.parentVisible};return[e,t]}resetIcons(){this.moveBelow(this.timeOfDayIconBgs[0],this.timeOfDayIconBgs[1]),this.moveBelow(this.timeOfDayIconMgs[0],this.timeOfDayIconBgs[1]),this.moveBelow(this.timeOfDayIconFgs[0],this.timeOfDayIconFgs[1]),this.timeOfDayIconPairs.forEach((e,t)=>{e[0].setTexture(ut[this.currentTime].toLowerCase()+"_icon_"+t),e[1].setTexture(ut[this.previousTime].toLowerCase()+"_icon_"+t)}),this.timeOfDayIconMgs[0].setRotation(-90*(3.14/180)),this.timeOfDayIcons.forEach(e=>e.setAlpha(1))}tweenTimeOfDayIcon(){n.tweens.killTweensOf(this.timeOfDayIcons),this.resetIcons(),(n.timeOfDayAnimation===Ul.BACK?this.getBackTween():this.getBounceTween()).forEach(e=>n.tweens.add(e)),this.timeOfDayIconPairs.forEach(e=>{const t=e.shift();t&&e.push(t)})}onEncounterPhase(e){const t=n.arena.getTimeOfDay();this.currentTime!==t&&(this.currentTime=t,this.previousTime=this.currentTime-1,this.previousTime<ut.DAWN&&(this.previousTime=ut.NIGHT),this.tweenTimeOfDayIcon())}};p(io,"TimeOfDayWidget");let Cr=io;function un(P){if(!P||P===Yl.NONE)return P;const t=`arenaFlyout:${yh(P)}`,s=S.t(t);return!s||s===t?di(P):s}p(un,"getFieldEffectText");const no=class no extends Phaser.GameObjects.Container{constructor(){super(n,0,0),this.flyoutWidth=170,this.flyoutHeight=51,this.fieldEffectInfo=[],this.onNewArenaEvent=e=>this.onNewArena(e),this.onTurnEndEvent=e=>this.onTurnEnd(e),this.onFieldEffectChangedEvent=e=>this.onFieldEffectChanged(e),this.setName("arena-flyout"),this.translationX=this.flyoutWidth,this.anchorX=0,this.anchorY=-98,this.flyoutParent=n.add.container(this.anchorX-this.translationX,this.anchorY),this.flyoutParent.setAlpha(0),this.add(this.flyoutParent),this.flyoutContainer=n.add.container(0,0),this.flyoutParent.add(this.flyoutContainer),this.flyoutWindow=me(0,0,this.flyoutWidth,this.flyoutHeight,!1,!1,0,0,gt.THIN),this.flyoutContainer.add(this.flyoutWindow),this.flyoutWindowHeader=me(this.flyoutWidth/2,0,this.flyoutWidth/2,14,!1,!1,0,0,gt.XTHIN),this.flyoutWindowHeader.setOrigin(),this.flyoutContainer.add(this.flyoutWindowHeader),this.flyoutTextHeader=V(this.flyoutWidth/2,0,S.t("arenaFlyout:activeBattleEffects"),x.BATTLE_INFO),this.flyoutTextHeader.setFontSize(54),this.flyoutTextHeader.setAlign("center"),this.flyoutTextHeader.setOrigin(),this.flyoutContainer.add(this.flyoutTextHeader),this.timeOfDayWidget=new Cr(this.flyoutWidth/2+this.flyoutWindowHeader.displayWidth/2),this.flyoutContainer.add(this.timeOfDayWidget),this.flyoutTextHeaderPlayer=V(6,5,S.t("arenaFlyout:player"),x.SUMMARY_BLUE),this.flyoutTextHeaderPlayer.setFontSize(54),this.flyoutTextHeaderPlayer.setAlign("left"),this.flyoutTextHeaderPlayer.setOrigin(0,0),this.flyoutContainer.add(this.flyoutTextHeaderPlayer),this.flyoutTextHeaderField=V(this.flyoutWidth/2,5,S.t("arenaFlyout:neutral"),x.SUMMARY_GREEN),this.flyoutTextHeaderField.setFontSize(54),this.flyoutTextHeaderField.setAlign("center"),this.flyoutTextHeaderField.setOrigin(.5,0),this.flyoutContainer.add(this.flyoutTextHeaderField),this.flyoutTextHeaderEnemy=V(this.flyoutWidth-6,5,S.t("arenaFlyout:enemy"),x.SUMMARY_RED),this.flyoutTextHeaderEnemy.setFontSize(54),this.flyoutTextHeaderEnemy.setAlign("right"),this.flyoutTextHeaderEnemy.setOrigin(1,0),this.flyoutContainer.add(this.flyoutTextHeaderEnemy),this.flyoutTextPlayer=V(6,13,"",x.BATTLE_INFO),this.flyoutTextPlayer.setLineSpacing(-1),this.flyoutTextPlayer.setFontSize(48),this.flyoutTextPlayer.setAlign("left"),this.flyoutTextPlayer.setOrigin(0,0),this.flyoutContainer.add(this.flyoutTextPlayer),this.flyoutTextField=V(this.flyoutWidth/2,13,"",x.BATTLE_INFO),this.flyoutTextField.setLineSpacing(-1),this.flyoutTextField.setFontSize(48),this.flyoutTextField.setAlign("center"),this.flyoutTextField.setOrigin(.5,0),this.flyoutContainer.add(this.flyoutTextField),this.flyoutTextEnemy=V(this.flyoutWidth-6,13,"",x.BATTLE_INFO),this.flyoutTextEnemy.setLineSpacing(-1),this.flyoutTextEnemy.setFontSize(48),this.flyoutTextEnemy.setAlign("right"),this.flyoutTextEnemy.setOrigin(1,0),this.flyoutContainer.add(this.flyoutTextEnemy),this.name="Fight Flyout",this.flyoutParent.name="Fight Flyout Parent",n.eventTarget.addEventListener(as.NEW_ARENA,this.onNewArenaEvent),n.eventTarget.addEventListener(as.TURN_END,this.onTurnEndEvent)}onNewArena(e){this.fieldEffectInfo.length=0,n.arena.eventTarget.addEventListener(Pt.WEATHER_CHANGED,this.onFieldEffectChangedEvent),n.arena.eventTarget.addEventListener(Pt.TERRAIN_CHANGED,this.onFieldEffectChangedEvent),n.arena.eventTarget.addEventListener(Pt.TAG_ADDED,this.onFieldEffectChangedEvent),n.arena.eventTarget.addEventListener(Pt.TAG_REMOVED,this.onFieldEffectChangedEvent)}clearText(){this.flyoutTextPlayer.text="",this.flyoutTextField.text="",this.flyoutTextEnemy.text=""}updateFieldText(){this.clearText(),this.fieldEffectInfo.sort((e,t)=>e.duration-t.duration);for(let e=0;e<this.fieldEffectInfo.length;e++){const t=this.fieldEffectInfo[e];let s;switch(t.effecType){case 0:s=this.flyoutTextPlayer;break;case 1:case 2:case 3:s=this.flyoutTextField;break;case 4:s=this.flyoutTextEnemy;break}s.text+=t.name,t.maxDuration!==0&&(s.text+="  "+t.duration+"/"+t.maxDuration),s.text+=`
`}}onFieldEffectChanged(e){const t=e;if(!t)return;let s;switch(t.constructor){case yc:{const i=t,r=n.arena.getTag(i.arenaTagType)instanceof Cc;let a;i.arenaTagSide===Bo.BOTH?a=3:i.arenaTagSide===Bo.PLAYER?a=0:a=4;const o=r?this.fieldEffectInfo.findIndex(h=>i.arenaTagType===h.tagType&&a===h.effecType):-1;let l=un(Yl[i.arenaTagType]);if(r){if(o!==-1){const h=i.arenaTagMaxLayers>1?` (${i.arenaTagLayers})`:"";this.fieldEffectInfo[o].name=`${l}${h}`;break}i.arenaTagMaxLayers>1&&(l=`${l} (${i.arenaTagLayers})`)}this.fieldEffectInfo.push({name:l,effecType:a,maxDuration:i.duration,duration:i.duration,tagType:i.arenaTagType});break}case mc:{const i=t;s=this.fieldEffectInfo.findIndex(r=>r.tagType===i.arenaTagType),s!==-1&&this.fieldEffectInfo.splice(s,1);break}case Xs:case gc:{const i=t,r=un(i instanceof Xs?mi[i.oldWeatherType]:Ps[i.oldTerrainType]),a={name:un(i instanceof Xs?mi[i.newWeatherType]:Ps[i.newTerrainType]),effecType:i instanceof Xs?1:2,maxDuration:i.duration,duration:i.duration};s=this.fieldEffectInfo.findIndex(o=>[a.name,r].includes(o.name)),s===-1?a.name!==void 0&&this.fieldEffectInfo.push(a):a.name?this.fieldEffectInfo[s]=a:this.fieldEffectInfo.splice(s,1);break}}this.updateFieldText()}onTurnEnd(e){if(!e)return;const s=[];this.fieldEffectInfo.forEach(i=>s.push(i));for(let i=0;i<s.length;i++){const r=s[i];r.maxDuration!==0&&(--r.duration,r.duration<=0&&this.fieldEffectInfo.splice(this.fieldEffectInfo.indexOf(r),1))}this.updateFieldText()}toggleFlyout(e){n.tweens.add({targets:this.flyoutParent,x:e?this.anchorX:this.anchorX-this.translationX,duration:ye(125),ease:"Sine.easeInOut",alpha:e?1:0,onComplete:p(()=>this.timeOfDayWidget.parentVisible=e,"onComplete")})}destroy(e){n.eventTarget.removeEventListener(as.NEW_ARENA,this.onNewArenaEvent),n.eventTarget.removeEventListener(as.TURN_END,this.onTurnEndEvent),n.arena.eventTarget.removeEventListener(Pt.WEATHER_CHANGED,this.onFieldEffectChangedEvent),n.arena.eventTarget.removeEventListener(Pt.TERRAIN_CHANGED,this.onFieldEffectChangedEvent),n.arena.eventTarget.removeEventListener(Pt.TAG_ADDED,this.onFieldEffectChangedEvent),n.arena.eventTarget.removeEventListener(Pt.TAG_REMOVED,this.onFieldEffectChangedEvent),super.destroy(e)}};p(no,"ArenaFlyout");let br=no;const ro=class ro extends ps{start(){super.start(),n.ui.setMode(L.MESSAGE).then(()=>{n.playSound("level_up_fanfare"),n.ui.showText(S.t("battle:levelCapUp",{levelCap:n.getMaxExpLevel()}),null,()=>this.end(),null,!0),this.executeForAll(e=>e.updateInfo(!0))})}};p(ro,"LevelCapPhase");let Tr=ro;const ao=class ao extends Gi{start(){super.start(),n.ui.showText(S.t("menu:boyOrGirl"),null,()=>{n.ui.setMode(L.OPTION_SELECT,{options:[{label:S.t("settings:boy"),handler:p(()=>(n.gameData.gender=bt.MALE,n.gameData.saveSetting(ts.Player_Gender,0),n.gameData.saveSystem().then(()=>this.end()),!0),"handler")},{label:S.t("settings:girl"),handler:p(()=>(n.gameData.gender=bt.FEMALE,n.gameData.saveSetting(ts.Player_Gender,1),n.gameData.saveSystem().then(()=>this.end()),!0),"handler")}]})})}end(){n.ui.setMode(L.MESSAGE),super.end()}};p(ao,"SelectGenderPhase");let Sr=ao;const oo=class oo extends Gi{start(){n.ui.setMode(L.UNAVAILABLE,()=>{n.unshiftPhase(new Pi(!0)),this.end()})}};p(oo,"UnavailablePhase");let vr=oo;const Fi=class Fi extends Gi{constructor(e=!0){super(),this.showText=e}start(){super.start(),Ch(bs),n.ui.setMode(L.LOADING,{buttonActions:[]}),El(yn,Is).then(e=>{const t=e?e[0]:!1,s=e?e[1]:null;if(!t){if(!s||s===400){this.showText&&n.ui.showText(S.t("menu:logInOrCreateAccount")),n.playSound("menu_open");const i=p(()=>{Is().then(r=>{if(!r[0]){oi(bs),n.reset(!0,!0);return}n.gameData.loadSystem().then(()=>this.end())})},"loadData");n.ui.setMode(L.LOGIN_FORM,{buttonActions:[()=>{n.ui.playSelect(),i()},()=>{n.playSound("menu_open"),n.ui.setMode(L.REGISTRATION_FORM,{buttonActions:[()=>{n.ui.playSelect(),Is().then(r=>{if(!r[0]){oi(bs),n.reset(!0,!0);return}this.end()})},()=>{n.unshiftPhase(new Fi(!1)),this.end()}]})},()=>{const o=`https://discord.com/api/oauth2/authorize?client_id=1234567890&redirect_uri=${encodeURIComponent("http://localhost:8001/auth/discord/callback")}&response_type=code&scope=identify&prompt=none`;window.open(o,"_self")},()=>{const o=`https://accounts.google.com/o/oauth2/auth?client_id=1234567890&redirect_uri=${encodeURIComponent("http://localhost:8001/auth/google/callback")}&response_type=code&scope=openid`;window.open(o,"_self")}]})}else s===401?(oi(bs),n.reset(!0,!0)):(n.unshiftPhase(new vr),super.end());return null}n.gameData.loadSystem().then(i=>{this.end()})})}end(){n.ui.setMode(L.MESSAGE),n.gameData.gender||n.unshiftPhase(new Sr),ws(Ls.Intro).then(()=>super.end())}};p(Fi,"LoginPhase");let Pi=Fi;const lo=class lo extends Ml{start(){super.start()}doEncounter(){var r,a;n.playBgm(void 0,!0);for(const o of n.getPlayerParty())o&&o.resetWaveData();n.arenaNextEnemy.setBiome(n.arena.biomeType),n.arenaNextEnemy.setVisible(!0);const e=n.getEnemyField(),t=[n.arenaEnemy,n.arenaNextEnemy,n.currentBattle.trainer,e,n.lastEnemyTrainer],s=(r=n.lastMysteryEncounter)==null?void 0:r.introVisuals;s&&t.push(s);const i=(a=n.currentBattle.mysteryEncounter)==null?void 0:a.introVisuals;i&&(i.enterFromRight?(i.x+=500,n.tweens.add({targets:i,x:"-=200",duration:2e3})):t.push(i)),n.tweens.add({targets:t.flat(),x:"+=300",duration:2e3,onComplete:p(()=>{n.arenaEnemy.setBiome(n.arena.biomeType),n.arenaEnemy.setX(n.arenaNextEnemy.x),n.arenaEnemy.setAlpha(1),n.arenaNextEnemy.setX(n.arenaNextEnemy.x-300),n.arenaNextEnemy.setVisible(!1),n.lastEnemyTrainer&&n.lastEnemyTrainer.destroy(),s&&(n.field.remove(s,!0),n.lastMysteryEncounter.introVisuals=void 0),this.tryOverrideForBattleSpec()||this.doEncounterCommon()},"onComplete")})}trySetWeatherIfNewBiome(){}};p(lo,"NextEncounterPhase");let Bi=lo;const ho=class ho extends Bi{doEncounter(){var i,r;n.playBgm(void 0,!0);for(const a of n.getPlayerParty())a&&(a.resetBattleAndWaveData(),a.isOnField()&&nt(Tc,a,null));const e=n.getEnemyField(),t=[n.arenaEnemy,e],s=(r=(i=n.currentBattle)==null?void 0:i.mysteryEncounter)==null?void 0:r.introVisuals;s&&t.push(s),n.tweens.add({targets:t.flat(),x:"+=300",duration:2e3,onComplete:p(()=>{this.tryOverrideForBattleSpec()||this.doEncounterCommon()},"onComplete")})}trySetWeatherIfNewBiome(){n.arena.trySetWeather(bc(n.arena))}};p(ho,"NewBiomeEncounterPhase");let Ir=ho;const co=class co extends Ys{constructor(e,t,s=[]){super(),this.key=e,this.pokemon=t,this.fieldAssets=s}start(){switch(super.start(),this.key){case rs.SUBSTITUTE_ADD:this.doSubstituteAddAnim();break;case rs.SUBSTITUTE_PRE_MOVE:this.doSubstitutePreMoveAnim();break;case rs.SUBSTITUTE_POST_MOVE:this.doSubstitutePostMoveAnim();break;case rs.SUBSTITUTE_REMOVE:this.doSubstituteRemoveAnim();break;case rs.COMMANDER_APPLY:this.doCommanderApplyAnim();break;case rs.COMMANDER_REMOVE:this.doCommanderRemoveAnim();break;default:this.end()}}doSubstituteAddAnim(){const e=this.pokemon.getTag(Ds);if(ve(e))return this.end();const t=p(()=>{const a=n.addFieldSprite(this.pokemon.x+this.pokemon.getSprite().x,this.pokemon.y+this.pokemon.getSprite().y,`pkmn${this.pokemon.isPlayer()?"__back":""}__sub`);return a.setOrigin(.5,1),n.field.add(a),a},"getSprite"),[s,i]=[t(),t()],r=this.pokemon.getSpriteScale()*(this.pokemon.isPlayer()?.5:1);s.setVisible(!1),s.setScale(r),i.setTintFill(16777215),i.setScale(.01),this.pokemon.isPlayer()&&n.field.bringToTop(this.pokemon),n.playSound("PRSFX- Transform"),n.tweens.add({targets:this.pokemon,duration:500,x:this.pokemon.x+this.pokemon.getSubstituteOffset()[0],y:this.pokemon.y+this.pokemon.getSubstituteOffset()[1],alpha:.5,ease:"Sine.easeIn"}),n.tweens.add({targets:i,delay:250,scale:r,ease:"Cubic.easeInOut",duration:500,onComplete:p(()=>{s.setVisible(!0),n.tweens.add({targets:i,delay:250,alpha:0,ease:"Cubic.easeOut",duration:1e3,onComplete:p(()=>{i.destroy(),e.sprite=s,this.end()},"onComplete")})},"onComplete")})}doSubstitutePreMoveAnim(){if(this.fieldAssets.length!==1)return this.end();const e=this.fieldAssets[0];if(e===void 0)return this.end();n.tweens.add({targets:e,alpha:0,ease:"Sine.easeInOut",duration:500}),n.tweens.add({targets:this.pokemon,x:e.x,y:e.y,alpha:1,ease:"Sine.easeInOut",delay:250,duration:500,onComplete:p(()=>this.end(),"onComplete")})}doSubstitutePostMoveAnim(){if(this.fieldAssets.length!==1)return this.end();const e=this.fieldAssets[0];if(e===void 0)return this.end();n.tweens.add({targets:this.pokemon,x:e.x+this.pokemon.getSubstituteOffset()[0],y:e.y+this.pokemon.getSubstituteOffset()[1],alpha:.5,ease:"Sine.easeInOut",duration:500}),n.tweens.add({targets:e,alpha:1,ease:"Sine.easeInOut",delay:250,duration:500,onComplete:p(()=>this.end(),"onComplete")})}doSubstituteRemoveAnim(){if(this.fieldAssets.length!==1)return this.end();const e=this.fieldAssets[0];if(e===void 0)return this.end();const s=p(()=>{const r=n.addFieldSprite(e.x,e.y,`pkmn${this.pokemon.isPlayer()?"__back":""}__sub`);return r.setOrigin(.5,1),n.field.add(r),r},"getSprite")(),i=this.pokemon.getSpriteScale()*(this.pokemon.isPlayer()?.5:1);s.setAlpha(0),s.setTintFill(16777215),s.setScale(i),n.tweens.add({targets:s,alpha:1,ease:"Sine.easeInOut",duration:500,onComplete:p(()=>{e.destroy();const r=n.time.addEvent({delay:100,repeat:7,startAt:200,callback:p(()=>{n.playSound("PRSFX- Substitute2.wav"),s.setVisible(r.repeatCount%2===0),r.repeatCount||(n.tweens.add({targets:s,scale:.01,ease:"Sine.cubicEaseIn",duration:500}),n.tweens.add({targets:this.pokemon,x:this.pokemon.x-this.pokemon.getSubstituteOffset()[0],y:this.pokemon.y-this.pokemon.getSubstituteOffset()[1],alpha:1,ease:"Sine.easeInOut",delay:250,duration:500,onComplete:p(()=>{s.destroy(),this.end()},"onComplete")}))},"callback")})},"onComplete")})}doCommanderApplyAnim(){var l,h;if(!((l=n.currentBattle)!=null&&l.double))return this.end();const e=this.pokemon.getAlly();if(((h=e==null?void 0:e.species)==null?void 0:h.speciesId)!==ge.DONDOZO)return this.end();const t=this.pokemon.x+this.pokemon.getSprite().x,s=this.pokemon.y+this.pokemon.getSprite().y,r=p(()=>{const c=n.addPokemonSprite(this.pokemon,t,s,this.pokemon.getSprite().texture,this.pokemon.getSprite().frame.name,!0);return["spriteColors","fusionSpriteColors"].map(d=>c.pipelineData[d]=this.pokemon.getSprite().pipelineData[d]),c.setPipelineData("spriteKey",this.pokemon.getBattleSpriteKey()),c.setPipelineData("shiny",this.pokemon.shiny),c.setPipelineData("variant",this.pokemon.variant),c.setPipelineData("ignoreFieldPos",!0),c.setOrigin(.5,1),this.pokemon.getSprite().on("animationupdate",(d,f)=>c.setFrame(f.textureFrame)),n.field.add(c),c},"getSourceSprite")();this.pokemon.setVisible(!1);const a=this.pokemon.getFieldPositionOffset(),o=e.getFieldPositionOffset();n.playSound("se/pb_throw"),n.tweens.add({targets:r,duration:375,scale:.5,x:{value:t+(o[0]-a[0])/2,ease:"Linear"},y:{value:(this.pokemon.isPlayer()?100:65)+a[1],ease:"Sine.easeOut"},onComplete:p(()=>{n.field.bringToTop(e),n.tweens.add({targets:r,duration:375,scale:.01,x:{value:e.x,ease:"Linear"},y:{value:e.y+e.height/2,ease:"Sine.easeIn"},onComplete:p(()=>{r.destroy(),n.playSound("battle_anims/PRSFX- Liquidation1.wav"),n.tweens.add({targets:e,duration:250,ease:"Sine.easeInOut",scale:.85,yoyo:!0,onComplete:p(()=>this.end(),"onComplete")})},"onComplete")})},"onComplete")})}doCommanderRemoveAnim(){const e=this.pokemon.getAlly();if(ve(e))return console.warn("Aborting COMMANDER_REMOVE anim: Tatsugiri is undefined"),this.end();const t=n.addPokemonSprite(e,this.pokemon.x+this.pokemon.getSprite().x,this.pokemon.y+this.pokemon.getSprite().y+this.pokemon.height/2,e.getSprite().texture,e.getSprite().frame.name,!0);["spriteColors","fusionSpriteColors"].map(s=>t.pipelineData[s]=e.getSprite().pipelineData[s]),t.setPipelineData("spriteKey",e.getBattleSpriteKey()),t.setPipelineData("shiny",e.shiny),t.setPipelineData("variant",e.variant),t.setPipelineData("ignoreFieldPos",!0),this.pokemon.getSprite().on("animationupdate",(s,i)=>t.setFrame(i.textureFrame)),t.setOrigin(.5,1),t.setScale(.01),n.field.add(t),n.field.bringToTop(this.pokemon),t.setVisible(!0),n.tweens.add({targets:this.pokemon,duration:250,ease:"Sine.easeInOut",scale:1.15,yoyo:!0,onComplete:p(()=>{n.playSound("battle_anims/PRSFX- Liquidation4.wav"),n.tweens.add({targets:t,duration:500,scale:1,x:{value:e.x+e.getSprite().x,ease:"Linear"},y:{value:e.y+e.getSprite().y,ease:"Sine.easeIn"},onComplete:p(()=>{e.setVisible(!0),t.destroy(),this.end()},"onComplete")})},"onComplete")})}};p(co,"PokemonAnimPhase");let Er=co;const uo=class uo extends Ys{constructor(e,t){super(),this.pokemon=e,this.formChange=t}start(){if(super.start(),this.pokemon.formIndex===this.pokemon.species.forms.findIndex(r=>r.formKey===this.formChange.formKey))return this.end();const e=is(this.pokemon);if(!this.pokemon.isOnField()||this.pokemon.getTag(Sc)||this.pokemon.isFainted()){this.pokemon.isPlayer()||this.pokemon.isActive()?this.pokemon.changeForm(this.formChange).then(()=>{n.ui.showText(Sn(this.pokemon,this.formChange,e),null,()=>this.end(),1500)}):this.end();return}const t=p(()=>{const r=n.addPokemonSprite(this.pokemon,this.pokemon.x+this.pokemon.getSprite().x,this.pokemon.y+this.pokemon.getSprite().y,"pkmn__sub");r.setOrigin(.5,1);const a=this.pokemon.getBattleSpriteKey();try{r.play(a).stop()}catch(o){console.error(`Failed to play animation for ${a}`,o)}return r.setPipeline(n.spritePipeline,{tone:[0,0,0,0],hasShadow:!1,teraColor:Wl(this.pokemon.getTeraType()),isTerastallized:this.pokemon.isTerastallized}),["spriteColors","fusionSpriteColors"].map(o=>{this.pokemon.summonData.speciesForm&&(o+="Base"),r.pipelineData[o]=this.pokemon.getSprite().pipelineData[o]}),n.field.add(r),r},"getPokemonSprite"),[s,i]=[t(),t()];this.pokemon.getSprite().on("animationupdate",(r,a)=>{a.textureKey===s.texture.key?s.setFrame(a.textureFrame):i.setFrame(a.textureFrame)}),s.setAlpha(0),s.setTintFill(16777215),i.setVisible(!1),i.setTintFill(16777215),n.playSound("battle_anims/PRSFX- Transform"),n.tweens.add({targets:s,alpha:1,duration:1e3,ease:"Cubic.easeIn",onComplete:p(()=>{this.pokemon.setVisible(!1),this.pokemon.changeForm(this.formChange).then(()=>{i.setScale(.01);const r=this.pokemon.getBattleSpriteKey();try{i.play(r).stop()}catch(a){console.error(`Failed to play animation for ${r}`,a)}i.setVisible(!0),n.tweens.add({targets:s,delay:250,scale:.01,ease:"Cubic.easeInOut",duration:500,onComplete:p(()=>s.destroy(),"onComplete")}),n.tweens.add({targets:i,delay:250,scale:this.pokemon.getSpriteScale(),ease:"Cubic.easeInOut",duration:500,onComplete:p(()=>{this.pokemon.setVisible(!0),n.tweens.add({targets:i,delay:250,alpha:0,ease:"Cubic.easeOut",duration:1e3,onComplete:p(()=>{s.setVisible(!1),n.ui.showText(Sn(this.pokemon,this.formChange,e),null,()=>this.end(),1500)},"onComplete")})},"onComplete")})})},"onComplete")})}end(){var e;if(this.pokemon.findAndRemoveTags(t=>t.tagType===ss.AUTOTOMIZED),((e=n)==null?void 0:e.currentBattle.battleSpec)===hi.FINAL_BOSS&&this.pokemon instanceof vn){n.playBgm(),n.unshiftPhase(new Gl(this.pokemon.getBattlerIndex(),this.pokemon.getMaxHp(),null,!1,!1,!1,!0)),this.pokemon.findAndRemoveTags(()=>!0),this.pokemon.bossSegments=5,this.pokemon.bossSegmentIndex=4,this.pokemon.initBattleInfo(),this.pokemon.cry();const t=n.findPhase(s=>s instanceof Es&&s.pokemon===this.pokemon);t&&t.cancel()}this.formChange.trigger instanceof Hl&&(nt(vc,this.pokemon,null),nt(Ic,this.pokemon,null),nt(Ec,this.pokemon,null)),super.end()}};p(uo,"QuietFormChangePhase");let xr=uo;const po=class po extends ps{constructor(e){var t;super(),this.skipTurn=!1,this.fieldIndex=e,(t=n.currentBattle.mysteryEncounter)!=null&&t.skipEnemyBattleTurns&&(this.skipTurn=!0)}start(){var r;super.start();const e=n.getEnemyField()[this.fieldIndex],t=n.currentBattle,s=t.trainer;if(t.double&&e.hasAbility(Ui.COMMANDER)&&((r=e.getAlly())!=null&&r.getTag(ss.COMMANDED))&&(this.skipTurn=!0),s&&!e.getMoveQueue().length){const a=e.getOpponents();if(!e.isTrapped()){const o=s.getPartyMemberMatchupScores(e.trainerSlot,!0);if(o.length){const l=a.map(f=>e.getMatchupScore(f)),h=l.reduce((f,u)=>f+=u,0)/l.length,c=s.getSortedPartyMemberMatchupScores(o),d=1-(t.enemySwitchCounter?Math.pow(.1,1/t.enemySwitchCounter):0);if(c[0][1]*d>=h*(s.config.isBoss?2:3)){const f=s.getNextSummonIndex(e.trainerSlot,o);return t.turnCommands[this.fieldIndex+He.ENEMY]={command:Qe.POKEMON,cursor:f,args:[!1],skip:this.skipTurn},t.enemySwitchCounter++,this.end()}}}}const i=e.getNextMove();s!=null&&s.shouldTera(e)&&(n.currentBattle.preTurnCommands[this.fieldIndex+He.ENEMY]={command:Qe.TERA}),n.currentBattle.turnCommands[this.fieldIndex+He.ENEMY]={command:Qe.FIGHT,move:i,skip:this.skipTurn},n.currentBattle.enemySwitchCounter=Math.max(n.currentBattle.enemySwitchCounter-1,0),this.end()}getFieldIndex(){return this.fieldIndex}};p(po,"EnemyCommandPhase");let _r=po;const fo=class fo extends Kl{constructor(e,t){super(He.ENEMY+e),this.pokeballType=t}start(){super.start();const e=this.getPokemon();if(!(e!=null&&e.hp))return this.end();const t=e.getTag(Ds);t&&t.sprite.setVisible(!1),n.pokeballCounts[this.pokeballType]--,this.originalY=e.y;const s=3*e.getMaxHp(),i=2*e.hp,r=e.species.catchRate,a=xc(this.pokeballType),o=e.status?_c(e.status.effect):1,l=Math.round((s-i)*r*a/s*o),h=Math.round(65536/Math.pow(255/l,.1875)),c=wc(l),d=e.randBattleSeedInt(256)<c,f=e.getFieldPositionOffset(),u=bn(this.pokeballType);this.pokeball=n.addFieldSprite(16,80,"pb",u),this.pokeball.setOrigin(.5,.625),n.field.add(this.pokeball),n.playSound(d?"se/crit_throw":"se/pb_throw"),n.time.delayedCall(300,()=>{n.field.moveBelow(this.pokeball,e)}),n.tweens.add({targets:this.pokeball,x:{value:236+f[0],ease:"Linear"},y:{value:16+f[1],ease:"Cubic.easeOut"},duration:500,onComplete:p(()=>{this.pokeball.setTexture("pb",`${u}_opening`),n.time.delayedCall(17,()=>this.pokeball.setTexture("pb",`${u}_open`)),n.playSound("se/pb_rel"),e.tint(Ro(this.pokeballType)),Oc(this.pokeball.x,this.pokeball.y,this.pokeballType),n.tweens.add({targets:e,duration:500,ease:"Sine.easeIn",scale:.25,y:20,onComplete:p(()=>{this.pokeball.setTexture("pb",`${u}_opening`),e.setVisible(!1),n.playSound("se/pb_catch"),n.time.delayedCall(17,()=>this.pokeball.setTexture("pb",`${u}`));const C=p(()=>{let g=0;const v=this.pokeball.x,m=n.tweens.addCounter({from:0,to:1,repeat:d?2:4,yoyo:!0,ease:"Cubic.easeOut",duration:250,repeatDelay:500,onUpdate:p(b=>{if(g&&g<(d?2:4)){const E=b.getValue(),w=g%2===1?1:-1;this.pokeball.setX(v+E*4*w),this.pokeball.setAngle(E*27.5*w)}},"onUpdate"),onRepeat:p(()=>{if(!e.species.isObtainable())m.stop(),this.failCatch(g);else if(g++<(d?1:3))a===-1||d||l>=255||e.randBattleSeedInt(65536)<h?n.playSound("se/pb_move"):(m.stop(),this.failCatch(g));else if(d&&e.randBattleSeedInt(65536)>=h)m.stop(),this.failCatch(g);else{n.playSound("se/pb_lock"),Lc(this.pokeball);const b=n.add.sprite(this.pokeball.x,this.pokeball.y,"pb","pb");b.setOrigin(this.pokeball.originX,this.pokeball.originY),b.setTintFill(0),b.setAlpha(0),n.field.add(b),n.tweens.add({targets:b,alpha:.375,duration:200,easing:"Sine.easeOut",onComplete:p(()=>{n.tweens.add({targets:b,alpha:0,duration:200,easing:"Sine.easeIn",onComplete:p(()=>b.destroy(),"onComplete")})},"onComplete")})}},"onRepeat"),onComplete:p(()=>{this.catch()},"onComplete")})},"doShake");n.time.delayedCall(250,()=>Ac(this.pokeball,16,72,350,C,d))},"onComplete")})},"onComplete")})}failCatch(e){var r;const t=this.getPokemon();n.playSound("se/pb_rel"),t.setY(this.originalY),((r=t.status)==null?void 0:r.effect)!==yi.SLEEP&&t.cry(t.getHpRatio()>.25?void 0:{rate:.85}),t.tint(Ro(this.pokeballType)),t.setVisible(!0),t.untint(250,"Sine.easeOut");const s=t.getTag(Ds);s&&s.sprite.setVisible(!0);const i=bn(this.pokeballType);this.pokeball.setTexture("pb",`${i}_opening`),n.time.delayedCall(17,()=>this.pokeball.setTexture("pb",`${i}_open`)),n.tweens.add({targets:t,duration:250,ease:"Sine.easeOut",scale:1}),n.currentBattle.lastUsedPokeball=this.pokeballType,this.removePb(),this.end()}catch(){const e=this.getPokemon(),t=e.fusionSpecies?e.getFusionSpeciesForm():e.getSpeciesForm();t.abilityHidden&&(e.fusionSpecies?e.fusionAbilityIndex:e.abilityIndex)===t.getAbilityCount()-1&&n.validateAchv(Ge.HIDDEN_ABILITY),e.species.subLegendary&&n.validateAchv(Ge.CATCH_SUB_LEGENDARY),e.species.legendary&&n.validateAchv(Ge.CATCH_LEGENDARY),e.species.mythical&&n.validateAchv(Ge.CATCH_MYTHICAL),n.pokemonInfoContainer.show(e,!0),n.gameData.updateSpeciesDexIvs(e.species.getRootSpeciesId(!0),e.ivs),n.ui.showText(S.t("battle:pokemonCaught",{pokemonName:is(e)}),null,()=>{const s=p(()=>{n.unshiftPhase(new Mc(this.battlerIndex)),n.pokemonInfoContainer.hide(),this.removePb(),this.end()},"end"),i=p(()=>{n.addFaintedEnemyScore(e),e.hp=0,e.trySetStatus(yi.FAINT),n.clearEnemyHeldItemModifiers(),e.leaveField(!0,!0,!0)},"removePokemon"),r=p(a=>{const o=e.addToParty(this.pokeballType,a),l=n.findModifiers(h=>h instanceof $t,!1);n.getPlayerParty().filter(h=>h.isShiny()).length===pn&&n.validateAchv(Ge.SHINY_PARTY),Promise.all(l.map(h=>n.addModifier(h,!0))).then(()=>{n.updateModifiers(!0),i(),o?o.loadAssets().then(s):s()})},"addToParty");Promise.all([e.hideInfo(),n.gameData.setPokemonCaught(e)]).then(()=>{if(n.getPlayerParty().length===pn){const a=p(()=>{n.ui.showText(S.t("battle:partyFull",{pokemonName:e.getNameToRender()}),null,()=>{n.pokemonInfoContainer.makeRoomForConfirmUi(1,!0),n.ui.setMode(L.CONFIRM,()=>{const o=n.addPlayerPokemon(e.species,e.level,e.abilityIndex,e.formIndex,e.gender,e.shiny,e.variant,e.ivs,e.nature,e);n.ui.setMode(L.SUMMARY,o,0,kc.DEFAULT,()=>{n.ui.setMode(L.MESSAGE).then(()=>{a()})},!1)},()=>{const o={shiny:e.shiny,variant:e.variant,form:e.formIndex,female:e.gender===kt.FEMALE};n.ui.setOverlayMode(L.POKEDEX_PAGE,e.species,o,null,null,()=>{n.ui.setMode(L.MESSAGE).then(()=>{a()})})},()=>{n.ui.setMode(L.PARTY,Fl.RELEASE,this.fieldIndex,(o,l)=>{n.ui.setMode(L.MESSAGE).then(()=>{o<6?r(o):a()})})},()=>{n.ui.setMode(L.MESSAGE).then(()=>{i(),s()})},"fullParty")})},"promptRelease");a()}else r()})},0,!0)}removePb(){n.tweens.add({targets:this.pokeball,duration:250,delay:250,ease:"Sine.easeIn",alpha:0,onComplete:p(()=>this.pokeball.destroy(),"onComplete")})}};p(fo,"AttemptCapturePhase");let wr=fo;const go=class go extends Kl{constructor(){super(...arguments),this.forceFailEscape=!1}start(){super.start();const e=n.getPlayerField(),t=n.getEnemyField(),s=this.getPokemon(),i=new Jt(0);this.attemptRunAway(e,t,i),nt(Dc,s,null,!1,i),s.randBattleSeedInt(100)<i.value&&!this.forceFailEscape?(t.forEach(r=>Pc(Fc,r)),n.playSound("se/flee"),n.queueMessage(S.t("battle:runAwaySuccess"),null,!0,500),n.tweens.add({targets:[n.arenaEnemy,t].flat(),alpha:0,duration:250,ease:"Sine.easeIn",onComplete:p(()=>t.forEach(r=>r.destroy()),"onComplete")}),n.clearEnemyHeldItemModifiers(),t.forEach(r=>{r.hideInfo().then(()=>r.destroy()),r.hp=0,r.trySetStatus(yi.FAINT)}),n.pushPhase(new Bc(!1)),(n.gameMode.hasRandomBiomes||n.isNewBiome())&&n.pushPhase(new Rc),n.pushPhase(new Nc)):(s.turnData.failedRunAway=!0,n.queueMessage(S.t("battle:runAwayCannotEscape"),null,!0,500)),this.end()}attemptRunAway(e,t,s){const i=t.reduce((u,C)=>u+C.getStat(os.SPD),0),r=e.reduce((u,C)=>u+C.getStat(os.SPD),0);let a=!1;for(let u=0;u<t.length;u++)a=a||t[u].isBoss();const o=r/i,l=a?6:4,h=5,c=a?25:95,d=a?2:10,f=(c-h)/l;s.value=Phaser.Math.Clamp(Math.round(f*o+h+d*n.currentBattle.escapeAttempts++),h,c)}};p(go,"AttemptRunPhase");let Or=go;const mo=class mo extends ps{start(){super.start(),this.executeForAll(e=>{this.eatBerries(e),nt(Uc,e,null)}),this.end()}eatBerries(e){if(!!!n.findModifier(i=>i instanceof No&&i.shouldApply(e),e.isPlayer()))return;const s=new ft(!1);if(e.getOpponents().forEach(i=>nt(Yc,i,s)),s.value){n.queueMessage(S.t("abilityTriggers:preventBerryUse",{pokemonNameWithAffix:is(e)}));return}n.unshiftPhase(new zl(e.getBattlerIndex(),e.getBattlerIndex(),Ci.USE_ITEM));for(const i of n.applyModifiers(No,e.isPlayer(),e))i.consumed&&(i.consumed=!1,e.loseHeldItem(i)),n.eventTarget.dispatchEvent(new Vc(i));n.updateModifiers(e.isPlayer()),nt(Gc,e,new ft(!1))}};p(mo,"BerryPhase");let Ar=mo;const yo=class yo extends Ys{constructor(e,t){super(),this.pokemon=e,this.move=t}canMove(){return this.pokemon.isActive(!0)&&this.move.isUsable(this.pokemon)}start(){super.start(),this.canMove()&&Hc(jl,this.pokemon,null,this.move.getMove()),this.end()}};p(yo,"MoveHeaderPhase");let kr=yo;const Co=class Co extends ps{start(){super.start(),n.currentBattle.incrementTurn(),n.eventTarget.dispatchEvent(new Wc(n.currentBattle.turn)),n.hideAbilityBar();const e=p(t=>{var s;t.switchOutStatus||(t.lapseTags(Kc.TURN_END),n.applyModifiers(zc,t.isPlayer(),t),((s=n.arena.terrain)==null?void 0:s.terrainType)===Ps.GRASSY&&t.isGrounded()&&n.unshiftPhase(new Gl(t.getBattlerIndex(),Math.max(t.getMaxHp()>>4,1),S.t("battle:turnEndHpRestore",{pokemonName:is(t)}),!0)),t.isPlayer()||(n.applyModifiers(jc,!1,t),n.applyModifier(Xc,!1,t)),$c(Qc,t)),n.applyModifiers(Zc,t.isPlayer(),t),n.applyModifiers(qc,t.isPlayer(),t),t.tempSummonData.turnCount++,t.tempSummonData.waveTurnCount++},"handlePokemon");this.executeForAll(e),n.arena.lapseTags(),n.arena.weather&&!n.arena.weather.lapse()&&(n.arena.trySetWeather(mi.NONE),n.arena.triggerWeatherBasedFormChangesToNormal()),n.arena.terrain&&!n.arena.terrain.lapse()&&n.arena.trySetTerrain(Ps.NONE),this.end()}};p(Co,"TurnEndPhase");let Mr=Co;const bo=class bo extends zl{constructor(){var e,t,s,i,r;super(void 0,void 0,Ci.SUNNY+((((s=(t=(e=n)==null?void 0:e.arena)==null?void 0:t.weather)==null?void 0:s.weatherType)||mi.NONE)-1)),this.weather=(r=(i=n)==null?void 0:i.arena)==null?void 0:r.weather}start(){var e,t;if(this.weather=(t=(e=n)==null?void 0:e.arena)==null?void 0:t.weather,!this.weather)return this.end();if(this.setAnimation(Ci.SUNNY+(this.weather.weatherType-1)),this.weather.isDamaging()){const s=new ft(!1);if(this.executeForAll(i=>Fo(Jc,i,this.weather,s)),!s.value){const i=p(r=>{const a=new ft(!1);if(Fo(id,r,this.weather,a),nt(rd,r,a),a.value||r.getTag(ss.UNDERGROUND)||r.getTag(ss.UNDERWATER))return;const o=bh(r.getMaxHp()/16);n.queueMessage(nd(this.weather.weatherType,r)??""),r.damageAndUpdate(o,{result:Xt.INDIRECT,ignoreSegments:!0})},"inflictDamage");this.executeForAll(r=>{!r||!!r.getTypes(!0,!0).filter(o=>{var l;return(l=this.weather)==null?void 0:l.isTypeDamageImmune(o)}).length||r.switchOutStatus||i(r)})}}n.ui.showText(ed(this.weather.weatherType)??"",null,()=>{this.executeForAll(s=>{s.switchOutStatus||td(sd,s,this.weather)}),super.start()})}};p(bo,"WeatherEffectPhase");let Lr=bo;const To=class To extends Gi{constructor(e){super(),this.order=e}start(){var t;const e=n.getField();for(const s of this.order)(t=e[s].status)!=null&&t.isPostTurn()&&n.unshiftPhase(new ad(s));this.end()}};p(To,"CheckStatusEffectPhase");let Dr=To;const So=class So extends Ys{constructor(e){super(),this.pokemon=e}start(){super.start(),n.queueMessage(S.t("battle:pokemonTerastallized",{pokemonNameWithAffix:is(this.pokemon),type:S.t(`pokemonInfo:Type.${Te[this.pokemon.getTeraType()]}`)})),new od(Ci.TERASTALLIZE,this.pokemon).play(!1,()=>{this.end()})}end(){this.pokemon.isTerastallized=!0,this.pokemon.updateSpritePipelineData(),this.pokemon.isPlayer()&&(n.arena.playerTerasUsed+=1),n.triggerPokemonFormChange(this.pokemon,Hl),this.pokemon.isPlayer()&&(n.validateAchv(Ge.TERASTALLIZE),this.pokemon.getTeraType()===Te.STELLAR&&n.validateAchv(Ge.STELLAR_TERASTALLIZE)),super.end()}};p(So,"TeraPhase");let Pr=So;const vo=class vo extends ps{getSpeedOrder(){const e=n.getPlayerField().filter(r=>r.isActive()),t=n.getEnemyField().filter(r=>r.isActive());let s=e.concat(t);n.executeWithSeedOffset(()=>{s=Il(s)},n.currentBattle.turn,n.waveSeed);const i=new ft(!1);return n.arena.applyTags(ld,!1,i),s.sort((r,a)=>{const o=(r==null?void 0:r.getEffectiveStat(os.SPD))??0,l=(a==null?void 0:a.getEffectiveStat(os.SPD))??0;return i.value?o-l:l-o}),s.map(r=>r.getFieldIndex()+(r.isPlayer()?He.PLAYER:He.ENEMY))}getCommandOrder(){let e=this.getSpeedOrder();const t={};return n.getField(!0).map(s=>{const i=new ft(!1),r=new ft(!0);nt(hd,s,null,!1,i),nt(cd,s,null,!1,i,r),r.value&&n.applyModifiers(dd,s.isPlayer(),s,i),t[s.getBattlerIndex()]=i}),e=e.slice(0),e.sort((s,i)=>{const r=n.currentBattle.turnCommands[s],a=n.currentBattle.turnCommands[i];if((r==null?void 0:r.command)!==(a==null?void 0:a.command)){if((r==null?void 0:r.command)===Qe.FIGHT)return 1;if((a==null?void 0:a.command)===Qe.FIGHT)return-1}else if((r==null?void 0:r.command)===Qe.FIGHT){const h=_e[r.move.move],c=_e[a.move.move],d=n.getField(!0).find(v=>v.getBattlerIndex()===s),f=n.getField(!0).find(v=>v.getBattlerIndex()===i),u=h.getPriority(d,!1),C=c.getPriority(f,!1),g=Math.ceil(u)-Math.ceil(C)===0;if(u!==C)return g&&t[s].value!==t[i].value?t[s].value?-1:1:u<C?1:-1}if(t[s].value!==t[i].value)return t[s].value?-1:1;const o=e.indexOf(s),l=e.indexOf(i);return o<l?-1:o>l?1:0}),e}start(){var i;super.start();const e=n.getField(),t=this.getCommandOrder();let s=0;for(const r of this.getSpeedOrder()){const a=e[r],o=n.currentBattle.preTurnCommands[r];if(!(o!=null&&o.skip))switch(o==null?void 0:o.command){case Qe.TERA:n.pushPhase(new Pr(a))}}for(const r of t){const a=e[r],o=n.currentBattle.turnCommands[r];if(!(o!=null&&o.skip))switch(o==null?void 0:o.command){case Qe.FIGHT:const l=o.move;if(a.turnData.order=s++,!l)continue;const h=a.getMoveset().find(f=>f.moveId===l.move&&f.ppUsed<f.getMovePp())||new pd(l.move);if(h.getMove().hasAttr(jl)&&n.unshiftPhase(new kr(a,h)),a.isPlayer())if(o.cursor===-1)n.pushPhase(new Es(a,o.targets||o.move.targets,h));else{const f=new Es(a,o.targets||o.move.targets,h,!1,l.ignorePP);n.pushPhase(f)}else n.pushPhase(new Es(a,o.targets||o.move.targets,h,!1,l.ignorePP));break;case Qe.BALL:n.unshiftPhase(new wr(o.targets[0]%2,o.cursor));break;case Qe.POKEMON:const c=(i=o.args)!=null&&i[0]?Vo.BATON_PASS:Vo.SWITCH;n.unshiftPhase(new ud(c,a.getFieldIndex(),o.cursor,!0,a.isPlayer()));break;case Qe.RUN:let d=a;if(n.currentBattle.double){const f=e.filter(u=>{if(u)return u.isPlayer()&&u.isActive()});if(f.length>1){const u=f[0].getStat(os.SPD)>f[1].getStat(os.SPD)?f[0]:f[1],C=f.find(g=>g.hasAbility(Ui.RUN_AWAY));d=C!==void 0?C:u}}n.unshiftPhase(new Or(d.getFieldIndex()));break}}n.pushPhase(new Lr),n.pushPhase(new Ar),n.pushPhase(new Dr(t)),n.pushPhase(new Mr),this.end()}};p(vo,"TurnStartPhase");let Br=vo;const Io=class Io extends ps{start(){if(super.start(),n.getPlayerField().forEach(e=>{if(e.isOnField()&&!e.isAllowedInBattle()){n.queueMessage(S.t("challenges:illegalEvolution",{pokemon:e.name}),null,!0);const t=n.getPokemonAllowedInBattle();t.length?t.length>=n.currentBattle.getBattlerCount()||n.currentBattle.double&&!t[0].isActive(!0)?e.switchOut():e.leaveField():(n.clearPhaseQueue(),n.unshiftPhase(new fd)),t.length===1&&n.currentBattle.double&&n.unshiftPhase(new Xl(!0))}}),n.eventTarget.dispatchEvent(new gd),md(),yd()){this.end();return}n.getField().forEach((e,t)=>{e!=null&&e.isActive()&&(e.isPlayer()&&n.currentBattle.addParticipant(e),e.resetTurnData(),n.pushPhase(e.isPlayer()?new Cd(t):new _r(t-He.ENEMY)))}),n.pushPhase(new Br),this.end()}};p(Io,"TurnInitPhase");let Rr=Io;const Eo=class Eo extends $l{constructor(e,t){super(e),this.expValue=t}start(){super.start();const e=this.getPokemon(),t=new Jt(this.expValue);n.applyModifiers(Zl,!0,t),t.value=Math.floor(t.value),n.ui.showText(S.t("battle:expGain",{pokemonName:is(e),exp:t.value}),null,()=>{const s=e.level;e.addExp(t.value);const i=e.level;i>s&&n.unshiftPhase(new ql(this.partyMemberIndex,s,i)),e.updateInfo().then(()=>this.end())},null,!0)}};p(Eo,"ExpPhase");let Nr=Eo;const xo=class xo extends Ys{start(){super.start(),n.partyExpBar.hide().then(()=>this.end())}};p(xo,"HidePartyExpBarPhase");let Fr=xo;const _o=class _o extends $l{constructor(e,t){super(e),this.expValue=t}start(){super.start();const e=this.getPokemon(),t=new Jt(this.expValue);n.applyModifiers(Zl,!0,t),t.value=Math.floor(t.value);const s=e.level;e.addExp(t.value);const i=e.level;i>s&&n.unshiftPhase(new ql(this.partyMemberIndex,s,i)),n.unshiftPhase(new Fr),e.updateInfo(),n.expParty===$i.SKIP?this.end():n.expParty===$i.ONLY_LEVEL_UP?i>s?n.partyExpBar.showPokemonExp(e,t.value,n.expParty===$i.ONLY_LEVEL_UP,i).then(()=>{setTimeout(()=>this.end(),800/Math.pow(2,n.expGainsSpeed))}):this.end():n.expGainsSpeed<Ql.SKIP?n.partyExpBar.showPokemonExp(e,t.value,!1,i).then(()=>{setTimeout(()=>this.end(),500/Math.pow(2,n.expGainsSpeed))}):this.end()}};p(_o,"ShowPartyExpBarPhase");let Vr=_o;const Cl=(Array.isArray(pe.OPP_IVS_OVERRIDE)?pe.OPP_IVS_OVERRIDE:new Array(6).fill(pe.OPP_IVS_OVERRIDE)).map(P=>Number.isNaN(P)||P===null||P>31?-1:P),wo=class wo extends bd{constructor(){super("battle"),this.sessionPlayTime=null,this.lastSavePlayTime=null,this.masterVolume=.5,this.bgmVolume=1,this.fieldVolume=1,this.seVolume=1,this.uiVolume=1,this.gameSpeed=1,this.damageNumbersMode=0,this.reroll=!1,this.shopCursorTarget=Td.REWARDS,this.commandCursorMemory=!1,this.dexForDevs=!1,this.showMovesetFlyout=!0,this.showArenaFlyout=!0,this.showTimeOfDayWidget=!0,this.timeOfDayAnimation=Ul.NONE,this.showLevelUpStats=!0,this.enableTutorials=!1,this.enableMoveInfo=!0,this.enableRetries=!1,this.hideIvs=!1,this.candyUpgradeNotification=0,this.candyUpgradeDisplay=0,this.moneyFormat=Th.NORMAL,this.uiTheme=Sd.DEFAULT,this.windowType=0,this.experimentalSprites=!1,this.musicPreference=vd.ALLGENS,this.moveAnimations=!0,this.expGainsSpeed=Ql.DEFAULT,this.skipSeenDialogues=!1,this.eggSkipPreference=0,this.expParty=0,this.hpBarSpeed=0,this.fusionPaletteSwaps=!0,this.enableTouchControls=!1,this.enableVibration=!1,this.showBgmBar=!0,this.battleStyle=Id.SWITCH,this.typeHints=!1,this.disableMenu=!1,this.mysteryEncounterSaveData=new Uo,this.shopOverlayShown=!1,this.shopOverlayOpacity=.8,this.bgmCache=new Set,this.rngCounter=0,this.rngSeedOverride="",this.rngOffset=0,this.infoToggles=[],this.eventTarget=new EventTarget,this.phaseQueue=[],this.phaseQueuePrepend=[],this.conditionalQueue=[],this.phaseQueuePrependSpliceIndex=-1,this.nextCommandPhaseQueue=[],this.eventManager=new Ed,this.updateGameInfo(),xh(this)}loadPokemonAtlas(e,t,s){s===void 0&&(s=this.experimentalSprites);const i=t.includes("variant/")||/_[0-3]$/.test(t);s&&(s=xd(e)),i&&(t=t.replace("variant/","")),this.load.atlas(e,`images/pokemon/${i?"variant/":""}${s?"exp/":""}${t}.png`,`images/pokemon/${i?"variant/":""}${s?"exp/":""}${t}.json`)}async preload(){_d(),await this.initVariantData()}create(){this.scene.remove(wd.KEY),qu.apply(this),this.inputController=new mr,this.uiInputs=new yr(this.inputController),this.gameData=new Yo,Od(),this.load.setBaseURL(),this.spritePipeline=new lr(this.game),this.renderer.pipelines.add("Sprite",this.spritePipeline),this.fieldSpritePipeline=new Li(this.game),this.renderer.pipelines.add("FieldSprite",this.fieldSpritePipeline),this.launchBattle()}update(){var e;(e=this.ui)==null||e.update()}launchBattle(){this.arenaBg=this.add.sprite(0,0,"plains_bg"),this.arenaBg.setName("sprite-arena-bg"),this.arenaBgTransition=this.add.sprite(0,0,"plains_bg"),this.arenaBgTransition.setName("sprite-arena-bg-transition");for(const d of[this.arenaBgTransition,this.arenaBg])d.setPipeline(this.fieldSpritePipeline),d.setScale(6),d.setOrigin(0),d.setSize(320,240);const e=this.add.container(0,0);e.setName("field"),e.setScale(6),this.field=e;const t=this.add.container(0,this.game.canvas.height);t.setName("field-ui"),t.setDepth(1),t.setScale(6),this.fieldUI=t;const s=this.make.rexTransitionImagePack({x:0,y:0,scale:6,key:"loading_bg",origin:{x:0,y:0}},!0);s.transit({mode:"blinds",ease:"Cubic.easeInOut",duration:1250}),s.once("complete",()=>{s.destroy()}),this.add.existing(s);const i=this.add.container(0,0);i.setName("ui"),i.setDepth(2),i.setScale(6),this.uiContainer=i;const r=this.game.canvas.width/6,a=this.game.canvas.height/6-48;this.fieldOverlay=this.add.rectangle(0,a*-1-48,r,a,4342338),this.fieldOverlay.setName("rect-field-overlay"),this.fieldOverlay.setOrigin(0,0),this.fieldOverlay.setAlpha(0),this.fieldUI.add(this.fieldOverlay),this.shopOverlay=this.add.rectangle(0,a*-1-48,r,a,460551),this.shopOverlay.setName("rect-shop-overlay"),this.shopOverlay.setOrigin(0,0),this.shopOverlay.setAlpha(0),this.fieldUI.add(this.shopOverlay),this.modifiers=[],this.enemyModifiers=[],this.modifierBar=new Go,this.modifierBar.setName("modifier-bar"),this.add.existing(this.modifierBar),i.add(this.modifierBar),this.enemyModifierBar=new Go(!0),this.enemyModifierBar.setName("enemy-modifier-bar"),this.add.existing(this.enemyModifierBar),i.add(this.enemyModifierBar),this.charSprite=new ur,this.charSprite.setName("sprite-char"),this.charSprite.setup(),this.fieldUI.add(this.charSprite),this.pbTray=new Di(!0),this.pbTray.setName("pb-tray"),this.pbTray.setup(),this.pbTrayEnemy=new Di(!1),this.pbTrayEnemy.setName("enemy-pb-tray"),this.pbTrayEnemy.setup(),this.fieldUI.add(this.pbTray),this.fieldUI.add(this.pbTrayEnemy),this.abilityBar=new or,this.abilityBar.setName("ability-bar"),this.abilityBar.setup(),this.fieldUI.add(this.abilityBar),this.partyExpBar=new hr,this.partyExpBar.setName("party-exp-bar"),this.partyExpBar.setup(),this.fieldUI.add(this.partyExpBar),this.candyBar=new fr,this.candyBar.setName("candy-bar"),this.candyBar.setup(),this.fieldUI.add(this.candyBar),this.biomeWaveText=V(this.game.canvas.width/6-2,0,Zi.toString(),x.BATTLE_INFO),this.biomeWaveText.setName("text-biome-wave"),this.biomeWaveText.setOrigin(1,.5),this.fieldUI.add(this.biomeWaveText),this.moneyText=V(this.game.canvas.width/6-2,0,"",x.MONEY),this.moneyText.setName("text-money"),this.moneyText.setOrigin(1,.5),this.fieldUI.add(this.moneyText),this.scoreText=V(this.game.canvas.width/6-2,0,"",x.PARTY,{fontSize:"54px"}),this.scoreText.setName("text-score"),this.scoreText.setOrigin(1,.5),this.fieldUI.add(this.scoreText),this.luckText=V(this.game.canvas.width/6-2,0,"",x.PARTY,{fontSize:"54px"}),this.luckText.setName("text-luck"),this.luckText.setOrigin(1,.5),this.luckText.setVisible(!1),this.fieldUI.add(this.luckText),this.luckLabelText=V(this.game.canvas.width/6-2,0,S.t("common:luckIndicator"),x.PARTY,{fontSize:"54px"}),this.luckLabelText.setName("text-luck-label"),this.luckLabelText.setOrigin(1,.5),this.luckLabelText.setVisible(!1),this.fieldUI.add(this.luckLabelText),this.arenaFlyout=new br,this.fieldUI.add(this.arenaFlyout),this.fieldUI.moveBelow(this.arenaFlyout,this.fieldOverlay),this.updateUIPositions(),this.damageNumberHandler=new pr,this.spriteSparkleHandler=new dr,this.spriteSparkleHandler.setup(),this.pokemonInfoContainer=new Nl(this.game.canvas.width/6+52,-(this.game.canvas.height/6)+66),this.pokemonInfoContainer.setup(),this.fieldUI.add(this.pokemonInfoContainer),this.party=[];const o=[];this.arenaPlayer=new $s(!0),this.arenaPlayer.setName("arena-player"),this.arenaPlayerTransition=new $s(!0),this.arenaPlayerTransition.setName("arena-player-transition"),this.arenaEnemy=new $s(!1),this.arenaEnemy.setName("arena-enemy"),this.arenaNextEnemy=new $s(!1),this.arenaNextEnemy.setName("arena-next-enemy"),this.arenaBgTransition.setVisible(!1),this.arenaPlayerTransition.setVisible(!1),this.arenaNextEnemy.setVisible(!1);for(const d of[this.arenaPlayer,this.arenaPlayerTransition,this.arenaEnemy,this.arenaNextEnemy])d instanceof wt.GameObjects.Sprite&&d.setOrigin(0,0),e.add(d);const l=this.addFieldSprite(0,0,`trainer_${this.gameData.gender===bt.FEMALE?"f":"m"}_back`);l.setOrigin(.5,1),l.setName("sprite-trainer"),e.add(l),this.trainer=l,this.anims.create({key:"prompt",frames:this.anims.generateFrameNumbers("prompt",{start:1,end:4}),frameRate:6,repeat:-1,showOnStart:!0}),this.anims.create({key:"tera_sparkle",frames:this.anims.generateFrameNumbers("tera_sparkle",{start:0,end:12}),frameRate:18,repeat:0,showOnStart:!0,hideOnComplete:!0}),this.reset(!1,!1,!0);const h=new ar;this.uiContainer.add(h),this.ui=h,h.setup();const c=[Dt.TACKLE,Dt.TAIL_WHIP,Dt.FOCUS_ENERGY,Dt.STRUGGLE];Promise.all([Promise.all(o),Ad().then(()=>kd(!0)),Promise.all([Dt.TACKLE,Dt.TAIL_WHIP,Dt.FOCUS_ENERGY,Dt.STRUGGLE].map(d=>Md(d))).then(()=>Ld(c,!0)),this.initStarterColors()]).then(()=>{this.pushPhase(new Pi),this.pushPhase(new Yr),this.shiftPhase()})}initSession(){this.sessionPlayTime===null&&(this.sessionPlayTime=0),this.lastSavePlayTime===null&&(this.lastSavePlayTime=0),this.playTimeTimer&&this.playTimeTimer.destroy(),this.playTimeTimer=this.time.addEvent({delay:ye(1e3),repeat:-1,callback:p(()=>{this.gameData&&this.gameData.gameStats.playTime++,this.sessionPlayTime!==null&&this.sessionPlayTime++,this.lastSavePlayTime!==null&&this.lastSavePlayTime++},"callback")}),this.updateBiomeWaveText(),this.updateMoneyText(),this.updateScoreText()}async initExpSprites(){Ho.size>0||this.cachedFetch("./exp-sprites.json").then(e=>e.json()).then(e=>{if(Array.isArray(e))for(const t of e)Ho.add(t);Promise.resolve()})}async initVariantData(){Dd();const e=await this.cachedFetch("./images/pokemon/variant/_masterlist.json").then(s=>s.json());for(const s of Object.keys(e))Wo[s]=e[s];if(!this.experimentalSprites)return;const t=await this.cachedFetch("./images/pokemon/variant/_exp_masterlist.json").then(s=>s.json());Pd(Wo,t)}cachedFetch(e,t){const s=this.game.manifest;if(s){const i=s[`/${e.replace("./","")}`];i&&(e+=`?t=${i}`)}return fetch(e,t)}async initStarterColors(){if(Object.keys(Ye).length>0)return;const e=await this.cachedFetch("./starter-colors.json").then(t=>t.json());for(const t of Object.keys(e))Ye[t]=e[t]}getPlayerParty(){return this.party}getPokemonAllowedInBattle(){return this.getPlayerParty().filter(e=>e.isAllowedInBattle())}getPlayerPokemon(e=!0){return this.getPlayerField().find(t=>t.isActive()&&(e||t.switchOutStatus===!1))}getPlayerField(){var t;const e=this.getPlayerParty();return e.slice(0,Math.min(e.length,(t=this.currentBattle)!=null&&t.double?2:1))}getEnemyParty(){var e;return((e=this.currentBattle)==null?void 0:e.enemyParty)??[]}getEnemyPokemon(e=!0){return this.getEnemyField().find(t=>t.isActive()&&(e||t.switchOutStatus===!1))}getEnemyField(){var t;const e=this.getEnemyParty();return e.slice(0,Math.min(e.length,(t=this.currentBattle)!=null&&t.double?2:1))}getField(e=!1){const t=new Array(4).fill(null),s=this.getPlayerField(),i=this.getEnemyField();return t.splice(0,s.length,...s),t.splice(2,i.length,...i),e?t.filter(r=>r==null?void 0:r.isActive()):t}redirectPokemonMoves(e,t){if(this.currentBattle.double!==!1&&t!=null&&t.isActive(!0)){let s;do s=this.findPhase(i=>i instanceof Es&&i.targets.length===1&&i.targets[0]===e.getBattlerIndex()&&i.pokemon.isPlayer()!==t.isPlayer()),s&&s.targets[0]!==t.getBattlerIndex()&&(s.targets[0]=t.getBattlerIndex());while(s)}}getModifierBar(e){return e?this.enemyModifierBar:this.modifierBar}addInfoToggle(e){this.infoToggles.push(e)}getInfoToggles(e=!1){return e?this.infoToggles.filter(t=>t==null?void 0:t.isActive()):this.infoToggles}getPokemonById(e){const t=p(s=>s.find(i=>i.id===e),"findInParty");return(t(this.getPlayerParty())||t(this.getEnemyParty()))??null}addPlayerPokemon(e,t,s,i,r,a,o,l,h,c,d){const f=new Zs(e,t,s,i,r,a,o,l,h,c);return d&&d(f),f.init(),f}addEnemyPokemon(e,t,s,i=!1,r=!1,a,o){pe.OPP_LEVEL_OVERRIDE>0&&(t=pe.OPP_LEVEL_OVERRIDE),pe.OPP_SPECIES_OVERRIDE&&(e=hs(pe.OPP_SPECIES_OVERRIDE),i=this.getEncounterBossSegments(this.currentBattle.waveIndex,t,e)>1);const l=new vn(e,t,s,i,r,a);if(pe.OPP_FUSION_OVERRIDE&&l.generateFusionSpecies(),i&&!a){const h=Sh(Ae(4294967296));for(let c=0;c<l.ivs.length;c++)l.ivs[c]=Math.round(wt.Math.Linear(Math.min(l.ivs[c],h[c]),Math.max(l.ivs[c],h[c]),.75))}o&&o(l);for(let h=0;h<l.ivs.length;h++)Cl[h]>-1&&(l.ivs[h]=Cl[h]);return l.init(),l}removePokemonFromPlayerParty(e,t=!0){if(!e)return;const s=this.party.indexOf(e);this.party.splice(s,1),t&&(this.field.remove(e,!0),e.destroy()),this.updateModifiers(!0)}addPokemonIcon(e,t,s,i=.5,r=.5,a=!0,o=!1){const l=this.add.container(t,s);l.setName(`${e.name}-icon`);const h=this.add.sprite(0,0,e.getIconAtlasKey(a,o));if(h.setName(`sprite-${e.name}-icon`),h.setFrame(e.getIconId(a,o)),h.frame.name!==e.getIconId(a,o)){console.log(`${e.name}'s variant icon does not exist. Replacing with default.`);const c=e.shiny;e.shiny=!1,h.setTexture(e.getIconAtlasKey(a,o)),h.setFrame(e.getIconId(!0,o)),e.shiny=c}if(h.setOrigin(.5,0),l.add(h),e.isFusion(o)){const c=this.add.sprite(0,0,e.getFusionIconAtlasKey(a,o));c.setName("sprite-fusion-icon"),c.setOrigin(.5,0),c.setFrame(e.getFusionIconId(a,o));const d=h.width,f=h.height,u=h.frame,C=(h.frame.cutHeight<=c.frame.cutHeight?Math.ceil:Math.floor)((h.frame.cutHeight+c.frame.cutHeight)/4),g=`${h.frame.name}f${c.frame.name}`;h.frame.texture.has(g)||h.frame.texture.add(g,h.frame.sourceIndex,h.frame.cutX,h.frame.cutY,h.frame.cutWidth,C),h.setFrame(g),c.y=h.frame.cutHeight;const v=c.frame,m=c.frame.cutY+h.frame.cutHeight,b=c.frame.cutHeight-h.frame.cutHeight,E=`${c.frame.name}f${h.frame.name}`;c.frame.texture.has(E)||c.frame.texture.add(E,c.frame.sourceIndex,c.frame.cutX,m,c.frame.cutWidth,b),c.setFrame(E);const w=(u.y+v.y)/2;h.frame.y=c.frame.y=w,l.add(c),i!==.5&&(l.x-=d*(i-.5)),r!==0&&(l.y-=f*r)}else i!==.5&&(l.x-=h.width*(i-.5)),r!==0&&(l.y-=h.height*r);return l}setSeed(e){this.seed=e,this.rngCounter=0,this.waveCycleOffset=this.getGeneratedWaveCycleOffset(),this.offsetGym=this.gameMode.isClassic&&this.getGeneratedOffsetGym()}randBattleSeedInt(e,t=0){var s;return(s=this.currentBattle)==null?void 0:s.randSeedInt(e,t)}reset(e=!1,t=!1,s=!1){var i,r,a;t&&(this.gameData=new Yo),this.gameMode=Bd(vs.CLASSIC),this.disableMenu=!1,this.score=0,this.money=0,this.lockModifierTiers=!1,this.pokeballCounts=Object.fromEntries(Ss(qi).filter(o=>o<=qi.MASTER_BALL).map(o=>[o,0])),this.pokeballCounts[qi.POKEBALL]+=5,pe.POKEBALL_OVERRIDE.active&&(this.pokeballCounts=pe.POKEBALL_OVERRIDE.pokeballs),this.modifiers=[],this.enemyModifiers=[],this.modifierBar.removeAll(!0),this.enemyModifierBar.removeAll(!0);for(const o of this.getPlayerParty())o.destroy();this.party=[];for(const o of this.getEnemyParty())o.destroy();if((r=(i=this.currentBattle)==null?void 0:i.mysteryEncounter)!=null&&r.introVisuals&&this.field.remove((a=this.currentBattle.mysteryEncounter)==null?void 0:a.introVisuals,!0),this.currentBattle=null,this.setSeed(pe.SEED_OVERRIDE||vh(24)),console.log("Seed:",this.seed),this.resetSeed(),this.biomeWaveText.setText(Zi.toString()),this.biomeWaveText.setVisible(!1),this.updateMoneyText(),this.moneyText.setVisible(!1),this.updateScoreText(),this.scoreText.setVisible(!1),[this.luckLabelText,this.luckText].map(o=>o.setVisible(!1)),this.newArena(pe.STARTING_BIOME_OVERRIDE||Ue.TOWN),this.field.setVisible(!0),this.arenaBgTransition.setPosition(0,0),this.arenaPlayer.setPosition(300,0),this.arenaPlayerTransition.setPosition(0,0),this.arenaEnemy.setPosition(-280,0),this.arenaNextEnemy.setPosition(-280,0),this.arenaNextEnemy.setVisible(!1),this.arena.init(),this.trainer.setTexture(`trainer_${this.gameData.gender===bt.FEMALE?"f":"m"}_back`),this.trainer.setPosition(406,186),this.trainer.setVisible(!0),this.mysteryEncounterSaveData=new Uo,this.updateGameInfo(),s){const o=[...Re,..._e,...Fe,...Ss(tn).map(l=>Rd(l)).flatMap(l=>Object.values(l).flat().map(h=>h.modifierType).filter(h=>"localize"in h).map(h=>h))];for(const l of o)l.localize()}e&&(this.initVariantData(),this.fadeOutBgm(250,!1),this.tweens.add({targets:[this.uiContainer],alpha:0,duration:250,ease:"Sine.easeInOut",onComplete:p(()=>{this.clearPhaseQueue(),this.ui.freeUIData(),this.uiContainer.remove(this.ui,!0),this.uiContainer.destroy(),this.children.removeAll(!0),this.game.domContainer.innerHTML="",this.launchBattle()},"onComplete")}))}getDoubleBattleChance(e,t){const s=new Jt(e%10===0?32:8);this.applyModifiers(Nd,!0,s);for(const i of t)nt(Eu,i,null,!1,s);return Math.max(s.value,1)}isNewBiome(e=this.currentBattle){const t=!(e.waveIndex%10),s=this.gameMode.hasShortBiomes||this.gameMode.isDaily,i=this.gameMode.hasShortBiomes&&e.waveIndex%5===0,r=e.waveIndex%50===49;return t||i||s&&r}newBattle(e,t,s,i,r){var g,v,m;const a=pe.STARTING_WAVE_OVERRIDE||Zi,o=e||(((g=this.currentBattle)==null?void 0:g.waveIndex)||a-1)+1;let l,h,c,d=null;this.resetSeed(o);const f=this.getPlayerField();if(this.gameMode.isFixedBattle(o)&&s===void 0)d=this.gameMode.getFixedBattle(o),l=d.double,h=d.battleType,this.executeWithSeedOffset(()=>c=d==null?void 0:d.getTrainer(),(d.seedOffsetWaveIndex||o)<<8),c&&this.field.add(c);else{if(!this.gameMode.hasTrainers||pe.BATTLE_TYPE_OVERRIDE===Pe.WILD||pe.DISABLE_STANDARD_TRAINERS_OVERRIDE&&ve(s)?h=Pe.WILD:h=pe.BATTLE_TYPE_OVERRIDE??t??(this.gameMode.isWaveTrainer(o,this.arena)?Pe.TRAINER:Pe.WILD),h===Pe.TRAINER){const b=((v=pe.RANDOM_TRAINER_OVERRIDE)==null?void 0:v.trainerType)??this.arena.randomTrainerType(o);let E=!1;Qi[b].doubleOnly?E=!0:Qi[b].hasDouble&&(E=((m=pe.RANDOM_TRAINER_OVERRIDE)==null?void 0:m.alwaysDouble)||!Ae(this.getDoubleBattleChance(o,f)),Qi[b].trainerTypeDouble&&![Ko.TATE,Ko.LIZA].includes(b)&&(E=!1));const w=E?qs.DOUBLE:Ae(2)?qs.FEMALE:qs.DEFAULT;c=s!==void 0?s.toTrainer():new Tn(b,w),this.field.add(c)}!pe.BATTLE_TYPE_OVERRIDE&&(this.isWaveMysteryEncounter(h,o)||h===Pe.MYSTERY_ENCOUNTER)&&(h=Pe.MYSTERY_ENCOUNTER,this.mysteryEncounterSaveData.encounterSpawnChance=Fd)}if(i===void 0&&o>1?h===Pe.WILD&&!this.gameMode.isWaveFinal(o)?l=!Ae(this.getDoubleBattleChance(o,f)):h===Pe.TRAINER&&(l=(c==null?void 0:c.variant)===qs.DOUBLE):d||(l=!!i),this.gameMode.isEndlessBoss(o)&&(l=!1),!ve(pe.BATTLE_STYLE_OVERRIDE)){let b=null;switch(pe.BATTLE_STYLE_OVERRIDE){case"double":b="double";break;case"single":b="single";break;case"even-doubles":b=o%2?"single":"double";break;case"odd-doubles":b=o%2?"double":"single";break}b==="double"&&(l=!0),h!==Pe.TRAINER&&b==="single"&&(l=!1)}const u=this.currentBattle,C=this.getMaxExpLevel();if(this.lastEnemyTrainer=(u==null?void 0:u.trainer)??null,this.lastMysteryEncounter=u==null?void 0:u.mysteryEncounter,h===Pe.MYSTERY_ENCOUNTER&&(l=!1),u!=null&&u.double&&!l){this.tryRemovePhase(b=>b instanceof Vd);for(const b of this.getPlayerField())b.lapseTag(ss.COMMANDED)}if(this.executeWithSeedOffset(()=>{this.currentBattle=new Ud(this.gameMode,o,h,c,l)},o<<3,this.waveSeed),this.currentBattle.incrementTurn(),h===Pe.MYSTERY_ENCOUNTER&&(this.currentBattle.mysteryEncounterType=r),!e&&u){const b=this.isNewBiome(u),E=b||[Pe.TRAINER,Pe.MYSTERY_ENCOUNTER].includes(this.currentBattle.battleType)||this.currentBattle.battleSpec===hi.FINAL_BOSS;for(const w of this.getEnemyParty())w.destroy();if(this.trySpreadPokerus(),!b&&o%10===5&&this.arena.updatePoolsForTimeOfDay(),E){this.arena.resetArenaEffects();for(const w of f)w.lapseTag(ss.COMMANDED);f.forEach((w,_)=>{w.isOnField()&&this.pushPhase(new Yd(_))});for(const w of this.getPlayerParty())w.resetBattleAndWaveData(),w.resetTera(),Gd(xu,w),(w.hasSpecies(ge.TERAPAGOS)||this.gameMode.isClassic&&this.currentBattle.waveIndex>180&&this.currentBattle.waveIndex<=190)&&(this.arena.playerTerasUsed=0);this.trainer.visible||this.pushPhase(new Hd)}for(const w of this.getPlayerParty())this.triggerPokemonFormChange(w,Wd);!this.gameMode.hasRandomBiomes&&!b?this.pushPhase(new Bi):(this.pushPhase(new Ir),this.getMaxExpLevel()>C&&this.pushPhase(new Tr))}return this.currentBattle}newArena(e,t){return this.arena=new Kd(e,Ue[e].toLowerCase(),t),this.eventTarget.dispatchEvent(new zd),this.arenaBg.pipelineData={terrainColorRatio:this.arena.getBgTerrainColorRatioForBiome()},this.arena}updateFieldScale(){return new Promise(e=>{const t=Math.floor(Math.pow(1/this.getField(!0).map(s=>s.getSpriteScale()).reduce((s,i)=>s=Math.max(i,s),0),.7)*40)/40;this.setFieldScale(t).then(()=>e())})}setFieldScale(e,t=!1){return new Promise(s=>{if(e*=6,this.field.scale===e)return s();const i=this.arenaBg.width*6,r=132*6,a=this.arenaBg.width*e,o=132*e;this.tweens.add({targets:this.field,scale:e,x:(i-a)/2,y:r-o,duration:t?0:ye(Math.abs(this.field.scale-e)*200),ease:"Sine.easeInOut",onComplete:p(()=>s(),"onComplete")})})}getSpeciesFormIndex(e,t,s,i){var a,o,l,h,c,d,f,u;if(!((a=e.forms)!=null&&a.length))return 0;const r=["EggLapsePhase","EggHatchPhase"].includes(((o=this.getCurrentPhase())==null?void 0:o.constructor.name)??"");if(!r&&((l=this.currentBattle)==null?void 0:l.battleType)===Pe.TRAINER&&!ve(this.currentBattle.trainer)&&this.currentBattle.trainer.config.hasSpecialtyType()){if(e.speciesId===ge.WORMADAM)switch(this.currentBattle.trainer.config.specialtyType){case Te.GROUND:return 1;case Te.STEEL:return 2;case Te.GRASS:return 0}if(e.speciesId===ge.ROTOM)switch(this.currentBattle.trainer.config.specialtyType){case Te.FLYING:return 4;case Te.GHOST:return 0;case Te.FIRE:return 1;case Te.GRASS:return 5;case Te.WATER:return 2;case Te.ICE:return 3}if(e.speciesId===ge.ORICORIO)switch(this.currentBattle.trainer.config.specialtyType){case Te.GHOST:return 3;case Te.FIRE:return 0;case Te.ELECTRIC:return 1;case Te.PSYCHIC:return 2}if(e.speciesId===ge.PALDEA_TAUROS)switch(this.currentBattle.trainer.config.specialtyType){case Te.FIRE:return 1;case Te.WATER:return 2}if(e.speciesId===ge.SILVALLY||e.speciesId===ge.ARCEUS)return this.currentBattle.trainer.config.specialtyType}switch(e.speciesId){case ge.UNOWN:case ge.SHELLOS:case ge.GASTRODON:case ge.BASCULIN:case ge.DEERLING:case ge.SAWSBUCK:case ge.SCATTERBUG:case ge.SPEWPA:case ge.VIVILLON:case ge.FLABEBE:case ge.FLOETTE:case ge.FLORGES:case ge.FURFROU:case ge.PUMPKABOO:case ge.GOURGEIST:case ge.ORICORIO:case ge.MAGEARNA:case ge.ZARUDE:case ge.SQUAWKABILLY:case ge.TATSUGIRI:case ge.PALDEA_TAUROS:return Ae(e.forms.length);case ge.PIKACHU:return((h=this.currentBattle)==null?void 0:h.battleType)===Pe.TRAINER&&((c=this.currentBattle)==null?void 0:c.waveIndex)<30?0:Ae(8);case ge.EEVEE:return((d=this.currentBattle)==null?void 0:d.battleType)===Pe.TRAINER&&((f=this.currentBattle)==null?void 0:f.waveIndex)<30&&!r?0:Ae(2);case ge.FROAKIE:case ge.FROGADIER:case ge.GRENINJA:return((u=this.currentBattle)==null?void 0:u.battleType)===Pe.TRAINER&&!r?0:Ae(2);case ge.URSHIFU:return Ae(2);case ge.ZYGARDE:return Ae(4);case ge.MINIOR:return Ae(7);case ge.ALCREMIE:return Ae(9);case ge.MEOWSTIC:case ge.INDEEDEE:case ge.BASCULEGION:case ge.OINKOLOGNE:return t===kt.FEMALE?1:0;case ge.TOXTRICITY:{const C=[ht.LONELY,ht.BOLD,ht.RELAXED,ht.TIMID,ht.SERIOUS,ht.MODEST,ht.MILD,ht.QUIET,ht.BASHFUL,ht.CALM,ht.GENTLE,ht.CAREFUL];return s!==void 0&&C.indexOf(s)>-1?1:0}case ge.GIMMIGHOUL:return this.gameMode.hasMysteryEncounters&&!r?1:Ae(e.forms.length)}if(i){switch(e.speciesId){case ge.BURMY:case ge.WORMADAM:case ge.ROTOM:case ge.LYCANROC:return Ae(e.forms.length)}return 0}return this.arena.getSpeciesFormIndex(e)}getGeneratedOffsetGym(){let e=!1;return this.executeWithSeedOffset(()=>{e=!Ae(2)},0,this.seed.toString()),e}getGeneratedWaveCycleOffset(){let e=0;return this.executeWithSeedOffset(()=>{e=Ae(8)*5},0,this.seed.toString()),e}getEncounterBossSegments(e,t,s,i=!1){if(pe.OPP_HEALTH_SEGMENTS_OVERRIDE>1)return pe.OPP_HEALTH_SEGMENTS_OVERRIDE;if(pe.OPP_HEALTH_SEGMENTS_OVERRIDE===1)return 0;if(this.gameMode.isDaily&&this.gameMode.isWaveFinal(e))return 5;let r;if(i||s&&(s.subLegendary||s.legendary||s.mythical)?r=!0:this.executeWithSeedOffset(()=>{r=e%10===0||this.gameMode.hasRandomBosses&&Ae(100)<Math.min(Math.max(Math.ceil((e-250)/50),0)*2,30)},e<<2),!r)return 0;let a=2;return t>=100&&a++,s&&s.baseTotal>=670&&a++,a+=Math.floor(e/250),a}trySpreadPokerus(){const e=this.getPlayerParty(),t=[],s=p((i,r)=>{const a=e[i+r];!a.pokerus&&!Ae(10)&&(a.pokerus=!0,t.push(i+r))},"spread");e.forEach((i,r)=>{!i.pokerus||t.indexOf(r)>-1||this.executeWithSeedOffset(()=>{r&&s(r,-1),r<e.length-1&&s(r,1)},this.currentBattle.waveIndex+(r<<8))})}resetSeed(e){var s;const t=e||((s=this.currentBattle)==null?void 0:s.waveIndex)||0;this.waveSeed=Oo(this.seed,t),wt.Math.RND.sow([this.waveSeed]),console.log("Wave Seed:",this.waveSeed,t),this.rngCounter=0}executeWithSeedOffset(e,t,s){if(!e)return;const i=this.rngCounter,r=this.rngOffset,a=this.rngSeedOverride,o=wt.Math.RND.state();wt.Math.RND.sow([Oo(s||this.seed,t)]),this.rngCounter=0,this.rngOffset=t,this.rngSeedOverride=s||"",e(),wt.Math.RND.state(o),this.rngCounter=i,this.rngOffset=r,this.rngSeedOverride=a}addFieldSprite(e,t,s,i,r=0){const a=this.add.sprite(e,t,s,i);return a.setPipeline(this.fieldSpritePipeline),r&&(a.pipelineData.terrainColorRatio=r),a}addPokemonSprite(e,t,s,i,r,a=!1,o=!1){const l=this.addFieldSprite(t,s,i,r);return this.initPokemonSprite(l,e,a,o),l}initPokemonSprite(e,t,s=!1,i=!1){return e.setPipeline(this.spritePipeline,{tone:[0,0,0,0],hasShadow:s,ignoreOverride:i,teraColor:t?Wl(t.getTeraType()):void 0,isTerastallized:t?t.isTerastallized:!1}),this.spriteSparkleHandler.add(e),e}moveBelowOverlay(e){this.fieldUI.moveBelow(e,this.fieldOverlay)}processInfoButton(e){this.arenaFlyout.toggleFlyout(e)}showFieldOverlay(e){return new Promise(t=>{this.tweens.add({targets:this.fieldOverlay,alpha:.5,ease:"Sine.easeOut",duration:e,onComplete:p(()=>t(),"onComplete")})})}hideFieldOverlay(e){return new Promise(t=>{this.tweens.add({targets:this.fieldOverlay,alpha:0,duration:e,ease:"Cubic.easeIn",onComplete:p(()=>t(),"onComplete")})})}updateShopOverlayOpacity(e){this.shopOverlayOpacity=e,this.shopOverlayShown&&this.shopOverlay.setAlpha(this.shopOverlayOpacity)}showShopOverlay(e){return this.shopOverlayShown=!0,new Promise(t=>{this.tweens.add({targets:this.shopOverlay,alpha:this.shopOverlayOpacity,ease:"Sine.easeOut",duration:e,onComplete:p(()=>t(),"onComplete")})})}hideShopOverlay(e){return this.shopOverlayShown=!1,new Promise(t=>{this.tweens.add({targets:this.shopOverlay,alpha:0,duration:e,ease:"Cubic.easeIn",onComplete:p(()=>t(),"onComplete")})})}showEnemyModifierBar(){this.enemyModifierBar.setVisible(!0)}hideEnemyModifierBar(){this.enemyModifierBar.setVisible(!1)}updateBiomeWaveText(){const e=!(this.currentBattle.waveIndex%10),t=zo(this.arena.biomeType);this.fieldUI.moveAbove(this.biomeWaveText,this.luckText),this.biomeWaveText.setText(t+" - "+this.currentBattle.waveIndex.toString()),this.biomeWaveText.setColor(e?"#f89890":"#ffffff"),this.biomeWaveText.setShadowColor(e?"#984038":"#636363"),this.biomeWaveText.setVisible(!0)}updateMoneyText(e=!0){if(this.money===void 0)return;const t=Ih(this.moneyFormat,this.money);this.moneyText.setText(S.t("battleScene:moneyOwned",{formattedMoney:t})),this.fieldUI.moveAbove(this.moneyText,this.luckText),e&&this.moneyText.setVisible(!0)}animateMoneyChanged(e){if(this.tweens.getTweensOf(this.moneyText).length>0)return;const t=this.moneyText.scale*.14*(e?1:-1);this.moneyText.setShadowColor(e?"#008000":"#FF0000"),this.tweens.add({targets:this.moneyText,duration:250,scale:this.moneyText.scale+t,loop:0,yoyo:!0,onComplete:p(s=>this.moneyText.setShadowColor(At(x.MONEY,!0)),"onComplete")})}updateScoreText(){this.scoreText.setText(`Score: ${this.score.toString()}`),this.scoreText.setVisible(this.gameMode.isDaily)}updateAndShowText(e){const t=[this.luckLabelText,this.luckText];for(const i of t)i.setAlpha(0);const s=jo(this.getPlayerParty());this.luckText.setText(jd(s)),s<14?this.luckText.setTint(Xd(s)):this.luckText.setTint(16772956,4718441,7039999,16738665),this.luckLabelText.setX(this.game.canvas.width/6-2-(this.luckText.displayWidth+2)),this.tweens.add({targets:t,duration:e,alpha:1,onComplete:p(()=>{for(const i of t)i.setVisible(!0)},"onComplete")})}hideLuckText(e){if(this.reroll)return;const t=[this.luckLabelText,this.luckText];this.tweens.add({targets:t,duration:e,alpha:0,onComplete:p(()=>{for(const s of t)s.setVisible(!1)},"onComplete")})}updateUIPositions(){var i;const e=this.enemyModifiers.filter(r=>r.isIconVisible()).length,t=this.biomeWaveText.getBottomLeft().y-this.biomeWaveText.getTopLeft().y;this.biomeWaveText.setY(-(this.game.canvas.height/6)+(e?e<=12?15:24:0)+t/2),this.moneyText.setY(this.biomeWaveText.y+10),this.scoreText.setY(this.moneyText.y+10),[this.luckLabelText,this.luckText].map(r=>r.setY((this.scoreText.visible?this.scoreText:this.moneyText).y+10));const s=(this.scoreText.visible?this.scoreText:this.moneyText).y+15;this.partyExpBar.setY(s),this.candyBar.setY(s+15),(i=this.ui)==null||i.achvBar.setY(this.game.canvas.height/6+s)}sendTextToBack(){this.fieldUI.sendToBack(this.biomeWaveText),this.fieldUI.sendToBack(this.moneyText),this.fieldUI.sendToBack(this.scoreText)}addFaintedEnemyScore(e){let t=e.getSpeciesForm().getBaseExp()*(e.level/this.getMaxExpLevel())*(e.ivs.reduce((s,i)=>i+=s,0)/93*.2+.8);this.findModifiers(s=>s instanceof $t&&s.pokemonId===e.id,!1).map(s=>t*=s.getScoreMultiplier()),e.isBoss()&&(t*=Math.sqrt(e.bossSegments)),this.currentBattle.battleScore+=Math.ceil(t)}getMaxExpLevel(e=!1){var r;if(pe.LEVEL_CAP_OVERRIDE>0)return pe.LEVEL_CAP_OVERRIDE;if(e||pe.LEVEL_CAP_OVERRIDE<0)return Number.MAX_SAFE_INTEGER;const t=Math.ceil((((r=this.currentBattle)==null?void 0:r.waveIndex)||1)/10)*10,s=this.gameMode.getWaveForDifficulty(t),i=(1+s/2+Math.pow(s/25,2))*1.2;return Math.ceil(i/2)*2+2}randomSpecies(e,t,s,i,r){if(s)return this.arena.randomSpecies(e,t,void 0,jo(this.party));const a=i?[...new Set(Re.filter(o=>o.isCatchable()).filter(i).map(o=>{if(!r)for(;It.hasOwnProperty(o.speciesId);)o=hs(It[o.speciesId]);return o}))]:Re.filter(o=>o.isCatchable());return a[Ae(a.length)]}generateRandomBiome(e){const t=e%250,s=Ss(Ue).filter(h=>h!==Ue.TOWN&&h!==Ue.END),i=Ji[Ue.END][0]-2,r=new Array(i+1).fill(null).map((h,c)=>(1-Math.min(Math.abs(c/(i-1)-t/250)+.25,1))/.75*250),a=[];let o=0;for(const h of s)o+=Math.ceil(r[Ji[h][0]-1]/Ji[h][1]),a.push(o);const l=Ae(o);for(let h=0;h<s.length;h++)if(l<a[h])return s[h];return s[Ae(s.length)]}isBgmPlaying(){var e;return((e=this.bgm)==null?void 0:e.isPlaying)??!1}playBgm(e,t){var a,o;if(e===void 0&&(e=((a=this.currentBattle)==null?void 0:a.getBgmOverride())||((o=this.arena)==null?void 0:o.bgm)),e=li.getEventBgmReplacement(e),this.bgm&&e===this.bgm.key){this.bgm.isPlaying||this.bgm.play({volume:this.masterVolume*this.bgmVolume});return}t&&!this.bgm&&(t=!1),this.bgmCache.add(e),this.loadBgm(e);let s=0;s=e===this.arena.bgm?this.arena.getBgmLoopPoint():this.getBgmLoopPoint(e);let i=!1;const r=p(()=>{if(this.ui.bgmBar.setBgmToBgmBar(e),e===null&&this.bgm&&!this.bgm.pendingRemove){this.bgm.play({volume:this.masterVolume*this.bgmVolume});return}this.bgm&&!this.bgm.pendingRemove&&this.bgm.isPlaying&&this.bgm.stop(),this.bgm=this.sound.add(e,{loop:!0}),this.bgm.play({volume:this.masterVolume*this.bgmVolume}),s&&this.bgm.on("looped",()=>this.bgm.play({seek:s}))},"playNewBgm");if(this.load.once(wt.Loader.Events.COMPLETE,()=>{i=!0,(!t||!this.bgm.isPlaying)&&r()}),t){const l=p(()=>{i&&(!this.bgm.isPlaying||this.bgm.pendingRemove)&&r()},"onBgmFaded");this.time.delayedCall(this.fadeOutBgm(500,!0)?750:250,l)}this.load.isLoading()||this.load.start()}pauseBgm(){return this.bgm&&!this.bgm.pendingRemove&&this.bgm.isPlaying?(this.bgm.pause(),!0):!1}resumeBgm(){return this.bgm&&!this.bgm.pendingRemove&&this.bgm.isPaused?(this.bgm.resume(),!0):!1}updateSoundVolume(){if(this.sound)for(const e of this.sound.getAllPlaying())if(this.bgmCache.has(e.key))e.setVolume(this.masterVolume*this.bgmVolume);else{const t=e.key.split("/");switch(t[0]){case"battle_anims":case"cry":t[1].startsWith("PRSFX- ")?e.setVolume(this.masterVolume*this.fieldVolume*.5):e.setVolume(this.masterVolume*this.fieldVolume);break;case"se":case"ui":e.setVolume(this.masterVolume*this.seVolume)}}}fadeOutBgm(e=500,t=!0){return this.bgm&&this.sound.getAllPlaying().find(i=>i.key===this.bgm.key)?(Ts.fadeOut(this,this.bgm,e,t),!0):!1}fadeAndSwitchBgm(e,t=!1,s=2e3){this.fadeOutBgm(s,t),this.time.delayedCall(s,()=>{this.playBgm(e)})}playSound(e,t){const s=typeof e=="string"?e:e.key;t=t??{};try{const i=s.split("/");switch(t.volume=t.volume??1,i[0]){case"level_up_fanfare":case"item_fanfare":case"minor_fanfare":case"heal":case"evolution":case"evolution_fanfare":t.volume*=this.masterVolume*this.bgmVolume;break;case"battle_anims":case"cry":t.volume*=this.masterVolume*this.fieldVolume,i[1].startsWith("PRSFX- ")&&(t.volume*=.5);break;case"ui":t.volume*=this.masterVolume*this.uiVolume;break;case"se":t.volume*=this.masterVolume*this.seVolume;break}return this.sound.play(s,t),this.sound.get(s)}catch{return console.log(`${s} not found`),e}}playSoundWithoutBgm(e,t){this.bgmCache.add(e);const s=this.pauseBgm();this.playSound(e);const i=this.sound.get(e);return this.bgmResumeTimer&&this.bgmResumeTimer.destroy(),s&&(this.bgmResumeTimer=this.time.delayedCall(t||ye(i.totalDuration*1e3),()=>{this.resumeBgm(),this.bgmResumeTimer=null})),i}getBgmLoopPoint(e){switch(e){case"title":return 46.5;case"battle_kanto_champion":return 13.95;case"battle_johto_champion":return 23.498;case"battle_hoenn_champion_g5":return 11.328;case"battle_hoenn_champion_g6":return 11.762;case"battle_sinnoh_champion":return 12.235;case"battle_champion_alder":return 27.653;case"battle_champion_iris":return 10.145;case"battle_kalos_champion":return 10.38;case"battle_champion_kukui":return 15.784;case"battle_alola_champion":return 13.025;case"battle_galar_champion":return 61.635;case"battle_mustard":return 22.442;case"battle_champion_geeta":return 37.447;case"battle_champion_nemona":return 14.914;case"battle_champion_kieran":return 7.206;case"battle_hoenn_elite":return 11.35;case"battle_unova_elite":return 17.73;case"battle_kalos_elite":return 12.34;case"battle_alola_elite":return 19.212;case"battle_galar_elite":return 164.069;case"battle_paldea_elite":return 12.77;case"battle_bb_elite":return 19.434;case"battle_final_encounter":return 19.159;case"battle_final":return 16.453;case"battle_kanto_gym":return 13.857;case"battle_johto_gym":return 12.911;case"battle_hoenn_gym":return 12.379;case"battle_sinnoh_gym":return 13.122;case"battle_unova_gym":return 19.145;case"battle_kalos_gym":return 44.81;case"battle_galar_gym":return 171.262;case"battle_paldea_gym":return 127.489;case"battle_legendary_kanto":return 32.966;case"battle_legendary_raikou":return 12.632;case"battle_legendary_entei":return 2.905;case"battle_legendary_suicune":return 12.636;case"battle_legendary_lugia":return 19.77;case"battle_legendary_ho_oh":return 17.668;case"battle_legendary_regis_g5":return 49.5;case"battle_legendary_regis_g6":return 21.13;case"battle_legendary_gro_kyo":return 10.547;case"battle_legendary_rayquaza":return 10.495;case"battle_legendary_deoxys":return 13.333;case"battle_legendary_lake_trio":return 16.887;case"battle_legendary_sinnoh":return 22.77;case"battle_legendary_dia_pal":return 16.009;case"battle_legendary_origin_forme":return 18.961;case"battle_legendary_giratina":return 10.451;case"battle_legendary_arceus":return 9.595;case"battle_legendary_unova":return 13.855;case"battle_legendary_kyurem":return 18.314;case"battle_legendary_res_zek":return 18.329;case"battle_legendary_xern_yvel":return 26.468;case"battle_legendary_tapu":return 0;case"battle_legendary_sol_lun":return 6.525;case"battle_legendary_ub":return 9.818;case"battle_legendary_dusk_dawn":return 5.211;case"battle_legendary_ultra_nec":return 10.344;case"battle_legendary_zac_zam":return 11.424;case"battle_legendary_glas_spec":return 12.503;case"battle_legendary_calyrex":return 50.641;case"battle_legendary_riders":return 18.155;case"battle_legendary_birds_galar":return .175;case"battle_legendary_ruinous":return 6.333;case"battle_legendary_kor_mir":return 6.442;case"battle_legendary_loyal_three":return 6.5;case"battle_legendary_ogerpon":return 14.335;case"battle_legendary_terapagos":return 24.377;case"battle_legendary_pecharunt":return 6.508;case"battle_rival":return 14.11;case"battle_rival_2":return 17.714;case"battle_rival_3":return 17.586;case"battle_trainer":return 13.686;case"battle_wild":return 12.703;case"battle_wild_strong":return 13.94;case"end_summit":return 30.025;case"battle_rocket_grunt":return 12.707;case"battle_aqua_magma_grunt":return 12.062;case"battle_galactic_grunt":return 13.043;case"battle_plasma_grunt":return 14.758;case"battle_flare_grunt":return 4.228;case"battle_aether_grunt":return 16;case"battle_skull_grunt":return 20.87;case"battle_macro_grunt":return 11.56;case"battle_star_grunt":return 133.362;case"battle_galactic_admin":return 11.997;case"battle_colress":return 12.234;case"battle_skull_admin":return 15.463;case"battle_oleana":return 14.11;case"battle_star_admin":return 9.493;case"battle_rocket_boss":return 9.115;case"battle_aqua_magma_boss":return 14.847;case"battle_galactic_boss":return 106.962;case"battle_plasma_boss":return 25.624;case"battle_flare_boss":return 8.085;case"battle_aether_boss":return 11.33;case"battle_skull_boss":return 13.13;case"battle_macro_boss":return 11.42;case"battle_star_boss":return 25.764;case"mystery_encounter_gen_5_gts":return 8.52;case"mystery_encounter_gen_6_gts":return 9.24;case"mystery_encounter_fun_and_games":return 4.78;case"mystery_encounter_weird_dream":return 41.42;case"mystery_encounter_delibirdy":return 82.28;case"title_afd":return 47.66;case"battle_rival_3_afd":return 49.147}return 0}toggleInvert(e){e?this.cameras.main.setPostPipeline(Eh):this.cameras.main.removePostPipeline("InvertPostFX")}getCurrentPhase(){return this.currentPhase}getStandbyPhase(){return this.standbyPhase}pushConditionalPhase(e,t){this.conditionalQueue.push([t,e])}pushPhase(e,t=!1){(t?this.nextCommandPhaseQueue:this.phaseQueue).push(e)}unshiftPhase(...e){this.phaseQueuePrependSpliceIndex===-1?this.phaseQueuePrepend.push(...e):this.phaseQueuePrepend.splice(this.phaseQueuePrependSpliceIndex,0,...e)}clearPhaseQueue(){this.phaseQueue.splice(0,this.phaseQueue.length)}clearAllPhases(){for(const e of[this.phaseQueue,this.phaseQueuePrepend,this.conditionalQueue,this.nextCommandPhaseQueue])e.splice(0,e.length);this.currentPhase=null,this.standbyPhase=null,this.clearPhaseQueueSplice()}setPhaseQueueSplice(){this.phaseQueuePrependSpliceIndex=this.phaseQueuePrepend.length}clearPhaseQueueSplice(){this.phaseQueuePrependSpliceIndex=-1}shiftPhase(){var e;if(this.standbyPhase){this.currentPhase=this.standbyPhase,this.standbyPhase=null;return}if(this.phaseQueuePrependSpliceIndex>-1&&this.clearPhaseQueueSplice(),this.phaseQueuePrepend.length)for(;this.phaseQueuePrepend.length;){const t=this.phaseQueuePrepend.pop();t&&this.phaseQueue.unshift(t)}if(this.phaseQueue.length||(this.populatePhaseQueue(),this.conditionalQueue=[]),this.currentPhase=this.phaseQueue.shift()??null,(e=this.conditionalQueue)!=null&&e.length){const t=this.conditionalQueue.shift();t!=null&&t[0]()?this.pushPhase(t[1]):t?this.conditionalQueue.unshift(t):console.warn("condition phase is undefined/null!",t)}this.currentPhase&&(console.log(`%cStart Phase ${this.currentPhase.constructor.name}`,"color:green;"),this.currentPhase.start())}overridePhase(e){return this.standbyPhase?!1:(this.standbyPhase=this.currentPhase,this.currentPhase=e,console.log(`%cStart Phase ${e.constructor.name}`,"color:green;"),e.start(),!0)}findPhase(e){return this.phaseQueue.find(e)}tryReplacePhase(e,t){const s=this.phaseQueue.findIndex(e);return s>-1?(this.phaseQueue[s]=t,!0):!1}tryRemovePhase(e){const t=this.phaseQueue.findIndex(e);return t>-1?(this.phaseQueue.splice(t,1),!0):!1}tryRemoveUnshiftedPhase(e){const t=this.phaseQueuePrepend.findIndex(e);return t>-1?(this.phaseQueuePrepend.splice(t,1),!0):!1}prependToPhase(e,t){Array.isArray(e)||(e=[e]);const s=this.phaseQueue.findIndex(i=>i instanceof t);return s!==-1?(this.phaseQueue.splice(s,0,...e),!0):(this.unshiftPhase(...e),!1)}appendToPhase(e,t){Array.isArray(e)||(e=[e]);const s=this.phaseQueue.findIndex(i=>i instanceof t);return s!==-1&&this.phaseQueue.length>s?(this.phaseQueue.splice(s+1,0,...e),!0):(this.unshiftPhase(...e),!1)}queueMessage(e,t,s,i,r){const a=new $d(e,t,s,i);r?this.pushPhase(a):this.unshiftPhase(a)}queueAbilityDisplay(e,t,s){this.unshiftPhase(s?new Zd(e.getBattlerIndex(),t):new Xo),this.clearPhaseQueueSplice()}hideAbilityBar(){this.abilityBar.isVisible()&&this.unshiftPhase(new Xo)}populatePhaseQueue(){this.nextCommandPhaseQueue.length&&(this.phaseQueue.push(...this.nextCommandPhaseQueue),this.nextCommandPhaseQueue.splice(0,this.nextCommandPhaseQueue.length)),this.phaseQueue.push(new Rr)}addMoney(e){this.money=Math.min(this.money+e,Number.MAX_SAFE_INTEGER),this.updateMoneyText(),this.animateMoneyChanged(!0),this.validateAchvs(qd)}getWaveMoneyAmount(e){const t=this.currentBattle.waveIndex,s=Math.ceil(t/10)-1,i=Math.pow((s+1+(.75+((t-1)%10+1)/10))*100,1+.005*s)*e;return Math.floor(i/10)*10}addModifier(e,t,s,i,r,a){if(!e||!e.type)return!1;let o=!1;const l=e.type.soundName;this.validateAchvs(Qd,e);const h=[];if(e instanceof en){if(e.add(this.modifiers,!!i)){if(e instanceof Qs){const c=this.getPokemonById(e.pokemonId);c&&(o=e.apply(c,!0))}s&&!this.sound.get(l)&&this.playSound(l)}else if(!i){const c=Jd(e.type.tier);return this.queueMessage(S.t("battle:itemStackFull",{fullItemName:e.type.name,itemName:c.name}),void 0,!1,3e3),this.addModifier(c.newModifier(),t,s,!1,r)}for(const c of h)this.removeModifier(c);!t&&!i&&this.updateModifiers(!0,r)}else if(e instanceof eu)if(s&&!this.sound.get(l)&&this.playSound(l),e instanceof tu){for(const c in this.party){const d=this.party[c],f=[];if(e instanceof su)if(e.fainted)f.push(1);else{const u=new Jt(1);this.applyModifiers(iu,!0,u),f.push(u.value)}else e instanceof nu?f.push(this.getPokemonById(e.fusePokemonId)):e instanceof ru&&!ve(a)&&f.push(a);if(e.shouldApply(d,...f)){const u=e.apply(d,...f);o||(o=u)}}this.party.map(c=>c.updateInfo(r))}else{const c=[this];if(e.shouldApply(...c)){const d=e.apply(...c);o||(o=d)}}return o}addEnemyModifier(e,t,s){return new Promise(i=>{const r=[];if(e.add(this.enemyModifiers,!1)){if(e instanceof Qs){const a=this.getPokemonById(e.pokemonId);a&&e.apply(a,!0)}for(const a of r)this.removeModifier(a,!0)}t||this.updateModifiers(!1,s),i()})}tryTransferHeldItemModifier(e,t,s,i=1,r,a,o=!0){const l=e.pokemonId?e.getPokemon():null,h=new ft(!1);if(l&&l.isPlayer()!==t.isPlayer()&&nt(Jo,l,h),h.value)return!1;const c=e.clone();c.pokemonId=t.id;const d=this.findModifier(u=>u instanceof $t&&u.matchType(e)&&u.pokemonId===t.id,t.isPlayer());if(d){const u=d.getMaxStackCount();if(d.stackCount>=u)return!1;const C=Math.min(i,e.stackCount,u-d.stackCount);e.stackCount-=C,c.stackCount=d.stackCount+C}else{const u=Math.min(i,e.stackCount);e.stackCount-=u,c.stackCount=u}if(!(e.stackCount===0)||!l||this.removeModifier(e,!l.isPlayer())){const u=p(()=>!d||this.removeModifier(d,!t.isPlayer())?t.isPlayer()?(this.addModifier(c,a,s,!1,r),l&&o&&qo(Qo,l,!1),!0):(this.addEnemyModifier(c,a,r),l&&o&&qo(Qo,l,!1),!0):!1,"addModifier");return l&&l.isPlayer()!==t.isPlayer()&&!a&&this.updateModifiers(l.isPlayer(),r),u(),!0}return!1}canTransferHeldItemModifier(e,t,s=1){const i=e.clone(),r=i.pokemonId?i.getPokemon():null,a=new ft(!1);if(r&&r.isPlayer()!==t.isPlayer()&&nt(Jo,r,a),a.value)return!1;const o=this.findModifier(h=>h instanceof $t&&h.matchType(i)&&h.pokemonId===t.id,t.isPlayer());if(o){const h=o.getMaxStackCount();if(o.stackCount>=h)return!1;const c=Math.min(s,i.stackCount,h-o.stackCount);i.stackCount-=c}else{const h=Math.min(s,i.stackCount);i.stackCount-=h}return!(i.stackCount===0)||!r||this.hasModifier(e,!r.isPlayer())}removePartyMemberModifiers(e){return new Promise(t=>{const s=this.getPlayerParty()[e].id,i=this.modifiers.filter(r=>r instanceof $t&&r.pokemonId===s);for(const r of i)this.modifiers.splice(this.modifiers.indexOf(r),1);this.updateModifiers(),t()})}generateEnemyModifiers(e){return new Promise(t=>{if(this.currentBattle.battleSpec===hi.FINAL_BOSS)return t();const s=this.gameMode.getWaveForDifficulty(this.currentBattle.waveIndex),i=this.gameMode.isWaveFinal(this.currentBattle.waveIndex);let r=Math.ceil(s/10);i&&(r=Math.ceil(r*2.5));const a=this.getEnemyParty();if(this.currentBattle.trainer){const o=this.currentBattle.trainer.genModifiers(a);for(const l of o)this.addEnemyModifier(l,!0,!0)}a.forEach((o,l)=>{var h;if(e&&l<e.length&&e[l])for(const c of e[l]){let d;c.modifier instanceof au?d=c.modifier.newModifier(o):(d=c.modifier,d.pokemonId=o.id),d.stackCount=c.stackCount??1,d.isTransferable=c.isTransferable??d.isTransferable,this.addEnemyModifier(d,!0)}else{const c=o.isBoss()||this.currentBattle.battleType===Pe.TRAINER&&!!((h=this.currentBattle.trainer)!=null&&h.config.isBoss);let d=32;c&&(d/=2),i&&(d/=8);let f=0;for(let u=0;u<r;u++)Ae(this.gameMode.getEnemyModifierChance(c))||f++;c&&(f=Math.max(f,Math.floor(r/2))),ou(s,f,[o],this.currentBattle.battleType===Pe.TRAINER?tn.TRAINER:tn.WILD,d).map(u=>u.newModifier(o).add(this.enemyModifiers,!1))}return!0}),this.updateModifiers(!1),t()})}clearEnemyModifiers(){const e=this.enemyModifiers.filter(t=>t instanceof en);for(const t of e)this.enemyModifiers.splice(this.enemyModifiers.indexOf(t),1);this.updateModifiers(!1),this.updateUIPositions()}clearEnemyHeldItemModifiers(e){const t=this.enemyModifiers.filter(s=>s instanceof $t&&(!e||s.getPokemon()===e));for(const s of t)this.enemyModifiers.splice(this.enemyModifiers.indexOf(s),1);this.updateModifiers(!1),this.updateUIPositions()}setModifiersVisible(e){[this.modifierBar,this.enemyModifierBar].map(t=>t.setVisible(e))}updateModifiers(e=!0,t){const s=e?this.modifiers:this.enemyModifiers;for(let r=0;r<s.length;r++){const a=s[r];a instanceof $t&&!this.getPokemonById(a.pokemonId)&&s.splice(r--,1)}for(const r of s)r instanceof en&&(r.virtualStackCount=0);const i=s.slice(0);for(const r of i)r.getStackCount()||s.splice(s.indexOf(r),1);this.updatePartyForModifiers(e?this.getPlayerParty():this.getEnemyParty(),t),(e?this.modifierBar:this.enemyModifierBar).updateModifiers(s),e||this.updateUIPositions()}updatePartyForModifiers(e,t){return new Promise(s=>{Promise.allSettled(e.map(i=>(i.calculateStats(),i.updateInfo(t)))).then(()=>s())})}hasModifier(e,t=!1){return(t?this.enemyModifiers:this.modifiers).indexOf(e)>-1}removeModifier(e,t=!1){const s=t?this.enemyModifiers:this.modifiers,i=s.indexOf(e);if(i>-1){if(s.splice(i,1),e instanceof Qs){const r=this.getPokemonById(e.pokemonId);r&&e.apply(r,!1)}return!0}return!1}getModifiers(e,t=!0){return(t?this.modifiers:this.enemyModifiers).filter(s=>s instanceof e)}findModifiers(e,t=!0){return(t?this.modifiers:this.enemyModifiers).filter(e)}findModifier(e,t=!0){return(t?this.modifiers:this.enemyModifiers).find(e)}applyShuffledModifiers(e,t=!0,...s){let i=(t?this.modifiers:this.enemyModifiers).filter(r=>r instanceof e&&r.shouldApply(...s));return this.executeWithSeedOffset(()=>{const r=p(a=>{if(a.length<1)return a;const o=Ae(a.length);return[a[o],...r(a.filter((l,h)=>h!==o))]},"shuffleModifiers");i=r(i)},this.currentBattle.turn<<4,this.waveSeed),this.applyModifiersInternal(i,t,s)}applyModifiers(e,t=!0,...s){const i=(t?this.modifiers:this.enemyModifiers).filter(r=>r instanceof e&&r.shouldApply(...s));return this.applyModifiersInternal(i,t,s)}applyModifiersInternal(e,t,s){const i=[];for(const r of e)r.apply(...s)&&(console.log("Applied",r.type.name,t?"":"(enemy)"),i.push(r));return i}applyModifier(e,t=!0,...s){const i=(t?this.modifiers:this.enemyModifiers).filter(r=>r instanceof e&&r.shouldApply(...s));for(const r of i)if(r.apply(...s))return console.log("Applied",r.type.name,t?"":"(enemy)"),r;return null}triggerPokemonFormChange(e,t,s=!1,i=!1){if(Ms.hasOwnProperty(e.species.speciesId)){const r=Ms[e.species.speciesId].filter(o=>o.findTrigger(t)&&o.canChange(e));let a;if(e.species.speciesId===ge.NECROZMA&&r.length>1){const o=this.findModifiers(l=>l instanceof Qs&&l.pokemonId===e.id).filter(l=>l.active).map(l=>l.formChangeItem);a=o.includes($o.N_LUNARIZER)?r[0]:o.includes($o.N_SOLARIZER)?r[1]:null}else a=r[0];if(a){let o;return e instanceof Zs&&!a.quiet?o=new cr(e,a,i):o=new xr(e,a),e instanceof Zs&&!a.quiet&&i?this.overridePhase(o):s?this.pushPhase(o):this.unshiftPhase(o),!0}}return!1}triggerPokemonBattleAnim(e,t,s,i=!1){const r=new Er(t,e,s);return i?this.pushPhase(r):this.unshiftPhase(r),!0}validateAchvs(e,...t){const s=Object.values(Ge).filter(i=>i instanceof e);for(const i of s)this.validateAchv(i,t)}validateAchv(e,t){return(!this.gameData.achvUnlocks.hasOwnProperty(e.id)||pe.ACHIEVEMENTS_REUNLOCK_OVERRIDE)&&e.validate(t)?(this.gameData.achvUnlocks[e.id]=new Date().getTime(),this.ui.achvBar.showAchv(e),Vt.hasOwnProperty(e.id)&&this.validateVoucher(Vt[e.id]),!0):!1}validateVoucher(e,t){return!this.gameData.voucherUnlocks.hasOwnProperty(e.id)&&e.validate(t)?(this.gameData.voucherUnlocks[e.id]=new Date().getTime(),this.ui.achvBar.showAchv(e),this.gameData.voucherCounts[e.voucherType]++,!0):!1}updateGameInfo(){var t,s;const e={playTime:this.sessionPlayTime??0,gameMode:this.currentBattle?this.gameMode.getName():"Title",biome:this.currentBattle?zo(this.arena.biomeType):"",wave:((t=this.currentBattle)==null?void 0:t.waveIndex)??0,party:this.party?this.party.map(i=>{var r;return{name:i.name,form:i.getFormKey(),types:i.getTypes().map(a=>Te[a]),teraType:Te[i.getTeraType()],isTerastallized:i.isTerastallized,level:i.level,currentHP:i.hp,maxHP:i.getMaxHp(),status:(r=i.status)!=null&&r.effect?yi[i.status.effect]:""}}):[],modeChain:((s=this.ui)==null?void 0:s.getModeChain())??[]};window.gameInfo=e}getActiveKeys(){const e=[];let t=this.getPlayerParty();t=t.concat(this.getEnemyParty());for(const s of t)e.push(s.getSpriteKey(!0)),s instanceof Zs&&e.push(s.getBattleSpriteKey(!0,!0)),e.push(s.species.getCryKey(s.formIndex)),s.fusionSpecies&&e.push(s.fusionSpecies.getCryKey(s.fusionFormIndex));return e}initFinalBossPhaseTwo(e){if(e instanceof vn&&e.isBoss()&&!e.formIndex&&e.bossSegmentIndex<1){this.fadeOutBgm(ye(2e3),!1),this.ui.showDialogue(lu[hi.FINAL_BOSS].firstStageWin,e.species.name,void 0,()=>{const t=hu(vu.MINI_BLACK_HOLE).newModifier(e);t.setTransferrableFalse(),this.addEnemyModifier(t,!1,!0),e.generateAndPopulateMoveset(1),this.setFieldScale(.75),this.triggerPokemonFormChange(e,cu,!1),this.currentBattle.double=!0;const s=this.getPlayerParty().filter(i=>i.isAllowedInBattle());s.length>1&&(this.pushPhase(new Xl(!0)),s[1].isOnField()||this.pushPhase(new du(1))),this.shiftPhase()});return}this.shiftPhase()}applyPartyExp(e,t,s,i){var u;const r=i??this.currentBattle.playerParticipantIds,a=this.getPlayerParty(),o=this.findModifier(C=>C instanceof uu),l=this.findModifier(C=>C instanceof pu),h=this.findModifier(C=>C instanceof fu),c=a.filter(C=>C.hp),d=c.filter(C=>C.level<this.getMaxExpLevel()),f=[];if(s&&(e=Math.floor(e*this.currentBattle.waveIndex/5+1)),r.size>0){this.currentBattle.battleType===Pe.TRAINER||((u=this.currentBattle.mysteryEncounter)==null?void 0:u.encounterMode)===gu.TRAINER_BATTLE?e=Math.floor(e*1.5):this.currentBattle.isBattleMysteryEncounter()&&this.currentBattle.mysteryEncounter&&(e=Math.floor(e*this.currentBattle.mysteryEncounter.expMultiplier));for(const C of c){const g=C.id,v=r.has(g);if(v&&t){C.addFriendship(mu);const E=C.getHeldItems().find(w=>w instanceof yu);E&&E.stackCount<E.getMaxStackCount()&&(E.stackCount++,this.updateModifiers(!0,!0),C.updateInfo())}if(!d.includes(C))continue;if(!v&&!o){f.push(0);continue}let m=0;v?(m+=1/r.size,r.size>1&&h&&(m+=h.getStackCount()*.2)):o&&(m+=o.getStackCount()*.2/r.size),C.pokerus&&(m*=1.5),pe.XP_MULTIPLIER_OVERRIDE!==null&&(m=pe.XP_MULTIPLIER_OVERRIDE);const b=new Jt(e*m);this.applyModifiers(Cu,!0,C,b),f.push(Math.floor(b.value))}if(l){let C=0,g=0;d.forEach((E,w)=>{g+=f[w],C+=E.level});const v=Math.floor(C/d.length),m=[];d.forEach((E,w)=>{E.level<=v&&m.push(w)});const b=Math.floor(g/m.length);d.forEach((E,w)=>{f[w]=wt.Math.Linear(f[w],m.indexOf(w)>-1?b:0,.2*l.getStackCount())})}for(let C=0;C<d.length;C++){const g=f[C];if(g){const v=a.indexOf(d[C]);this.unshiftPhase(d[C].isOnField()?new Nr(v,g):new Vr(v,g))}}}}isMysteryEncounterValidForWave(e,t){const[s,i]=this.gameMode.getMysteryEncounterLegalWaves();return this.gameMode.hasMysteryEncounters&&e===Pe.WILD&&!this.gameMode.isBoss(t)&&t<i&&t>s}isWaveMysteryEncounter(e,t){const[s,i]=this.gameMode.getMysteryEncounterLegalWaves();if(this.isMysteryEncounterValidForWave(e,t)){const r=this.mysteryEncounterSaveData.encounterSpawnChance,a=this.mysteryEncounterSaveData.encounteredEvents,l=Su/(i-s)*(t-s)-a.length,h=r+Math.min(l*Iu,sn/2),c=ve(pe.MYSTERY_ENCOUNTER_RATE_OVERRIDE)?h:pe.MYSTERY_ENCOUNTER_RATE_OVERRIDE;if(a.length===0||t-a[a.length-1].waveIndex>3||!ve(pe.MYSTERY_ENCOUNTER_RATE_OVERRIDE)){let f=sn;return this.executeWithSeedOffset(()=>{f=Ae(sn)},t*3*1e3),f<c}}return!1}getMysteryEncounter(e,t){var g,v;let s;if(!ve(pe.MYSTERY_ENCOUNTER_OVERRIDE)&&Bt.hasOwnProperty(pe.MYSTERY_ENCOUNTER_OVERRIDE)){if(s=Bt[pe.MYSTERY_ENCOUNTER_OVERRIDE],t)return s}else{if(t)return s=Bt[e??-1],s;s=ve(e)?null:Bt[e]}if(!s&&((g=this.mysteryEncounterSaveData)!=null&&g.queuedEncounters)&&this.mysteryEncounterSaveData.queuedEncounters.length>0){let m=0;for(;m<this.mysteryEncounterSaveData.queuedEncounters.length&&s;){const b=this.mysteryEncounterSaveData.queuedEncounters[m],E=b.spawnPercent;Ae(100)<E&&(s=Bt[b.type]),m++}}if(s)return s=new Zo(s),s.populateDialogueTokensFromRequirements(),s;const i=[Ve.COMMON,Ve.GREAT,Ve.ULTRA,Ve.ROGUE];for(const m of this.mysteryEncounterSaveData.encounteredEvents)m.tier===Ve.COMMON?i[0]=i[0]-6:m.tier===Ve.GREAT&&(i[1]=i[1]-4);const r=i.reduce((m,b)=>m+b),a=Ae(r),o=r-i[0],l=r-i[0]-i[1],h=r-i[0]-i[1]-i[2];let c=a>o?Ve.COMMON:a>l?Ve.GREAT:a>h?Ve.ULTRA:Ve.ROGUE;ve(pe.MYSTERY_ENCOUNTER_TIER_OVERRIDE)||(c=pe.MYSTERY_ENCOUNTER_TIER_OVERRIDE);let d=[];const f=this.mysteryEncounterSaveData.encounteredEvents.length>0?this.mysteryEncounterSaveData.encounteredEvents[this.mysteryEncounterSaveData.encounteredEvents.length-1].type:null,u=this.eventManager.getEventMysteryEncountersDisabled(),C=((v=bu.get(this.arena.biomeType))==null?void 0:v.filter(m=>!u.includes(m)))??[];for(;d.length===0&&c!==null;)d=C.filter(m=>{const b=Bt[m];if(!b||this.eventManager.getMysteryEncounterTierForEvent(m,b.encounterTier)!==c)return!1;const E=b.disallowedGameModes;if(E&&E.length>0&&E.includes(this.gameMode.modeId))return!1;if(this.gameMode.modeId===vs.CHALLENGE){const w=b.disallowedChallenges;if(w&&w.length>0&&this.gameMode.challenges.some(_=>w.includes(_.id)))return!1}return!(!b.meetsRequirements()||f!==null&&m===f||this.mysteryEncounterSaveData.encounteredEvents.length>0&&b.maxAllowedEncounters&&b.maxAllowedEncounters>0&&this.mysteryEncounterSaveData.encounteredEvents.filter(w=>w.type===m).length>=b.maxAllowedEncounters)}).map(m=>Bt[m]),c===Ve.ROGUE?c=Ve.ULTRA:c===Ve.ULTRA?c=Ve.GREAT:c===Ve.GREAT?c=Ve.COMMON:c=null;return d.length===0?(console.log("No Mystery Encounters found, falling back to Mysterious Challengers."),Bt[Tu.MYSTERIOUS_CHALLENGERS]):(s=d[Ae(d.length)],s=new Zo(s),s.populateDialogueTokensFromRequirements(),s)}};p(wo,"BattleScene");let bl=wo;export{bl as default};
